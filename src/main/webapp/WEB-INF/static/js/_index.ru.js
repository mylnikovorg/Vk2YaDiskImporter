!function e(t,n,r){function s(i,o){if(!n[i]){if(!t[i]){var c="function"==typeof require&&require;if(!o&&c)return c(i,!0);if(a)return a(i,!0);throw new Error("Cannot find module '"+i+"'")}var l=n[i]={exports:{}};t[i][0].call(l.exports,function(e){var n=t[i][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)s(r[i]);return s}({1:[function(e,t){!function(){"use strict";var e="undefined"!=typeof t&&t.exports,n="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,r=function(){for(var e,t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,s=n.length,a={};s>r;r++)if(e=n[r],e&&e[1]in document){for(r=0,t=e.length;t>r;r++)a[n[0][r]]=e[r];return a}return!1}(),s={request:function(e){var t=r.requestFullscreen;e=e||document.documentElement,/5\.1[\.\d]* Safari/.test(navigator.userAgent)?e[t]():e[t](n&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[r.exitFullscreen]()},toggle:function(e){this.isFullscreen?this.exit():this.request(e)},onchange:function(){},onerror:function(){},raw:r};return r?(Object.defineProperties(s,{isFullscreen:{get:function(){return!!document[r.fullscreenElement]}},element:{enumerable:!0,get:function(){return document[r.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!document[r.fullscreenEnabled]}}}),document.addEventListener(r.fullscreenchange,function(e){s.onchange.call(s,e)}),document.addEventListener(r.fullscreenerror,function(e){s.onerror.call(s,e)}),e?t.exports=s:window.screenfull=s,void 0):(e?t.exports=!1:window.screenfull=!1,void 0)}()},{}],2:[function(e,t,n){!function(){var e=this,r=e._,s={},a=Array.prototype,i=Object.prototype,o=Function.prototype,c=a.push,l=a.slice,d=a.concat,u=i.toString,p=i.hasOwnProperty,f=a.forEach,h=a.map,m=a.reduce,v=a.reduceRight,g=a.filter,y=a.every,b=a.some,_=a.indexOf,k=a.lastIndexOf,w=Array.isArray,x=Object.keys,j=o.bind,S=function(e){return e instanceof S?e:this instanceof S?(this._wrapped=e,void 0):new S(e)};"undefined"!=typeof n?("undefined"!=typeof t&&t.exports&&(n=t.exports=S),n._=S):e._=S,S.VERSION="1.6.0";var A=S.each=S.forEach=function(e,t,n){if(null==e)return e;if(f&&e.forEach===f)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,a=e.length;a>r;r++)if(t.call(n,e[r],r,e)===s)return}else for(var i=S.keys(e),r=0,a=i.length;a>r;r++)if(t.call(n,e[i[r]],i[r],e)===s)return;return e};S.map=S.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(A(e,function(e,s,a){r.push(t.call(n,e,s,a))}),r)};var C="Reduce of empty array with no initial value";S.reduce=S.foldl=S.inject=function(e,t,n,r){var s=arguments.length>2;if(null==e&&(e=[]),m&&e.reduce===m)return r&&(t=S.bind(t,r)),s?e.reduce(t,n):e.reduce(t);if(A(e,function(e,a,i){s?n=t.call(r,n,e,a,i):(n=e,s=!0)}),!s)throw new TypeError(C);return n},S.reduceRight=S.foldr=function(e,t,n,r){var s=arguments.length>2;if(null==e&&(e=[]),v&&e.reduceRight===v)return r&&(t=S.bind(t,r)),s?e.reduceRight(t,n):e.reduceRight(t);var a=e.length;if(a!==+a){var i=S.keys(e);a=i.length}if(A(e,function(o,c,l){c=i?i[--a]:--a,s?n=t.call(r,n,e[c],c,l):(n=e[c],s=!0)}),!s)throw new TypeError(C);return n},S.find=S.detect=function(e,t,n){var r;return D(e,function(e,s,a){return t.call(n,e,s,a)?(r=e,!0):void 0}),r},S.filter=S.select=function(e,t,n){var r=[];return null==e?r:g&&e.filter===g?e.filter(t,n):(A(e,function(e,s,a){t.call(n,e,s,a)&&r.push(e)}),r)},S.reject=function(e,t,n){return S.filter(e,function(e,r,s){return!t.call(n,e,r,s)},n)},S.every=S.all=function(e,t,n){t||(t=S.identity);var r=!0;return null==e?r:y&&e.every===y?e.every(t,n):(A(e,function(e,a,i){return(r=r&&t.call(n,e,a,i))?void 0:s}),!!r)};var D=S.some=S.any=function(e,t,n){t||(t=S.identity);var r=!1;return null==e?r:b&&e.some===b?e.some(t,n):(A(e,function(e,a,i){return r||(r=t.call(n,e,a,i))?s:void 0}),!!r)};S.contains=S.include=function(e,t){return null==e?!1:_&&e.indexOf===_?-1!=e.indexOf(t):D(e,function(e){return e===t})},S.invoke=function(e,t){var n=l.call(arguments,2),r=S.isFunction(t);return S.map(e,function(e){return(r?t:e[t]).apply(e,n)})},S.pluck=function(e,t){return S.map(e,S.property(t))},S.where=function(e,t){return S.filter(e,S.matches(t))},S.findWhere=function(e,t){return S.find(e,S.matches(t))},S.max=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var r=-1/0,s=-1/0;return A(e,function(e,a,i){var o=t?t.call(n,e,a,i):e;o>s&&(r=e,s=o)}),r},S.min=function(e,t,n){if(!t&&S.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var r=1/0,s=1/0;return A(e,function(e,a,i){var o=t?t.call(n,e,a,i):e;s>o&&(r=e,s=o)}),r},S.shuffle=function(e){var t,n=0,r=[];return A(e,function(e){t=S.random(n++),r[n-1]=r[t],r[t]=e}),r},S.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=S.values(e)),e[S.random(e.length-1)]):S.shuffle(e).slice(0,Math.max(0,t))};var M=function(e){return null==e?S.identity:S.isFunction(e)?e:S.property(e)};S.sortBy=function(e,t,n){return t=M(t),S.pluck(S.map(e,function(e,r,s){return{value:e,index:r,criteria:t.call(n,e,r,s)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index-t.index}),"value")};var F=function(e){return function(t,n,r){var s={};return n=M(n),A(t,function(a,i){var o=n.call(r,a,i,t);e(s,o,a)}),s}};S.groupBy=F(function(e,t,n){S.has(e,t)?e[t].push(n):e[t]=[n]}),S.indexBy=F(function(e,t,n){e[t]=n}),S.countBy=F(function(e,t){S.has(e,t)?e[t]++:e[t]=1}),S.sortedIndex=function(e,t,n,r){n=M(n);for(var s=n.call(r,t),a=0,i=e.length;i>a;){var o=a+i>>>1;n.call(r,e[o])<s?a=o+1:i=o}return a},S.toArray=function(e){return e?S.isArray(e)?l.call(e):e.length===+e.length?S.map(e,S.identity):S.values(e):[]},S.size=function(e){return null==e?0:e.length===+e.length?e.length:S.keys(e).length},S.first=S.head=S.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:0>t?[]:l.call(e,0,t)},S.initial=function(e,t,n){return l.call(e,0,e.length-(null==t||n?1:t))},S.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:l.call(e,Math.max(e.length-t,0))},S.rest=S.tail=S.drop=function(e,t,n){return l.call(e,null==t||n?1:t)},S.compact=function(e){return S.filter(e,S.identity)};var I=function(e,t,n){return t&&S.every(e,S.isArray)?d.apply(n,e):(A(e,function(e){S.isArray(e)||S.isArguments(e)?t?c.apply(n,e):I(e,t,n):n.push(e)}),n)};S.flatten=function(e,t){return I(e,t,[])},S.without=function(e){return S.difference(e,l.call(arguments,1))},S.partition=function(e,t){var n=[],r=[];return A(e,function(e){(t(e)?n:r).push(e)}),[n,r]},S.uniq=S.unique=function(e,t,n,r){S.isFunction(t)&&(r=n,n=t,t=!1);var s=n?S.map(e,n,r):e,a=[],i=[];return A(s,function(n,r){(t?r&&i[i.length-1]===n:S.contains(i,n))||(i.push(n),a.push(e[r]))}),a},S.union=function(){return S.uniq(S.flatten(arguments,!0))},S.intersection=function(e){var t=l.call(arguments,1);return S.filter(S.uniq(e),function(e){return S.every(t,function(t){return S.contains(t,e)})})},S.difference=function(e){var t=d.apply(a,l.call(arguments,1));return S.filter(e,function(e){return!S.contains(t,e)})},S.zip=function(){for(var e=S.max(S.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=S.pluck(arguments,""+n);return t},S.object=function(e,t){if(null==e)return{};for(var n={},r=0,s=e.length;s>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},S.indexOf=function(e,t,n){if(null==e)return-1;var r=0,s=e.length;if(n){if("number"!=typeof n)return r=S.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,s+n):n}if(_&&e.indexOf===_)return e.indexOf(t,n);for(;s>r;r++)if(e[r]===t)return r;return-1},S.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(k&&e.lastIndexOf===k)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var s=r?n:e.length;s--;)if(e[s]===t)return s;return-1},S.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),s=0,a=new Array(r);r>s;)a[s++]=e,e+=n;return a};var P=function(){};S.bind=function(e,t){var n,r;if(j&&e.bind===j)return j.apply(e,l.call(arguments,1));if(!S.isFunction(e))throw new TypeError;return n=l.call(arguments,2),r=function(){if(!(this instanceof r))return e.apply(t,n.concat(l.call(arguments)));P.prototype=e.prototype;var s=new P;P.prototype=null;var a=e.apply(s,n.concat(l.call(arguments)));return Object(a)===a?a:s}},S.partial=function(e){var t=l.call(arguments,1);return function(){for(var n=0,r=t.slice(),s=0,a=r.length;a>s;s++)r[s]===S&&(r[s]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},S.bindAll=function(e){var t=l.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return A(t,function(t){e[t]=S.bind(e[t],e)}),e},S.memoize=function(e,t){var n={};return t||(t=S.identity),function(){var r=t.apply(this,arguments);return S.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},S.delay=function(e,t){var n=l.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},S.defer=function(e){return S.delay.apply(S,[e,1].concat(l.call(arguments,1)))},S.throttle=function(e,t,n){var r,s,a,i=null,o=0;n||(n={});var c=function(){o=n.leading===!1?0:S.now(),i=null,a=e.apply(r,s),r=s=null};return function(){var l=S.now();o||n.leading!==!1||(o=l);var d=t-(l-o);return r=this,s=arguments,0>=d?(clearTimeout(i),i=null,o=l,a=e.apply(r,s),r=s=null):i||n.trailing===!1||(i=setTimeout(c,d)),a}},S.debounce=function(e,t,n){var r,s,a,i,o,c=function(){var l=S.now()-i;t>l?r=setTimeout(c,t-l):(r=null,n||(o=e.apply(a,s),a=s=null))};return function(){a=this,s=arguments,i=S.now();var l=n&&!r;return r||(r=setTimeout(c,t)),l&&(o=e.apply(a,s),a=s=null),o}},S.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},S.wrap=function(e,t){return S.partial(t,e)},S.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},S.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},S.keys=function(e){if(!S.isObject(e))return[];if(x)return x(e);var t=[];for(var n in e)S.has(e,n)&&t.push(n);return t},S.values=function(e){for(var t=S.keys(e),n=t.length,r=new Array(n),s=0;n>s;s++)r[s]=e[t[s]];return r},S.pairs=function(e){for(var t=S.keys(e),n=t.length,r=new Array(n),s=0;n>s;s++)r[s]=[t[s],e[t[s]]];return r},S.invert=function(e){for(var t={},n=S.keys(e),r=0,s=n.length;s>r;r++)t[e[n[r]]]=n[r];return t},S.functions=S.methods=function(e){var t=[];for(var n in e)S.isFunction(e[n])&&t.push(n);return t.sort()},S.extend=function(e){return A(l.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},S.pick=function(e){var t={},n=d.apply(a,l.call(arguments,1));return A(n,function(n){n in e&&(t[n]=e[n])}),t},S.omit=function(e){var t={},n=d.apply(a,l.call(arguments,1));for(var r in e)S.contains(n,r)||(t[r]=e[r]);return t},S.defaults=function(e){return A(l.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},S.clone=function(e){return S.isObject(e)?S.isArray(e)?e.slice():S.extend({},e):e},S.tap=function(e,t){return t(e),e};var R=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof S&&(e=e._wrapped),t instanceof S&&(t=t._wrapped);var s=u.call(e);if(s!=u.call(t))return!1;switch(s){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var a=n.length;a--;)if(n[a]==e)return r[a]==t;var i=e.constructor,o=t.constructor;if(i!==o&&!(S.isFunction(i)&&i instanceof i&&S.isFunction(o)&&o instanceof o)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),r.push(t);var c=0,l=!0;if("[object Array]"==s){if(c=e.length,l=c==t.length)for(;c--&&(l=R(e[c],t[c],n,r)););}else{for(var d in e)if(S.has(e,d)&&(c++,!(l=S.has(t,d)&&R(e[d],t[d],n,r))))break;if(l){for(d in t)if(S.has(t,d)&&!c--)break;l=!c}}return n.pop(),r.pop(),l};S.isEqual=function(e,t){return R(e,t,[],[])},S.isEmpty=function(e){if(null==e)return!0;if(S.isArray(e)||S.isString(e))return 0===e.length;for(var t in e)if(S.has(e,t))return!1;return!0},S.isElement=function(e){return!(!e||1!==e.nodeType)},S.isArray=w||function(e){return"[object Array]"==u.call(e)},S.isObject=function(e){return e===Object(e)},A(["Arguments","Function","String","Number","Date","RegExp"],function(e){S["is"+e]=function(t){return u.call(t)=="[object "+e+"]"}}),S.isArguments(arguments)||(S.isArguments=function(e){return!(!e||!S.has(e,"callee"))}),"function"!=typeof/./&&(S.isFunction=function(e){return"function"==typeof e}),S.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},S.isNaN=function(e){return S.isNumber(e)&&e!=+e},S.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==u.call(e)},S.isNull=function(e){return null===e},S.isUndefined=function(e){return void 0===e},S.has=function(e,t){return p.call(e,t)},S.noConflict=function(){return e._=r,this},S.identity=function(e){return e},S.constant=function(e){return function(){return e}},S.property=function(e){return function(t){return t[e]}},S.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},S.times=function(e,t,n){for(var r=Array(Math.max(0,e)),s=0;e>s;s++)r[s]=t.call(n,s);return r},S.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},S.now=Date.now||function(){return(new Date).getTime()};var z={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};z.unescape=S.invert(z.escape);var T={escape:new RegExp("["+S.keys(z.escape).join("")+"]","g"),unescape:new RegExp("("+S.keys(z.unescape).join("|")+")","g")};S.each(["escape","unescape"],function(e){S[e]=function(t){return null==t?"":(""+t).replace(T[e],function(t){return z[e][t]})}}),S.result=function(e,t){if(null==e)return void 0;var n=e[t];return S.isFunction(n)?n.call(e):n},S.mixin=function(e){A(S.functions(e),function(t){var n=S[t]=e[t];S.prototype[t]=function(){var e=[this._wrapped];return c.apply(e,arguments),V.call(this,n.apply(S,e))}})};var q=0;S.uniqueId=function(e){var t=++q+"";return e?e+t:t},S.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var E=/(.)^/,O={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},$=/\\|'|\r|\n|\t|\u2028|\u2029/g;S.template=function(e,t,n){var r;n=S.defaults({},n,S.templateSettings);var s=new RegExp([(n.escape||E).source,(n.interpolate||E).source,(n.evaluate||E).source].join("|")+"|$","g"),a=0,i="__p+='";e.replace(s,function(t,n,r,s,o){return i+=e.slice(a,o).replace($,function(e){return"\\"+O[e]}),n&&(i+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(i+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),s&&(i+="';\n"+s+"\n__p+='"),a=o+t.length,t}),i+="';\n",n.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{r=new Function(n.variable||"obj","_",i)}catch(o){throw o.source=i,o}if(t)return r(t,S);var c=function(e){return r.call(this,e,S)};return c.source="function("+(n.variable||"obj")+"){\n"+i+"}",c},S.chain=function(e){return S(e).chain()};var V=function(e){return this._chain?S(e).chain():e};S.mixin(S),A(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=a[e];S.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],V.call(this,n)}}),A(["concat","join","slice"],function(e){var t=a[e];S.prototype[e]=function(){return V.call(this,t.apply(this._wrapped,arguments))}}),S.extend(S.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return S})}.call(this)},{}],3:[function(e,t){!function(){"use strict";var e,n=function(){var e=/\-([a-z])/g,t=function(e,t){return t.toUpperCase()};return function(n){return n.replace(e,t)}}(),r=function(e,t){var r,s,a,i,o,c;if(window.getComputedStyle?r=window.getComputedStyle(e,null).getPropertyValue(t):(s=n(t),r=e.currentStyle?e.currentStyle[s]:e.style[s]),"cursor"===t&&(!r||"auto"===r))for(a=e.tagName.toLowerCase(),i=["a"],o=0,c=i.length;c>o;o++)if(a===i[o])return"pointer";return r},s=function(e){if(v.prototype._singleton){e||(e=window.event);var t;this!==window?t=this:e.target?t=e.target:e.srcElement&&(t=e.srcElement),v.prototype._singleton.setCurrent(t)}},a=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},i=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},o=function(e,t){if(e.addClass)return e.addClass(t),e;if(t&&"string"==typeof t){var n=(t||"").split(/\s+/);if(1===e.nodeType)if(e.className){for(var r=" "+e.className+" ",s=e.className,a=0,i=n.length;i>a;a++)r.indexOf(" "+n[a]+" ")<0&&(s+=" "+n[a]);e.className=s.replace(/^\s+|\s+$/g,"")}else e.className=t}return e},c=function(e,t){if(e.removeClass)return e.removeClass(t),e;if(t&&"string"==typeof t||void 0===t){var n=(t||"").split(/\s+/);if(1===e.nodeType&&e.className)if(t){for(var r=(" "+e.className+" ").replace(/[\n\t]/g," "),s=0,a=n.length;a>s;s++)r=r.replace(" "+n[s]+" "," ");e.className=r.replace(/^\s+|\s+$/g,"")}else e.className=""}return e},l=function(){var e,t,n,r=1;return"function"==typeof document.body.getBoundingClientRect&&(e=document.body.getBoundingClientRect(),t=e.right-e.left,n=document.body.offsetWidth,r=Math.round(100*(t/n))/100),r},d=function(e){var t={left:0,top:0,width:0,height:0,zIndex:999999999},n=r(e,"z-index");if(n&&"auto"!==n&&(t.zIndex=parseInt(n,10)),e.getBoundingClientRect){var s,a,i,o=e.getBoundingClientRect();"pageXOffset"in window&&"pageYOffset"in window?(s=window.pageXOffset,a=window.pageYOffset):(i=l(),s=Math.round(document.documentElement.scrollLeft/i),a=Math.round(document.documentElement.scrollTop/i));var c=document.documentElement.clientLeft||0,d=document.documentElement.clientTop||0;t.left=o.left+s-c,t.top=o.top+a-d,t.width="width"in o?o.width:o.right-o.left,t.height="height"in o?o.height:o.bottom-o.top}return t},u=function(e,t){var n=!(t&&t.useNoCache===!1);return n?(-1===e.indexOf("?")?"?":"&")+"nocache="+(new Date).getTime():""},p=function(e){var t=[],n=[];return e.trustedOrigins&&("string"==typeof e.trustedOrigins?n.push(e.trustedOrigins):"object"==typeof e.trustedOrigins&&"length"in e.trustedOrigins&&(n=n.concat(e.trustedOrigins))),e.trustedDomains&&("string"==typeof e.trustedDomains?n.push(e.trustedDomains):"object"==typeof e.trustedDomains&&"length"in e.trustedDomains&&(n=n.concat(e.trustedDomains))),n.length&&t.push("trustedOrigins="+encodeURIComponent(n.join(","))),"string"==typeof e.amdModuleId&&e.amdModuleId&&t.push("amdModuleId="+encodeURIComponent(e.amdModuleId)),"string"==typeof e.cjsModuleId&&e.cjsModuleId&&t.push("cjsModuleId="+encodeURIComponent(e.cjsModuleId)),t.join("&")},f=function(e,t){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;r>n;n++)if(t[n]===e)return n;return-1},h=function(e){if("string"==typeof e)throw new TypeError("ZeroClipboard doesn't accept query strings.");return e.length?e:[e]},m=function(e,t,n,r,s){s?window.setTimeout(function(){e.call(t,n,r)},0):e.call(t,n,r)},v=function(e,t){if(e&&(v.prototype._singleton||this).glue(e),v.prototype._singleton)return v.prototype._singleton;v.prototype._singleton=this,this.options={};for(var n in b)this.options[n]=b[n];for(var r in t)this.options[r]=t[r];this.handlers={},v.detectFlashSupport()&&w()},g=[];v.prototype.setCurrent=function(t){e=t,this.reposition();var n=t.getAttribute("title");n&&this.setTitle(n);var s=this.options.forceHandCursor===!0||"pointer"===r(t,"cursor");return y.call(this,s),this},v.prototype.setText=function(e){return e&&""!==e&&(this.options.text=e,this.ready()&&this.flashBridge.setText(e)),this},v.prototype.setTitle=function(e){return e&&""!==e&&this.htmlBridge.setAttribute("title",e),this},v.prototype.setSize=function(e,t){return this.ready()&&this.flashBridge.setSize(e,t),this},v.prototype.setHandCursor=function(e){return e="boolean"==typeof e?e:!!e,y.call(this,e),this.options.forceHandCursor=e,this};var y=function(e){this.ready()&&this.flashBridge.setHandCursor(e)};v.version="1.2.3";var b={moviePath:"ZeroClipboard.swf",trustedOrigins:null,text:null,hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",allowScriptAccess:"sameDomain",useNoCache:!0,forceHandCursor:!1};v.setDefaults=function(e){for(var t in e)b[t]=e[t]},v.destroy=function(){v.prototype._singleton.unglue(g);var e=v.prototype._singleton.htmlBridge;e.parentNode.removeChild(e),delete v.prototype._singleton},v.detectFlashSupport=function(){var e=!1;if("function"==typeof ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(e=!0)}catch(t){}return!e&&navigator.mimeTypes["application/x-shockwave-flash"]&&(e=!0),e};var _=null,k=null,w=function(){var e,t,n=v.prototype._singleton,r=document.getElementById("global-zeroclipboard-html-bridge");if(!r){var s={};for(var a in n.options)s[a]=n.options[a];s.amdModuleId=_,s.cjsModuleId=k;var i=p(s),o='      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="'+n.options.moviePath+u(n.options.moviePath,n.options)+'"/>         <param name="allowScriptAccess" value="'+n.options.allowScriptAccess+'"/>         <param name="scale" value="exactfit"/>         <param name="loop" value="false"/>         <param name="menu" value="false"/>         <param name="quality" value="best" />         <param name="bgcolor" value="#ffffff"/>         <param name="wmode" value="transparent"/>         <param name="flashvars" value="'+i+'"/>         <embed src="'+n.options.moviePath+u(n.options.moviePath,n.options)+'"           loop="false" menu="false"           quality="best" bgcolor="#ffffff"           width="100%" height="100%"           name="global-zeroclipboard-flash-bridge"           allowScriptAccess="always"           allowFullScreen="false"           type="application/x-shockwave-flash"           wmode="transparent"           pluginspage="http://www.macromedia.com/go/getflashplayer"           flashvars="'+i+'"           scale="exactfit">         </embed>       </object>';r=document.createElement("div"),r.id="global-zeroclipboard-html-bridge",r.setAttribute("class","global-zeroclipboard-container"),r.setAttribute("data-clipboard-ready",!1),r.style.position="absolute",r.style.left="-9999px",r.style.top="-9999px",r.style.width="15px",r.style.height="15px",r.style.zIndex="9999",r.innerHTML=o,document.body.appendChild(r)}n.htmlBridge=r,e=document["global-zeroclipboard-flash-bridge"],e&&(t=e.length)&&(e=e[t-1]),n.flashBridge=e||r.children[0].lastElementChild};v.prototype.resetBridge=function(){return this.htmlBridge.style.left="-9999px",this.htmlBridge.style.top="-9999px",this.htmlBridge.removeAttribute("title"),this.htmlBridge.removeAttribute("data-clipboard-text"),c(e,this.options.activeClass),e=null,this.options.text=null,this},v.prototype.ready=function(){var e=this.htmlBridge.getAttribute("data-clipboard-ready");return"true"===e||e===!0},v.prototype.reposition=function(){if(!e)return!1;var t=d(e);return this.htmlBridge.style.top=t.top+"px",this.htmlBridge.style.left=t.left+"px",this.htmlBridge.style.width=t.width+"px",this.htmlBridge.style.height=t.height+"px",this.htmlBridge.style.zIndex=t.zIndex+1,this.setSize(t.width,t.height),this},v.dispatch=function(e,t){v.prototype._singleton.receiveEvent(e,t)},v.prototype.on=function(e,t){for(var n=e.toString().split(/\s/g),r=0;r<n.length;r++)e=n[r].toLowerCase().replace(/^on/,""),this.handlers[e]||(this.handlers[e]=t);return this.handlers.noflash&&!v.detectFlashSupport()&&this.receiveEvent("onNoFlash",null),this},v.prototype.addEventListener=v.prototype.on,v.prototype.off=function(e,t){for(var n=e.toString().split(/\s/g),r=0;r<n.length;r++){e=n[r].toLowerCase().replace(/^on/,"");for(var s in this.handlers)s===e&&this.handlers[s]===t&&delete this.handlers[s]}return this},v.prototype.removeEventListener=v.prototype.off,v.prototype.receiveEvent=function(t,n){t=t.toString().toLowerCase().replace(/^on/,"");var r=e,s=!0;switch(t){case"load":if(n&&parseFloat(n.flashVersion.replace(",",".").replace(/[^0-9\.]/gi,""))<10)return this.receiveEvent("onWrongFlash",{flashVersion:n.flashVersion}),void 0;this.htmlBridge.setAttribute("data-clipboard-ready",!0);break;case"mouseover":o(r,this.options.hoverClass);break;case"mouseout":c(r,this.options.hoverClass),this.resetBridge();break;case"mousedown":o(r,this.options.activeClass);break;case"mouseup":c(r,this.options.activeClass);break;case"datarequested":var a=r.getAttribute("data-clipboard-target"),i=a?document.getElementById(a):null;if(i){var l=i.value||i.textContent||i.innerText;l&&this.setText(l)}else{var d=r.getAttribute("data-clipboard-text");d&&this.setText(d)}s=!1;break;case"complete":this.options.text=null}if(this.handlers[t]){var u=this.handlers[t];"string"==typeof u&&"function"==typeof window[u]&&(u=window[u]),"function"==typeof u&&m(u,r,this,n,s)}},v.prototype.glue=function(e){e=h(e);for(var t=0;t<e.length;t++)-1==f(e[t],g)&&(g.push(e[t]),a(e[t],"mouseover",s));return this},v.prototype.unglue=function(e){e=h(e);for(var t=0;t<e.length;t++){i(e[t],"mouseover",s);var n=f(e[t],g);-1!=n&&g.splice(n,1)}return this},"function"==typeof define&&define.amd?define(["require","exports","module"],function(e,t,n){return _=n&&n.id||null,v}):"object"==typeof t&&t&&"object"==typeof t.exports&&t.exports?(k=t.id||null,t.exports=v):window.ZeroClipboard=v}()},{}],4:[function(e){var t=e("underscore"),n=e("models/user-current/user-current"),r=e("environment"),s=e("helpers/init"),a=e("helpers/page"),i=e("helpers/metrika");e("config"),e("layouts/errors"),e("layouts/panels"),e("layouts/not-found"),e("actions/actions"),e("models/subscription-xiva/subscription-xiva"),t.extend(yr.externals,e("libs/yate.externals"));var o=["dropzone","upload","welcome","slider","access-folder","create-folder-shared","import-social","edit-photo","promo-editor","promo-export","export-social","export-social-single"],c=["tuning","payment","invites"],l=["vkontakte","facebook","odnoklassniki"];t.extend(ns.router.regexps,{id:"[A-Za-z0-9_-]*",path:"(?:\\/[^\\/\\?]+)+",dialog:o.join("|"),page:c.join("|"),service:l.join("|"),slashOptional:"\\/?",pipe:"(?:\\||%7C)",query:"[^/]+",force:"force"}),ns.router.routes={route:{"/client/error":"errors","/client/search/{typeSearch:force}/{querySearch:query}{scopeSearch:path}":"panels","/client/search/{typeSearch:force}/{querySearch:query}{scopeSearch:path}{slash:slashOptional}{separator:pipe}{dialog:dialog}{idDialog:path}":"panels","/client/search/{querySearch:query}{scopeSearch:path}{slash:slashOptional}{separator:pipe}{dialog:dialog}{idDialog:path}":"panels","/client/search/{querySearch:query}{scopeSearch:path}{slash:slashOptional}{separator:pipe}{dialog:dialog}":"panels","/client/search/{querySearch:query}{scopeSearch:path}":"panels","/client{idContext:path}{slash:slashOptional}{separator:pipe}{dialog:dialog}{slash:slashOptional}{service:service}":"panels","/client{idContext:path}{slash:slashOptional}{separator:pipe}{dialog:dialog}{idDialog:path}":"panels","/client{idContext:path}{slash:slashOptional}{separator:pipe}{dialog:dialog}":"panels","/client{idContext:path}":"panels","/{page:page}/{idPage:id}":"panels","/{page:page}":"panels"},redirect:{"/":"/client/disk","/auth":"/client/disk","/client{slash:slashOptional}":"/client/disk","/client/hidden":"/client/disk","/client/hidden{path:path}":"/client/disk","/client/share":"/client/disk","/client/share{path:path}":"/client/disk","/client/camera":"/client"+(n.get(".foldersDefault.photostream")||"/disk"),"/client/social{slash:slashOptional}":"/client"+n.get(".foldersDefault.social")+"|import-social","/invite{slash:slashOptional}":"/client/disk","/folder":"/client/disk"},rewriteParams:{panels:function(e){if(delete e.slash,delete e.separator,a.isSearch(e)&&(e.idContext="/search/"+(e.typeSearch?e.typeSearch+"/":"")+e.querySearch+e.scopeSearch),e.idContext){var n=ns.Model.getValid("statesContext",e);n||(n=ns.Model.get("statesContext",e).setDataDefault()),e=t.extend(e,n.getData())}return e}}},e("nanoblocks/preview-expirable/preview-expirable"),nb.on("preview-expired",function(e,n){var r=ns.Model.getValid("resource",{id:n.id}),s=t.findWhere(r.get(".meta.sizes"),{url:n.src});s&&r.fetch().then(function(){var e=t.findWhere(r.get(".meta.sizes"),{name:s.name});e&&e.url&&n.block&&n.block.setSource(e.url)})}),function(){var e=window.innerWidth>0?window.innerWidth:screen.width,t=document.getElementById("meta-viewport");r.agent.isMobile&&e>600?t.setAttribute("content","width=device-width, user-scalable=yes, initial-scale=1"):r.agent.isMobile&&t.setAttribute("content","width=device-width, user-scalable=yes, initial-scale=0.5")}(),$(function(){s().always(function(){ns.Model.get("resources",ns.page.current.params).on("ns-model-changed",t.once(function(){ns.Model.get("operationsActive").revive()})),i.init(e("config").countersMetrika.index,[r.agent.isMobile?"mobile":"desktop"]);var n=ns.Model.get("subscriptionXiva");n.sign(),r.agent.isMobile&&$(document).on("blur","input, textarea",function(){setTimeout(function(){window.scrollTo(document.body.scrollLeft,document.body.scrollTop),$(".nb-layer_type_fixed").css("position","fixed")},0)})})})},{"actions/actions":5,config:6,environment:8,"helpers/init":16,"helpers/metrika":17,"helpers/page":19,"layouts/errors":31,"layouts/not-found":32,"layouts/panels":33,"libs/yate.externals":41,"models/subscription-xiva/subscription-xiva":173,"models/user-current/user-current":177,"nanoblocks/preview-expirable/preview-expirable":184,underscore:2}],5:[function(e){e("models/resource/resource"),e("models/slices/slices"),e("models/player/player"),e("models/state-resource/state-resource"),e("models/states-context/states-context"),e("models/rights-social/rights-social"),e("models/queues/queue-confirmations"),e("models/queues/queue-request"),e("models/queues/queue-rate-limiter"),e("models/operation/operation-create-folder"),e("models/operation/operation-leave-folder"),e("models/operation/operation-delete"),e("models/operation/operation-move"),e("models/operation/operation-copy"),e("models/operation/operation-rename"),e("models/operation/operation-publish"),e("models/operation/operation-restore"),e("models/operation/operation-unshare"),e("models/operation/operation-upload"),e("models/operation/operation-upload-folder"),e("models/operation/operation-accept-invite"),e("models/operation/operation-reject-invite"),e("models/operation/operation-access-folder"),e("models/operation/operation-invite-folder"),e("models/operation/operation-clean-trash"),e("models/operation/operation-changed"),e("models/operation/operation-invite-disk"),e("models/operation/operation-export-social"),e("models/space/package-space"),e("models/payment/state-form-payment"),e("models/payment/do-order-payment"),e("models/payment/do-service-unsubscribe"),e("models/payment/do-service-prolongate"),e("models/state-export-social/state-export-social");var t=e("underscore"),n=e("config"),r=e("environment"),s=e("helpers/page"),a=e("helpers/path"),i=e("helpers/string"),o=e("helpers/operation"),c=e("helpers/metrika"),l=e("helpers/proxy-social"),d=e("libs/social").Broker;
ns.action.define("listing.openFolder",function(e,n){if(ns.Model.get("statesContext",ns.page.current.params).deselectAll(),n.id===ns.page.current.params.idContext)return!1;if(n.from){var r=t.find(ns.Model.get("slices").get(".slice"),function(e){return e.idContext?e.idContext===decodeURIComponent(n.id):void 0});c.count("navigation","via "+n.from,r?r.id:"custom folder"),c.count("actions","with resources","open folder",n.from)}return s.go("/client"+n.id),!1}),ns.action.define("listing.deselect-all",function(e,t,n,r){return r.isDefaultPrevented()||(ns.Model.get("statesContext",ns.page.current.params).get(".selected").length&&c.count("interface elements","listing","deselect all","click on universe"),ns.Model.get("statesContext",ns.page.current.params).deselectAll()),!0}),ns.action.define("resource.restore",function(e,n){var i=function(e){return o.create("restore",{idSrc:a.unescape(e.id)}),!0};return s.isSearch()&&c.count("about search","actions","restore"),r.agent.isMobile?(t.defer(i,n),!1):i(n)}),ns.action.define("resource.upload",function(e,n){var s="iOS"===r.agent.OSFamily,l=ns.page.current.params.idContext,d=ns.Model.get("operationsUpload"),u=ns.Model.get("queueRateLimiter");t.each(n.files,function(e){var t={file:e,idFolderDst:l};s&&(t.nameDst=i.getUnique()+a.extname(e.name)),u.push(function(){c.count("interface elements","upload dialog","try upload","file"),d.insert(o.create("upload",t))})}),t.each(n.folders,function(e){var t={folder:e,idFolderDst:l};u.push(function(){c.count("interface elements","upload dialog","try upload","folder"),d.insert(o.create("uploadFolder",t))})})}),ns.action.define("resource.upload-denied",function(){var e=ns.Model.getValid("resource",{id:ns.page.current.params.idContext});ns.Model.get("queueConfirmations").add({operation:"upload",src:e.getData(),status:"denied"}).then(function(){ns.action.run("listing.openFolder",{id:"/disk"})})}),ns.action.define("resource.delete",function(e,n){a.isParent("/yavideo",n.id)?c.count("interface elements","yavideo","actions","delete"):a.isParent("/attach/yaruarchive",n.id)&&c.count("interface elements","yaru","actions","delete"),s.isSearch()&&c.count("about search","actions","delete");var i=function(e){var t=a.unescape(e.id),n=ns.Model.getValid("resource",{id:t}),r="delete";n&&n.get(".meta.group.is_root")&&!n.get(".meta.group.is_owned")&&(r="leaveFolder",c.count("actions","shared folders","leave folder","by deleting"));var i=o.create(r,{idSrc:t});return i.on("ns-model-changed.status",function(){if("done"===i.get(".status")){var e=ns.page.current.params.idContext,t=i.get(".src")&&i.get(".src").get(".id");t&&(a.isParent(t,e)||e===t)&&s.go("/client"+a.escape(a.dirname(t)))}}),!0};return r.agent.isMobile?(t.defer(i,n),!1):i(n)}),ns.action.define("resource.copy",function(e,t){return a.isParent("/attach/yaruarchive",t.id)?c.count("interface elements","yaru","actions","copy"):a.isParent("/mail",t.id)?c.count("interface elements","mail attachments","/mail","actions","copy"):a.isParent("/attach",t.id)&&c.count("interface elements","mail attachments","/attach","actions","copy"),s.isSearch()&&c.count("about search","actions","copy"),o.create("copy",{idSrc:a.unescape(t.id)})}),ns.action.define("resource.move",function(e,t){a.isParent("/yavideo",t.id)&&c.count("interface elements","yavideo","actions","move"),s.isSearch()&&c.count("about search","actions","move");var n=o.create("move",{idSrc:a.unescape(t.id)});return n.on("ns-model-changed.status",function(){if("done"===n.get(".status")){var e=ns.page.current.params.idContext,t=n.get(".src")&&n.get(".src").get(".id"),r=n.get(".dst")&&n.get(".dst").get(".id");t&&r&&(a.isParent(t,e)||e===t)&&s.go("/client"+a.escape(e.replace(new RegExp("^"+t),r)))}}),n}),ns.action.define("resource.rename",function(e,n){var r=o.create("rename",{idSrc:a.unescape(n.id)});return r.on("ns-model-changed.status",function(){var e=ns.page.current.params.idContext,n=r.get(".src")&&r.get(".src").get(".id"),i=r.get(".dst")&&r.get(".dst").get(".id");if("canceled"===r.get(".status")&&"exists"===r.get(".reason")){var o=ns.Model.getValid("statesContext",ns.page.current.params).get(".selected")||[];(e===n&&!o.length||-1!==n.indexOf(o))&&t.defer(function(){ns.action.run("resource.rename",{id:n})})}else if("done"===r.get(".status")&&n&&i&&(a.isParent(n,e)||e===n)){var c="/client"+e.replace(new RegExp("^"+$.ui.autocomplete.escapeRegex(n)),i);s.go(a.escape(c))}}),r}),ns.action.define("resource.invite-accept",function(e,t){return o.create("acceptInvite",{idSrc:a.unescape(t.id)})}),ns.action.define("resource.invite-reject",function(e,t){return o.create("rejectInvite",{idSrc:a.unescape(t.id)})}),ns.action.define("resource.view-slider",function(e,t){var n=a.unescape(t.id),r=ns.Model.getValid("resource",{id:n}),i=ns.Model.get("stateResource",{id:n,idContext:ns.page.current.params.idContext});return r&&"video"===r.get(".meta.mediatype")&&Modernizr.videostream&&i.set(".autoplay",!0),a.isParent("/attach/yaruarchive",t.id)?c.count("interface elements","yaru","actions","open"):a.isParent("/yavideo",t.id)&&c.count("interface elements","yavideo","actions","open"),s.isSearch()&&c.count("about search","actions","view"),s.go([s.getUrlBase(),"|slider",t.id].join("")),!0}),ns.action.define("resource.view-docviewer",function(e,t){var r=document.location.protocol,s=r+"//"+n.domains.docviewer+"/?url=ya-disk://"+t.id+"&name="+encodeURIComponent(t.name);return a.isParent("/attach/yaruarchive",t.id)?c.count("interface elements","yaru","actions","open"):a.isParent("/yavideo",t.id)?c.count("interface elements","yavideo","actions","open"):a.isParent("/mail",t.id)?c.count("interface elements","mail attachments","/mail","actions","open"):a.isParent("/attach",t.id)&&c.count("interface elements","mail attachments","/attach","actions","open"),window.open(s),!0}),ns.action.define("resource.show-fullsize",function(e,t){var n='.meta.sizes[.name == "ORIGINAL"].url',s=ns.Model.getValid("resource",{id:a.unescape(t.id)});if(r.agent.isMobile)window.open(s.get(n)[0],"_blank");else{var i=window.open("about:blank","_blank");s.fetch().then(function(){i.document.location=s.get(n)[0],i.focus()},function(){i.close()})}}),ns.action.define("resource.download",function(e,t){var n=a.unescape(t.id);a.isParent("/attach/yaruarchive",t.id)?c.count("interface elements","yaru","actions","download"):a.isParent("/yavideo",t.id)?c.count("interface elements","yavideo","actions","download"):a.isParent("/mail",t.id)?c.count("interface elements","mail attachments","/mail","actions","download"):a.isParent("/attach",t.id)&&c.count("interface elements","mail attachments","/attach","actions","download");var i=function(){function e(){var e=document.getElementById(t);return e||(e=document.createElement("iframe"),e.id=t,e.style.display="none",document.body.appendChild(e)),e}var t="download-iframe";return"iOS"===r.agent.OSFamily||"Android"===r.agent.OSFamily?function(e){e&&window.location.assign(e)}:function(t){e().src=t.replace(/&amp;/g,"&")}}(),o=ns.Model.getValid("resource",{id:n}),l=function(){o.getURL().then(function(e){i(e.get(".file")||e.get(".folder"))})};return 2==o.get(".meta.drweb")?ns.Model.get("queueConfirmations").add({operation:"download",status:"virused"}).then(l):l(),s.isSearch()&&c.count("about search","actions","download"),!0}),ns.action.define("resource.move-audio",function(e,n){var r=ns.page.current.params,s=ns.Model.getValid("resources",r),a=t.last(s.getSiblingsOf(r.selected[0],{take:n.delta,loop:!0,filter:function(e){return!e.get(".state.hidden")&&"player"===e.get(".app")}})),i=ns.Model.get("player");i.setResourcePlaying(a.get(".id")),i.set(".autoplay",!0),ns.Model.get("stateResource",{id:a.get(".id"),idContext:r.idContext}).selectSingle()}),ns.action.define("resource.play-next",function(){return ns.action.run("resource.move-audio",{delta:1}),!0}),ns.action.define("resource.play-prev",function(){return ns.action.run("resource.move-audio",{delta:-1}),!0}),ns.action.define("resource.play",function(e,t){var n=ns.Model.get("player");return n.setResourcePlaying(a.unescape(t.id)),n.play(),s.isSearch()&&c.count("about search","actions","play"),!1}),ns.action.define("resource.toggle-play",function(e,t){var n=ns.Model.get("player");n.get(".playing")?n.pause():(ns.action.run("resource.play",t),c.count("interface elements","audio","play","sidebar preview"))}),function(e,s){function i(e){if(e.type||"dir","mail"==e.service){var t,s;"dir"===e.type?(t="Ссылка на папку «"+e.title+"» на Яндекс.Диске",s=["Посмотреть или скачать папку «"+e.title+"»"]):"file"===e.type&&(t="Ссылка на файл «"+e.title+"» на Яндекс.Диске",s=["Посмотреть или скачать файл «"+e.title+"»"]),s.push(" — ",'<a href="'+e.link+'">',e.link,"</a>");var a;return a=r.agent.isMobile?[n.links.mail,"/touch/compose/?","body="+encodeURIComponent(s.join("")),"&subject="+encodeURIComponent(t)].join(""):[n.links.mail,"/neo2#compose/mode=html&body="+encodeURIComponent(s.join("")),"&subject="+encodeURIComponent(t)].join("")}var i=e.service;return"mailru"===i&&(i="moimir"),["http://share.yandex.ru/go.xml?service="+i,"&amp;url="+encodeURIComponent(e.link),e.title?"&amp;title="+encodeURIComponent(e.title):""].join("")}function c(e){var n=t.findWhere(l,{service:e}),r="";return n&&(r="scrollbars=1,resizable=1,menubar=0,toolbar=0,status=0",r+=",left="+(screen.width-n.width)/2,r+=",top="+(screen.height-n.height)/2,r+=",width="+n.width,r+=",height="+n.height),r}var l=[{service:"mail",width:1e3,height:600},{service:"vkontakte",width:550,height:420},{service:"twitter",width:650,height:520},{service:"odnoklassniki",width:560,height:370},{service:"facebook",width:800,height:500},{service:"mailru",width:560,height:400},{service:"gplus",width:560,height:370}];e.action.define("share.resource",function(t,n){var r,l,d=a.unescape(n.id),u=e.Model.getValid("resource",{id:d}),p=u.get(".meta.short_url"),f=u.get(".name"),h=u.get(".type"),m=c(n.service);if(p)r=i({service:n.service,type:h,link:p,title:f}),l=s.open(r,"YaShare",m);else{var v=o.initialize("publish",{idSrc:d,reverse:!1}).on("status.started",function(){l=s.open("","YaShare",m)}).on("status.done",function(){l.location=i({service:n.service,type:h,link:u.get(".meta.short_url"),title:f})}).on("status.failed",function(){l.close()});v.run()}return l}),e.action.define("share.link",function(e,t){var n=i({service:t.service,link:t.link});return s.open(n,"YaShare",c(t.service))})}(ns,window),ns.action.define("resource.export",function(e,t){var n=a.unescape(t.idResource),r=function(){-1===ns.Model.get("statesContext",ns.page.current.params).get(".selected").indexOf(n)&&ns.Model.get("stateResource",{idContext:ns.page.current.params.idContext,id:n}).selectSingle(),s.go(s.getUrlBase()+"|export-social-single/"+t.service)},i=ns.Model.get("rightsSocial",{scenario:"photos_export"});i.isAuthorized(t.service)?r():ns.action.run("ufo-broker.bind-social",{scenario:"photos_export",service:t.service}).then(r)}),ns.action.define("folder.create",function(){return o.create("createFolder",{idFolderDst:ns.page.current.params.idContext})}),ns.action.define("resource.publish",function(e,t){return s.isSearch()&&c.count("about search","actions",t.reverse?"unpublish":"publish"),t.reverse||c.reach("publish_resource"),o.create("publish",{idSrc:a.unescape(t.id),reverse:!!t.reverse})}),ns.action.define("dialog-edit-photo.open",function(e,t){return s.go(s.getUrlBase()+"|edit-photo"+t.id)}),ns.action.define("dialog-create-shared-folder.open",function(){return s.go(s.getUrlBase()+"|create-folder-shared")}),ns.action.define("dialog-access-folder.open",function(e,t){var n=a.unescape(t.id),r=ns.Model.get("inviteesFolder",{idFolder:n});return r.isValid()?r.syncOrder():r.fetch(),s.go([s.getUrlBase(),"|access-folder",t.id].join(""))}),ns.action.define("resource.unshare",function(e,t){return ns.action.run("dialog.close"),c.count("interface elements","folder access dialog","revoke access for all"),o.create("unshare",{idSrc:a.unescape(t.id)})}),ns.action.define("user-access-folder.add-social",function(e,n){var r=t.extend({scenario:"invite"},n);ns.action.run("ufo-broker.bind-social",r).then(function(){ns.action.run("user-access-folder.invite",n)})}),ns.action.define("dialog-invite-disk.invite",function(){var e=ns.Model.get("statesContactInviteDisk").getChecked();if(t.isEmpty(e)){var n=ns.Model.get("stateDialogInviteDisk"),r=n.get(".emailValid");if(r){c.count("actions","invite user to Disk","direct email");var s=o.create("inviteDisk",{service:"email",userid:r});s.on("status.created",function(){n.resetEmail(),ns.Model.get("statesContactInviteDisk").reset()}),s.on("status.done",function(){ns.Model.get("stateContactInviteDisk",{userid:r}).setDataDefault().set(".status","done"),c.count("interface elements","invites to disk contacts dialog","invite","1 user, typed in email")})}}else{t.each(e,function(e){var t=e.contact,n=t.get(".service"),r=function(){c.count("actions","invite user to Disk","contact from list",n),o.create("inviteDisk",{userid:t.get(".userid"),service:n,notify:!1})};"email"===n?r():ns.Model.get("rightsSocial",{scenario:"invite"}).isAuthorized(n)?r():ns.action.run("ufo-broker.bind-social",{service:n,scenario:"invite"}).then(r)});var a=e.length;c.count("interface elements","invites to disk contacts dialog","invite",a+" user(s)")}t.invoke(e,"reset")}),ns.action.define("ufo-broker.bind-social",function(e,t){var n=t.service,r=t.scenario,s=new d({action_if_anonymous:"ignore",provider:n,scope:l.getScopes(n,r).join(",")}),a=s.start();return a.then(function(){var e=ns.Model.getValid("rightsSocial",{scenario:r});e&&e.setAuthorized(n)}),a}),ns.action.define("ufo-broker.add-social",function(e,n){var r=t.extend({scenario:"invite"},n);ns.action.run("ufo-broker.bind-social",r).then(function(){ns.Model.get("contacts").fetch()}),"dialogAccessFolder"===n.from?c.count("interface elements","folder access dialog","add social profile",n.service):"contactsInviteDisk"===n.from&&c.count("interface elements","invites to disk contacts dialog","add social profile",n.service)}),ns.action.define("dialog.close",function(){return t.defer(function(){ns.events.trigger("ufo-dialog-close"),s.go(s.getUrlBase())}),!1}),ns.action.define("form-invite-folder.invite",function(e,t){var n=t.id,r=ns.Model.get("stateFormInviteFolder",{id:n});o.create("inviteFolder",{idSrc:n,userid:r.get(".userid"),service:r.get(".service"),rights:r.get(".rights")||660}),r.reset(),c.accumulate("interface elements","folder access dialog","invite")}),ns.action.define("user-access-folder.invite",function(e,n){var r=decodeURIComponent(n.idSrc);o.create("inviteFolder",t.extend(n,{idSrc:r})),c.accumulate("interface elements","folder access dialog","invite");var s=ns.Model.getValid("resource",{id:r});s&&!s.get(".meta.group.gid")&&c.count("actions","shared folders","share folder (first invite)",n.rights)}),ns.action.define("user-access-folder.resend",function(e,n){o.create("inviteFolder",t.extend(n,{idSrc:decodeURIComponent(n.idSrc)})),c.count("actions","shared folders","invite user","resend invite")}),ns.action.define("user-access-folder.change-rights",function(e,t,n){var r=$(n).closest(".js-user-folder-rights")[0],s=decodeURIComponent(t.idFolder),a=ns.Model.get("inviteeFolder",{id:t.idInvitee,idFolder:s}),i=ns.Model.get("stateInviteeFolder",{id:t.idInvitee,idFolder:s});return r&&nb.block(r).on("nb-changed",function(){var e=String(this.getState().value);return"contact"===a.get(".status")?(i.set(".rights",e),void 0):(e!==a.get(".rights")&&("0"===e?(c.count("actions","shared folders","revoke access"),c.count("interface elements","folder access dialog","revoke access")):(c.count("actions","shared folders","change access rights","640"==e?"ro":"rw"),c.count("interface elements","folder access dialog","change access rights","640"==e?"ro":"rw")),o.create("accessFolder",{rights:e,idInvitee:t.idInvitee,idSrc:s})),void 0)}),!0}),ns.action.define("trash.clean",function(){return o.create("cleanTrash"),!0}),ns.action.define("popup.close",function(){nb.trigger("popup-close")}),ns.action.define("payment.pay",function(){var e=ns.Model.get("stateFormPayment"),t=window.location;ns.Model.get("queueRequest").pushPriority({id:"do-order-payment",params:{idOfferSpace:e.get(".idOfferSpace"),method:e.get(".method"),repeat:e.get(".repeat"),retpath:t.protocol+"//"+t.host+"/tuning"}}).always(function(t){var n=t.valueOf().getData();n&&n.url&&n.params?(e.resetStatus(),ns.action.run("form-submit.post",n)):e.set(".status","error")})}),ns.action.define("payment.cancel",function(e,t){var n=ns.Model.get("statePackageSpace",{id:t.id});n.set(".loading",!0),n.set(".error",!1),n.set(".action","cancel"),ns.Model.get("queueRequest").pushPriority({id:"do-service-unsubscribe",params:{sid:t.sid}}).always(function(e){n.set(".loading",!1);var r=e.valueOf().getData();r.error?n.set(".error",!0):(ns.Model.get("packageSpace",{id:t.id}).set(".subscription",!1),ns.action.run("popup.close"))})}),ns.action.define("payment.prolong",function(e,t){var n=ns.Model.get("statePackageSpace",{id:t.id}),r=window.location;n.set(".loading",!0),n.set(".action","prolong"),ns.Model.get("queueRequest").pushPriority({id:"do-service-prolongate",params:{sid:t.sid,method:t.method,retpath:r.protocol+"//"+r.host+"/tuning"}}).always(function(e){var t=e.valueOf().getData();n.set(".loading",!1),t&&t.url&&t.params?(ns.action.run("popup.close"),ns.action.run("form-submit.post",t),n.set(".error",!1)):n.set(".error",!0)})}),ns.action.define("form-submit.post",function(e,t){var n=$('<form method="post"></form>');for(var r in t.params){var s=t.params[r],a=$('<input type="hidden" />');a.attr("name",r),a.val(s),n.append(a)}n.attr({action:t.url}),n.appendTo("body").submit()}),ns.action.define("app.auth",function(){window.location.reload(!0)}),ns.action.define("app.refresh",function(){window.location.reload(!0)}),ns.action.define("app.search",function(e,t){return ns.Model.invalidate("resources",function(e){return e.params.querySearch&&e.params.scopeSearch}),s.go(s.getUrlBase({querySearch:encodeURIComponent(encodeURIComponent(t.querySearch)),scopeSearch:t.scopeSearch,typeSearch:t.typeSearch})).then(function(e){function n(){var e=ns.page.current.params,t=ns.Model.getValid("resources",e);t&&c.count("about search","search",t.isQueryCorrected()?"with typo":"without typo",e.scopeSearch,t.isEmpty()?"empty result":"not empty result")}"formSearch"===t.from&&(e&&e.async?Vow.all(e.async).then(n):n())}),!0}),ns.action.define("locale.set",function(e,t,n){var r=encodeURIComponent(window.location);return window.location=n.href+"&retpath="+r,!1}),ns.action.define("export-social-single.dialog-open",function(e,n){var r=ns.Model.get("rightsSocial",{scenario:"photos_export"}),s=function(){ns.action.run("dialog.close"),t.defer(function(){var e=ns.Model.get("stateExportSocial");e.set(".serviceSelected",n.service),e.check(n.service),ns.action.run("export-social.dialog-open",{idsResources:[a.unescape(n.id)]})})};r.isAuthorized(n.service)?s():ns.action.run("ufo-broker.bind-social",{scenario:"photos_export",service:n.service}).then(s)}),ns.action.define("export-social-single.click-continue",function(e,t){return c.count("interface elements","dialog for single photo export","ok"),t.idResource=a.unescape(t.idResource),o.create("exportSocial",t),ns.action.run("dialog.close"),!0}),ns.action.define("export-social.dialog-open",function(e,t){t=t||{};var n=ns.Model.get("stateExportSocial");return t.idsResources&&n.set(".idsResources",t.idsResources),s.go([s.getUrlBase(),"|export-social"].join("")),!0})},{config:6,environment:8,"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"helpers/path":20,"helpers/proxy-social":21,"helpers/string":25,"libs/social":37,"models/operation/operation-accept-invite":77,"models/operation/operation-access-folder":78,"models/operation/operation-changed":80,"models/operation/operation-clean-trash":81,"models/operation/operation-copy":82,"models/operation/operation-create-folder":83,"models/operation/operation-delete":84,"models/operation/operation-export-social":85,"models/operation/operation-invite-disk":89,"models/operation/operation-invite-folder":90,"models/operation/operation-leave-folder":91,"models/operation/operation-move":92,"models/operation/operation-publish":94,"models/operation/operation-reject-invite":95,"models/operation/operation-rename":98,"models/operation/operation-restore":99,"models/operation/operation-unshare":101,"models/operation/operation-upload":104,"models/operation/operation-upload-folder":103,"models/payment/do-order-payment":108,"models/payment/do-service-prolongate":109,"models/payment/do-service-unsubscribe":110,"models/payment/state-form-payment":112,"models/player/player":115,"models/queues/queue-confirmations":117,"models/queues/queue-rate-limiter":119,"models/queues/queue-request":120,"models/resource/resource":133,"models/rights-social/rights-social":148,"models/slices/slices":154,"models/space/package-space":160,"models/state-export-social/state-export-social":166,"models/state-resource/state-resource":169,"models/states-context/states-context":171,underscore:2}],6:[function(e,t){var n=e("models/config/config");t.exports=n&&n.getData()||{}},{"models/config/config":49}],7:[function(e,t){t.exports={KEYS:{ENTER:13,ESC:27,RIGHT:39,LEFT:37},VIEWS:["tile","icons","list"],ONE_DAY:864e5,INTERVALS_COUNT_CONTACTS:[0,20,100,200,300,400,500],TYPE_FOLDER_SOCIAL:["vkontakte","facebook","odnoklassniki","mailru","instagram","google"],TITLE_ALBUM_DEFAULT:"Яндекс.Диск"}},{}],8:[function(e,t){var n=e("models/environment/environment");t.exports=n&&n.getData()||{}},{"models/environment/environment":57}],9:[function(e,t){t.exports={hasGap:function(e,t){if(t.length<2)return null;for(var n=0,r=t.length;r>n;n++){var s=t[n],a=e.indexOf(s),i=null;a>0&&(i=e[a-1]);var o=null;a<e.length-1&&(o=e[a+1]);var c=i&&-1!==t.indexOf(i)||o&&-1!==t.indexOf(o);if(!c)return!0}return!1},getRange:function(e,t,n){for(var r,s,a=0,i=e.length;i>a;a++){var o=e[a];if(o===t&&(r=a),o===n&&(s=a),!isNaN(r)&&!isNaN(s))break}if(isNaN(r)||isNaN(s))return null;if(r>s){var c=s;s=r,r=c}return e.slice(r,s+1)},sortedIndex:function(e,t,n){for(var r=0,s=e.length;s>r;){var a=r+s>>>1;n(e[a],t)<0?r=a+1:s=a}return r}}},{}],10:[function(e,t){t.exports={player:{extnames:[".mp3"],mimetypes:["audio/mpeg","audio/mp3"]},docviewer:{mimetypes:["application/gzip","application/x-gzip","application/x-gunzip","application/gzipped","application/x-bzip2","application/x-bz2","application/zip","application/x-compressed","application/x-zip-compressed","application/rar","application/x-rar","application/x-rar-compressed","compressed/rar","application/vnd.ms-excel","application/x-msexcel","application/x-ms-excel","application/x-excel","application/xls","application/x-xls","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.sun.xml.calc","application/vnd.sun.xml.calc.template","application/x-vnd.oasis.opendocument.spreadsheet","application/x-vnd.oasis.opendocument.spreadsheet-template","application/msexcel","application/x-dos_ms_excel","text/csv","text/comma-separated-values","application/pdf","application/x-pdf","application/acrobat","applications/vnd.pdf","text/pdf","text/x-pdf","application/mspowerpoint","application/ms-powerpoint","application/mspowerpnt","application/vnd-mspowerpoint","application/vnd.ms-powerpoint","application/powerpoint","application/x-powerpoint","application/x-mspowerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/msword","application/rtf","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.sun.xml.writer","application/vnd.sun.xml.writer.template","application/vnd.oasis.opendocument.text","application/x-vnd.oasis.opendocument.text","application/doc","application/vnd.msword","application/vnd.ms-word","application/winword","application/word","application/x-msw6","application/x-msword","text/rtf","application/vnd.oasis.opendocument.text","image/tiff","application/x-shockwave-flash","application/postscript","application/futuresplash","image/vnd.adobe.photoshop","image/photoshop","image/x-photoshop","image/psd","application/photoshop","application/psd","zz-application/zz-winassoc-psd","application/x-fictionbook+xml","application/epub+zip"],extnames:[".xls",".xlsx",".ods",".xlt",".csv",".pdf",".ppt",".pptx",".odp",".rtf",".jpg",".jpeg",".png",".bmp",".gif",".doc",".docx",".odt",".docm",".dotx",".dot",".dotm",".tiff",".tif",".ps",".psd",".eps",".ai",".cdr",".nef",".dng",".ini",".log",".asc",".txt",".zip",".rar",".cab",".xar",".7z",".chm",".epub",".fb2"]}}},{}],11:[function(e,t){t.exports={"default":"none",virus:"virus",mediatypes:{image:"image",audio:"audio",video:"video",archive:"archive",text:"text",font:"font",executable:"application",flash:"flash",development:"development",book:"book",compressed:"archive"},extnames:{".7z":"archive",".cab":"archive",".gz":"archive",".gzip":"archive",".jar":"archive",".rar":"rar",".tar":"archive",".zip":"zip",".zipx":"zip",".aud":"audio",".flac":"audio",".iff":"audio",".m3u":"audio",".m3u8":"audio",".m4a":"audio",".m4b":"audio",".m4r":"audio",".mp3":"mp3",".pls":"pls",".ogg":"audio",".wav":"wav",".wma":"wma",".asf":"video",".avi":"avi",".flv":"flash",".mov":"mov",".mp4":"mp4",".mpeg":"video",".mkv":"video",".mpg":"video",".srt":"srt",".swf":"flash",".vob":"video",".wmv":"wmv",".ai":"ai",".cur":"image",".bmp":"bmp",".dng":"image",".djvu":"djvu",".ico":"image",".gif":"gif",".jpg":"jpg",".jpeg":"jpg",".png":"png",".psd":"psd",".pcx":"pcx",".mng":"image",".tif":"tiff",".tiff":"tiff",".xcf":"image",".epub":"book",".ibooks":"book",".mobi":"book",".fb2":"book",".cdr":"cdr",".csv":"csv",".doc":"doc",".docx":"doc",".dot":"doc",".dotx":"doc",".indd":"text",".key":"text",".odt":"odt",".odp":"odp",".pdf":"pdf",".pps":"text",".ppsm":"text",".ppsx":"text",".ppt":"ppt",".pptx":"ppt",".ods":"ods",".rtf":"rtf",".txt":"txt",".xls":"xls",".xlsb":"xls",".xlsx":"xls",".xltm":"xls",".xltx":"xls",".xps":"text",".css":"development",".htm":"development",".html":"development",".js":"development",".php":"development",".xhtml":"development",".htaccess":"development",".mso":"development",".asm":"development",".asp":"development",".aspx":"development",".c":"development",".cgi":"development",".class":"development",".cpp":"development",".dtd":"development",".h":"development",".java":"development",".apk":"application",".bat":"application",".cgi":"application",".com":"application",".exe":"exe",".gadget":"application",".jar":"application"}}},{}],12:[function(e,t){!function(n){var r=t.exports={},s=e("underscore"),a=null,i=!1,o="is-disabled-editor-photo",c=["enhance","effects","frames","stickers","orientation","focus","crop","warmth","brightness","contrast","saturation","sharpness","colorsplash","draw","text","redeye","whiten","blemish"];no.extend(r,ns.Events),r.isReady=!1,r.isOpened=!1,r.fetch=function(e){var t=new Vow.Promise,n=document.createElement("script");return n.type="text/javascript",n.src=e,n.onload=function(){r.trigger("editor-photo.loaded"),t.fulfill()},n.onerror=function(){r.trigger("editor-photo.error",{code:0,message:"Feather.js load failed"}),t.reject()},document.body.appendChild(n),t},r.init=s.once(function(e){function t(){try{a=new n.Aviary.Feather(no.extend({apiVersion:3,theme:"minimum",tools:c,enableCORS:!0,onReady:r.trigger.bind(r,"editor-photo.opened"),onClose:r.trigger.bind(r,"editor-photo.closed"),onSaveButtonClicked:function(){return i=!0,r.trigger("editor-photo.save"),!1},onCloseButtonClicked:function(e){return e&&!i?!0:(a.close(),!1)},onLoad:function(){r.isReady=!0,r.trigger("editor-photo.inited")},onError:function(e){r.trigger("editor-photo.error",e)}},e))}catch(t){r.trigger("editor-photo.error",{code:0,message:t.message})}}r.isReady?t():r.fetch(e.urlFeather).then(t)}),r.getActionsJson=function(){return r.isReady?a.getActionList():"{}"},r.open=function(e){r.isOpened=!0,i=!1,a.launch(e)},r.close=function(){r.isReady&&(r.isOpened=!1,a.close())},r.setViewProgressing=function(){r.isReady&&(a.showWaitIndicator(),$wrapper.addClass(o))},r.removeViewProgressing=function(){r.isReady&&(a.hideWaitIndicator(),$wrapper.removeClass(o))}}.call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{underscore:2}],13:[function(e,t){var n=e("underscore");e("models/user-current/user-current");var r=t.exports={domainNormal:"yandex.ru",isEmail:function(e){var t=/^[-a-zа-яё0-9!#$%&'*+\/=?^_`{|}~]+(?:\.[-a-zа-яё0-9!#$%&'*+\/=?^_`{|}~]*)*@(?:[a-zа-яё0-9]([-a-zа-яё0-9]{0,61}[a-zа-яё0-9])?\.)+(?:aero|arpa|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|рф|[a-z]{2})$/i;return t.test("string"==typeof e&&e.toLowerCase())},isEmailYandex:function(e){if(!r.isEmail(e))return!1;var t=e.split("@")[1],s=ns.Model.get("userCurrent").getDomainsYandex();return n.contains(s,t)},normalize:function(e){return e=e&&e.toLowerCase(),r.isEmailYandex(e)?e.split("@")[0].split(".").join("-")+"@"+r.domainNormal:e}}},{"models/user-current/user-current":177,underscore:2}],14:[function(e,t){function n(e,t){if("undefined"==typeof t&&(t=2),0>e||0>=t)return e.toString();var n=Math.pow(10,t-1);return e>=n?e.toString():Array(n.toString().length-e.toString().length+1).join("0")+e}t.exports={secondsToTime:function(e,t){var r=0>e;t=t||":",r&&(e=Math.abs(e));var s=Math.floor(e/3600),a=n(Math.floor(e%3600/60)),i=n(e%60);return(r?"-":"")+(s?s+t:"")+a+t+i},timestampToDate:function(e,t){var r=new Date(1e3*e),s=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],a=["Января","Февраля","Марта","Апреля","Мая","Июня","Июля","Августа","Сентября","Октября","Ноября","Декабря"];return"undefined"==typeof t&&(t="DD.MM.YYYY HH:mm"),t.replace(/([a-zA-Z]{1,4})/g,function(e,t){switch(t){case"M":return r.getMonth()+1;case"MM":return n(r.getMonth()+1);case"mmmm":return a[r.getMonth()];case"MMMM":return s[r.getMonth()];case"D":return r.getDate();case"DD":return n(r.getDate());case"YY":return r.getFullYear()%100;case"YYYY":return r.getFullYear();case"H":return r.getHours();case"HH":return n(r.getHours());case"m":return r.getMinutes();case"mm":return n(r.getMinutes());case"s":return r.getSeconds();case"ss":return n(r.getSeconds());default:return t}})},dateToTimestamp:function(e,t,n,r,s,a,i){var o,c=arguments.length;e=e||0,t=t||0,n=n||1,r=r||0,s=s||0,a=a||0,i=i||0;var l=e;return o=0===c?Date.now():1===c?new Date(l):new Date(e,t,n,r,s,a,i),Math.floor(o/1e3)},numberToInterval:function(e,t){var n,r=t.length,s=t[0],a=t[r-1];if(s>=e)return"<= "+s;if(e>a)return"> "+a;for(var i=0;r-1>i;i++)if(s=t[i],a=t[i+1],e>s&&a>=e){n=s+1+" - "+a;break}return n}}},{}],15:[function(e,t){var n=1,r=function(){return n++};r.reset=function(e){n="undefined"==typeof e?1:e},t.exports=r},{}],16:[function(e,t){e("underscore");var n=e("config"),r=e("environment"),s=e("models/user-current/user-current"),a=e("helpers/tns"),i=e("helpers/string"),o=e("helpers/metrika");e("libs/modernizr-tests"),e("libs/fixes-ie"),e("libs/extensions.nb"),t.exports=function(){window.history.redirect(),n.idClient=i.md5(s.get(".uid")+String((new Date).getTime())),ns.request.requestParams.idClient=n.idClient,ns.request.requestParams.sk=r.session.sk,ns.request.requestParams.version=n.version,ns.request.canProcessResponse=function(e){return e.error?!1:e.uid!==s.get(".uid")?(ns.action.run("app.auth"),!1):e.version!==n.version?(ns.action.run("app.refresh"),!1):(ns.request.requestParams.sk!==e.sk&&(ns.request.requestParams.sk=e.sk),!0)},ns.page.title=function(){var e="Яндекс.Диск";return e};var e=ns.history.pushState;ns.history.pushState=function(t,n){var r=window.location.href;e.apply(ns.history,arguments),o.hit(t,n,r,null)};var t=ns.history.onpopstate;return ns.history.onpopstate=function(){var e=window.location.href,n=window.location.origin+ns.page.currentUrl,r=ns.page.title(e);o.hit(e,r,n,null),t.apply(ns.history,arguments)},ns.init(),r.session.loadingFailed?ns.page.go("/client/error","preserve"):(a.init(),ns.page.go())}},{config:6,environment:8,"helpers/metrika":17,"helpers/string":25,"helpers/tns":27,"libs/extensions.nb":34,"libs/fixes-ie":35,"libs/modernizr-tests":36,"models/user-current/user-current":177,underscore:2}],17:[function(e,t){!function(n){function r(e,t){return f.push(function(){try{m=n["yaCounter"+e]=new n.Ya.Metrika({id:e,webvisor:!0,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,ut:"noindex"}),h.fulfill()
}catch(t){h.reject()}}),v=t,s(),h}function s(){var e=document.getElementsByTagName("script")[0],t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="//mc.yandex.ru/metrika/watch.js",$(function(){e.parentNode.insertBefore(t,e)})}function a(e){return function(){var t=arguments;h.then(function(){e.apply(null,t)})}}function i(e){return function(){try{m[e].apply(m,arguments)}catch(t){}}}function o(e){return function(){var t=p.toArray(arguments),n=JSON.stringify(t);if(c(n))throw new Error("Wrong Yandex.Metrika call: "+n+" contains double-byte characters. Please use latin characters and numbers.");return e.apply(null,arguments)}}function c(e){return/[^\u0000-\u00ff]/.test(e)}function l(e,t,n){x[e]||(x[e]={}),x[e][t]||(x[e][t]=[]),x[e][t].push(n)}function d(e,t){x[e.key]&&x[e.key][t]&&p.each(x[e.key][t],function(t){t.call(e)})}function u(e,t){x[e.key]&&(t&&x[e.key][t]?delete x[e.key][t]:delete x[e.key])}var p=e("underscore"),f=n.yandex_metrika_callbacks=[],h=new Vow.Promise,m=null,v=[],g={},y=a(i("hit")),b=a(o(function(){i("params").apply(null,v.concat(p.toArray(arguments)))})),_=a(o(i("reachGoal"))),k=a(o(function(){var e=p.toArray(arguments).join(",");g[e]=(g[e]||0)+1})),w=a(function(){var e=p.toArray(arguments),t=e.join(",");g[t]&&(e.push(g[t].toString()+" time(s)"),b.apply(null,e),delete g[t])});h.then(function(){function e(e){var n=$(e.currentTarget),r=n.data("metrika-"+e.type),s=t(n.data("metrika-params"));if("count"===r)s.forEach(function(e){b.apply(null,e)});else if("reach"===r)s.forEach(function(e){_.apply(null,e)});else if(r)throw new Error("Wrong Yandex.Metrika call: Unexpected `data-metrika-"+e.type+"` action.")}function t(e){if(p.isString(e)&&""!==e)return p.map(e.split("|"),function(e){return e.split(",")});throw new Error("Wrong Yandex.Metrika call: No `data-metrika-params` passed.")}var n=$("body");p.each(["click","dblclick"],function(t){n.on(t,"[data-metrika-"+t+"]",e)})});var x={};n.yr&&(yr.externals.addShowHookMetrika=function(e,t,n){var r;"count"===e?r=b:"reach"===e&&(r=_),p.isFunction(r)&&l(t,"show",function(){r.apply(null,n)})}),t.exports={init:r,count:b,reach:_,hit:y,accumulate:k,release:w,hooks:{execute:d,drop:u}}}.call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{underscore:2}],18:[function(e,t){function n(e,t,n){var r=s.clone(n);t&&(r.gid=t);var i=ns.Model.get(e,{id:a()}).setData(r);return ns.Model.get("operations").insert(i),i.init(),i}function r(e){var t=e.type,n=e.data.source&&o.normalize(e.data.source),r=e.data.target&&o.normalize(e.data.target);return"move"===t?o.dirname(n)!==o.dirname(r)?"move":"rename":"trash"===t?"delete":"copy"===t?"copy":"aviary"===t?"saveEditorPhoto":!1}var s=e("underscore"),a=e("./guid"),i=e("./string"),o=e("helpers/path");e("../models/operations/operations"),t.exports={create:function(e,t){var n=this.initialize(e,t);return s.isArray(n)?s.invoke(n,"run"):n.run(),n},initialize:function(e,t){return/^operation/.test(e)||(e="operation"+i.capitalize(e)),s.isArray(t)?s.map(t,s.partial(n,e,a())):n(e,null,t)},initializeRemote:function(e){var t="operationRemote"+i.capitalize(e),n=ns.Model.get(t,{id:a()});return n},catchUp:function(e){var t=r(e);if(t){t="operation"+i.capitalize(t);var n=ns.Model.get(t,{id:a()}).setData({oid:e.id});ns.Model.get("operations").insert(n),n.initFromMessage(e)}}}},{"../models/operations/operations":107,"./guid":15,"./string":25,"helpers/path":20,underscore:2}],19:[function(e,t){var n,r=e("underscore"),s=e("helpers/path"),a=20,i=t.exports={go:function(e,t){if(!arguments.length)throw new Error("`go` should be called with arguments. Use `update` to update views.");clearTimeout(n);var r=ns.router(e),s=ns.page.current.params.idContext===r.params.idContext,a=ns.page.current.params.dialog===r.params.dialog;!t&&s&&a&&(t=!0);var i=ns.page.go(e,t);return s||i.then(function(){ns.events.trigger("ufo-context-changed")}),i},update:function(){clearTimeout(n),n=setTimeout(ns.page.go.bind(null,null,"preserve"),a)},getUrlBase:function(e){var t,n=$.extend(!0,{},ns.page.current.params,e);t=i.isSearch(n)?e&&e.typeSearch?r.pick(n,"querySearch","scopeSearch","typeSearch"):r.pick(n,"querySearch","scopeSearch"):r.pick(n,"idContext","page","idPage"),t.idContext&&(t.idContext=s.escape(t.idContext));var a=ns.router.generateUrl(ns.page.current.page,t);return a=decodeURIComponent(a)},scrollToTop:function(){window.scrollTo(0,0)},isSearch:function(e){var t=e||ns.page.current.params;return!!(t&&t.querySearch&&t.scopeSearch)},deferFollowLink:function(e,t){var n=$(e.currentTarget).attr("href");return n&&!e.isDefaultPrevented()?(t(),e.metaKey||e.ctrlKey||(e.preventDefault(),window.setTimeout(function(){window.location.href=n},700)),!1):void 0},appendImage:function(e){return this.containerImage||(this.containerImage=$("<div />",{"class":"js-images-container _hidden"}).appendTo("body")),$("<img />",{src:e}).appendTo(this.containerImage)}}},{"helpers/path":20,underscore:2}],20:[function(e,t){function n(e,t){return e?r.map(e.split("/"),t).join("/"):void 0}var r=e("underscore"),s=t.exports={split:function(e){var t=e?e.split("/"):[];return r.compact(t)},basename:function(e){var t=s.split(e);return r.last(t)||null},dirname:function(e){var t=s.split(e);return t.pop(),t.length?"/"+t.join("/"):null},extname:function(e){var t=s.basename(e);if(!t)return"";var n=t.length,r=n-t.lastIndexOf(".");return r>=n?"":t.substr(-r)},normalize:function(e){return e?"/"+s.split(e.replace(/^(\d+):/,"")).join("/"):"/"},join:function(){return s.normalize(r.flatten(r.toArray(arguments)).join("/"))},isParent:function(e,t){var n=s.split(t),r=s.split(e);if(r.length===n.length)return!1;for(var a=0,i=r.length;i>a;a+=1){if(0===a&&"narod"===r[a]&&-1!==["narod","lnarod"].indexOf(n[a]))return!0;if(r[a]!==n[a])return!1}return!0},escape:function(e){return n(e,encodeURIComponent)},unescape:function(e){return n(e,decodeURIComponent)}}},{underscore:2}],21:[function(e,t){var n="invite",r="photos_import",s="photos_export",a=[],i={importPhotos:{vkontakte:["photos"],facebook:["user_photos"],odnoklassniki:a,mailru:a,google:["https://picasaweb.google.com/data/"],instagram:a},exportPhotos:{vkontakte:["photos"],facebook:["user_photos","publish_actions"],odnoklassniki:["PHOTO_CONTENT"],mailru:["photos"]},invite:{vkontakte:a,facebook:["user_birthday","email","offline_access","xmpp_login"],odnoklassniki:a,mailru:a}},o=function(e,t){var o;return t===n?o=i.invite[e]:t===r?o=i.importPhotos[e]:t===s&&(o=i.exportPhotos[e]),o||a};t.exports={getScopes:o}},{}],22:[function(e,t){var n=e("underscore"),r=e("helpers/path"),s=e("helpers/uri"),a=e("models/user-current/user-current"),i=e("consts");e("models/settings/settings");var o=ns.Model.get("settings"),c=a.get(".foldersDefault.social"),l=e("./dicts/apps"),d=e("./dicts/icons"),u=t.exports={};u.create=function(e,t){var n=ns.Model.get("resource",{id:r.normalize(e.id)}).setData(e);return t&&t.silent||n.notifyCreated(t),n},u.createPart=function(e,t){var e=n.clone(e);no.jpath.set(".state.part",e,!0);var r=u.create(e,{silent:!0});return t&&t.silent||r.notifyCreated(t),r},u.getIdUnique=function(e,t){var n=t?e+"_"+t:e,r=ns.Model.getValid("resource",{id:n});return r?(t=t?t+1:1,u.getIdUnique(e,t)):n},u.getParents=function(e){for(var t=[];e=r.dirname(e);)t.unshift({id:e,name:u.getAlias(e)});return t},u.getAlias=function(e){var t;return"/disk"===e?t="Яндекс.Диск":"/yavideo"===e?t="Яндекс.Видео":r.basename(e)},u.updateParentsOf=function(e){var t=r.dirname(e),s=n.isNull(r.dirname(t));if(!s){var a=ns.Model.getValid("resource",{id:t});a&&a.fetch(),u.updateParentsOf(t)}},u.preprocess=function(e){e.id=r.normalize(e.id),e.name=e.name||r.basename(e.id),e.isInTrash=0===e.id.indexOf("/trash/"),e.isVisitable=!("dir"!==e.type||e.isInTrash||e.state&&e.state.part),e.idEncoded=r.escape(e.id),e.hasfolders=!!e.hasfolders,no.jpath(".meta.group",e)&&n.extend(e.meta.group,{readonly:640==e.meta.group.rights,readwrite:660==e.meta.group.rights,in_readonly:640==e.meta.group.rights&&!e.meta.group.is_root,in_shared:!e.meta.group.is_root}),e.parents||(e.parents=u.getParents(e.id));var t=no.jpath(".meta.original_parent_id",e);return t&&(e.parentsOriginal=u.getParents(r.join(t,e.name))),"file"===e.type?(e.icon=u.getIconFile(e),e.app=u.getAppFile(e)):e.icon=u.getIconFolder(e),e.hasPreview="file"===e.type&&!(!e.meta||!e.meta.sizes),no.jpath(".meta.sizes",e)&&n.each(e.meta.sizes,function(t){r.isParent("/yavideo",e.id)||(t.url=s.replaceTld(t.url,s.getTldRootCurrent())),t.url=s.addPrefixDownloader(t.url),t.url=s.cutProto(t.url)}),e.isExportable=no.jpath(".state.part",e)?"file"===e.type&&-1!==["jpg","png"].indexOf(e.icon):"file"===e.type&&e.meta&&"image"==e.meta.mediatype&&e.meta.sizes&&-1!==["image/jpeg","image/png"].indexOf(e.meta.mimetype),e.isEditable=e.isExportable,e},u.getIconFile=function(e){var t=e.meta&&2==e.meta.drweb,n=r.extname(e.name).toLowerCase(),s=e.meta&&e.meta.mediatype||"";return t&&d.virus||d.extnames[n]||d.mediatypes[s]||d["default"]},u.getIconFolder=function(e){var t="dir",n=u.isSocialFolder(e),r=no.jpath(".meta.group.is_shared && 1 == .meta.group.is_root",e);return"/disk"==e.id?t="root":"/trash"==e.id?t="trash":r?t="shared":c===e.id?t="social":n?(t=u.getIconSocial(e),r&&(t+="-shared")):u.isCamera(e.id)?t="photostream":u.isScreenshots(e.id)&&(t="screenshots"),t},u.getAppFile=function(e){var t=r.extname(e.name).toLowerCase(),s=e.meta&&e.meta.mimetype,a=e.meta&&e.meta.mediatype,i=e.meta&&e.meta.sizes;if(e.isInTrash)return null;if(e.state&&e.state.part)return null;if("video"===a&&Modernizr.videostream&&!r.isParent("/mail",e.id))return"slider";if("image"===a&&i)return r.isParent("/mail",e.id)?"docviewer":"slider";var c=n.reduce(l,function(e,r,a){return n.contains(r.mimetypes,s)||n.contains(r.extnames,t)?a:e},null);return c&&r.isParent("/narod",e.id)&&!o.get(".narodMigrated")?null:c},u.isCamera=function(e){return a.get(".foldersDefault.photostream")===e},u.isScreenshots=function(e){return a.get(".foldersDefault.screenshots")===e},u.isNameInvalid=function(e){return e.indexOf("/")>-1},u.getIconSocial=function(e){return e.meta&&e.meta.folder_type},u.isSocialFolder=function(e){return e.meta&&-1!=i.TYPE_FOLDER_SOCIAL.indexOf(e.meta.folder_type)},u.isInsideFolderSocial=function(e){return r.isParent(c,e)&&c!=r.dirname(e)},u.isSocialOrDescendant=function(e){return c===e||r.isParent(c,e)},u.isInsideFolderCamera=function(e){return r.isParent(a.get(".foldersDefault.photostream"),e)},u.getIdInvite=function(e,t){return r.join("disk","."+e+"-"+t)},u.inviteToResource=function(e){return{id:u.getIdInvite(e.gid,e.folder_name),name:e.folder_name,ctime:e.ctime,type:"dir",meta:{size:e.size,group:{is_root:1,gid:e.gid,owner:{username:e.owner_name,uid:e.owner_uid}}},invite:n.pick(e,"rights","status","hash")}}},{"./dicts/apps":10,"./dicts/icons":11,consts:7,"helpers/path":20,"helpers/uri":29,"models/settings/settings":153,"models/user-current/user-current":177,underscore:2}],23:[function(e,t){function n(e){for(var t=0,n=y.length;n>t;t++)if(e==y[t])return b[t]}function r(e,t,r,s,a){return-1!==$.inArray(t,["ru","uk","tr"])&&(e=e.replace(/\./,",")),s&&a?e=e+" "+n(r):a||(e=n(r)),e}function s(e){for(var t=y.length;t>=0;t--){var n=y[t];if(a(e,n))return n}return y[0]}function a(e,t){return e>=t}function i(e,t){var n;return n="best unit"===t?s(e):t,e/=n,{number:e,unit:n}}function o(e,t,n){var r=e;if(void 0!==t)if(n)r=e.toFixed(t);else{var s=Math.pow(10,t);r=(Math.round(e*s)/s).toString()}return r}function c(e){return e.replace(/\.[0-9]*/,"")}function l(e,t){var n=c(e),r=e.replace(/[0-9]*\.?/,"").slice(0,t);return n+(0!=r?"."+r:"")}function d(e,t,n,r,s){if(!r)switch(t){case"length":var a=c(e).length;e=l(e,s>=a?s-a:0);break;case"precise":n==h&&(e=l(e,0)),n==m&&(e=l(e,1)),n==v&&(e=l(e,2));break;case"rough":(n==h||n==m||n==v&&c(e)>=100)&&(e=l(e,0)),n==v&&(e=l(e,1))}return e}var u=e("underscore"),p=e("environment"),f=1,h=1024,m=Math.pow(h,2),v=Math.pow(h,3),g=Math.pow(h,4),y=[f,h,m,v,g],b=["байт","КБ","МБ","ГБ","ТБ"],_=function(e){return this instanceof _?(e=parseFloat(e,10),this.bytes=e>0&&e||0,this.locale=p.session.locale||"ru",this.units="best unit",this.fixed=!1,this.withUnit=!0,this.withNumber=!0,this.calculation="precise",void 0):new _(e)},k={"best unit":function(){this.units="best unit"},GB:function(){this.units=v},MB:function(){this.units=m},KB:function(){this.units=h},fixed:function(){this.fixed=!0},"float":function(){this.fixed=!1},"int":function(){this.precision=0},precision:function(e){this.precision=e},number:function(){this.withUnit=!1},unit:function(){this.withNumber=!1},precise:function(){this.calculation="precise"},rough:function(){this.calculation="rough"},length:function(e){this.calculation="length",this.length=e}};_.prototype.format=function(){var e=u.toArray(arguments);if(e.length){var t=e[0],n=e.slice(1);"function"==typeof k[t]&&k[t].apply(this,n)}return this},_.prototype.getString=function(){var e=i(this.bytes,this.units),t=this.getNumber().toString();return t=r(t,this.locale,e.unit,this.withUnit,this.withNumber)},_.prototype.getNumber=function(){var e=i(this.bytes,this.units),t=d(e.number.toString(),this.calculation,e.unit,this.precision,this.length);return t=o(parseFloat(t,10),this.precision,this.fixed)},_.prototype.getUnit=function(){return n(i(this.bytes,this.units).unit)},t.exports=_},{environment:8,underscore:2}],24:[function(e,t){var n=e("helpers/page");t.exports={count:function(e){n.appendImage(this._getUrl(e))},_getUrl:function(t){var n=[];for(key in t)n.push(key+"="+t[key]);return e("config").links.statbox+"/"+n.join("/")+"/*"}}},{config:6,"helpers/page":19}],25:[function(e,t){function n(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(192|r>>6),t+=String.fromCharCode(128|63&r)):(t+=String.fromCharCode(224|r>>12),t+=String.fromCharCode(128|63&r>>6),t+=String.fromCharCode(128|63&r))}return t}var r=e("./format");t.exports={capitalize:function(e){return"string"==typeof e&&e.length?e.charAt(0).toUpperCase()+e.slice(1):e},isEmail:function(e){var t=/^[-a-zа-яё0-9!#$%&'*+\/=?^_`{|}~]+(?:\.[-a-zа-яё0-9!#$%&'*+\/=?^_`{|}~]*)*@(?:[a-zа-яё0-9]([-a-zа-яё0-9]{0,61}[a-zа-яё0-9])?\.)+(?:aero|arpa|asia|biz|cat|com|coop|edu|gov|info|int|jobs|mil|mobi|museum|name|net|org|pro|tel|travel|рф|[a-z]{2})$/i;return t.test("string"==typeof e&&e.toLowerCase())},getUnique:function(){var e=null,t=1;return function(){var n=r.timestampToDate(Date.now()/1e3,"YYYY-MM-DD HH-mm-ss"),s=n;return n===e?(s=n+" ("+t.toString()+")",t+=1):t=1,e=n,s}}(),md5:function(e){var t,r,s,a,i,o,c,l,d,u=function(e,t){return e<<t|e>>>32-t},p=function(e,t){var n,r,s,a,i;return s=2147483648&e,a=2147483648&t,n=1073741824&e,r=1073741824&t,i=(1073741823&e)+(1073741823&t),n&r?2147483648^i^s^a:n|r?1073741824&i?3221225472^i^s^a:1073741824^i^s^a:i^s^a},f=function(e,t,n){return e&t|~e&n},h=function(e,t,n){return e&n|t&~n},m=function(e,t,n){return e^t^n},v=function(e,t,n){return t^(e|~n)},g=function(e,t,n,r,s,a,i){return e=p(e,p(p(f(t,n,r),s),i)),p(u(e,a),t)},y=function(e,t,n,r,s,a,i){return e=p(e,p(p(h(t,n,r),s),i)),p(u(e,a),t)},b=function(e,t,n,r,s,a,i){return e=p(e,p(p(m(t,n,r),s),i)),p(u(e,a),t)},_=function(e,t,n,r,s,a,i){return e=p(e,p(p(v(t,n,r),s),i)),p(u(e,a),t)},k=function(e){for(var t,n=e.length,r=n+8,s=(r-r%64)/64,a=16*(s+1),i=Array(a-1),o=0,c=0;n>c;)t=(c-c%4)/4,o=8*(c%4),i[t]=i[t]|e.charCodeAt(c)<<o,c++;return t=(c-c%4)/4,o=8*(c%4),i[t]=i[t]|128<<o,i[a-2]=n<<3,i[a-1]=n>>>29,i},w=function(e){var t,n,r="",s="";for(n=0;3>=n;n++)t=255&e>>>8*n,s="0"+t.toString(16),r+=s.substr(s.length-2,2);return r},x=Array(),j=7,S=12,A=17,C=22,D=5,M=9,F=14,I=20,P=4,R=11,z=16,T=23,q=6,E=10,O=15,$=21;for(e=n(e),x=k(e),o=1732584193,c=4023233417,l=2562383102,d=271733878,t=0;t<x.length;t+=16)r=o,s=c,a=l,i=d,o=g(o,c,l,d,x[t+0],j,3614090360),d=g(d,o,c,l,x[t+1],S,3905402710),l=g(l,d,o,c,x[t+2],A,606105819),c=g(c,l,d,o,x[t+3],C,3250441966),o=g(o,c,l,d,x[t+4],j,4118548399),d=g(d,o,c,l,x[t+5],S,1200080426),l=g(l,d,o,c,x[t+6],A,2821735955),c=g(c,l,d,o,x[t+7],C,4249261313),o=g(o,c,l,d,x[t+8],j,1770035416),d=g(d,o,c,l,x[t+9],S,2336552879),l=g(l,d,o,c,x[t+10],A,4294925233),c=g(c,l,d,o,x[t+11],C,2304563134),o=g(o,c,l,d,x[t+12],j,1804603682),d=g(d,o,c,l,x[t+13],S,4254626195),l=g(l,d,o,c,x[t+14],A,2792965006),c=g(c,l,d,o,x[t+15],C,1236535329),o=y(o,c,l,d,x[t+1],D,4129170786),d=y(d,o,c,l,x[t+6],M,3225465664),l=y(l,d,o,c,x[t+11],F,643717713),c=y(c,l,d,o,x[t+0],I,3921069994),o=y(o,c,l,d,x[t+5],D,3593408605),d=y(d,o,c,l,x[t+10],M,38016083),l=y(l,d,o,c,x[t+15],F,3634488961),c=y(c,l,d,o,x[t+4],I,3889429448),o=y(o,c,l,d,x[t+9],D,568446438),d=y(d,o,c,l,x[t+14],M,3275163606),l=y(l,d,o,c,x[t+3],F,4107603335),c=y(c,l,d,o,x[t+8],I,1163531501),o=y(o,c,l,d,x[t+13],D,2850285829),d=y(d,o,c,l,x[t+2],M,4243563512),l=y(l,d,o,c,x[t+7],F,1735328473),c=y(c,l,d,o,x[t+12],I,2368359562),o=b(o,c,l,d,x[t+5],P,4294588738),d=b(d,o,c,l,x[t+8],R,2272392833),l=b(l,d,o,c,x[t+11],z,1839030562),c=b(c,l,d,o,x[t+14],T,4259657740),o=b(o,c,l,d,x[t+1],P,2763975236),d=b(d,o,c,l,x[t+4],R,1272893353),l=b(l,d,o,c,x[t+7],z,4139469664),c=b(c,l,d,o,x[t+10],T,3200236656),o=b(o,c,l,d,x[t+13],P,681279174),d=b(d,o,c,l,x[t+0],R,3936430074),l=b(l,d,o,c,x[t+3],z,3572445317),c=b(c,l,d,o,x[t+6],T,76029189),o=b(o,c,l,d,x[t+9],P,3654602809),d=b(d,o,c,l,x[t+12],R,3873151461),l=b(l,d,o,c,x[t+15],z,530742520),c=b(c,l,d,o,x[t+2],T,3299628645),o=_(o,c,l,d,x[t+0],q,4096336452),d=_(d,o,c,l,x[t+7],E,1126891415),l=_(l,d,o,c,x[t+14],O,2878612391),c=_(c,l,d,o,x[t+5],$,4237533241),o=_(o,c,l,d,x[t+12],q,1700485571),d=_(d,o,c,l,x[t+3],E,2399980690),l=_(l,d,o,c,x[t+10],O,4293915773),c=_(c,l,d,o,x[t+1],$,2240044497),o=_(o,c,l,d,x[t+8],q,1873313359),d=_(d,o,c,l,x[t+15],E,4264355552),l=_(l,d,o,c,x[t+6],O,2734768916),c=_(c,l,d,o,x[t+13],$,1309151649),o=_(o,c,l,d,x[t+4],q,4149444226),d=_(d,o,c,l,x[t+11],E,3174756917),l=_(l,d,o,c,x[t+2],O,718787259),c=_(c,l,d,o,x[t+9],$,3951481745),o=p(o,r),c=p(c,s),l=p(l,a),d=p(d,i);var V=w(o)+w(c)+w(l)+w(d);return V.toLowerCase()},processHashResource:function(e){var t=e.split(":/"),n=t.length>1?":/"+t.slice(1).join(":/"):"";return t[0].replace(/\s/g,"+")+n}}},{"./format":14}],26:[function(e,t){t.exports={getDifferenceInDays:function(e,t){return Math.abs(Math.floor((e-t)/60/60/24))}}},{}],27:[function(e,t){function n(e){(new Image).src=e}var r=e("underscore"),s="yandex_disk";t.exports={init:r.once(function(){var e=Date.now(),t=document.referrer.replace(/\*/g,"%2a");n("//www.tns-counter.ru/V13a***R>"+t+"*yandex_ru/ru/CP1251/tmsec="+s+"/"+e)})}},{underscore:2}],28:[function(e,t){t.exports={scaleDimensionsToArea:function(e,t){var n=e[0]/e[1],r=t[0]/t[1];return r>n?[Math.round(e[0]*t[1]/e[1]),t[1]]:[t[0],Math.round(e[1]*t[0]/e[0])]}}},{}],29:[function(e,t){var n=t.exports={cutProto:function(e){return e.replace(/^(https:|http:)/,"")},replaceTld:function(e,t){var n=e.match(/(?:(?:https?\:)?\/\/)?[^\/]*/g)[0],r=n.replace(/(com\.tr|[^\.]+)$/,t);return e.replace(n,r)},getTldCurrent:function(e){return(e||window.location.host).replace(/^.+\.yandex\./,"")},getTldRootCurrent:function(e){var t=n.getTldCurrent(e);return"ua"===t?"ru":t},getLocaleInvite:function(){var e=n.getTldCurrent(),t="ru";return"com.tr"===e?t="tr":"com"===e?t="en":"ua"===e&&(t="uk"),t},makeRelative:function(e){return e=e.replace(/^(https:|http:)/,"").replace(/^\/\//,""),"/"+e.split("/").slice(1).join("/")},addPrefixDownloader:function(e){function t(e){for(var t=0,n=0,r=e.length;r>n;n++){var s=e.charCodeAt(n);t=(t<<5)-t+s,t|=0}return t>>>=0}if(/^(https?:)?\/\/downloader\.(dst|disk)\.yandex\./.test(e)){var n=t(e)%4+1;return e.replace(/^(.*?\/\/)/,"$1"+n+".")}return e}}},{}],30:[function(e,t){var n=e("helpers/operation");t.exports={handleMessage:function(e){var t,r,s=[],a=e.root.tag;"diff"===a?t=n.initializeRemote("resource"):"quota"===a?s=s.concat(["space","offersSpacePaid","offersSpaceFree","packagesSpace"]):"invite"===a?s.push("invitees"):"share"===a&&(t=n.initializeRemote("share")),t&&(t.setData(e),r=t.toLocal(),r&&r.complete()),s.forEach(function(e){ns.Model.getValid(e)&&ns.Model.get("queueRequest").pushPriority({id:e})})}}},{"helpers/operation":18}],31:[function(e,t){e("views/layout/layout-errors"),e("views/page-error/page-error"),e("views/header/header"),e("views/forms/form-search/form-search"),e("views/app/app"),t.exports=ns.layout.define("errors",{app:{"layout@":{layoutErrors:{pageError:{header:{"boxFormSearch@":"formSearch"}}}}}})},{"views/app/app":195,"views/forms/form-search/form-search":239,"views/header/header":240,"views/layout/layout-errors":255,"views/page-error/page-error":263}],32:[function(e,t){e("views/not-found/not-found"),t.exports=ns.layout.define("not-found",{app:{notFound:!0}})},{"views/not-found/not-found":261}],33:[function(e,t){function n(e){return{contentSinglePane:{"boxPage@":e,header:p.header,notifications:!0,progressbars:p.progressbars,"boxSlices@":p["boxSlices@"]}}}function r(e){return a.contains(["/shared","/published",d.get(".foldersDefault.photostream")],e)}function s(){var e=ns.Model.getValid("invitesFolder");return e&&!a.isEmpty(e.models)}e("models/invites/invites-folder"),e("models/operations/operations-active"),e("models/operations/operations-upload"),e("models/queues/queue-confirmations"),e("models/resource/resource"),e("models/resources/resources"),e("models/slices/slices"),e("models/payment/state-form-payment"),e("models/video-info/video-info"),e("models/albums-social/albums-social"),e("models/state-export-social/state-export-social"),e("models/states-context/states-context"),e("models/settings/settings"),e("views/ads/ads"),e("views/app/app"),e("views/aside/aside"),e("views/aside-audio/aside-audio"),e("views/aside-multiple/aside-multiple"),e("views/aside-tree/aside-tree"),e("views/awaps/awaps"),e("views/albums-social/albums-social"),e("views/albums-social/group-albums-social"),e("views/banner/banner"),e("views/clean-trash/clean-trash"),e("views/confirmations/confirmation"),e("views/confirmations/confirmation-prompt"),e("views/contacts/contacts-invite-disk/contacts-invite-disk"),e("views/crumbs/crumbs"),e("views/dialogs/dialog-welcome/dialog-welcome"),e("views/dialogs/dialog-slice/dialog-slice"),e("views/dialogs/dialog-invitees/dialog-invitees"),e("views/dialogs/dialog-create-folder-shared/dialog-create-folder-shared"),e("views/dialogs/dialog-access-folder/dialog-access-folder"),e("views/dialogs/dialog-access-folder/title-access-folder"),e("views/dialogs/dialog-access-folder/toolset-access-folder/toolset-access-folder"),e("views/dialogs/dialog-access-folder/warning-access-folder/warning-access-folder"),e("views/dialogs/dialog-invite-disk/dialog-invite-disk"),e("views/dialogs/dialog-invite-disk/toolset-invite-disk/toolset-invite-disk"),e("views/dialogs/dialog-edit-photo/dialog-edit-photo"),e("views/dialogs/dialog-promo-editor/dialog-promo-editor"),e("views/dialogs/dialog-promo-export/dialog-promo-export"),e("views/dialogs/dialog-export-social/dialog-export-social"),e("views/dialogs/dialog-confirm-export-social/dialog-confirm-export-social"),e("views/dialogs/dialog-refresh-token-social/dialog-refresh-token-social"),e("views/dialogs/dialog-message/dialog-message"),e("views/dialogs/dialog-upload/dialog-upload"),e("views/dropzone/dropzone"),e("views/dropzone-small/dropzone-small"),e("views/fetch/resource"),e("views/fetch/resource-context"),e("views/fetch/resources"),e("views/fetch/video-info"),e("views/footer/footer"),e("views/forms/form-invite-folder/form-invite-folder"),e("views/forms/form-search/form-search"),e("views/header/header"),e("views/invites/invites"),e("views/layout/layout-panels"),e("views/listing/listing"),e("views/loader-portion/loader-portion"),e("views/location-resource/location-resource"),e("views/link-import-social/link-import-social"),e("views/notifications/notifications"),e("views/panes/content-dual-pane/content-dual-pane"),e("views/panes/content-single-pane/content-single-pane"),e("views/panes/content-search/content-search"),e("views/photostream/photostream"),e("views/player-video-html/player-video-html"),e("views/player-video-container/player-video-flv"),e("views/player-video-container/player-video-yandex"),e("views/progressbars/progressbar-common"),e("views/progressbars/progressbar-upload"),e("views/progressbars/progressbars"),e("views/resources/resources"),e("views/select-folder/select-folder"),e("views/slices/slice-link-mail/slice-link-mail"),e("views/slices/slice-shared/slice-shared"),e("views/slices/slices"),e("views/slider/slider"),e("views/slider/slider-bar"),e("views/slider/slider-item"),e("views/slider/slider-stream"),e("views/stickies/stickies"),e("views/stickies/sticky-invites"),e("views/stub/stub"),e("views/toolset/toolset"),e("views/tree/tree"),e("views/tree-menu/tree-menu"),e("views/invitees/invitees-folder/invitees-folder"),e("views/users/users-folder/users-folder"),e("views/page-tuning/page-tuning"),e("views/page-tuning/tuning-space"),e("views/page-payment/page-payment"),e("views/page-invites/page-invites"),e("views/page-import-social/page-import-social"),e("views/invitees/invitees"),e("views/space/offers-space-free"),e("views/space/packages-space"),e("views/space/packages-space-paid"),e("views/info-space/info-space"),e("views/hint-search/hint-search-query"),e("views/hint-search/hint-search-action"),e("views/hint-search/hint-search-scope-disk"),e("views/hint-search/hint-search-scope-trash"),e("views/hint-search/hint-search-scope-mail"),e("views/forms/form-payment/form-payment"),e("views/crumbs/crumbs-page"),e("views/attach-link/attach-link");var a=e("underscore"),i=e("helpers/path"),o=e("helpers/page"),c=e("helpers/resource"),l=e("environment"),d=e("models/user-current/user-current"),u=e("consts"),p={header:{"boxFormSearch@":"formSearch"},progressbars:{"boxProgressbars@":function(e){var t={progressbarCommon:!0},n=ns.Model.get("operationsUpload");return n.models.length&&!a.contains(["upload","dropzone"],e.dialog)&&(t.progressbarUpload={progressbarUploadBack:!0,progressbarUploadFront:!0}),t}},"boxSlices@":function(){return{slices:{"sliceLinkMail&":!0,"sliceShared&":!0}}},"boxAside@":function(e){var t={};if(e.dragging.length)t["asideTree&"]=!0;else if(e.selected.length>1)t.asideMultiple=!0;else{t.ads={infoSpace:!0,"awaps&":!0};var n,r=ns.Model.get("resource",{id:e.idContext}),s=!("/disk"===e.idContext||r.get(".isSlice")&&"/trash"!==e.idContext||o.isSearch(e)||i.isParent("/yavideo",e.idContext));if(1===e.selected.length?n=ns.Model.get("resource",{id:e.selected[0]}):s&&(n=r),n&&!n.isValid())t.fetchResourceContext=!0;else if(n&&!n.get(".error")){t.aside={},"dir"!==n.get(".type")||"/trash"===n.get(".id")||i.isParent("/yavideo",n.get(".id"))||(t.aside={"boxUsersFolder@":!0}),!n.get(".state.hidden")&&n.get(".meta.group.is_root")&&(t.aside["boxUsersFolder@"]="usersFolder&"),"player"===n.get(".app")&&(t.aside["boxAsideAudio@"]=n.get(".state.part")||n.get(".state.blocked")?!0:"asideAudio"),"/trash"===n.get(".id")&&n.get(".id")!==e.idContext&&(t.aside={"cleanTrash&":!0}),t.aside["boxLocationResource@"]={};var a="search"===e.idContext&&"mail"===e.scopeSearch;"/trash"===n.get(".id")||n.get(".invite")||i.isParent(e.idContext,n.get(".id"))||e.idContext===n.get(".id")||a||(t.aside["boxLocationResource@"]="locationResource")}}return t},"boxStickies@":function(e){return c.isSocialOrDescendant(e.idContext)?void 0:{stickies:"sticky-invites&"}}};t.exports=ns.layout.define("panels",{app:{"layout@":{banner:!0,layoutPanels:{"layerApp@":function(e){if("tuning"===e.page)return n({pageTuning:{"boxCrumbs@":"crumbsPage",tuningSpace:!0,offersSpaceFree:!0,packagesSpace:!0}});if("payment"===e.page){var t=ns.Model.get("stateFormPayment");return t.get(".idOfferSpace")!=e.idPage&&(t.setDataDefault(),t.set(".idOfferSpace",e.idPage)),n({pagePayment:{"boxCrumbs@":"crumbsPage",formPayment:!0,packagesSpacePaid:!0}})}if("invites"===e.page)return n({pageInvites:{"boxCrumbs@":"crumbsPage",invitees:!0}});if(r(e.idContext)){var d=ns.Model.getValid("resources",e);if(d&&d.isEmpty()&&("/shared"!==e.idContext||!s()))return n("stub")}if(o.isSearch(e))return{contentSearch:{header:p.header,notifications:!0,progressbars:p.progressbars,"boxSlices@":p["boxSlices@"],"boxListing@":function(e){var t=ns.Model.getValid("resources",e);if(!t)return"fetchResources&";var n={};return!t.get(".error")&&t.get(".linksSearch").length&&(n.hintSearchAction=!0),n.hintSearchQuery=!0,t.isEmpty()||("/disk"!==e.scopeSearch&&(n["hintSearchScopeDisk&"]=!0),"/trash"!==e.scopeSearch&&(n["hintSearchScopeTrash&"]=!0),"/mail"!==e.scopeSearch&&(n["hintSearchScopeMail&"]=!0)),n.listing={resources:!0,loaderPortion:!0},n},"boxAside@":p["boxAside@"],footer:!0}};var d=ns.Model.getValid("resources",e),u=ns.Model.getValid("resource",{id:e.idContext});if(!d||!u)return{contentDualPane:{"boxStickies@":p["boxStickies@"],header:p.header,notifications:!0,progressbars:p.progressbars,"boxSlices@":p["boxSlices@"],footer:!0,"boxLinkImportSocial@":{},"boxCrumbs@":{},"boxToolset@":{},"boxDropzone@":{},"boxListing@":"fetchResources&","boxAside@":"fetchResourceContext&"}};var f=d.isSocial();if(f&&d.isEmpty()&&"import-social"!=e.dialog)return a.defer(function(){o.go(o.getUrlBase()+"|import-social","replace"),d.invalidate(),u.invalidate()}),{contentDualPane:{"boxStickies@":p["boxStickies@"],header:p.header,notifications:!0,progressbars:p.progressbars,"boxSlices@":p["boxSlices@"],footer:!0,"boxLinkImportSocial@":{},"boxCrumbs@":{},"boxToolset@":{},"boxDropzone@":{},"boxListing@":{},"boxAside@":{}}};var h=-1!==["/yavideo","/narod"].indexOf(e.idContext),m=i.isParent("/yavideo",e.idContext)||i.isParent("/narod",e.idContext);if(d.isEmpty()&&(h||m))return m?o.go("/client"+i.dirname(e.idContext),"replace"):o.go("/client/disk","replace"),d.invalidate(),null;var v=d.get(".error.id");return v&&0===v.indexOf("HTTP_50")&&!h?a.defer(function(){o.go("/client/error","preserve"),d.invalidate()}):"HTTP_404"!==d.get(".error.id")||f||h||a.defer(function(){o.go("/client/disk"),d.invalidate()}),{contentDualPane:{"boxStickies@":p["boxStickies@"],header:p.header,notifications:!0,progressbars:p.progressbars,"boxSlices@":p["boxSlices@"],footer:!0,"boxLinkImportSocial@":function(e){return c.isSocialOrDescendant(e.idContext)?{"linkImportSocial&":!0}:void 0},"boxCrumbs@":function(e){return"/disk"!==e.idContext?"crumbs":void 0},"boxToolset@":function(e){return"/trash"===e.idContext?{toolset:"cleanTrash&"}:"toolset"},"boxDropzone@":function(e){var t=ns.Model.getValid("resource",{id:e.idContext}),n=ns.Model.get("resources",e);return!l.agent.isMobile&&Modernizr.uploaddrag&&t?"/disk"==e.idContext||n.isEmpty()&&t.allowsUpload()?"dropzoneSmall":!1:!1},"boxListing@":function(e){var t={listing:{}};return a.contains(["/disk","/shared"],e.idContext)&&(t.listing.invites=!0),"/mail"===e.idContext&&(t.listing["attach-link&"]=!0),"photostream"===e.display&&"month"===e.groupBy?t.listing.photostream=!0:t.listing.resources=!0,t.listing.loaderPortion=!0,t},"boxAside@":p["boxAside@"]}}},"layerWdg@":function(e){if(e.idDialog){var t=ns.Model.getValid("resource",{id:e.idDialog});if(!t||t.get('.error[.id=="HTTP_404"]'))return o.go(o.getUrlBase(),"preserve"),null}if("slider"===e.dialog&&e.idDialog){if(!e.idDialog)return null;if(!t)return"fetchResource";var n={slider:{"boxSliderItem@":{"slider-item":!0},"boxSliderBar@":"slider-bar","slider-stream&":!0}};if("video"===t.get(".meta.mediatype")&&Modernizr.videostream){var r=ns.Model.getValid("videoInfo",{id:e.idDialog});if(r){var s=!0;s=r.get(".canUseYandexVideo")?"playerVideoYandex":"flv"===Modernizr.videostream?"playerVideoFlv":"playerVideoHtml",n.slider["boxSliderItem@"]["slider-item"]=s}else n.slider["boxSliderItem@"]="fetchVideoInfo&"}return n}if("upload"===e.dialog)return"dialogUpload";if("access-folder"===e.dialog)return e.idDialog?t?0===t.get(".meta.group.is_owned")||t.get(".state.hidden")?(o.go(o.getUrlBase(),"preserve"),void 0):{dialogAccessFolder:{titleAccessFolder:!0,warningAccessFolder:!0,"boxInviteesFolder@":{inviteesFolder:!0},formInviteFolder:!0,toolsetAccessFolder:!0}}:"fetchResource":null;if("create-folder-shared"===e.dialog)return{"dialogCreateFolderShared&":{"treeMenu&":!0}};
if("import-social"===e.dialog)return{"pageImportSocial&":!0,notifications:!0};if("invites"===e.page&&"send"===e.idPage)return{dialogInviteDisk:{contactsInviteDisk:!0,toolsetInviteDisk:!0}};if("edit-photo"===e.dialog)return t?t.get(".state.hidden")?null:{dialogEditPhoto:!0}:"fetchResource";if("export-social"===e.dialog){var i=ns.Model.get("stateExportSocial").get(".idsResources");return i.length?{dialogExportSocial:{"boxAlbumsSocial@":function(){var e=ns.Model.get("stateExportSocial");return e.get(".serviceSelected")?{albumsSocial:{albumsSocialPublic:!0,albumsSocialFriends:!0,albumsSocialPrivate:!0}}:void 0}}}:(a.defer(function(){o.go(o.getUrlBase())}),null)}if("export-social-single"===e.dialog){var i=ns.Model.get("statesContext",e).get(".selected");return i.length&&e.service?{dialogConfirmExportSocial:!0}:(a.defer(function(){o.go(o.getUrlBase())}),null)}return"error"===d.get(".attemptAcceptInvite.result")?"dialogMessage":"invites"===e.page&&"all"===e.idPage?"dialogInvitees":"dropzone"===e.dialog?"dropzone":null},"layerModal@":function(e){var t=ns.Model.get("settings"),n=ns.Model.get("queueConfirmations").get(".active");if(n)return e.confirmation=n.params.confirmation,"select-folder"===n.get(".type")?{"select-folder":"tree&"}:"confirm-export-social"===n.get(".type")?"dialogConfirmExportSocial":"refresh-token-social"===n.get(".type")?"dialogRefreshTokenSocial":"prompt"===n.get(".type")?"confirmationPrompt":"confirmation";if(!l.agent.isMobile){if("promo-editor"===e.dialog)return"dialogPromoEditor";if("promo-export"===e.dialog)return"dialogPromoExport";if(/^\/disk/.test(e.idContext)&&e.idContext!==d.get(".foldersDefault.photostream")&&!t.get(".wasDialogClosed")){var r=t.get(".timestampLastDisplayedDialogWelcome"),s=t.get(".countDisplaysDialogWelcome"),o=!a.isEmpty(d.get(".devices"));if(d.get(".justInitialized")||!d.get(".justInitialized")&&!o&&3>s&&(!r||Date.now()-r>u.ONE_DAY))return"dialogWelcome"}if("/yavideo"==e.idContext||i.isParent("/yavideo",e.idContext)){var c=ns.Model.getValid("resources",e);if(!c||c.isEmpty())return;if(!t.get(".timestampDisplayedDialogYavideo"))return"dialogSlice"}}},"layerAuth@":function(){}}}}})},{consts:7,environment:8,"helpers/page":19,"helpers/path":20,"helpers/resource":22,"models/albums-social/albums-social":44,"models/invites/invites-folder":68,"models/operations/operations-active":105,"models/operations/operations-upload":106,"models/payment/state-form-payment":112,"models/queues/queue-confirmations":117,"models/resource/resource":133,"models/resources/resources":147,"models/settings/settings":153,"models/slices/slices":154,"models/state-export-social/state-export-social":166,"models/states-context/states-context":171,"models/user-current/user-current":177,"models/video-info/video-info":180,underscore:2,"views/ads/ads":191,"views/albums-social/albums-social":193,"views/albums-social/group-albums-social":194,"views/app/app":195,"views/aside-audio/aside-audio":198,"views/aside-multiple/aside-multiple":199,"views/aside-tree/aside-tree":200,"views/aside/aside":201,"views/attach-link/attach-link":202,"views/awaps/awaps":203,"views/banner/banner":204,"views/clean-trash/clean-trash":205,"views/confirmations/confirmation":207,"views/confirmations/confirmation-prompt":206,"views/contacts/contacts-invite-disk/contacts-invite-disk":209,"views/crumbs/crumbs":211,"views/crumbs/crumbs-page":210,"views/dialogs/dialog-access-folder/dialog-access-folder":212,"views/dialogs/dialog-access-folder/title-access-folder":213,"views/dialogs/dialog-access-folder/toolset-access-folder/toolset-access-folder":214,"views/dialogs/dialog-access-folder/warning-access-folder/warning-access-folder":215,"views/dialogs/dialog-confirm-export-social/dialog-confirm-export-social":216,"views/dialogs/dialog-create-folder-shared/dialog-create-folder-shared":217,"views/dialogs/dialog-edit-photo/dialog-edit-photo":218,"views/dialogs/dialog-export-social/dialog-export-social":219,"views/dialogs/dialog-invite-disk/dialog-invite-disk":220,"views/dialogs/dialog-invite-disk/toolset-invite-disk/toolset-invite-disk":221,"views/dialogs/dialog-invitees/dialog-invitees":222,"views/dialogs/dialog-message/dialog-message":223,"views/dialogs/dialog-promo-editor/dialog-promo-editor":224,"views/dialogs/dialog-promo-export/dialog-promo-export":225,"views/dialogs/dialog-refresh-token-social/dialog-refresh-token-social":226,"views/dialogs/dialog-slice/dialog-slice":227,"views/dialogs/dialog-upload/dialog-upload":228,"views/dialogs/dialog-welcome/dialog-welcome":229,"views/dropzone-small/dropzone-small":230,"views/dropzone/dropzone":231,"views/fetch/resource":233,"views/fetch/resource-context":232,"views/fetch/resources":234,"views/fetch/video-info":235,"views/footer/footer":236,"views/forms/form-invite-folder/form-invite-folder":237,"views/forms/form-payment/form-payment":238,"views/forms/form-search/form-search":239,"views/header/header":240,"views/hint-search/hint-search-action":241,"views/hint-search/hint-search-query":242,"views/hint-search/hint-search-scope-disk":243,"views/hint-search/hint-search-scope-mail":244,"views/hint-search/hint-search-scope-trash":245,"views/info-space/info-space":246,"views/invitees/invitees":250,"views/invitees/invitees-folder/invitees-folder":249,"views/invites/invites":251,"views/layout/layout-panels":256,"views/link-import-social/link-import-social":257,"views/listing/listing":258,"views/loader-portion/loader-portion":259,"views/location-resource/location-resource":260,"views/notifications/notifications":262,"views/page-import-social/page-import-social":264,"views/page-invites/page-invites":265,"views/page-payment/page-payment":266,"views/page-tuning/page-tuning":267,"views/page-tuning/tuning-space":268,"views/panes/content-dual-pane/content-dual-pane":269,"views/panes/content-search/content-search":270,"views/panes/content-single-pane/content-single-pane":271,"views/photostream/photostream":273,"views/player-video-container/player-video-flv":274,"views/player-video-container/player-video-yandex":275,"views/player-video-html/player-video-html":276,"views/progressbars/progressbar-common":277,"views/progressbars/progressbar-upload":278,"views/progressbars/progressbars":279,"views/resources/resources":281,"views/select-folder/select-folder":282,"views/slices/slice-link-mail/slice-link-mail":283,"views/slices/slice-shared/slice-shared":284,"views/slices/slices":285,"views/slider/slider":290,"views/slider/slider-bar":286,"views/slider/slider-item":287,"views/slider/slider-stream":289,"views/space/offers-space-free":292,"views/space/packages-space":295,"views/space/packages-space-paid":294,"views/stickies/stickies":296,"views/stickies/sticky-invites":298,"views/stub/stub":299,"views/toolset/toolset":300,"views/tree-menu/tree-menu":301,"views/tree/tree":302,"views/users/users-folder/users-folder":304}],34:[function(){!function(e){function t(e,t,n){[].slice.call(e).forEach(function(e){nb.block(e).on(t,n)})}function n(e,t,n){[].slice.call(e).forEach(function(e){nb.block(e).off(t,n)})}e.nb.bindTo=t,e.nb.unbindTo=n}.call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(){document.attachEvent&&document.attachEvent("onpropertychange",function(e){var t=window.location.hash,n=document.title.replace(t,"");"title"===e.propertyName&&t&&-1!==document.title.indexOf(t)&&setTimeout(function(){document.title=n},0)})},{}],36:[function(e){var t=e("environment"),n=e("swfobject");Modernizr.addTest("videostream",function(){if(n.hasFlashPlayerVersion("9.0.0"))return"flv";var e=document.createElement("video");try{if(e.canPlayType("application/vnd.apple.mpegURL"))return"hls";if(e.canPlayType("video/webm"))return"webm"}catch(t){}return!1}),Modernizr.addTest("audiomp3",function(){var e=document.createElement("audio");try{return!!e.canPlayType("audio/mpeg;").replace(/no/,"")}catch(t){return!1}}),Modernizr.addTest("isMobile",function(){return t.agent.isMobile}),Modernizr.addTest("uploader",function(){return window.FormData?"html5":n.hasFlashPlayerVersion("10.0.0")?"flash":!1}),Modernizr.addTest("uploaddrag",function(){return Modernizr.draganddrop&&Modernizr.filereader}),Modernizr.addTest("folderupload",function(){var e=parseInt(t.agent.BrowserBaseVersion,10);return"Chromium"===t.agent.BrowserBase&&e>=21}),Modernizr.addTest("webkit",function(){return new RegExp(" AppleWebKit/").test(navigator.userAgent)})},{environment:8,swfobject:190}],37:[function(e,t){!function(n){function r(e){this.id="broker_"+p++,this.params=c.defaults(e,u.params)}function s(e){var t=a();return e=c.defaults(e||{},{scrollbars:"yes",resizable:1,menubar:0,toolbar:0,status:0,location:0,directories:0},t),c.map(e,function(e,t){return t+"="+e}).join(", ")}function a(){var e=500,t=280;return{width:e,height:t,left:Math.round((screen.availWidth-e)/2),top:Math.round((screen.availHeight-t)/2)}}function i(e,t){var n=c.map(t,function(e,t){return t+"="+e}).join("&");return e+=e.match("#")?"&":"#",e+n}function o(e,t,n){e=e+"?"+c.map(n,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&");var r=s(),a=window.open(e,t,r);return a.focus(),a}var c=e("underscore"),l=e("config"),d=document.location,u={urlBroker:d.protocol+"//"+l.domains.social+"/broker/start",retpath:d.protocol+"//"+d.hostname+"/close_broker.html",brokers:{},params:{consumer:"disk",application:"",action_if_anonymous:"authorize",result_location:"fragment"}},p=0;r.prototype.start=function(){var e=new Vow.Promise;u.brokers[this.id]=e;var t={broker:this.id};this.params.ddom&&(t.ddom=this.params.ddom),this.params.retpath=i(this.params.retpath||u.retpath,t);var n=o(u.urlBroker,this.id,this.params),r=setInterval(function(){n&&n.closed!==!0||(e.reject({status:"error"}),clearInterval(r))}.bind(this),500);return e},t.exports=n.__social__={Broker:r,brokers:u.brokers}}.call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{config:6,underscore:2}],38:[function(e,t){!function(n){var r=e("swfobject"),s=e("config"),a="9.0.28",i=s.links.static.host+"/disk/www/_/3Ggy9sEf_foF2q4ibQl-Nz957EI.swf",o=function(){},c=function(e){r.hasFlashPlayerVersion(a)?(this.url=e.proto("ws").path("/events/websocket"),this.id="flash_websocket"+Date.now().toString(),this._init()):this.atrigger("fail")};no.extend(c.prototype,ns.Events,{destroy:function(){this.off(),this._destroyFlash()},_init:function(){this._declareHandlersGlobal(),this._insertWrapperFlash(),this._embedSWF(),window.addEventListener("beforeunload",this._destroyFlash.bind(this))},_destroyFlash:function(){this._deleteHandlersGlobal(),this._closeSocket(),this._removeSWF(),this._removeWrapperFlash()},_declareHandlersGlobal:function(){n[this.id]={onOpen:this.atrigger.bind(this,"open"),onClose:this.atrigger.bind(this,"close"),onMessage:this._onMessage.bind(this),onLoad:this._openSocket.bind(this)}},_deleteHandlersGlobal:function(){n[this.id]={onOpen:o,onClose:o,onMessage:o,onLoad:o}},_insertWrapperFlash:function(){var e=$("<div />",{id:"wrapper_"+this.id,style:"position:absolute;top:-9999px;left:-9999px"});e.append($("<div />",{id:this.id})),e.appendTo("body")},_removeWrapperFlash:function(){$("#wrapper_"+this.id).remove()},_embedSWF:function(){var e=i+"?"+this.id,t={onOpen:this.id+".onOpen",onClose:this.id+".onClose",onMessage:this.id+".onMessage",onLoad:this.id+".onLoad"},n={allowScriptAccess:"always"},s=function(e){e.success||this.atrigger("fail")}.bind(this);r.embedSWF(e,this.id,1,1,a,null,t,n,null,s)},_removeSWF:function(){r.removeSWF(this.id)},_openSocket:function(){try{this.flash=document.getElementById(this.id),this.flash.create(this.url.toString(),void 0,null,0,null)}catch(e){this.atrigger("fail")}},_closeSocket:function(){try{this.flash.close()}catch(e){}delete this.flash},_onMessage:function(e){try{this.atrigger("message",decodeURIComponent(e))}catch(t){}}}),t.exports=c}.call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{config:6,swfobject:190}],39:[function(e,t){!function(e){var n=e.MozWebSocket||e.WebSocket,r=function(e){this.url=e.proto("wss").path("/events/websocket"),n?this._openSocket():this.atrigger("fail")};no.extend(r.prototype,ns.Events,{destroy:function(){this.off(),this._closeSocket()},_openSocket:function(){var e=this._ws=new n(this.url.toString());e.onopen=this.atrigger.bind(this,"open"),e.onclose=this.atrigger.bind(this,"close"),e.onerror=this.atrigger.bind(this,"close"),e.onmessage=function(e){this.atrigger("message",e.data)}.bind(this)},_closeSocket:function(){try{this._ws.onopen=this._ws.onclose=this._ws.onerror=this._ws.onmessage=null,this._ws.close()}catch(e){}delete this._ws}}),t.exports=r}.call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],40:[function(e,t){var n=e("underscore"),r=1e3,s=30*r,a=60*r,i=3*r,o=60*r,c=720*r,l=function(e){this.url=e,this.queue=[],this._resetCountReconnect(),this.connectBackend()};l.backends=[e("./backends/ws"),e("./backends/flash")],no.extend(l.prototype,ns.Events,{destroy:function(){this.off(),this.disconnectBackend()},connectBackend:function(){var e=n.first(l.backends);return e?(this.backend=new e(this.url),this.backend.on("message",this.onMessage.bind(this)),this.backend.on("open",this.onOpen.bind(this)),this.backend.on("close",this.onClose.bind(this)),this.backend.on("fail",this.onFail.bind(this)),this._trackTimeoutPing(),void 0):(this.trigger("error",{id:"NO_BACKEND_AVAILABLE"}),void 0)},disconnectBackend:function(){this.backend&&(this.backend.destroy(),delete this.backend),this._clearTimeoutStable(),this._abortReconnect(),this._untrackTimeoutPing()},onMessage:function(e,t){var n;try{n=JSON.parse(t)}catch(e){this.trigger("error",{id:"PARSE_ERROR",originalMessage:t})}n&&n.operation&&n.lcn?(n.lcn&&this.url.replaceParams({lcn:n.lcn}),"subscribe"!==n.operation&&this.trigger("message",n)):n&&"ping"===n.operation?this._resetTimeoutPing():n&&"transport-error"==n.type?this.trigger("error",{id:"TRANSPORT_ERROR",originalMessage:t}):n&&"bad sign"===n.Error?this.trigger("error",{id:"BAD_SIGN",originalMessage:t}):this.trigger("error",{id:"UNKNOWN_MESSAGE",originalMessage:t})},onOpen:function(){this._timeoutStable=setTimeout(this._resetCountReconnect.bind(this),o)},onClose:function(){this.disconnectBackend(),this._scheduleReconnect()},onFail:function(){this.disconnectBackend(),l.backends.shift(),this.connectBackend()},_resetCountReconnect:function(){this._countReconnect=0},_scheduleReconnect:function(){var e=Math.max(s+this._countReconnect*i,a);this._timeoutReconnect=setTimeout(this.connectBackend.bind(this),e),this._countReconnect+=1},_abortReconnect:function(){clearTimeout(this._timeoutReconnect),delete this._timeoutReconnect},_clearTimeoutStable:function(){clearTimeout(this._timeoutStable),delete this._timeoutStable},_reconnectOnTimeoutPing:function(){this.disconnectBackend(),this.connectBackend()},_trackTimeoutPing:function(){this._timeoutPing=setTimeout(this._reconnectOnTimeoutPing.bind(this),c)},_untrackTimeoutPing:function(){clearTimeout(this._timeoutPing),delete this._timeoutPing},_resetTimeoutPing:function(){this._timeoutPing&&(this._untrackTimeoutPing(),this._trackTimeoutPing())}}),t.exports=l},{"./backends/flash":38,"./backends/ws":39,underscore:2}],41:[function(e,t){var n=e("underscore"),r=e("config"),s=e("consts"),a=e("environment"),i=e("helpers/path"),o=e("helpers/space"),c=e("helpers/string"),l=e("helpers/resource"),d=e("helpers/format"),u=e("helpers/time"),p=e("helpers/uri"),f=e("helpers/guid"),h=t.exports={};h.entityify=ns.entityify,h.deentityify=ns.deentityify,h.encodeURIComponent=encodeURIComponent,h.escapePath=i.escape,h.isParent=i.isParent,h.dirname=i.dirname,h.basename=i.basename,h.getAlias=l.getAlias,h.capitalize=c.capitalize,h.trim=$.trim,h.md5=c.md5,h.round=Math.round.bind(Math),h.range=n.range.bind(n),h.getConfig=no.value(r),h.getEnvironment=no.value(a),h.getConsts=no.value(s),h.makeUrlRelative=p.makeRelative,h.isInsideFolderSocial=l.isInsideFolderSocial,h.getDifferenceInDays=u.getDifferenceInDays,h.stringCrop=function(e,t,r){return t=parseInt(t,10)||27,r=n.isUndefined(r)?"…":r,t+=Math.floor(.6*(e.match(/i|I|l|j/g)||[]).length),e.length>t?$.trim(e.substring(0,t)).replace(/(\.{1,3})$/g,"")+r:e},h.substring=function(e,t,n){return e.substr(t,n)},h.stringIndexOf=function(e,t){return e.indexOf(t)},h.stringLength=function(e){return e.length},h.json=function(e){return JSON.stringify(e[0].data)},h.parseJSON=function(e){return[{data:JSON.parse(e[0].data)}]},h.secondsToTime=d.secondsToTime,h.timestampToDate=d.timestampToDate,h.timestampCurrent=function(){return(new Date).getTime()/1e3},h.reverse=function(e){return n.clone(e).reverse()},h.last=function(e){return n.rest(e,-1)},h.contains=function(e,t){return n.contains(n.pluck(e,"data"),t)},h.formatSpace=function(e){for(var t=o(e),n=Array.prototype.slice.call(arguments,1),r=0,s=n.length;s>r;r++){var a=n[r];if("precision"===a||"length"===a){var i=parseInt(n[r+1],10);isNaN(i)||(t.format(a,i),r++)}else t.format(a)}return t.getString()},h.breakLongWords=function(e,t){"undefined"==typeof t&&(t=12);var r=" ",s="<wbr />",a=new RegExp(".{1,"+t+"}","g");return n.map(e.split(r),function(e){return n.map(e.match(a)||[],ns.entityify).join(s)}).join(r)},h.sum=function(e){return n.reduce(n.pluck(e,"data"),function(e,t){return e+t},0)},h.now=function(){return Math.round(Date.now()/1e3)},h.modernizr=function(e){return Modernizr[e]},h["borschik-link"]=function(e){return r.links.static.host+"/"+e},h.split=function(e,t,n){var r=e.split(t,n),s=[];return $.each(r,function(e,t){s.push({data:t})}),s},h.split2Nodeset=function(e,t){return yr.array2nodeset(e.split(t||","))},h.join=function(e,t){return n.pluck(n.pluck(e,"data"),"item")[0].join(t||",")},h.maxAmongItems=function(e){var t=yr.nodeset2data(e),r=e.length;return 0===r||1===r?t:n.max(t)},h.getFullYear=function(){return(new Date).getFullYear()},h["nb-extend"]=function(e,t){if(t&&t[0])if("string"==typeof t)e[0].data.content=t;else{var r=e[0].data,s=t[0].data,a=n.extend({},r,s);e[0].data=a}return e},h["nb-wrap"]=function(e,t){var r={};return t&&t.length&&(r[e]=1==t.length?t[0].data:n.pluck(t,"data")),[{data:r,name:"",parent:null,doc:t[0].doc}]},h["nb-uniq"]=f,h.isUrlWebClient=function(e){var t="/client";return 0===e.indexOf(r.links.disk+t)}},{config:6,consts:7,environment:8,"helpers/format":14,"helpers/guid":15,"helpers/path":20,"helpers/resource":22,"helpers/space":23,"helpers/string":25,"helpers/time":26,"helpers/uri":29,underscore:2}],42:[function(e,t){var n={},r=$("#models-client").text()||"[]";r=JSON.parse(r);for(var s=0;s<r.length;s++){var a=r[s];n[a.model]=a}t.exports=function(e,t){if(t)return n[e]||null;if(!n[e])return null;var r=n[e],s=ns.Model.get(r.model,r.params);return s.setData(r.data),s}},{}],43:[function(){ns.Model.define("albumSocial",{params:{aid:null}})},{}],44:[function(e){e("models/albums-social/album-social"),e("models/albums-social/group-albums-social"),e("models/operation/operation-get-albums"),e("underscore");var t=e("consts"),n=e("helpers/operation");ns.Model.define("albumsSocial",{split:{items:".items",model_id:"groupAlbumsSocial",params:{service:".service",privacy:".privacy"}},defaults:{items:[],status:"initiated"},params:{service:null},methods:{preprocessData:function(e){var n=e&&e.items||[],r=e&&e.status||"initiated",s=this.params.service,a=no.jpath('.[ .visibility == "public" ]',n)||[],i=no.jpath('.[ .visibility == "friends" ]',n)||[],o=no.jpath('.[ .visibility == "private" ]',n)||[];return"loaded"==r&&(no.jpath('.[ .title == "'+t.TITLE_ALBUM_DEFAULT+'" ]',n)||a.unshift({aid:"default-album-"+s,title:t.TITLE_ALBUM_DEFAULT,visibility:"public",state:{part:!0}})),{items:[{service:s,privacy:"public",items:a,status:r},{service:s,privacy:"friends",items:i,status:r},{service:s,privacy:"private",items:o,status:r}],status:r}},load:function(){return this.promise=new Vow.Promise,-1===["loading","loaded"].indexOf(this.get(".status"))&&this.fetch(),this.promise},isLoaded:function(){return"loaded"===this.get(".status")},fetch:function(){this.setData({items:[],status:"loading"}),this.getAlbums()},getAlbums:function(){var e=this,t=n.create("getAlbums",{service:this.params.service});t.on("status.done",function(){e.setData({items:this.get(".albums"),status:"loaded"}),e.promise.fulfill()}),t.on("status.failed",function(){e.setDataDefault(),e.promise.reject()})},insertAlbum:function(e,t){var n=e.get(".visibility"),r=ns.Model.get("groupAlbumsSocial",{service:this.params.service,privacy:n});r.insert(e,t||0)},removeAlbum:function(e){var t=e.get(".visibility"),n=ns.Model.get("groupAlbumsSocial",{service:this.params.service,privacy:t});n.remove(e)},findAlbum:function(e,t){var n=ns.Model.get("groupAlbumsSocial",{service:this.params.service,privacy:t});return n.findByTitle(e)},findAlbumByTitle:function(e){for(var t,n=0,r=this.models.length;r>n;n++){var s=this.models[n];if(t=s.findByTitle(e))break}return t}}})},{consts:7,"helpers/operation":18,"models/albums-social/album-social":43,"models/albums-social/group-albums-social":47,"models/operation/operation-get-albums":86,underscore:2}],45:[function(){ns.Model.define("do-create-album-social",{params:{service:null,title:null,privacy:null}})},{}],46:[function(){ns.Model.define("do-get-albums-social",{params:{service:null}})},{}],47:[function(e){e("models/albums-social/album-social");var t=e("underscore");ns.Model.define("groupAlbumsSocial",{split:{items:".items",model_id:"albumSocial",params:{aid:".aid"}},defaults:{items:[],status:"initiated"},params:{service:null,privacy:null},methods:{findByTitle:function(e){return t.find(this.models,function(t){return t.get(".title")===e})}}})},{"models/albums-social/album-social":43,underscore:2}],48:[function(){ns.Model.define("awaps",{params:{"disk-has-desktop":null,"disk-has-mobile":null,"disk-lang":null,"disk-domain":null}})},{}],49:[function(e,t){e("models/model-local").define("config"),t.exports=e("models-preloaded")("config")},{"models-preloaded":42,"models/model-local":72}],50:[function(){ns.Model.define("confirmation",{params:{confirmation:null},methods:{confirm:function(e){return this._decide(!0,e)},reject:function(e){return this._decide(!1,e)},confirmAll:function(e){return this._all()._decide(!0,e)},rejectAll:function(e){return this._all()._decide(!1,e)},_all:function(){return this.set(".all",!0),this},_decide:function(e,t){return this.set(".confirm",e),this.set(".data",t),this.get(".all")&&this.trigger("all",this.getData()),this.trigger(e?"confirmed":"rejected",t),this}}})},{}],51:[function(e){ns.Model.define("contact",{params:{userid:null},methods:{formatSuggest:function(){var t=this.get(".name"),n=this.get(".userid"),r=this.get(".service"),s={userid:n,service:r,userpic:this.get(".avatar")||e("config").links.static.host+"/disk/www/_/SFzCr2GZxGw2r1fKJO9soo0otUI.png"};return"email"===r?(s.value=n,t?(s.username=t,s.email=n,s.label=t+" "+n):(s.username=n,s.label=n)):(s.username=t,s.value=t,s.label=t),s}}})},{config:6}],52:[function(e,t){e("models/contacts/contact"),e("models/operation/operation-get-contacts"),e("models/user-current/user-current");var n=e("underscore"),r=e("helpers/email"),s=e("helpers/operation");ns.Model.define("contacts",t.exports={split:{items:".contacts",model_id:"contact",params:{userid:".id"}},defaults:{contacts:[],status:"initiated"},methods:{preprocessData:function(e){var t=[],s=[],a=ns.Model.get("userCurrent").getEmailNormalized();return n.each(e.contacts,function(e){e.userid=String(e.userid),"email"===e.service&&(e.userid=r.normalize(e.userid)),e.id=e.userid,a!==e.id&&(e.nameEncoded=encodeURIComponent(e.name),t.push(e))}),t.length&&(t=n.chain(t).uniq(!1,function(e){return e.userid}).sortBy(function(e){return e.name||e.userid}).value(),s=n.map(t,function(e){return e.id})),n.extend(e,{contacts:t,index:s})},load:function(){-1===["loading","loaded"].indexOf(this.get(".status"))&&this.fetch()},isLoaded:function(){return"loaded"===this.get(".status")},fetch:function(){this.setData({contacts:[],status:"loading"});var e=this,t=s.create("getContacts",{});t.on("status.done",function(){e.setData({contacts:this.get(".contacts"),status:"loaded"})})},insertItem:function(e,t){t=t||0,this.insert(e,t);var n=this.get(".index");n.splice(t,0,e.get(".id")),this.set(".index",n,{silent:!0})},formatSuggest:function(){return n.invoke(this.models.slice(),"formatSuggest")},isEmpty:function(){return n.isEmpty(this.models)}}}),ns.Model.get("contacts").setDataDefault()},{"helpers/email":13,"helpers/operation":18,"models/contacts/contact":51,"models/operation/operation-get-contacts":87,"models/user-current/user-current":177,underscore:2}],53:[function(){ns.Model.define("do-get-contacts",{})},{}],54:[function(e,t){e("models/contacts/states-contact-invite-disk"),ns.Model.define("stateContactInviteDisk",t.exports={params:{userid:null},methods:{_init:function(){ns.Model.prototype._init.apply(this,arguments),ns.Model.get("statesContactInviteDisk").insert(this),this.contact=ns.Model.get("contact",{userid:this.params.userid})},reset:function(){this.resetChecked(),this.resetHidden()},resetChecked:function(){this.get(".checked")&&this.set(".checked",!1)},resetHidden:function(){this.get(".hidden")&&this.set(".hidden",!1)}}})},{"models/contacts/states-contact-invite-disk":55}],55:[function(e,t){var n=e("underscore");ns.Model.define("statesContactInviteDisk",t.exports={isCollection:!0,jpathItems:".stateContactInviteDisk",methods:{reset:function(){n.invoke(this.models.slice(),"reset"),this.trigger("reset")},getChecked:function(){return n.filter(this.models.slice(),function(e){return e.get(".checked")})},hideFiltered:function(e){var t=RegExp($.ui.autocomplete.escapeRegex(e),"i");n.each(this.models.slice(),function(e){isHidden=!(t.test(e.contact.get(".name"))||t.test(e.contact.get(".userid"))),isHidden!=e.get(".hidden")&&(e.set(".hidden",isHidden),isHidden&&e.resetChecked())})}}})},{underscore:2}],56:[function(){var e=6e4;ns.Model.define("counterMail",{methods:{preprocessData:function(e){return{count:parseInt(e.countMail&&$(e.countMail).find("mail").text()||"0",10)}},_init:function(){this.super_._init.apply(this,arguments),this.scheduleUpdate()},scheduleUpdate:function(){var t=this;setInterval(function(){t.fetch()},e)},fetch:function(){return ns.Model.get("queueSync").push(this)}}})},{}],57:[function(e,t){e("models/model-local").define("environment"),t.exports=e("models-preloaded")("environment")},{"models-preloaded":42,"models/model-local":72}],58:[function(){ns.Model.define("invitee",{params:{userid:null}})},{}],59:[function(e,t){e("models/invitees/invitees-folder/state-invitee-folder");var n=e("underscore");ns.Model.define("inviteeFolder",t.exports={params:{id:null,idFolder:null},methods:{_init:function(){ns.Model.prototype._init.apply(this,arguments),n.bindAll(this,"onChangedSource"),this.state=ns.Model.get("stateInviteeFolder",this.params),this.on("ns-model-destroyed",function(){ns.Model.destroy(this.state),this.state=null,this.source=null}.bind(this))},setData:function(){var e=this.super_.setData.apply(this,arguments);return this.state||this.setState(),e},setState:function(){this.state=ns.Model.get("stateInviteeFolder",this.params),this.state.setDataDefault()},syncWith:function(e){if(e&&e!==this.source){this.source&&this.source.off("ns-model-changed",this.onChangedSource),this.source=e;var t=this.source.getData();"contact"==e.id&&(t.status="contact",t.idFolder=this.params.idFolder),this.setData(t),this.source.on("ns-model-changed",this.onChangedSource)}},onChangedSource:function(){this.setData(n.extend({},this.getData(),this.source.getData()))},resetState:function(){this.state.reset()}}})},{"models/invitees/invitees-folder/state-invitee-folder":62,underscore:2}],60:[function(e,t){e("models/invitees/invitees-folder/invitee-folder"),e("models/users/users-folder"),e("models/contacts/contacts");var n=e("underscore"),r=e("helpers/email");ns.Model.define("inviteesFolder",t.exports={isCollection:!0,jpathItems:".invitees",params:{idFolder:null},defaults:{status:"initiated",invitees:[]},methods:{_init:function(){ns.ModelCollection.prototype._init.apply(this,arguments),n.bindAll(this,"onChangedLinkedModel","onInsertUserFolder"),this.folder=ns.Model.getValid("resource",{id:this.params.idFolder}),this.gidFolder=this.folder.get(".meta.group.gid"),this.folder.on("ns-model-changed",function(){this.gidFolder!==this.folder.get(".meta.group.gid")&&this.toggleUsersFolders()}.bind(this)),this.folder.on("ns-model-destroyed",function(){this.destroyAll()}.bind(this)),this.linkUsersFolder(),this.linkContacts(),this.fetch()},linkContacts:function(){this.contacts&&this.contacts.off("ns-model-changed",this.onChangedLinkedModel),this.contacts=ns.Model.get("contacts"),this.contacts.on("ns-model-changed",this.onChangedLinkedModel)},linkUsersFolder:function(){this.usersFolder&&(this.usersFolder.off("ns-model-changed",this.onChangedLinkedModel),this.usersFolder.off("ufo-model-insert",this.onInsertUserFolder)),this.usersFolder=ns.Model.get("usersFolder",n.extend({},this.params,{gidFolder:this.gidFolder})),this.usersFolder.on("ns-model-changed",this.onChangedLinkedModel),this.usersFolder.on("ufo-model-insert",this.onInsertUserFolder)},onChangedLinkedModel:function(e,t){t||this.syncDataLinked()},onInsertUserFolder:function(e,t){var n=ns.Model.get("inviteeFolder",{id:t.get(".id"),idFolder:this.params.idFolder});n.syncWith(t),this.insertItem(n,0)},fetch:function(){this.setDataDefault(),this.usersFolder.isValid()||(this.gidFolder?this.usersFolder.fetch():this.usersFolder.isValid()||this.usersFolder.setDataDefault()),this.contacts.isLoaded()||this.contacts.load(),this.syncDataLinked()},updateStatus:function(){var e="loaded";this.usersFolder.isValid()?this.contacts.isLoaded()||(e="loadingContacts"):e="loadingUsers",this.get(".status")!==e&&this.set(".status",e)},syncDataLinked:function(){this.updateStatus();var e=this.usersFolder.get(".index")||[],t=this.contacts.get(".index")||[],r=n.difference(t,e),s=0;n.each(e,function(e){var t=ns.Model.get("userFolder",{userid:e,idFolder:this.params.idFolder}),n=ns.Model.get("inviteeFolder",{id:t.get(".id"),idFolder:this.params.idFolder});n.syncWith(t),this.insertItem(n,s++)}.bind(this)),n.each(r,function(e){var t=ns.Model.get("contact",{userid:e}),n=ns.Model.get("inviteeFolder",{id:t.get(".id"),idFolder:this.params.idFolder});n.syncWith(t),this.insertItem(n,this.models.length)}.bind(this))},insertItem:function(e,t){-1===this.models.indexOf(e)&&this.insert(e,t)},syncOrder:function(){var e=this.usersFolder.get(".index"),t=this.contacts.get(".index"),r=n.uniq(e.concat(t)),s=[];n.each(r,function(e){s.push(ns.Model.get("inviteeFolder",{id:e,idFolder:this.params.idFolder}))}.bind(this)),this.models=s,this.touch()},destroyAll:function(){n.each(this.models.slice(),ns.Model.destroy),ns.Model.destroy(this)},fetchUsersFolder:function(){return this.usersFolder.fetch()},toggleUsersFolders:function(){this.gidFolder=this.folder.get(".meta.group.gid");var e=ns.Model.get("usersFolder",{idFolder:this.params.idFolder,gidFolder:this.gidFolder||null}),t=this,n=function(){t.linkUsersFolder(),t.syncDataLinked()};this.gidFolder?e.fetch().then(n):(e.setDataDefault(),n())},resetState:function(){n.invoke(this.models.slice(),"resetState")},getItem:function(e){return ns.Model.getValid("inviteeFolder",{id:r.normalize(e),idFolder:this.params.idFolder})},isEmpty:function(){return n.isEmpty(this.models)}}})},{"helpers/email":13,"models/contacts/contacts":52,"models/invitees/invitees-folder/invitee-folder":59,"models/users/users-folder":179,underscore:2}],61:[function(){ns.Model.define("stateAccessFolder",{params:{idFolder:null},methods:{_init:function(){ns.Model.prototype._init.apply(this,arguments),this.setDataDefault()},reset:function(){this.get(".operationFailed")&&this.set(".operationFailed",null)}}})},{}],62:[function(e){e("models/invitees/invitees-folder/state-access-folder");var t=e("underscore");ns.Model.define("stateInviteeFolder",{params:{id:null,idFolder:null},methods:{_init:function(){ns.Model.prototype._init.apply(this,arguments),this.stateAccessFolder=ns.Model.get("stateAccessFolder",{idFolder:this.params.idFolder}),t.bindAll(this,"onOperationStatusChanged","onOperationDestroyed"),this.on("ns-model-destroyed",this.unbindOperation)
},getData:function(){var e=ns.Model.prototype.getData.apply(this,arguments),t=$.extend(!0,{},e);return this.operation&&(t.operation=this.operation.getData(),t.operation.type=this.operation.getType()),t},bindOperation:function(e){this.operation&&this.unbindOperation(),this.operation=e,this.trigger("ns-model-changed"),this.operation.on("ns-model-changed.status",this.onOperationStatusChanged),this.operation.on("ns-model-destroyed",this.onOperationDestroyed),this.stateAccessFolder.reset()},unbindOperation:function(){this.operation&&(this.operation.off("ns-model-changed.status",this.onOperationStatusChanged),this.operation.off("ns-model-destroyed",this.onOperationDestroyed),this.operation=null,this.trigger("ns-model-changed"),this.stateAccessFolder.reset())},onOperationStatusChanged:function(){"failed"===this.operation.get(".status")&&this.stateAccessFolder.set(".operationFailed",this.operation.getData()),this.trigger("ns-model-changed")},onOperationDestroyed:function(){this.unbindOperation()},reset:function(){this.unbindOperation(),this.setDataDefault()}}})},{"models/invitees/invitees-folder/state-access-folder":61,underscore:2}],63:[function(e,t){e("models/invitees/invitee");var n=e("underscore"),r={ok:2,wait:1};ns.Model.define("invitees",t.exports={split:{items:".invitees",model_id:"invitee",params:{userid:".userid"}},methods:{preprocessData:function(e){if(e.error)return{invitees:[],error:e.error};var t=e.sort(function(e,t){return(r[t.state]||0)-(r[e.state]||0)});return n.each(t,function(e,t){e.index=t}),{invitees:t}}}})},{"models/invitees/invitee":58,underscore:2}],64:[function(e){var t=e("config");ns.Model.define("linkInvite",{methods:{preprocessData:function(e){return{link:t.links.disk+"/invite/?hash="+e,hash:e}}}})},{config:6}],65:[function(){ns.Model.define("do-invite-disk",{params:{userid:null,service:null,locale:null}})},{}],66:[function(){ns.Model.define("do-invite-folder",{params:{gid:null,path:null,rights:null,userid:null,service:null,avatar:null,name:null,locale:null}})},{}],67:[function(e){ns.Model.define("inviteCurrent"),e("models-preloaded")("inviteCurrent")},{"models-preloaded":42}],68:[function(e){function t(e){return!e.get(".state.closed")}function n(e){return e.hash}e("models/resource/resource"),e("models/invites/invite-current");var r=e("underscore");e("helpers/path");var s=e("helpers/resource");ns.Model.define("invitesFolder",{split:{model_id:"resource",items:".invites",params:{id:".id"}},methods:{preprocessData:function(e){e=Array.isArray(e)?e:[];var t=ns.Model.getValid("inviteCurrent");return t&&e.unshift(t.getData()),{invites:r.map(r.uniq(e,n),s.inviteToResource)}},countOpen:function(){return r.filter(this.models,t).length},fetch:function(){return ns.Model.get("queueRequest").push(this)}}})},{"helpers/path":20,"helpers/resource":22,"models/invites/invite-current":67,"models/resource/resource":133,underscore:2}],69:[function(){ns.Model.define("stateDialogInviteDisk",{methods:{resetEmail:function(){this.get(".emailValid")&&this.set(".emailValid",null)}}})},{}],70:[function(){ns.Model.define("stateFormInviteFolder",{params:{id:null},methods:{_init:function(){ns.Model.prototype._init.apply(this,arguments);var e=ns.Model.getValid("resource",{id:this.params.id});e.on("ns-model-destroyed",function(){this.reset()}.bind(this))},reset:function(){this.setDataDefault()},resetError:function(){this.get(".error")&&this.set(".error",null)}}})},{}],71:[function(e,t){e("models/queues/queue-request");var n=e("underscore"),r="offset",s="amount",a=40,i=0,o=t.exports=function(){};no.inherit(o,ns.ModelCollection,{_init:function(){ns.ModelCollection.prototype._init.apply(this,arguments);var e=function(){this.off("ns-model-changed",e);var t=ns.Model.infoLite(this.id),n=t.params[t.amountProperty];!(this.models.length<n)||this.params&&this.params.offset||this.complete()};this.on("ns-model-changed",e)},offset:function(){return i+n.filter(this.models,this.offsetFilter).length},offsetFilter:function(e){return!!e},fetchNext:function(){var e=this,t=ns.Model.infoLite(e.id),r=t.params[t.amountProperty];if(this.isValid()&&0===this.models.length&&this.complete(),this.isComplete())return Vow.fulfill([]);if(this.loading)return this.loading;var s=this.loading=new Vow.Promise;this.trigger("ns-model-loading-start");var a=ns.Model.get("queueRequest").push({id:this.id,params:no.extend({},this.params,n.object([[t.offsetProperty,this.offset()]]))});return a.always(function(){e.trigger("ns-model-loading-finish"),delete e.loading}),a.then(function(t){var n=e.insert(t.models);t.models.length<r&&e.complete(),n?s.fulfill(t.models):s.fulfill([]),ns.Model.destroy(t)},function(e){s.reject(e)}),s},complete:function(){this._complete=!0,this.trigger("ns-model-loading-complete")},isComplete:function(){return!!this._complete}}),o.define=function(e,t){return t.offsetProperty||(t.offsetProperty=r),t.amountProperty||(t.amountProperty=s),no.jpath.set(".params."+t.offsetProperty,t,i),no.jpath.set(".params."+t.amountProperty,t,t.sizePortion||a),ns.Model.define(e,t,this)}},{"models/queues/queue-request":120,underscore:2}],72:[function(e,t){var n=e("underscore"),r=t.exports=function(){};no.inherit(r,ns.Model,{isValid:no["true"],_init:function(e,t,r){var s=ns.Model.infoLite(e),a=n.isFunction(s.defaults)?s.defaults.call(this,t):s.defaults,i=n.extend({},a,r);return ns.Model.prototype._init.call(this,e,t,i)}}),r.define=function(e,t){return ns.Model.define(e,t,r)}},{underscore:2}],73:[function(e,t){function n(e){var t=e[0];if(t!==this.get(".status")){this.set(".status",t);var n=this["onStatus"+s.capitalize(t)];"function"==typeof n&&n.apply(this,e.slice(1)),this.trigger("status."+t),this.queueSetStatus.shift(),this.queueSetStatus.length&&this.queueSetStatus[0].call()}}e("models/queues/queue-request"),e("models/queues/queue-confirmations"),e("models/operation/do-status-operation");var r=e("underscore"),s=e("helpers/string"),a=e("models/model-local"),i=t.exports=function(){};no.inherit(i,a,{_init:function(){return this.countRequestStatus=0,this.queueSetStatus=[],a.prototype._init.apply(this,arguments)},init:no.nop,initFromMessage:no.nop,resetCounter:function(){this.countRequestStatus=0},setStatus:function(){this.queueSetStatus.push(n.bind(this,[].slice.call(arguments))),1===this.queueSetStatus.length&&this.queueSetStatus[0].call()},complete:function(){-1===["canceled","failed","done","rejected"].indexOf(this.get(".status"))&&this.setStatus("completed")},run:function(){return this.setStatus(this.get(".status")||"created"),this},getTimeoutStatus:function(){var e=2e4,t=5,n=2e3,r=Math.min(n+Math.floor(this.countRequestStatus/t)*n,e);return this.countRequestStatus++,r},doRequestStatus:function(){this.nextTick(function(){var e=this.handleResponseStatus.bind(this);ns.Model.get("queueRequest").push({id:"do-status-operation",params:{oid:this.get(".oid")}}).then(e,e)})},confirm:function(e){return ns.Model.get("queueConfirmations").add(r.extend({operation:this.getType(),gid:this.get(".gid"),status:this.get(".status")},e))},prompt:function(e){return this.confirm(r.extend({type:"prompt"},e))},getType:function(){var e=this.id.replace(/^operation/,"");return e.charAt(0).toLowerCase()+e.substr(1)},nextTick:function(e){window.setTimeout(e.bind(this),this.getTimeoutStatus())},isActive:function(){return r.contains(["started","progressing","determined"],this.get(".status"))},countItems:function(){return 1}}),i.define=function(e,t){return t.params={id:null},ns.Model.define(e,t,i)}},{"helpers/string":25,"models/model-local":72,"models/operation/do-status-operation":76,"models/queues/queue-confirmations":117,"models/queues/queue-request":120,underscore:2}],74:[function(e,t){var n=e("underscore"),r=t.exports=function(){};r.define=function(e,t){return ns.Model.define(e,t,r)},no.inherit(r,ns.Model,{_init:function(e){return this.limit=ns.Model.infoLite(e).limit||10,this.items=[],this.itemsProcessing=[],this.busy=!1,ns.Model.prototype._init.apply(this,arguments)},push:function(e){var t=this.createItem(e);return this.items.push(t),this.trigger("added",t),this.nextTick(this.doIteration),t.promise},pushPriority:function(e){var t=this.createItem(e),n=this.items.indexOf(this.itemLastPriority);return this.items.splice(n+1,0,t),this.itemLastPriority=t,this.trigger("added",t),this.doIteration(),t.promise},doIteration:function(){if(!this.busy){var e=this.getPortion();e.length?(this.busy=!0,this.handlePortion(e).always(function(){this.busy=!1,this.trigger("processed",e),this.doIteration()},this),this.trigger("processing",e)):this.trigger("drained")}},getPortion:function(){return this.items.splice(0,this.limit)},createItem:function(e){return{item:e,promise:new Vow.Promise}},handlePortion:function(e){return n.each(e,function(e,t){t.promise&&t.promise.fulfill()}),Vow.fulfill()},nextTick:function(e){n.defer(e.bind(this))}})},{underscore:2}],75:[function(e,t){ns.Model.define("notification",t.exports={params:{notification:null}})},{}],76:[function(){ns.Model.define("do-status-operation",{params:{oid:null}})},{}],77:[function(e){e("models/resource/resource"),e("models/invites/invites-folder"),e("models/users/users-folder"),e("models/state-resource/state-resource"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-invite-accept");var t=e("helpers/resource");e("helpers/path");var n=e("models/model-operation");n.define("operationAcceptInvite",{methods:{init:function(){this.get(".idSrc")&&this.set(".src",ns.Model.getValid("resource",{id:this.get(".idSrc")})),this.get(".isRemote")&&("actor"==this.get(".role")?this.set(".dst",t.createPart({id:this.get(".idDst"),type:"dir"})):this.set(".dst",ns.Model.getValid("resource",{id:this.get(".idDst")})))},onStatusCreated:function(){this.get(".src").set(".state.processing",!0),this.doRequestAccept()},doRequestAccept:function(){ns.Model.get("queueRequest").push({id:"do-resource-invite-accept",params:{hash:this.get(".src").get(".invite.hash")}}).then(this.handleResponseAccept,this.handleResponseAccept,this)},handleResponseAccept:function(e){e.get(".error")?this.setStatus("failed"):(this.set(".dst",t.createPart(e.getData())),this.setStatus("completed"))},onStatusCompleted:function(){var e=this.get(".src"),t=this.get(".dst");if(this.get(".isRemote")&&("owner"===this.get(".role")||"user"===this.get(".role"))){if(t){var n=ns.Model.getValid("usersFolder",{idFolder:t.get(".id"),gidFolder:t.get(".meta.group.gid")});n&&n.fetch()}return"owner"===this.get(".role")&&ns.Model.get("queueNotifications").add({role:this.get(".role"),nameFolder:this.get(".nameFolder"),nameUser:this.get(".nameUser"),operation:this.getType(),status:this.get(".status")}),this.setStatus("done"),void 0}e&&(e.hide(),t.fetch().always(this.handleSyncResource.bind(this)),ns.Model.get("space").fetch())},handleSyncResource:function(){var e=this.get(".src");ns.Model.getValid("invitesFolder").remove(e),e.remove();var t=ns.Model.getValid("usersFolder",{id:e.get(".id"),gid:e.get(".meta.group.gid")});t&&t.invalidate(),this.notify(),this.setStatus("done")},onStatusDone:function(){ns.Model.destroy(this)},onStatusFailed:function(){this.get(".src").set(".state.processing",!1),this.notify(),ns.Model.destroy(this)},notify:function(){var e=this.get(".dst"),t=this.get(".src");ns.Model.get("queueNotifications").add({dst:e&&e.getData(),src:t&&t.getData(),operation:this.getType(),status:this.get(".status")})}}})},{"helpers/path":20,"helpers/resource":22,"models/invites/invites-folder":68,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-invite-accept":138,"models/state-resource/state-resource":169,"models/users/users-folder":179}],78:[function(e){e("models/resource/resource"),e("models/invitees/invitees-folder/invitee-folder"),e("models/invitees/invitees-folder/state-invitee-folder"),e("models/users/user-folder"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-share-access"),e("underscore");var t=e("helpers/resource"),n=e("models/model-operation");n.define("operationAccessFolder",{methods:{init:function(){var e;if(this.get(".idSrc")&&(e=ns.Model.getValid("resource",{id:this.get(".idSrc")})),this.set(".src",e),e){var t=ns.Model.getValid("inviteesFolder",{idFolder:e.get(".id")});this.set(".invitees",t)}var n=this.get(".idInvitee");if(n){var r=ns.Model.getValid("inviteeFolder",{id:n,idFolder:e.get(".id")});r.state.bindOperation(this),this.set(".invitee",r)}},onStatusCreated:function(){this.doRequestShareAccess()},doRequestShareAccess:function(){var e=this.get(".invitee");ns.Model.get("queueRequest").push({id:"do-resource-share-access",params:{gid:this.get(".src").get(".meta.group.gid"),userid:e.get(".userid"),uid:e.get(".uid"),service:e.get(".service"),status:e.get(".status"),rights:this.get(".rights")}}).then(this.handleResponseShareAccess,this.handleResponseShareAccess,this)},handleResponseShareAccess:function(e){var t=e.get(".error");t?this.setStatus("failed"):this.setStatus("completed")},onStatusCompleted:function(){var e=this.get(".src"),n=this.get(".invitees");return this.get(".invitee"),this.get(".isRemote")?"actor"===this.get(".role")?(this.get(".rights")?e?(e.fetch().always(this.handleSyncResource.bind(this)),e.notifyChangedAccess()):this.setStatus("done"):(this.get(".invite")?ns.Model.get("invitesFolder").fetch():(e&&e.remove(),t.updateParentsOf(this.get(".idSrc")),ns.Model.get("space").fetch()),this.setStatus("done")),ns.Model.get("queueNotifications").add({operation:this.getType(),nameFolder:this.get(".nameFolder"),role:this.get(".role"),rights:this.get(".rights"),status:this.get(".status")}),void 0):(("owner"===this.get(".role")||"user"===this.get(".role")&&!this.get(".rights"))&&(e&&n.usersFolder.fetch(),this.setStatus("done")),void 0):("0"===this.get(".rights")?(n.usersFolder.removeItem(this.get(".idInvitee")),e.set(".meta.group.user_count",e.get(".meta.group.user_count")-1)):ns.Model.get("userFolder",{idFolder:e.get(".id"),userid:this.get(".idInvitee")}).updateData({rights:this.get(".rights")}),this.setStatus("done"),void 0)},handleSyncResource:function(){this.setStatus("done")},isFinalized:function(){return"failed"===this.get(".status")||"done"===this.get(".status")}}})},{"helpers/resource":22,"models/invitees/invitees-folder/invitee-folder":59,"models/invitees/invitees-folder/state-invitee-folder":62,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-share-access":144,"models/users/user-folder":178,underscore:2}],79:[function(e){function t(e){var t=ns.Model.getValid("resource",{id:e});t&&t.hide()}function n(e){var t=ns.Model.getValid("resource",{id:e});t&&t.show()}e("models/operation/operation-create-folder"),e("models/operation/operation-move");var r=e("underscore"),s=e("helpers/path"),a=e("helpers/operation"),i=e("models/model-operation");i.define("operationBundle",{methods:{init:function(){var e=r.map(this.get(".ids"),s.dirname);1!==r.uniq(e).length&&this.set(".status","failed")},onStatusCreated:function(){var e=this.get(".ids");r.each(e,t);var n=a.initialize("createFolder",{idFolderDst:s.dirname(e[0])});n.on("status.done",function(){this.set(".dst",n.get(".dst")),this.setStatus("moving")}.bind(this)),n.on("status.canceled",this.setStatus.bind(this,"failed")),n.on("status.failed",this.setStatus.bind(this,"failed")),n.run()},onStatusMoving:function(){var e=a.initialize("move",r.map(this.get(".ids"),function(e){return{idSrc:e,idFolderDst:this.get(".dst").get(".id")}},this)),t=r.map(e,function(e){var t=new Vow.Promise;return e.on("status.done",t.fulfill.bind(t,!0)),e.on("status.canceled",t.fulfill.bind(t,!1)),e.on("status.failed",t.fulfill.bind(t,!1)),t},this);r.invoke(e,"run"),Vow.all(t).then(function(e){r.every(e)?this.setStatus("done"):this.setStatus("failed")},this)},onStatusFailed:function(){r.each(this.get(".ids"),n)}}})},{"helpers/operation":18,"helpers/path":20,"models/model-operation":73,"models/operation/operation-create-folder":83,"models/operation/operation-move":92,underscore:2}],80:[function(e){e("models/resource/resource"),e("models/queues/queue-request");var t=e("models/model-operation");t.define("operationChanged",{methods:{init:function(){this.set(".src",ns.Model.getValid("resource",{id:this.get(".idSrc")}))},onStatusCreated:function(){},onStatusCompleted:function(){this.get(".src")?this.get(".src").fetch().always(this.handleSyncResource.bind(this)):this.setStatus("done")},handleSyncResource:function(){this.setStatus("done")}}})},{"models/model-operation":73,"models/queues/queue-request":120,"models/resource/resource":133}],81:[function(e){e("models/resource/resource"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/trash/do-clean-trash");var t=e("underscore"),n=e("models/model-operation");n.define("operationCleanTrash",{methods:{init:function(){this.set(".src",ns.Model.get("resource",{id:"/trash"}))},onStatusCreated:function(){var e=this;e.confirm().then(function(){e.setStatus("started")},function(){e.setStatus("rejected")})},onStatusRejected:function(){this.destroy()},onStatusStarted:function(){this.get(".src").hideChildren(),this.doRequestClean()},doRequestClean:function(){ns.Model.get("queueRequest").push({id:"do-clean-trash"}).then(this.handleResponseClean,this.handleResponseClean,this)},handleResponseClean:function(e){var t=e.get(".error");t?this.setStatus("failed"):e.get(".oid")?(this.set(".oid",e.get(".oid")),this.setStatus("progressing")):this.setStatus("failed")},onStatusProgressing:function(){this.doRequestStatus()},handleResponseStatus:function(e){var n=e.get(".error");if(n)this.setStatus("failed");else{var r=e.get(".status");t.contains(["EXECUTING","WAITING"],r)?this.doRequestStatus():"DONE"===r?this.setStatus("done"):this.setStatus("failed")}},onStatusCompleted:function(){this.setStatus("done")},onStatusDone:function(){this.get(".src").destroyChildren(),ns.Model.get("space").fetch(),this.get(".src").showChildren(),this.notify(),this.destroy()},onStatusFailed:function(){this.get(".src").showChildren(),this.notify(),this.destroy()},notify:function(){return ns.Model.get("queueNotifications").add({operation:"cleanTrash",status:this.get(".status")})}}})},{"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/trash/do-clean-trash":174,underscore:2}],82:[function(e){e("models/resource/resource"),e("models/space/space"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-copy");var t=e("underscore"),n=e("helpers/resource"),r=e("helpers/path");e("helpers/string");var s=e("models/model-operation");s.define("operationCopy",{methods:{init:function(){var e=ns.Model.getValid("resource",{id:this.get(".idSrc")});if(!e){var t={id:this.get(".idSrc"),type:this.get(".typeSrc")};this.get(".nameSrc")&&(t.name=this.get(".nameSrc")),e=n.createPart(t)}this.set(".src",e);var s=this.get(".idDst");s&&(this.set(".idFolderDst",r.dirname(s)),this.set(".dst",this.createDst()))},initFromMessage:function(e){var t=e.data.source&&r.normalize(e.data.source),n=e.data.target&&r.normalize(e.data.target),s=e.data.source_data;s?(this.set(".nameSrc",s.name),this.set(".typeSrc",s.type)):this.set(".typeSrc",r.extname(t)?"file":"dir"),this.set(".idSrc",t),this.set(".idDst",n),this.init(),this.setStatus("progressing")},run:function(){return this.get(".idFolderDst")?this.setStatus("determined"):this.setStatus("created"),this},removeDst:function(){this.get(".dst")&&this.get(".dst").get(".state.part")&&this.get(".dst").remove()},onStatusCreated:function(){this.doConfirmDst()},doConfirmDst:function(){var e=this;this.confirm({type:"select-folder",src:this.get(".src").getData()}).then(function(t){e.set(".idFolderDst",t),e.setStatus("determined")},function(){e.setStatus("cancelled")})},onStatusDetermined:function(){var e=r.join(this.get(".idFolderDst"),this.get(".nameNew")||this.get(".src").get(".name"));this.set(".idDst",e);var t=ns.Model.getValid("resource",{id:e});t&&!this.get(".force")?(this.set(".dst",t),this.setStatus("exists")):(this.set(".dst",this.createDst()),this.doRequestCopy())},createDst:function(){return n.createPart($.extend(!0,{},this.get(".src").getData(),{id:this.get(".idDst"),parents:null}))},doRequestCopy:function(){ns.Model.get("queueRequest").push({id:"do-resource-copy",params:{src:this.get(".src").get(".id"),dst:this.get(".dst").get(".id"),force:this.get(".force")}}).then(this.handleResponseCopy,this.handleResponseCopy,this)},handleResponseCopy:function(e){e=e.valueOf();var t=e.get(".oid");t?(this.set(".oid",t),this.setStatus("progressing")):this.handleErrorCopy(e)},handleErrorCopy:function(e){var t=e.get(".error")||{};"HTTP_412"===t.id||"HTTP_409"===t.id?this.setStatus("exists"):this.setStatus("failed")},onStatusExists:function(){var e=this,t=this.setStatus.bind(this,"cancelled"),n=this.get(".src"),r=this.get(".dst"),s={src:n.getData(),dst:r.getData()};"dir"===n.get(".type")?this.prompt(s).then(function(n){n.name?(e.set(".nameNew",n.name),e.removeDst(),e.setStatus("determined")):t()},t):this.confirm(s).then(function(){e.set(".force",!0),e.doRequestCopy()},t)},onStatusProgressing:function(){this.doRequestStatus()},handleResponseStatus:function(e){if(e.get(".error"))this.setStatus("failed");else{var n=e.get(".status");t.contains(["EXECUTING","WAITING"],n)?this.doRequestStatus():"DONE"===n?this.setStatus("completed"):this.setStatus("failed")}},onStatusCompleted:function(){this.get(".dst").fetch().always(this.handleSyncResource.bind(this))},handleSyncResource:function(){this.setStatus("done")},onStatusCancelled:function(){this.removeDst()},onStatusDone:function(){ns.Model.get("space").fetch(),this.notify()},onStatusFailed:function(){this.notify()},notify:function(){return ns.Model.get("queueNotifications").add({operation:"copy",gid:this.get(".gid"),status:this.get(".status"),dst:this.get(".dst").getData(),src:this.get(".src").getData()})}}})},{"helpers/path":20,"helpers/resource":22,"helpers/string":25,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-copy":135,"models/space/space":163,underscore:2}],83:[function(e){e("models/resource/resource"),e("models/state-resource/state-resource"),e("models/states-context/states-context"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-create-folder");var t=e("helpers/resource"),n=e("helpers/path"),r=e("models/model-operation");r.define("operationCreateFolder",{methods:{init:function(){var e=this.get(".nameFolderDst")||"Новая папка",t=this.get(".idDst");t&&!ns.Model.getValid("resource",{id:t})&&(e=n.basename(t),this.set(".idFolderDst",n.dirname(t)),this.set(".dst",this.createDst(e))),this.set(".src",this.createSrc(e)),this.set(".state",ns.Model.get("statesContext",{idContext:this.get(".idFolderDst")}))},run:function(){return this.get(".nameFolderDst")?this.setStatus("validating"):this.get(".idDst")?this.setStatus("determined"):this.setStatus("created"),this},createSrc:function(e){return t.createPart({id:n.join(this.get(".idFolderDst"),"."+Date.now()+e),name:e,type:"dir"})},createDst:function(e){return t.createPart({id:this.get(".idDst"),name:e,type:"dir"},{after:this.get(".src")})},onStatusCreated:function(){this.selectResource(this.get(".src").get(".id")),this.get(".state").set(".creatingFolder",!0),this.doRename()},doRename:function(){this.get(".src").rename().then(function(e){this.set(".nameFolderDst",e),this.setStatus("validating")},function(){this.setStatus("canceled")},this)},onStatusValidating:function(){var e=this.get(".nameFolderDst"),r=n.join(this.get(".idFolderDst"),e),s=ns.Model.getValid("resource",{id:r});return t.isNameInvalid(e)?(this.set(".reason","nameHasSlash"),this.setStatus("canceled")):s?this.setStatus("exists"):(this.set(".idDst",r),this.set(".dst",this.createDst(e)),this.setStatus("determined"),void 0)},onStatusDetermined:function(){this.get(".src").hide(),this.doRequestCreate()},doRequestCreate:function(){ns.Model.get("queueRequest").push({id:"do-resource-create-folder",params:{id:this.get(".idDst"),force:this.get(".force")}}).always(this.handleResponseCreate,this)},handleResponseCreate:function(e){var t=e.valueOf();t.get(".error")?this.handleErrorCreate(t):this.setStatus("completed")},handleErrorCreate:function(e){var t=e.get(".error");"HTTP_412"===t.id||"HTTP_409"===t.id||"HTTP_405"===t.id?this.setStatus("exists"):this.setStatus("failed")},onStatusCanceled:function(){this.notify(),this.get(".src").remove(),this.get(".dst")&&this.get(".dst").remove(),this.get(".state").set(".creatingFolder",!1)},onStatusExists:function(){this.notify();var e=this.get(".src");e.show(),this.get(".dst")&&this.get(".dst").remove();var t=this.getStateResource(e.get(".id"));t&&t.get(".selected")?this.setStatus("created"):this.setStatus("canceled")},onStatusFailed:function(){this.notify(),this.get(".src").remove(),this.get(".dst")&&this.get(".dst").remove(),this.get(".state").set(".creatingFolder",!1)},onStatusCompleted:function(){this.get(".src").remove(),this.get(".dst")&&this.get(".dst").fetch().always(this.handleSyncResource,this)},handleSyncResource:function(){this.setStatus("done")},onStatusDone:function(){this.notify(),this.get(".state").set(".creatingFolder",!1),this.selectResource(this.get(".dst").get(".id"))},notify:function(){return ns.Model.get("queueNotifications").add({operation:"createFolder",nameFolderDst:this.get(".nameFolderDst"),src:this.get(".src").getData(),dst:this.get(".dst")&&this.get(".dst").getData(),reason:this.get(".reason"),status:this.get(".status")})},getStateResource:function(e){return ns.Model.get("stateResource",{idContext:n.dirname(e),id:e})},selectResource:function(e){var t=this.getStateResource(e);t&&!t.get(".selected")&&t.selectSingle()}}})},{"helpers/path":20,"helpers/resource":22,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-create-folder":136,"models/state-resource/state-resource":169,"models/states-context/states-context":171}],84:[function(e){e("models/resource/resource"),e("models/space/space"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-leave"),e("models/resources/do-resource-delete");var t=e("underscore"),n=e("helpers/resource"),r=e("helpers/path"),s=e("helpers/metrika"),a=e("models/model-operation");a.define("operationDelete",{methods:{init:function(){var e,t=this.get(".idSrc");if(e=ns.Model.getValid("resource",{id:t}),e||(e=n.createPart({id:t,type:this.get(".typeSrc")},{silent:!0})),this.set(".src",e),!r.isParent("/trash",t)&&!r.isParent("/yavideo",t)){var s=this.get(".idDst");s||(s=n.getIdUnique(r.join("trash",this.get(".src").get(".name"))),this.set(".idDst",s)),this.set(".dst",n.createPart({id:s,name:this.get(".src").get(".name"),type:this.get(".src").get(".type")}))}},initFromMessage:function(e){var t=e.data.source&&r.normalize(e.data.source),n=r.extname(t)?"file":"dir";this.set(".typeSrc",n),this.set(".idSrc",t),this.init(),this.get(".src").hide(),this.setStatus("progressing")},onStatusCreated:function(){var e=this.get(".src"),t=null;e.get(".meta.group.is_root")&&e.get(".meta.group.is_owned")&&(t="delete-shared"),n.isCamera(e.get(".id"))&&(t="camera"),r.isParent("/yavideo",e.get(".id"))&&(t="yavideo"),t?this.confirm({reason:t,src:this.get(".src").getData()}).then(this.setStatus.bind(this,"started"),this.setStatus.bind(this,"rejected")):this.setStatus("started")},onStatusStarted:function(){var e=this.get(".src");e.get(".meta.group.is_root")&&e.get(".meta.group.is_owned")&&s.count("actions","shared folders","revoke access for all","by deleting"),e.hide(),this.doRequestDelete()},onStatusRejected:function(){this.get(".dst")&&this.get(".dst").remove(),this.remove()},doRequestDelete:function(){ns.Model.get("queueRequest").push({id:"do-resource-delete",params:{id:this.get(".idSrc")}}).always(this.handleResponseDelete,this)},handleResponseDelete:function(e){var t=e.valueOf(),n=t.get(".error");n?this.setStatus("failed"):(this.set(".oid",t.get(".oid")),this.setStatus("progressing"))},onStatusProgressing:function(){this.doRequestStatus()},handleResponseStatus:function(e){var n=e.get(".error");if(n)this.setStatus("failed");else{var r=e.get(".status");t.contains(["EXECUTING","WAITING"],r)?this.doRequestStatus():"DONE"===r?(this.result=e.data,this.setStatus("done")):this.setStatus("failed")}},onStatusCompleted:function(){this.get(".dst")?this.get(".dst").fetch().always(this.handleSyncResource.bind(this)):this.setStatus("done")},handleSyncResource:function(){this.setStatus("done")},remove:function(){ns.Model.destroy(this)},onStatusDone:function(){this.get(".dst")&&this.result&&this.result.resource&&this.get(".dst").replaceData(this.result.resource),ns.Model.get("space").fetch(),this.notify();var e=this.get(".src");e&&(e.get(".meta.group.is_root")||e.get(".meta.with_shared"))&&n.updateParentsOf(e.get(".id")),e.remove()},onStatusFailed:function(){this.get(".src").show(),this.get(".dst")&&this.get(".dst").remove(),this.notify()},notify:function(){var e=this.get(".src"),t=this.get(".dst");return ns.Model.get("queueNotifications").add({src:e.getData(),dst:t&&t.getData(),operation:this.getType(),gid:this.get(".gid"),status:this.get(".status")})}}})},{"helpers/metrika":17,"helpers/path":20,"helpers/resource":22,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-delete":137,"models/resources/do-resource-leave":140,"models/space/space":163,underscore:2}],85:[function(e){function t(e){return"success"===e.status}e("models/albums-social/albums-social"),e("models/albums-social/album-social"),e("models/albums-social/do-create-album-social"),e("models/social/do-export-social"),e("models/queues/queue-request"),e("models/queues/queue-notifications");var n=e("underscore"),r=e("models/model-operation");e("consts");var s=e("helpers/metrika"),a="photos_export";r.define("operationExportSocial",{methods:{init:function(){var e=this.get(".idResource");e&&!this.get(".idsResources")&&this.set(".idsResources",[e]);var t=ns.Model.get("albumsSocial",{service:this.get(".service")});this.set(".albums",t)},onStatusCreated:function(){this.ensureAlbumsLoaded()},onStatusAlbumsLoaded:function(){this.ensureAlbumExistence()},onStatusStarted:function(){this.doRequestExport()},onStatusProgressing:function(){this.doRequestStatus()},onStatusUnauthorized:function(){this.requestAuthorization()},onStatusFailed:function(){this.notify()},onStatusDone:function(){this.notify()},ensureAlbumsLoaded:function(){var e=this.get(".albums");e.isLoaded()?this.setStatus("albumsLoaded"):e.load().then(this.setStatus.bind(this,"albumsLoaded"),this.setStatus.bind(this,"canceled"))},ensureAlbumExistence:function(){var e=this.get(".albums").findAlbum(this.get(".titleAlbum"),this.get(".privacyAlbum"));e&&!e.get(".state.part")?(this.set(".aid",e.get(".aid")),this.setStatus("started")):this.createAlbum().always(this.handleResponseCreateAlbum.bind(this))},createAlbum:function(){return s.count("actions","social export","create new album"),ns.Model.get("queueRequest").push({id:"do-create-album-social",params:{service:this.get(".service"),title:this.get(".titleAlbum"),privacy:this.get(".privacyAlbum")}})},handleResponseCreateAlbum:function(e){var t=e.valueOf().get(".result.aid");if(t){var n=this.get(".albums"),r=n.findAlbum(this.get(".titleAlbum"),this.get(".privacyAlbum"));r&&r.get(".state.part")&&n.removeAlbum(r),r=ns.Model.get("albumSocial",{aid:t}).setData({aid:t,title:this.get(".titleAlbum"),visibility:this.get(".privacyAlbum")}),n.insertAlbum(r,0),this.set(".aid",t),this.setStatus("started")}else"token"===e.get(".reason")?this.setStatus("unauthorized"):this.setStatus("failed")
},doRequestExport:function(){var e;try{e=JSON.stringify(this.get(".idsResources")),ns.Model.get("queueRequest").push({id:"do-export-social",params:{service:this.get(".service"),aid:this.get(".aid"),photos:e}}).always(this.handleResponseExport.bind(this))}catch(t){this.setStatus("failed")}},requestAuthorization:function(){var e=this.confirm({type:"refresh-token-social",service:this.get(".service"),scenario:a});e.then(this.setStatus.bind(this,"started"),this.setStatus.bind(this,"canceled"))},handleResponseExport:function(e){var t=e.valueOf().get(".oid");t?(this.set(".oid",t),this.setStatus("progressing")):this.setStatus("failed")},handleResponseStatus:function(e){if(e.get(".error"))this.setStatus("failed");else{var r=e.get(".status"),s=e.get(".stages");if(n.contains(["EXECUTING","WAITING"],r))this.doRequestStatus();else if(e.get(".stages[ .details.invalid_token == 1 ]"))this.setStatus("unauthorized");else if(s){var a=n.partition(s,t),i=a[0],o=a[1];0===o.length?this.setStatus("done"):(this.set(".partial",i.length>0),this.setStatus("failed"))}else this.setStatus("failed")}},notify:function(){return ns.Model.get("queueNotifications").add({operation:"exportSocial",status:this.get(".status"),service:this.get(".service"),partial:this.get(".partial"),count:this.countItems()})},countItems:function(){return this.get(".idsResources").length}}})},{consts:7,"helpers/metrika":17,"models/albums-social/album-social":43,"models/albums-social/albums-social":44,"models/albums-social/do-create-album-social":45,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/social/do-export-social":155,underscore:2}],86:[function(e){e("models/queues/queue-request"),e("models/albums-social/do-get-albums-social");var t=e("underscore"),n=e("models/model-operation"),r=144,s="photos_export";n.define("operationGetAlbums",{methods:{onStatusCreated:function(){this.doRequestAlbums()},doRequestAlbums:function(){ns.Model.get("queueRequest").push({id:"do-get-albums-social",params:{service:this.get(".service")}}).always(this.handleResponseAlbums.bind(this))},handleResponseAlbums:function(e){var t=e.valueOf(),n=t.get(".error");n?n.body.code==r?this.setStatus("unauthorized"):this.setStatus("failed"):(this.set(".albums",t.getData().result),this.setStatus("done"))},onStatusUnauthorized:function(){this.requestAuthorization()},requestAuthorization:function(){var e=this.confirm({type:"refresh-token-social",service:this.get(".service"),scenario:s});e.then(this.setStatus.bind(this,"created"),this.setStatus.bind(this,"failed"))},onStatusDone:function(){t.defer(ns.Model.destroy,this)},onStatusFailed:function(){ns.Model.destroy(this)}}})},{"models/albums-social/do-get-albums-social":46,"models/model-operation":73,"models/queues/queue-request":120,underscore:2}],87:[function(e){e("models/queues/queue-request"),e("models/contacts/do-get-contacts");var t=e("underscore"),n=e("models/model-operation");n.define("operationGetContacts",{methods:{onStatusCreated:function(){this.doRequestContacts()},doRequestContacts:function(){var e=this.handleResponseContacts.bind(this);ns.Model.get("queueRequest").push({id:"do-get-contacts",params:{}}).then(e,e)},handleResponseContacts:function(e){var t=e.get(".oid");t?(this.set(".oid",t),this.setStatus("progressing")):this.setStatus("failed")},onStatusProgressing:function(){this.doRequestStatus()},handleResponseStatus:function(e){var n=e.get(".error");if(n)this.setStatus("failed");else{this.extractContacts(e);var r=e.get(".status");t.contains(["EXECUTING","WAITING"],r)?this.doRequestStatus():"DONE"===r?this.setStatus("done"):this.setStatus("failed")}},extractContacts:function(e){if(e.get(".stages")){var n=this.get(".contacts")||[];t.each(e.get(".stages"),function(e){e.details&&t.each(e.details,function(t){var r=t.user;r.service=e.service||"email",n.push(r)})}),this.set(".contacts",n)}},onStatusDone:function(){t.defer(ns.Model.destroy,this)},onStatusFailed:function(){ns.Model.destroy(this)}}})},{"models/contacts/do-get-contacts":53,"models/model-operation":73,"models/queues/queue-request":120,underscore:2}],88:[function(e){e("models/resource/resource"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/social/do-import-social");var t=e("underscore");e("consts");var n=e("helpers/page"),r=e("helpers/path"),s=e("helpers/resource"),a=e("models/user-current/user-current").get(".foldersDefault"),i=e("models/model-operation"),o="photos_import";i.define("operationImportSocial",{methods:{init:function(){this.set(".folderSocial",ns.Model.getValid("resource",{id:a.social}))},onStatusCreated:function(){var e=this.get(".service");if("google"==e||"instagram"==e)return this.set(".type","albums_only"),this.setStatus("started"),void 0;var t=this.prompt({service:this.get(".service"),status:this.get(".status")});t.fail(this.setStatus.bind(this,"rejected")),t.then(function(e){e.albums?e.tagged?this.set(".type","all"):this.set(".type","albums_only"):e.tagged&&this.set(".type","tagged_only"),this.setStatus("started")},this)},onStatusStarted:function(){this.doRequestImport(),this.showDialogInProgress()},onStatusRejected:function(){ns.Model.destroy(this)},doRequestImport:function(){ns.Model.get("queueRequest").push({id:"do-import-social",params:{service:this.get(".service"),type:this.get(".type")}}).always(this.handleResponseImportSocial,this)},handleResponseImportSocial:function(e){var t=e.valueOf(),n=t.get(".oid");n?(this.set(".oid",n),this.set(".idFolder",r.normalize(t.get(".provider_dir"))),this.setStatus("progressing")):this.setStatus("failed")},onStatusProgressing:function(){this.doRequestStatus(),this.refreshDialogInProgress();var e=this.get(".idFolder"),t=ns.Model.getValid("resource",{id:e});t||(t=s.createPart({id:e,type:"dir",name:r.basename(e)})),t.startImport(),this.set(".folder",t),t.fetch().always(function(){this.isFinalized()||t.startImport()}.bind(this));var n=this.get(".folderSocial");(!n||n.get(".error"))&&(n=s.createPart({id:a.social,type:"dir",name:r.basename(a.social)}),this.set(".folderSocial",n),n.fetch())},handleResponseStatus:function(e){var n=e.get(".error");if(n)401==n.response?this.setStatus("unauthorized"):this.setStatus("failed");else{var r=e.get(".status");if(t.contains(["EXECUTING","WAITING"],r))this.doRequestStatus();else if("DONE"===r){var s=(e.get(".protocol")||[]).length;if(this.set(".countTasks",s),!s)return this.setStatus("completed"),void 0;var a=e.get('.protocol[.status == "FAILED"]')||[],i=e.get('.protocol[.status == "DONE"]')||[];this.set(".partial",i.length&&a.length?!0:!1),!i.length&&a.length?this.setStatus("failed"):this.setStatus("completed")}else this.setStatus("failed")}},onStatusCompleted:function(){var e=this.get(".folder");e.stopImport(),this.setStatus("done")},isFinalized:function(){var e=this.get(".status");return t.contains(["done","failed","canceled"],e)},handleFetchResource:function(){this.setStatus("done")},onStatusUnauthorized:function(){this.requestAuthorization()},requestAuthorization:function(){this.rejectDialogInProgress();var e=this.confirm({type:"refresh-token-social",service:this.get(".service"),scenario:o});e.then(this.setStatus.bind(this,"started"),this.setStatus.bind(this,"canceled"))},onStatusFailed:function(){this.stopImportFolder(),this.rejectDialogInProgress(),this.notify()},onStatusCanceled:function(){this.stopImportFolder(),this.rejectDialogInProgress()},stopImportFolder:function(){var e=this.get(".folder");e.get(".state.part")?e.remove():e.stopImport()},onStatusDone:function(){this.rejectDialogInProgress(),this.notify()},showDialogInProgress:function(){var e=this.get(".idFolder");this.promiseDialogInProgress=this.confirm({service:this.get(".service"),status:this.get(".status")}),this.promiseDialogInProgress.then(function(){n.go("/client"+r.escape(e))})},rejectDialogInProgress:function(){this.promiseDialogInProgress&&this.promiseDialogInProgress.notify("reject")},refreshDialogInProgress:function(){var e=this.promiseDialogInProgress;!e||e.isResolved()||e.isRejected()||(this.rejectDialogInProgress(),this.showDialogInProgress())},notify:function(){return ns.Model.get("queueNotifications").add({operation:this.getType(),service:this.get(".service"),idFolder:this.get(".idFolder"),partial:this.get(".partial"),countTasks:this.get(".countTasks"),status:this.get(".status")})}}})},{consts:7,"helpers/page":19,"helpers/path":20,"helpers/resource":22,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/social/do-import-social":156,"models/user-current/user-current":177,underscore:2}],89:[function(e){e("models/contacts/contact"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/contacts/state-contact-invite-disk"),e("models/invites/do-invite-disk");var t=e("underscore"),n=e("helpers/uri"),r=e("models/user-current/user-current"),s=e("models/model-operation");s.define("operationInviteDisk",{methods:{init:function(){t.bindAll(this,"updateState"),this.modelState=ns.Model.get("stateContactInviteDisk",{userid:this.get(".userid")}),this.modelRightsSocial=ns.Model.get("rightsSocial",{scenario:"invite"}),this.on("ns-model-changed.status",this.updateState)},onStatusCreated:function(){this.doSendInvite();var e=this.get(".userid");if(!ns.Model.getValid("contact",{userid:e})){var t=ns.Model.get("contacts",{userid:r.get(".uid")}),n=ns.Model.get("contact",{userid:e}).setData({userid:e,service:"email"});t.insert(n,0)}},doSendInvite:function(){ns.Model.get("queueRequest").push({id:"do-invite-disk",params:{service:this.get(".service"),userid:this.get(".userid"),locale:n.getLocaleInvite()}}).then(this.handleResponseInvite,this.handleResponseInvite,this)},handleResponseInvite:function(e){var t=e.get(".oid");t?(this.set(".oid",t),this.setStatus("progressing")):this.handleErrorInvite(e)},handleErrorInvite:function(e){var t=e.get(".error")||{};if("HTTP_409"===t.id){var n=t.body&&t.body.code;11===n&&this.set(".reason","hasDisk")}this.setStatus("failed")},onStatusProgressing:function(){this.doRequestStatus()},handleResponseStatus:function(e){var n=e.get(".error");if(n)"email"===this.get(".service")?this.setStatus("failed"):this.setStatus("unauthed");else{var r=e.get(".status");t.contains(["EXECUTING","WAITING"],r)?this.doRequestStatus():"DONE"===r?this.setStatus("done"):this.setStatus("failed")}},onStatusDone:function(){this.notify()},onStatusFailed:function(){this.notify()},notify:function(){if(this.get(".notify")===!1)return Vow.Promise.rejected();var e=ns.Model.getValid("contact",{userid:this.get(".userid")});return ns.Model.get("queueNotifications").add({operation:"inviteDisk",status:this.get(".status"),reason:this.get(".reason"),contact:e&&e.getData(),userid:this.get(".userid")})},updateState:function(){var e=this.get(".status");this.modelState.set(".status",e),this.modelState.set(".reason",this.get(".reason")),t.contains(["done","failed","unauthed"],e)&&this.off("ns-model-changed.status",this.updateState)}}})},{"helpers/uri":29,"models/contacts/contact":51,"models/contacts/state-contact-invite-disk":54,"models/invites/do-invite-disk":65,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/user-current/user-current":177,underscore:2}],90:[function(e){e("models/resource/resource"),e("models/users/users-folder"),e("models/users/user-folder"),e("models/invitees/invitees-folder/invitees-folder"),e("models/invitees/invitees-folder/invitee-folder"),e("models/invitees/invitees-folder/state-invitee-folder"),e("models/contacts/contacts"),e("models/contacts/contact"),e("models/queues/queue-request"),e("models/invites/do-invite-folder");var t=e("underscore"),n=e("helpers/resource"),r=e("helpers/uri"),s=e("models/model-operation"),a=e("helpers/email");s.define("operationInviteFolder",{methods:{init:function(){var e;if(this.get(".idSrc")&&(e=ns.Model.getValid("resource",{id:this.get(".idSrc")}),this.set(".src",e)),e){var t=ns.Model.getValid("inviteesFolder",{idFolder:e.get(".id")});this.set(".invitees",t)}var n,r=this.get(".idInvitee"),s=this.get(".userid");r?n=ns.Model.getValid("inviteeFolder",{id:r,idFolder:e.get(".id")}):s&&(n=t.getItem(s),n&&s!=n.get(".id")&&this.set(".userid",n.get(".id"))),n&&this.set(".invitee",n)},onStatusCreated:function(){var e=this.get(".src"),t=this.get(".invitee"),n=this.get(".invitees");if(this.get(".idInvitee"))t.state.bindOperation(this);else{t&&n.remove(t);var r,s=a.normalize(this.get(".userid")),i=ns.Model.get("inviteeFolder",{id:s,idFolder:e.get(".id")});r=t?t.getData():{userid:this.get(".userid"),id:s,idFolder:e.get(".id"),rights:this.get(".rights"),service:"email",name:"",avatar:""},i.setData(r),i.state.setDataDefault(),i.state.bindOperation(this),n.insertItem(i,0),this.set(".inviteeNew",i)}this.doRequestInvite()},doRequestInvite:function(){var e=this.get(".src");this.get(".idInvitee");var t=this.get(".invitee");ns.Model.get("queueRequest").push({id:"do-invite-folder",params:{gid:e.get(".meta.group.gid")||"",path:e.get(".path"),rights:this.get(".rights"),userid:this.get(".idInvitee")||this.get(".userid"),service:t?t.get(".service"):"email",avatar:t?t.get(".avatar"):"",name:t?t.get(".name"):"",locale:r.getLocaleInvite()}}).then(this.handleResponseInvite,this.handleResponseInvite,this)},handleResponseInvite:function(e){var t=e.get(".oid");t?(this.set(".oid",t),this.setStatus("progressing")):this.handleErrorInvite(e)},handleErrorInvite:function(e){var t=e.get(".error")||{};if("HTTP_409"===t.id){var n=t.body&&t.body.code;if(124===n)this.set(".reason","limitFolders");else if(123===n)this.set(".reason","limitUsers");else{var r=t.body&&t.body.title;"token"===r?this.set(".reason","tokenExpired"):!r||-1===r.indexOf("captcha")&&-1===r.indexOf("flood")||this.set(".reason","flood")}}this.setStatus("failed")},onStatusProgressing:function(){this.doRequestStatus()},handleResponseStatus:function(e){var n=e.get(".error");if(n)"token"===n.message&&this.set(".reason","tokenExpired"),this.setStatus("failed");else{var r=e.get(".status");t.contains(["EXECUTING","WAITING"],r)?this.doRequestStatus():"DONE"===r?this.setStatus("completed"):this.setStatus("failed")}},onStatusCompleted:function(){if(this.get(".isRemote")&&"actor"===this.get(".role"))return ns.Model.get("invitesFolder").fetch(),void 0;var e=this.get(".src");if(e){var r=this.get(".invitees"),s=this.get(".invitee"),i=this.get(".inviteeNew"),o=e.get(".meta.group.gid");if(this.get(".isRemote"))o&&(r.usersFolder.fetch(),e.set(".meta.group.user_count",e.get(".meta.group.user_count")+1));else if(i&&r.remove(i),!s||"contact"===s.get(".status")||i){var c=ns.Model.get("userFolder",{idFolder:e.get(".id"),userid:this.get(".idInvitee")||a.normalize(this.get(".userid"))});c.setData(t.extend({},(s||i).getData(),{status:"proposed",rights:this.get(".rights")})),r.usersFolder.insertItem(c);var l=ns.Model.getValid("contact",{userid:c.get(".id")});l||(l=c.toContact(),ns.Model.get("contacts").insertItem(l)),e.set(".meta.group.user_count",e.get(".meta.group.user_count")+1)}o?this.setStatus("done"):(e.fetch().always(this.handleSyncResource.bind(this)),e.notifyChangedAccess(),n.updateParentsOf(e.get(".id")))}},handleSyncResource:function(){this.setStatus("done")},onStatusFailed:function(){var e=this.get(".inviteeNew");e&&this.get(".invitees").remove(e)},isFinalized:function(){return"failed"===this.get(".status")||"done"===this.get(".status")}}})},{"helpers/email":13,"helpers/resource":22,"helpers/uri":29,"models/contacts/contact":51,"models/contacts/contacts":52,"models/invitees/invitees-folder/invitee-folder":59,"models/invitees/invitees-folder/invitees-folder":60,"models/invitees/invitees-folder/state-invitee-folder":62,"models/invites/do-invite-folder":66,"models/model-operation":73,"models/queues/queue-request":120,"models/resource/resource":133,"models/users/user-folder":178,"models/users/users-folder":179,underscore:2}],91:[function(e){e("models/resource/resource"),e("models/space/space"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-leave"),e("underscore");var t=e("models/model-operation");t.define("operationLeaveFolder",{methods:{init:function(){this.set(".src",ns.Model.getValid("resource",{id:this.get(".idSrc")}))},onStatusCreated:function(){this.confirm({src:this.get(".src").getData()}).then(this.setStatus.bind(this,"started"),this.setStatus.bind(this,"rejected"))},onStatusStarted:function(){this.get(".src").hide(),this.doRequestLeave()},onStatusRejected:function(){this.remove()},doRequestLeave:function(){ns.Model.get("queueRequest").push({id:"do-resource-leave",params:{gid:this.get(".src").get(".meta.group.gid")}}).then(this.handleResponseLeave,this.handleResponseLeave,this)},handleResponseLeave:function(e){var t=e.get(".error");t?this.setStatus("failed"):this.setStatus("completed")},onStatusCompleted:function(){var e=this.get(".src");if(this.get(".isRemote")&&("owner"===this.get(".role")||"user"===this.get(".role"))){if(e){var t=ns.Model.getValid("usersFolder",{idFolder:e.get(".id"),gidFolder:e.get(".meta.group.gid")});t&&t.fetch()}return"owner"===this.get(".role")&&ns.Model.get("queueNotifications").add({nameFolder:this.get(".nameFolder"),nameUser:this.get(".nameUser"),operation:this.getType(),role:this.get(".role"),status:this.get(".status")}),this.setStatus("done"),void 0}ns.Model.get("space").fetch(),e&&(this.notify(),e.remove()),this.setStatus("done")},remove:function(){ns.Model.destroy(this)},onStatusFailed:function(){this.get(".src").show(),this.notify(),this.remove()},onStatusDone:function(){this.remove()},notify:function(){var e=this.get(".src"),t=this.get(".dst");return ns.Model.get("queueNotifications").add({src:e.getData(),dst:t&&t.getData(),operation:this.getType(),gid:this.get(".gid"),status:this.get(".status")})}}})},{"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-leave":140,"models/space/space":163,underscore:2}],92:[function(e,t){e("models/resource/resource"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-move");var n=e("underscore"),r=e("helpers/resource"),s=e("helpers/path");e("helpers/string");var a=e("models/model-operation");a.define("operationMove",t.exports={methods:{init:function(){var e=ns.Model.getValid("resource",{id:this.get(".idSrc")});if(!e){var t={id:this.get(".idSrc"),type:this.get(".typeSrc")};this.get(".nameSrc")&&(t.name=this.get(".nameSrc")),e=r.createPart(t,{silent:!0})}this.set(".src",e);var n=this.get(".idDst");n&&(this.set(".idFolderDst",s.dirname(n)),this.set(".dst",this.createDst())),s.isParent("/yavideo",this.get(".idSrc"))&&this.set(".isMoveFromYavideo",!0)},initFromMessage:function(e){var t=e.data.source&&s.normalize(e.data.source),n=e.data.target&&s.normalize(e.data.target),r=e.data.source_data;r?(this.set(".nameSrc",r.name),this.set(".typeSrc",r.type)):this.set(".typeSrc",s.extname(t)?"file":"dir"),this.set(".idSrc",t),this.set(".idDst",n),this.init(),this.setStatus("moving")},onStatusCreated:function(){var e=this.get(".src"),t=null;r.isCamera(e.get(".id"))&&(t="camera"),this.get(".isMoveFromYavideo")&&(t="yavideo"),t?this.confirm({reason:t,src:this.get(".src").getData()}).then(this.setStatus.bind(this,"approved"),this.setStatus.bind(this,"rejected")):this.setStatus("approved")},onStatusApproved:function(){this.get(".idFolderDst")?this.setStatus("determined"):this.doConfirmDst()},doConfirmDst:function(){var e=this;this.confirm({type:"select-folder",src:this.get(".src").getData()}).then(function(t){e.set(".idFolderDst",t),e.setStatus("determined")},function(){e.setStatus("rejected")})},onStatusDetermined:function(){var e=s.join(this.get(".idFolderDst"),this.get(".nameNew")||this.get(".src").get(".name"));if(e===this.get(".idSrc"))return this.setStatus("canceled");this.set(".idDst",e);var t=ns.Model.getValid("resource",{id:e});return t?(this.set(".dst",t),this.setStatus("exists"),void 0):(this.set(".dst",this.createDst()),this.setStatus("started"),void 0)},createDst:function(){var e={id:this.get(".idDst"),parents:null,state:null};return this.get(".isMoveFromYavideo")&&(e.meta={sizes:null}),r.createPart($.extend(!0,{},this.get(".src").getData(),e),{position:{after:this.get(".src")}})},removeDst:function(){this.get(".dst")&&this.get(".dst").get(".state.part")&&this.get(".dst").remove()},onStatusStarted:function(){this.get(".src").hide(),this.get(".isMoveFromYavideo")?this.doRequestCopy():this.doRequestMove()},onStatusRejected:function(){this.removeDst(),this.remove()},remove:function(){ns.Model.destroy(this)},doRequestMove:function(){ns.Model.get("queueRequest").push({id:"do-resource-move",params:{src:this.get(".idSrc"),force:this.get(".force")||0,dst:this.get(".dst").get(".id")}}).always(this.handleResponseMove,this)},doRequestCopy:function(){ns.Model.get("queueRequest").push({id:"do-resource-copy",params:{src:this.get(".idSrc"),force:this.get(".force")||0,dst:this.get(".dst").get(".id")}}).always(this.handleResponseCopy,this)},handleResponseMove:function(e){var t=e.valueOf(),n=t.get(".oid");n?(this.set(".oid",n,this),this.setStatus("moving")):this.handleErrorMove(t)},handleResponseCopy:function(e){var t=e.valueOf(),n=t.get(".oid");n?(this.set(".oid",n,this),this.setStatus("copying")):this.handleErrorMove(t)},handleErrorMove:function(e){var t=e.get(".error")||{};"HTTP_412"===t.id||"HTTP_409"===t.id?this.setStatus("exists"):this.setStatus("failed")},onStatusMoving:function(){this.doRequestStatus()},onStatusCopying:function(){this.doRequestStatus()},handleResponseStatus:function(e){if(e.get(".error"))this.setStatus("failed");else{var t=e.get(".status");n.contains(["EXECUTING","WAITING"],t)?this.doRequestStatus():"DONE"===t?(this.result=e.data,this.get(".isMoveFromYavideo")?this.setStatus("copied"):this.setStatus("done")):this.setStatus("failed")}},isActive:function(){return n.contains(["started","determined","copied","removing","moving","copying"],this.get(".status"))},onStatusCopied:function(){this.set(".copied",!0),this.resetCounter(),this.doRequestRemove()},doRequestRemove:function(){ns.Model.get("queueRequest").push({id:"do-resource-delete",params:{id:this.get(".idSrc")}}).always(this.handleResponseRemove,this)},handleResponseRemove:function(e){var t=e.valueOf(),n=t.get(".oid");n?(this.set(".oid",n,this),this.setStatus("removing")):this.setStatus("failed")},onStatusRemoving:function(){this.doRequestStatusRemove()},doRequestStatusRemove:function(){this.nextTick(function(){ns.Model.get("queueRequest").push({id:"do-status-operation",params:{oid:this.get(".oid")}}).always(this.handleResponseStatusRemove,this)})},handleResponseStatusRemove:function(e){var t=e.valueOf();if(t.get(".error"))this.setStatus("failed");else{var r=t.get(".status");n.contains(["EXECUTING","WAITING"],r)?this.doRequestStatusRemove():"DONE"===r?this.setStatus("completed"):this.setStatus("failed")}},onStatusExists:function(){var e=this.get(".src"),t=this,n=this.setStatus.bind(this,"canceled"),r=this.get(".dst"),s={src:e.getData(),dst:r.getData()};"dir"===e.get(".type")?this.prompt(s).then(function(e){e.name?(t.set(".nameNew",e.name),t.removeDst(),t.setStatus("determined")):n()},n):this.confirm(s).then(this.setStatus.bind(this,"forced"),n)},onStatusForced:function(){this.set(".force",1),this.get(".isMoveFromYavideo")?this.doRequestCopy():this.doRequestMove()},onStatusCompleted:function(){this.get(".dst").fetch().always(this.handleSyncResource,this)},handleSyncResource:function(){this.setStatus("done")},onStatusDone:function(){this.notify();var e=this.get(".src"),t=this.get(".dst");this.get(".isMoveFromYavideo")&&ns.Model.get("space").fetch(),(e.get(".meta.group.is_root")||e.get(".meta.with_shared"))&&(r.updateParentsOf(e.get(".id")),r.updateParentsOf(t.get(".id"))),e.remove(),this.result&&this.result.resource&&t.replaceData(this.result.resource)},onStatusCanceled:function(){this.get(".src").show(),this.removeDst()},onStatusFailed:function(){this.get(".isMoveFromYavideo")&&this.get(".copied")&&this.result&&this.result.resource&&this.get(".dst").replaceData(this.result.resource),this.notify(),this.get(".src").show(),this.removeDst()},notify:function(){return ns.Model.get("queueNotifications").add({dst:this.get(".dst").getData(),src:this.get(".src").getData(),operation:this.getType(),gid:this.get(".gid"),status:this.get(".status"),copied:this.get(".copied")})}}})},{"helpers/path":20,"helpers/resource":22,"helpers/string":25,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-move":141,underscore:2}],93:[function(e){function t(e){return function(t){t.remove(),this.setStatus(e)}}e("models/state-cached/state-cached");var n,r=e("models/model-operation"),s=e("helpers/metrika"),a=e("helpers/page"),i=3;r.define("operationPreload",{methods:{init:function(){this.retries=0;var e=ns.Model.get("stateCached",{id:this.get(".resource").get(".id")});e.isValid()||e.setDataDefault(),n=this.get(".fit")||n,this.set(".state",e),this.set(".fit",n)},onStatusCreated:function(){var e=this.get(".state"),t=function(){!1===e.get(".loading")&&(e.off("ns-model-changed.loading",t),this.setStatus("done"))}.bind(this);return e.get(".cached")||e.get(".error")?(this.setStatus("done"),void 0):e.get(".loading")?(e.on("ns-model-changed.loading",t),void 0):(this.setStatus("started"),void 0)},onStatusStarted:function(){var e,n,r=this.get(".resource").get('.meta.sizes[.name == "DEFAULT"].url')[0],s=this.get(".fit");r?(this._loadingStart=Date.now(),e=r+"&size="+s.width+"x"+s.height,n=a.appendImage(e),this.get(".state").set(".src",e),this.get(".state").set(".loading",!0),n.one("error",t("error").bind(this,n)).one("load",t("loaded").bind(this,n))):this.setStatus("loaded")},onStatusLoaded:function(){var e=this.get(".state");e.set(".cached",!0),e.set(".loading",!1),this._loadingStart&&s.count("tech","slider preview load time",Date.now()-this._loadingStart),this.setStatus("done")},onStatusError:function(){this.retries<i?(this.get(".resource").fetch().then(function(){this.setStatus("created")},this),this.retries++):(this.get(".state").set(".loading",!1),this.get(".state").set(".error",!0),this.setStatus("done"))},onStatusDone:function(){ns.Model.destroy(this)}}})},{"helpers/metrika":17,"helpers/page":19,"models/model-operation":73,"models/state-cached/state-cached":165}],94:[function(e){e("models/resource/resource"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-publish");var t=e("helpers/resource"),n=e("models/model-operation");n.define("operationPublish",{methods:{init:function(){var e;return(e=ns.Model.getValid("resource",{id:this.get(".idSrc")}))?(this.set(".src",e),void 0):(this.setStatus("canceled"),void 0)},onStatusCreated:function(){var e=this.get(".src");e.startPublish(),!this.get(".reverse")&&t.isCamera(e.get(".id"))?this.confirm({reason:"camera"}).then(this.setStatus.bind(this,"started"),this.setStatus.bind(this,"rejected")):this.setStatus("started")},onStatusStarted:function(){this.doRequestPublish()},onStatusRejected:function(){this.get(".src").stopPublish(),this.remove()},onStatusCanceled:function(){this.remove()},remove:function(){ns.Model.destroy(this)},doRequestPublish:function(){ns.Model.get("queueRequest").push({id:"do-resource-publish",params:{id:this.get(".src").get(".id"),reverse:this.get(".reverse"),type:this.get(".src").get(".type")}}).then(this.handleResponsePublish,this.handleResponsePublish,this)},handleResponsePublish:function(e){var t=e.get(".error");t?this.setStatus("failed"):(this.get(".src").stopPublish(),this.get(".reverse")?this.get(".src").unsetPublish():this.get(".src").setPublish(e.data),this.setStatus("done"))},onStatusCompleted:function(){this.get(".src").fetch().always(this.handleSyncResource.bind(this))},handleSyncResource:function(){this.setStatus("done")},onStatusDone:function(){this.notify()},onStatusFailed:function(){this.get(".src").stopPublish(),this.notify()},notify:function(){var e=this.get(".src");return ns.Model.get("queueNotifications").add({src:e.getData(),reverse:this.get(".reverse"),operation:this.getType(),status:this.get(".status")})}}})},{"helpers/resource":22,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-publish":142}],95:[function(e){e("models/resource/resource"),e("models/invites/invites-folder"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-invite-reject"),e("helpers/resource");var t=e("models/model-operation");t.define("operationRejectInvite",{methods:{init:function(){this.get(".idSrc")&&this.set(".src",ns.Model.getValid("resource",{id:this.get(".idSrc")})),this.get(".idDst")&&this.set(".dst",ns.Model.getValid("resource",{id:this.get(".idDst")}))},onStatusCreated:function(){this.get(".src").set(".state.processing",!0),this.doRequestReject()},doRequestReject:function(){ns.Model.get("queueRequest").push({id:"do-resource-invite-reject",params:{hash:this.get(".src").get(".invite.hash")}}).then(this.handleResponseReject,this.handleResponseReject,this)},handleResponseReject:function(e){e.get(".error")?this.setStatus("failed"):this.setStatus("completed")},onStatusCompleted:function(){if(this.get(".isRemote")&&"owner"===this.get(".role")){var e=this.get(".dst"),t=ns.Model.getValid("usersFolder",{idFolder:e.get(".id"),gidFolder:e.get(".meta.group.gid")});return t&&t.fetch(),this.setStatus("done"),void 0}var n=this.get(".src");n&&(this.notify(),ns.Model.getValid("invitesFolder").remove(n),n.remove()),this.setStatus("done")},onStatusDone:function(){ns.Model.destroy(this)},onStatusFailed:function(){this.notify(),this.get(".src").set(".state.processing",!1),ns.Model.destroy(this)},notify:function(){ns.Model.get("queueNotifications").add({src:this.get(".src").getData(),operation:this.getType(),status:this.get(".status")})}}})},{"helpers/resource":22,"models/invites/invites-folder":68,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-invite-reject":139}],96:[function(e,t){var n=e("helpers/path"),r=e("helpers/operation"),s=e("underscore");ns.Model.define("operationRemoteResource",t.exports={params:{id:null},methods:{preprocessData:function(e){var t=this,n=this.extractActions(e),r=this.groupActionsByType(n),a=r.map(function(e){return t.extractActionRoot(e)}),i={isRemote:!0},o=s.filter(a,function(e){return"new"===e.type})[0],c=s.filter(a,function(e){return"deleted"===e.type})[0];if(s.filter(a,function(e){return"changed"===e.type})[0],o&&c)i.idSrc=c.idSrc,i.idDst=o.idSrc,i.type=o.idParent===c.idParent?"rename":"/trash"===c.idParent?"restore":"/trash"===o.idParent?"delete":"move";else{var l;l=1===a.length?a[0]:o||c,"new"===l.type?(i.type="dir"===l.typeSrc?"createFolder":"upload",i.idDst=l.idSrc):"deleted"===l.type?(i.type="delete",i.idSrc=l.idSrc):"published"===l.type||"unpublished"===l.type?(i.type="publish",i.reverse=!("unpublished"!==l.type),i.idSrc=l.idSrc):"clean"===l.type?i.type="cleanTrash":"changed"===l.type&&"file"===l.typeSrc&&(i.type="changed",i.idSrc=l.idSrc)}return i},extractActions:function(e){return no.jpath('/.values["op" == .tag]',e).map(function(e){var t=e.parameters;return{type:t.type,idSrc:n.normalize(t.key),nameSrc:t.name||n.basename(t.key),typeSrc:t.resource_type,idParent:n.normalize(t.folder)}})},groupActionsByType:function(e){var t={};return e.forEach(function(e){t[e.type]||(t[e.type]=[]),t[e.type].push(e)}),s.values(t)},extractActionRoot:function(e){return e.sort(function(e,t){return e.idSrc>t.idSrc}),e[0]},toLocal:function(){return this.get(".type")?r.initialize(this.get(".type"),this.getData()):null}}})},{"helpers/operation":18,"helpers/path":20,underscore:2}],97:[function(e,t){var n=e("helpers/path"),r=e("helpers/resource"),s=e("helpers/operation"),a=e("underscore");
ns.Model.define("operationRemoteShare",t.exports={params:{id:null},methods:{preprocessData:function(e){var t={isRemote:!0,role:e.root.parameters["for"]},s={};switch(a.each(["folder","user","owner"],function(t){var n=no.jpath('/.values["'+t+'" == .tag]',e);n&&(s[t]=n[0].parameters)}),e.root.parameters.type){case"invite_new":t.type="inviteFolder",t.idSrc=n.normalize(s.folder.path);break;case"folder_unshared":t.type="unshare",t.nameFolder=s.folder.name,t.idSrc=n.normalize(s.folder.path);break;case"invite_removed":t.invite=!0;case"user_was_banned":t.type="accessFolder",t.nameFolder=n.basename(n.normalize(s.folder.path)),t.idSrc=n.normalize(s.folder.path);break;case"invite_rejected":t.type="rejectInvite","actor"===t.role?t.idSrc=r.getIdInvite(s.folder.gid,s.folder.name):t.idDst=n.normalize(s.folder.path);break;case"invite_approved":t.type="acceptInvite",t.nameFolder=s.folder.name||n.basename(s.folder.path),s.user&&(t.nameUser=s.user.name),"actor"===t.role&&(t.idSrc=r.getIdInvite(s.folder.gid,t.nameFolder)),t.idDst=n.normalize(s.folder.path);break;case"user_has_left":t.type="leaveFolder",t.idSrc=n.normalize(s.folder.path),t.nameFolder=s.folder.name||n.basename(s.folder.path),s.user&&(t.nameUser=s.user.name);break;case"rights_changed":t.type="accessFolder",t.rights=s.folder.rights,t.nameFolder=n.basename(n.normalize(s.folder.path)),t.idSrc=n.normalize(s.folder.path)}return t},toLocal:function(){return this.get(".type")?s.initialize(this.get(".type"),this.getData()):null}}})},{"helpers/operation":18,"helpers/path":20,"helpers/resource":22,underscore:2}],98:[function(e){e("models/resource/resource"),e("models/state-resource/state-resource"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-move");var t=e("underscore"),n=e("helpers/resource"),r=e("helpers/path"),s=e("models/model-operation");s.define("operationRename",{methods:{init:function(){var e=ns.Model.getValid("resource",{id:this.get(".idSrc")});e||(e=n.createPart({id:this.get(".idSrc"),type:this.get(".typeSrc")},{silent:!0})),this.set(".src",e),this.get(".idDst")&&(this.set(".dst",this.createDst(this.get(".idDst"))),this.transferSelection(this.get(".src"),this.get(".dst")),this.get(".src").hide())},initFromMessage:function(e){var t=e.data.source&&r.normalize(e.data.source),n=e.data.target&&r.normalize(e.data.target),s=r.extname(t)?"file":"dir";this.set(".typeSrc",s),this.set(".idSrc",t),this.set(".idDst",n),this.init(),this.setStatus("progressing")},onStatusCreated:function(){var e=this.get(".src");return e.get(".state.renaming")?this.setStatus("duplicate"):(this._oldName=e.get(".name"),e.rename().then(function(t){this.set(".nameProposed",t);var s=r.join(r.dirname(this.get(".idSrc")),t),a=ns.Model.getValid("resource",{id:s});return n.isNameInvalid(t)?(this.set(".reason","nameHasSlash"),this.setStatus("canceled")):a?this.setStatus(a===e?"canceled":"exists"):(this.set(".idDst",s),n.isCamera(e.get(".id"))?this.confirm({reason:"camera",name:this._oldName}).then(this.setStatus.bind(this,"approved"),this.setStatus.bind(this,"canceled")):this.setStatus("approved"),void 0)}.bind(this),this.setStatus.bind(this,"canceled")),void 0)},onStatusApproved:function(){var e=this.get(".src"),t=this.createDst();this.transferSelection(e,t),e.hide(),this.set(".dst",t),this.doRequestRename()},createDst:function(){return n.createPart($.extend(!0,{},this.get(".src").getData(),{id:this.get(".idDst"),name:this.get(".nameProposed")}),{position:{after:this.get(".src")}})},doRequestRename:function(){ns.Model.get("queueRequest").push({id:"do-resource-move",params:{src:this.get(".idSrc"),dst:this.get(".idDst"),force:0}}).then(this.handleResponseRename,this.handleResponseRename,this)},handleResponseRename:function(e){var t=e.get(".oid");t?(this.set(".oid",t),this.setStatus("progressing")):this.handleErrorRename(e)},handleErrorRename:function(e){var t=e.get(".error")||{};"HTTP_412"===t.id||"HTTP_409"===t.id?this.setStatus("exists"):this.setStatus("failed")},onStatusProgressing:function(){this.doRequestStatus()},handleResponseStatus:function(e){if(e.get(".error"))this.setStatus("failed");else{var n=e.get(".status");t.contains(["EXECUTING","WAITING"],n)?this.doRequestStatus():"DONE"===n?(this.result=e.data,this.setStatus("completed")):this.setStatus("failed")}},onStatusExists:function(){this.set(".reason","exists"),this.setStatus("canceled")},onStatusCompleted:function(){this.get(".dst").fetch().always(this.handleSyncResource,this)},handleSyncResource:function(){this.setStatus("done")},onStatusDone:function(){var e=this.get(".src");e&&e.remove(),delete this._oldName,this.notify()},onStatusCanceled:function(){this.notify(),this.restore()},onStatusFailed:function(){this.restore(),this.notify()},restore:function(){var e=this.get(".src"),t=this.get(".dst");e&&(this._oldName&&(e.set(".name",this._oldName),delete this._oldName),e.show()),t&&(this.transferSelection(t,e),t.get(".state.part")&&t.remove())},transferSelection:function(e,t){var n=ns.page.current.params.idContext,r=ns.Model.getValid("stateResource",{idContext:n,id:e.params.id});if(r&&r.get(".selected")){var s=ns.Model.get("stateResource",{idContext:n,id:t.params.id});s.toggleSelected(),s.setTransfered(),r.deselect()}},notify:function(){var e=this.get(".src"),t=this.get(".dst");return ns.Model.get("queueNotifications").add({src:e.getData(),dst:t&&t.getData(),operation:this.getType(),reason:this.get(".reason"),nameProposed:this.get(".nameProposed"),status:this.get(".status")})}}})},{"helpers/path":20,"helpers/resource":22,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-move":141,"models/state-resource/state-resource":169,underscore:2}],99:[function(e){e("models/resource/resource"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-restore");var t=e("underscore"),n=e("helpers/resource"),r=e("helpers/path"),s=e("helpers/string"),a=e("models/model-operation");a.define("operationRestore",{methods:{init:function(){var e=ns.Model.getValid("resource",{id:this.get(".idSrc")});e||(e=n.createPart({id:this.get(".idSrc"),type:this.get(".typeSrc")},{silent:!0})),this.set(".src",e);var t=this.get(".idDst");t&&this.set(".dst",n.createPart({id:t,type:this.get(".typeSrc")}))},onStatusCreated:function(){this.get(".src").hide(),this.doRequestRestore()},doRequestRestore:function(){ns.Model.get("queueRequest").push({id:"do-resource-restore",params:{id:this.get(".src").get(".id"),nameNew:this.get(".nameNew"),forced:this.get(".forced")}}).then(this.handleResponseRestore,this.handleResponseRestore,this)},handleResponseRestore:function(e){var t=e.get(".oid");t?(this.set(".oid",t),this.setStatus("progressing")):this.handleErrorRestore(e)},handleErrorRestore:function(e){var t=e.get(".error")||{};"HTTP_412"===t.id||"HTTP_409"===t.id?this.setStatus("exists"):this.setStatus("failed")},onStatusExists:function(){var e=this.get(".src").get(".name"),t=r.extname(e),n=e.replace(new RegExp(t+"$"),"-")+s.getUnique()+t;this.set(".nameNew",n),this.doRequestRestore()},onStatusProgressing:function(){this.doRequestStatus()},handleResponseStatus:function(e){var r=e.get(".error");if(r)this.setStatus("failed");else{var s=e.get(".status");if(t.contains(["EXECUTING","WAITING"],s))this.doRequestStatus();else if("DONE"===s){var a=e.get(".resource");this.set(".dst",n.create(a)),this.setStatus("done")}else this.setStatus("failed")}},onStatusCompleted:function(){this.get(".dst").fetch().always(this.handleSyncResource.bind(this))},handleSyncResource:function(){this.setStatus("done")},onStatusDone:function(){this.notify(),ns.Model.get("space").fetch(),this.get(".src").remove()},onStatusFailed:function(){this.get(".src").show(),this.notify()},notify:function(){var e=this.get(".dst"),t=this.get(".src");return ns.Model.get("queueNotifications").add({src:t&&t.getData(),dst:e&&e.getData(),operation:"restore",gid:this.get(".gid"),status:this.get(".status")})}}})},{"helpers/path":20,"helpers/resource":22,"helpers/string":25,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-restore":143,underscore:2}],100:[function(e){e("models/queues/queue-request"),e("models/save-editor-photo/do-save-editor-photo"),e("models/queues/queue-notifications");var t=e("underscore"),n=e("helpers/format"),r=e("helpers/path"),s=e("helpers/resource"),a=e("models/model-operation");a.define("operationSaveEditorPhoto",{methods:{init:function(){this.set(".suffixTime","_"+n.timestampToDate(Math.floor(Date.now()/1e3),"HH-mm-ss")),this.createResourceResult(this.generateName())},generateName:function(){var e=this.get(".id").split("."),t=e.pop(),n=e.pop();return e.push(n+this.get(".suffixTime")),e.push(t),e.join(".")},initFromMessage:function(e){var t=e.data&&r.normalize(e.data.target),n=e.data&&r.normalize(e.data.path);this.set(".id",n),this.createResourceResult(t),this.setStatus("progressing")},onStatusCreated:function(){this.doRequestSave()},onStatusProgressing:function(){this.doRequestStatus()},onStatusCompleted:function(){this.fetchResourceResult(),this.notify()},onStatusFailed:function(){this.get(".resource")&&this.removeResourceResult(),this.notify()},doRequestSave:function(){ns.Model.get("queueRequest").push({id:"do-save-editor-photo",params:{id:this.get(".id"),actionList:this.get(".actions"),suffixTime:this.get(".suffixTime")}}).then(this.handleResponseSave,this.handleResponseSave,this)},createResourceResult:function(e){var t=r.basename(e),n=ns.Model.get("resource",{id:this.get(".id")}),a=Math.floor(Date.now()/1e3),i=$.extend(!0,{},n.getData(),{id:e,name:t,ctime:a,mtime:a,type:"file"}),o=s.createPart(i);this.set(".resource",o)},fetchResourceResult:function(){this.get(".resource").fetch().always(this.handleFetchResource.bind(this))},removeResourceResult:function(){this.get(".resource").remove()},handleResponseSave:function(e){var t=e.get(".oid");t?(this.set(".oid",t),this.setStatus("progressing")):this.setStatus("failed")},handleResponseStatus:function(e){if(e.get(".error"))this.setStatus("failed");else{var n=e.get(".status");t.contains(["EXECUTING","WAITING"],n)?this.doRequestStatus():"DONE"===n?this.setStatus("completed"):this.setStatus("failed")}},handleFetchResource:function(){this.setStatus("done")},notify:function(){var e=this.get(".resource");return ns.Model.get("queueNotifications").add({operation:this.getType(),gid:this.get(".gid"),status:this.get(".status"),dst:e&&e.getData()})}}})},{"helpers/format":14,"helpers/path":20,"helpers/resource":22,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/save-editor-photo/do-save-editor-photo":149,underscore:2}],101:[function(e){e("models/resource/resource"),e("models/queues/queue-request"),e("models/queues/queue-notifications"),e("models/resources/do-resource-unshare");var t=e("helpers/resource"),n=e("helpers/metrika"),r=e("models/model-operation");r.define("operationUnshare",{methods:{init:function(){this.get(".idSrc")&&this.set(".src",ns.Model.getValid("resource",{id:this.get(".idSrc")}))},onStatusCreated:function(){this.confirm({src:this.get(".src").getData()}).then(this.setStatus.bind(this,"started"),this.setStatus.bind(this,"rejected"))},onStatusStarted:function(){n.count("actions","shared folders","revoke access for all","by button in dialog"),this.doRequestUnshare()},onStatusRejected:function(){this.remove()},remove:function(){ns.Model.destroy(this)},doRequestUnshare:function(){ns.Model.get("queueRequest").push({id:"do-resource-unshare",params:{gid:this.get(".src").get(".meta.group.gid")}}).always(this.handleResponseUnshare,this)},handleResponseUnshare:function(e){var t=e.valueOf(),n=t.get(".error");n?this.setStatus("failed"):this.setStatus("completed")},onStatusCompleted:function(){var e=this.get(".src");return this.get(".isRemote")&&"user"===this.get(".role")?(ns.Model.get("queueNotifications").add({nameFolder:this.get(".nameFolder"),operation:"unshare",role:this.get(".role"),status:this.get(".status")}),ns.Model.get("space").fetch(),e&&e.remove(),this.setStatus("done"),void 0):e?(e.notifyChangedAccess(),e.fetch().always(this.handleSyncResource.bind(this)),t.updateParentsOf(e.get(".id")),void 0):(this.setStatus("done"),void 0)},handleSyncResource:function(){this.setStatus("done")}}})},{"helpers/metrika":17,"helpers/resource":22,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/resource/resource":133,"models/resources/do-resource-unshare":145}],102:[function(e){var t=e("underscore"),n=e("models/model-operation"),r=e("models/operation/operation-upload");n.define("operationUploadFlash",{methods:t.extend({},r,{onStatusProgressing:function(e){this.doRequestStatus(),this.get(".uploader").notify("uploadFiles",[{url:e.get(".upload_url"),id:this.get(".file").id}]),this.promiseUpload=this.get(".uploader").promise,this.promiseUpload.then(function(){"done"!=this.get(".status")&&this.set(".uploaded",!0)},function(){"canceled"!=this.get(".status")&&this.setStatus("failed")},this)},onStatusCanceled:function(){this.notify(),this.removeDst(),this.destroy()}})})},{"models/model-operation":73,"models/operation/operation-upload":104,underscore:2}],103:[function(e){function t(e){function t(e){s.readEntries(function(n){n.length?(r=r.concat([].slice.call(n||[],0)),t(e)):e(r)})}var n=new Vow.Promise,r=[];try{var s=e.createReader();t(n.fulfill.bind(n))}catch(a){n.reject(a)}return n}function n(e){return p.contains(v,e.name)}function r(e){return"done"===e.get(".status")}function s(e){return"operationUploadFolder"===e.id}function a(e,t){return e+(t.get(".total")||0)}function i(e,t){var n=t.get(".total")*t.get(".progress")/100;return e+(n||0)}function o(e,t){var n=t.get(".reason");"NO_SPACE"===n?(e.set(".reason",n),e.fail()):t.restart()}function c(e,t){e.trigger(y,t.get(".idDst"),t.get(".reason")),e._dropUpload(t)}function l(e){e.off("ns-model-changed.progress"),e.off("ns-model-changed.total"),e.off("status.done"),e.off("status.canceled"),e.off("status.failed"),e.off("status.exists"),e.off(y)}function d(e,t){return function(){return e-->0?t.apply(this,arguments):void 0}}function u(e,t){return function(){return 0===e--?t.apply(this,arguments):void 0}}e("models/resource/resource"),e("models/operation/operation-create-folder"),e("models/operation/operation-upload");var p=e("underscore"),f=e("helpers/path"),h=e("helpers/operation"),m=e("models/model-operation"),v=[".DS_Store","Thumbs.db"],g=3,y="suboperation.failed",b=".suboperationsFailed";m.define("operationUploadFolder",{methods:{init:function(){this.get(".nameDst")||this.set(".nameDst",this.get(".folder.name")),this.uploads=[],p.bindAll(this,"_refreshProgress","_checkIfOperationDone")},onStatusCreated:function(){this.set(".progress",0),this.set(".total",0),this.set(".dst",null),this.set(b,{}),this.set(".idDst",f.join(this.get(".idFolderDst"),this.get(".nameDst")));var e=h.initialize("createFolder",{idDst:this.get(".idDst")});e.notify=e.onStatusExists=no.nop,e.on("status.done",function(){this.set(".dst",e.get(".dst")),this.setStatus("progressing")}.bind(this)),e.on("status.exists",this._onFolderExists.bind(this)),e.on("status.failed",this.setStatus.bind(this,"failed")),this.on("status.canceled",function(){e.off("status.done"),e.off("status.exists"),e.off("status.failed")}),e.run()},onStatusProgressing:function(){t(this.get(".folder")).then(function(e){if(!this._isCanceled()){var t=p.reject(e,n);p.isEmpty(t)?this._finalizeOperationEmpty():this.uploads=p.map(t,this._createUpload,this)}}.bind(this),this.setStatus.bind(this,"failed"))},onStatusDone:function(){p.each(this.uploads,l),delete this.uploads},onStatusFailed:function(){p.each(this.uploads,l),p.invoke(this.uploads,"cancel"),delete this.uploads},onStatusCanceled:function(){p.each(this.uploads,l),p.invoke(this.uploads,"cancel"),delete this.uploads,p.defer(this.destroy.bind(this))},cancel:function(){this.setStatus("canceled")},restart:function(){this.setStatus("created")},fail:function(){this.setStatus("failed")},renameDst:function(e){this._isExisting()&&(this.set(".nameDst",e),this.restart())},merge:function(){this._isExisting()&&this.setStatus("progressing")},isFinalized:function(){return r(this)},_isExisting:function(){return"exists"===this.get(".status")},_isCanceled:function(){return"canceled"===this.get(".status")},_isNested:function(){return!!this.get(".nested")},_createUpload:function(e){var t;return t=e.isDirectory?h.initialize("uploadFolder",{folder:e,idFolderDst:this.get(".idDst"),nested:!0}):h.initialize("upload",{file:e,idFolderDst:this.get(".idDst")}),this._bindToOperationUpload(t),t.notify=no.nop,t.run(),t},_refreshProgress:function(){if("failed"===this.get(".status"))return this.set(".total",0),this.set(".progress",0),void 0;if(p.isEmpty(this.uploads))this.set(".total",0),this.set(".progress",100);else{var e=p.reduce(this.uploads,a,0),t=p.reduce(this.uploads,i,0);this.set(".total",e),this.set(".progress",Math.round(100*(t/e)))}},_checkIfOperationDone:function(){p.every(this.uploads,r)&&this.setStatus("done")},_dropUpload:function(e){var t=this.uploads.indexOf(e);-1!==t&&(l(e),this.uploads.splice(t,1),this._refreshProgress(),this._checkIfOperationDone())},_bindToOperationUpload:function(e){e.on("ns-model-changed.progress",this._refreshProgress),e.on("ns-model-changed.total",this._refreshProgress),e.on("status.done",this._checkIfOperationDone),e.on("status.canceled",this._dropUpload.bind(this,e)),e.on("status.failed",d(g,p.partial(o,this,e))),e.on("status.failed",u(g,p.partial(c,this,e))),e.on("status.exists",function(){s(this)?this.setStatus("progressing"):this.cancel()}),e.on(y,this._onSuboperationFailed.bind(this))},_onSuboperationFailed:function(e,t,n){this._isNested()?this.trigger(y,t,n):this._addToSuboperationsFailed(t,n)},_onFolderExists:function(){var e=ns.Model.get("resource",{id:this.get(".idDst")}),t=function(){this.set(".dst",e),this.setStatus("exists")}.bind(this);e.isValid()?t():e.fetch().always(t)},_addToSuboperationsFailed:function(e,t){var n=this.get(b),r=p.extend(p.object([e,t]),n);this.set(b,r)},_finalizeOperationEmpty:function(){this._refreshProgress(),this.setStatus("done")}}})},{"helpers/operation":18,"helpers/path":20,"models/model-operation":73,"models/operation/operation-create-folder":83,"models/operation/operation-upload":104,"models/resource/resource":133,underscore:2}],104:[function(e,t){e("models/resource/resource"),e("models/space/space"),e("models/queues/queue-request"),e("models/queues/queue-upload"),e("models/queues/queue-notifications"),e("models/resources/do-resource-upload-url");var n=e("underscore"),r=e("environment"),s=e("helpers/resource"),a=e("helpers/path"),i=e("models/model-operation"),o=92,c="SIZE_ZERO",l="NO_SPACE";i.define("operationUpload",{methods:t.exports={init:function(){var e=this.get(".idDst");e?this.set(".dst",s.createPart({id:e,type:"file"})):(this.get(".nameDst")||this.set(".nameDst",this.get(".file.name")),e=a.join(this.get(".idFolderDst"),this.get(".nameDst"))),this.set(".idDst",e)},run:function(){var e=this.get(".file");return n.isFunction(e.file)?e.file(function(e){this.set(".file",e),this.setStatus("created")}.bind(this),function(e){this.set(".reason",e),this.setStatus("failed")}.bind(this)):this.setStatus("created"),this},onStatusCreated:function(){return"unsupported"===this.get(".file.error")||0===this.get(".file.size")&&"iOS"!==r.agent.OSFamily?(this.set(".reason",c),this.setStatus("failed"),void 0):(this.set(".progress",0),this.get(".file.size")>0&&this.set(".total",this.get(".file.size")),this.createDst(),void 0)},onStatusStarted:function(){this.doRequestUploadUrl()},onStatusForced:function(){var e=ns.Model.getValid("resource",{id:this.get(".idDst")});e?e.set(".state.blocked",!0):e=s.createPart({id:this.get(".idDst"),type:"file"}),this.set(".dst",e),this.doRequestUploadUrl()},doRequestUploadUrl:function(){ns.Model.get("queueRequest").push({id:"do-resource-upload-url",params:{dst:this.get(".idDst"),force:this.get(".force")}}).always(this.handleResponseUploadUrl,this)},handleResponseUploadUrl:function(e){var t=e.valueOf(),n=t.get(".oid");n?(this.set(".oid",n),this.setStatus("progressing",t)):this.handleErrorUploadUrl(t)},handleErrorUploadUrl:function(e){var t=e.get(".error")||{};"HTTP_412"===t.id||"HTTP_409"===t.id?this.setStatus("exists"):"HTTP_497"===t.id||"HTTP_507"===t.id?(this.set(".reason",l),this.setStatus("failed")):this.setStatus("failed")},onStatusProgressing:function(e){var t=new FormData;t.append("file",this.get(".file")),this.promiseUpload=ns.Model.get("queueUpload").push({url:e.get(".upload_url"),data:t,operationModel:this}),this.promiseUpload.then(function(){this.set(".uploaded",!0),this.doRequestStatus()},function(e){"canceled"!=this.get(".status")&&(e&&507==e.status?this.set(".reason",l):e&&0==e.status&&this.set(".reason",c),this.setStatus("failed"))},function(e){this.set(".total",e.total),this.setProgress(Math.round(e.loaded/e.total*o))},this)},handleResponseStatus:function(e){if(e.get(".error"))this.handleErrorStatus(e);else{this.setProgress(e.get(".progress"));var t=e.get(".status");"EXECUTING"===t||"WAITING"===t?(100===e.get(".progress")&&this.set(".uploaded",!0),this.doRequestStatus()):"DONE"===t?(this.result=e.data,this.setStatus("done")):this.setStatus("failed")}},handleErrorStatus:function(e){var t=e.get(".error.response");(497==t||507==t)&&this.set(".reason",l),this.setStatus("failed")},onStatusDone:function(){this.get(".dst")&&this.result&&this.result.resource&&this.get(".dst").replaceData(this.result.resource),ns.Model.get("space").fetch(),this.notify()},onStatusCompleted:function(){this.set(".file",null),this.get(".dst").fetch().always(this.handleSyncResource.bind(this))},handleSyncResource:function(){this.setStatus("done")},onStatusCanceled:function(){this.promiseUpload&&this.promiseUpload.reject(),this.notify(),this.removeDst(),this.destroy()},onStatusFailed:function(){this.promiseUpload&&this.promiseUpload.reject(),this.notify(),this.removeDst()},removeDst:function(){if(this.get(".dst"))if(this.get(".force")&&this.get(".dst").get(".state.blocked")){var e=this.get(".dst").getData();no.jpath.set(".state.blocked",e,!1),this.get(".dst").updateData(s.preprocess(e))}else this.get(".dst").remove()},notify:function(){return c!==this.get(".reason")?ns.Model.get("queueNotifications").add({operation:"upload",nameDst:a.basename(this.get(".idDst")),status:this.get(".status")}):void 0},createDst:function(){var e=this.get(".idDst"),t=ns.Model.getValid("resource",{id:e});t?this.setStatus("exists"):(this.set(".dst",s.createPart({id:e,type:"file"},{})),this.setStatus("started"))},cancel:function(){this.doRequestStatus=this.handleResponseStatus=no.nop,this.doRequestUploadUrl=this.handleResponseUploadUrl=no.nop,this.queueSetStatus=[],this.setStatus("canceled")},restart:function(){this.setStatus("created")},force:function(){this.set(".force",1),this.setStatus("forced")},isFinalized:function(){var e=this.get(".status");return n.contains(["done","failed","canceled"],e)},setProgress:function(e){var t=parseInt(e,10);(!this.get(".progress")||t>this.get(".progress"))&&this.set(".progress",t)}}})},{environment:8,"helpers/path":20,"helpers/resource":22,"models/model-operation":73,"models/queues/queue-notifications":118,"models/queues/queue-request":120,"models/queues/queue-upload":122,"models/resource/resource":133,"models/resources/do-resource-upload-url":146,"models/space/space":163,underscore:2}],105:[function(e){e("models/queues/queue-request");var t=e("underscore"),n=e("helpers/operation"),r=["copy","move","trash","aviary"];ns.Model.define("operationsActive",{methods:{preprocessData:function(e){return t.filter(e,function(e){return t.contains(r,e.type)})},revive:function(){ns.Model.get("queueRequest").push(this).then(this.createOperations.bind(this))},createOperations:function(){var e=this.getData();t.each(e,function(e){n.catchUp(e)})}}})},{"helpers/operation":18,"models/queues/queue-request":120,underscore:2}],106:[function(e){function t(e,t){return e+(t.get(".progress")||0)}function n(e){return e.isFinalized()}function r(e){return"failed"===e.get(".status")}e("models/operation/operation-upload"),e("models/operation/operation-upload-flash"),e("models/resource-uploaded/resource-uploaded");var s=e("underscore"),a=e("models/operations/operations");ns.Model.define("operationsUpload",{isCollection:!0,events:{"ns-model-insert":"onUploadCreated"},methods:{destroyAll:function(){s.invoke(this.models.slice(),"destroy")},cancelAll:function(){s.invoke(this.models.slice(),"cancel")},getProgressOverall:function(){return this.models.length&&s.reduce(this.models,t,0)/this.models.length},isComplete:function(){return s.every(this.models.slice(),n)},isAllFailed:function(){return s.every(this.models.slice(),r)},isEmpty:function(){return s.isEmpty(this.models)},onUploadCreated:function(e,t){var n=s.groupBy(this.models.slice(),function(e){return e.get(".idDst")});s.each(n,function(e,n){if(e.length>1){var r=s.difference(e,t);s.each(r,function(e){e.isFinalized()?e.destroy():s.invoke(s.filter(t,function(e){return e.get(".idDst")===n}),"cancel")})}}),s.each(t,function(e){e.on("status.done",this.replaceOperation.bind(this,e))},this)},replaceOperation:function(e){var t,n=e.get(".idDst");n&&(t=ns.Model.get("resourceUploaded",{id:n}),t.extractDataUpload(e),this.insert(t,this.models.indexOf(e)))}}},a),ns.Model.get("operationsUpload").setDataDefault()},{"models/operation/operation-upload":104,"models/operation/operation-upload-flash":102,"models/operations/operations":107,"models/resource-uploaded/resource-uploaded":123,underscore:2}],107:[function(e,t){var n=e("underscore");t.exports=ns.Model.define("operations",{isCollection:!0,methods:{getByType:function(){var e=n.toArray(arguments);return n.filter(this.models.slice(),function(t){return n.contains(e,t.getType())})}}}),ns.Model.get("operations").setDataDefault()},{underscore:2}],108:[function(e){var t=e("helpers/uri");ns.Model.define("do-order-payment",{params:{idOfferSpace:null,method:null,repeat:null,retpath:null},methods:{preprocessData:function(e){return e.url&&(e.url=t.replaceTld(e.url,t.getTldRootCurrent())),e}}})},{"helpers/uri":29}],109:[function(e){var t=e("helpers/uri");ns.Model.define("do-service-prolongate",{params:{sid:null,method:null,retpath:null},methods:{preprocessData:function(e){return e.url=t.replaceTld(e.url,t.getTldRootCurrent()),e}}})},{"helpers/uri":29}],110:[function(){ns.Model.define("do-service-unsubscribe",{params:{sid:null}})},{}],111:[function(){ns.Model.define("methodsPayment")},{}],112:[function(){var e="bankcard",t="yamoney";ns.Model.define("stateFormPayment",{defaults:{idOfferSpace:"100gb_1y",method:e,repeat:!0,autoCheckRepeat:!0},methods:{reset:function(){this.setDataDefault()},setMethod:function(e){this.set(".method",e),e===t?this.set(".repeat",!1):this.get(".autoCheckRepeat")&&this.set(".repeat",!0)},setRepeat:function(e){this.set(".repeat",e),e||this.set(".autoCheckRepeat",!1)},resetStatus:function(){this.set(".status",null)}}})},{}],113:[function(e){e("models/resource/resource");var t=e("underscore");ns.Model.define("photostreamGroup",{split:{items:".items",model_id:"resource",params:{id:".id"}},events:{"ns-model-remove":"onRemoved"},params:{name:null,idContext:null},methods:{onRemoved:function(){t.isEmpty(this.models)&&this.destroy()}}})},{"models/resource/resource":133,underscore:2}],114:[function(e){function t(e){function t(t){return e instanceof ns.Model?e.get(t):no.jpath(t,e)}if("dir"==t(".type"))return"folders";if(!t(".meta.etime"))return"files";var n=new Date(1e3*t(".meta.etime")),r=n.getMonth(),s=n.getFullYear();return s+"_"+(10>r?"0":"")+r}e("models/states-context/states-context"),e("models/resources/resources"),e("models/photostream/photostream-group");var n=e("underscore"),r=e("helpers/array");ns.Model.define("photostream",{split:{items:".groups",model_id:"photostreamGroup",params:{name:".name",idContext:".idContext"}},params:{idContext:null},defaults:function(){return this.resources&&this.resources.getData()},methods:{_init:function(e,t){var r=ns.Model.get("statesContext",t),s=ns.Model.get("resources",n.extend(t,r.getData()));this.resources=s,n.bindAll(this,"updatePositionResource","onResourceInserted","getPositionGroup"),s.on("ns-model-insert",this.onResourceInserted),s.on("ns-model-changed",this.updatePositionResource),ns.ModelCollection.prototype._init.apply(this,arguments)},preprocessData:function(e){return{groups:n.map(n.groupBy(e.resources,t),function(e,t){return{name:t,idContext:this.params.idContext,items:e}},this)}},updatePositionResource:function(e){var t=ns.Model.get("photostreamGroup",{name:"files",idContext:this.params.idContext});n.each(t.models,function(n){n.get(".meta.etime")&&(t.remove(n),this.onResourceInserted(e,[n]))},this)},onResourceInserted:function(e,s){var a=n.groupBy(s,t);n.each(a,function(e,t){var s=ns.Model.get("photostreamGroup",{name:t,idContext:this.params.idContext});"files"===t||"folders"===t?s.insert(e):n.each(e,function(e){s.insert(e,r.sortedIndex(s.models,e,function(e,t){return t.get(".meta.etime")-e.get(".meta.etime")}))}),"folders"===t?this.insert(s,0):"files"===t?this.insert(s,this.models.length):this.insert(s,this.getPositionGroup(s))},this)},getPositionGroup:function(e){var t=0,s=n.reject(this.models,function(e){return"files"===e.params.name||"folders"===e.params.name});return t=r.sortedIndex(s,e,function(e,t){return e.params.name>t.params.name?-1:e.params.name<t.params.name?1:0}),"folders"===this.models[0].params.name&&(t+=1),t}}})},{"helpers/array":9,"models/photostream/photostream-group":113,"models/resources/resources":147,"models/states-context/states-context":171,underscore:2}],115:[function(){ns.Model.define("player",{defaults:{volume:.5,time:0,total:0,error:!1},methods:{setError:function(){this.set(".error",!0)},resetError:function(){this.set(".error",!1)},setVolume:function(e){this.set(".volume",e)},setResourcePlaying:function(e){this.set(".resourcePlaying",e)},setPlaying:function(){this.set(".playing",!0)},resetPlaying:function(){this.set(".playing",!1)},play:function(){this.get(".resourcePlaying")&&this.trigger("play")},pause:function(){this.trigger("pause")}}}),ns.Model.get("player").setDataDefault()},{}],116:[function(e){function t(e,t){if(t&&".status"===t.jpath&&t.model){var s=t.model.getType();o.contains(l,s)&&o.chain(d.getByType.apply(d,l)).groupBy(r).reduce(i,{}).each(n)}}function n(e,t){u.set("."+t,e)}function r(e){return"id"+(e.get(".gid")||c())}function s(e){return o.reduce(e,function(e,t){return e+=t.countItems()},0)}function a(e){return o.reduce(e,function(e,t){var n=t.get(".src"),r=n&&n.get(".type");return e?r&&e!==r?"mix":e:r},null)}function i(e,t){var n=o.first(t).getType(),r=e[n],i=o.filter(t,function(e){return e.isActive()});if(i.length){var c={total:s(t),active:s(i),typeResources:a(t),type:n};r?(r.total+=c.total,r.active+=c.active):e[n]=c}else e[n]=null;return e}var o=e("underscore"),c=e("helpers/guid");ns.Model.define("progressGroup");var l=["copy","move","rename","delete","cleanTrash","saveEditorPhoto","exportSocial"],d=ns.Model.get("operations"),u=ns.Model.get("progressGroup").setDataDefault();d.on("ns-model-changed",t)},{"helpers/guid":15,underscore:2}],117:[function(e,t){e("models/confirmation/confirmation");var n=e("underscore"),r=e("helpers/guid"),s=e("helpers/page"),a=e("models/model-queue");a.define("queueConfirmations",t.exports={limit:1,methods:{add:function(e){var t=ns.Model.get("confirmation",{confirmation:r()}).setData(e),n=this.push(t);return t.on("all",function(e,t){i.create(t)}),t.on("confirmed",function(e,t){n.fulfill(t)}),t.on("rejected",function(e,t){n.reject(t)}),n},handlePortion:function(e){var t=e[0],n=i.find(t.item.getData());return n?(t.item[n.confirm?"confirm":"reject"](n.data),t.promise[n.confirm?"fulfill":"reject"](n.data),t.promise):(t.promise.always(function(){this.set(".active",null),t.item.destroy(),s.update()
},this),t.promise.progress(function(e){"confirm"===e?t.item.confirm():"reject"===e&&t.item.reject()}),this.set(".active",t.item),s.update(),t.promise)},resetRules:function(){i._reset()}}});var i={EXPIRATION_TIMEOUT:6e4,_rules:{},create:function(e){if(e.gid&&e.status){var t=n.clone(e);e instanceof ns.Model&&"confirmation"===e.id&&(t=e.getData()),this._rules[t.gid]||(this._rules[t.gid]={}),this._rules[t.gid][t.status]={confirm:t.confirm,data:t.data},this._touch(this._rules[t.gid][t.status])}},find:function(e){var t=this._rules[e.gid]&&this._rules[e.gid][e.status];return t&&this._touch(t),t},_touch:function(e){e._expiration=Date.now()+this.EXPIRATION_TIMEOUT},_recycle:function(){var e=Date.now();n.each(this._rules,function(t){n.each(t,function(t,n,r){t._expiration<e&&delete r[n]})})},_reset:function(){this._rules={}}};setInterval(n.bind(i._recycle,i),2*i.EXPIRATION_TIMEOUT),ns.Model.get("queueConfirmations").setDataDefault()},{"helpers/guid":15,"helpers/page":19,"models/confirmation/confirmation":50,"models/model-queue":74,underscore:2}],118:[function(e,t){e("models/notification/notification");var n=e("underscore"),r=e("helpers/guid"),s=e("models/model-queue");s.define("queueNotifications",t.exports={limit:4,methods:{add:function(e){if(e.gid){var t=n.find(n.union(this.items,this.itemsProcessing),function(t){return e.gid===t.item.get(".gid")&&e.status===t.item.get(".status")});if(t)return e.src.type!==t.item.get(".typeResources")&&t.item.set(".typeResources","mix"),t.item.set(".count",(t.item.get(".count")||1)+1),t.promise}e.typeResources=e.src&&e.src.type;var s=ns.Model.get("notification",{notification:r()}).setData(e);return this.push(s)},getPortion:function(){var e=Math.max(this.limit-this.itemsProcessing.length,0);return this.items.splice(0,e)},doIteration:function(){var e=this.getPortion();e.length&&(this.itemsProcessing=this.itemsProcessing.concat(e),n.each(e,function(e){e.promise.always(function(){var t=this.itemsProcessing.indexOf(e);-1!==t&&this.itemsProcessing.splice(t,1),this.doIteration()},this)},this),this.handlePortion(e))},handlePortion:function(e){n.each(e,function(e){this.trigger("processing",e)},this)}}}),ns.Model.get("queueNotifications").setDataDefault()},{"helpers/guid":15,"models/model-queue":74,"models/notification/notification":75,underscore:2}],119:[function(e){var t=e("underscore"),n=e("models/model-queue"),r=100;n.define("queueRateLimiter",{limit:25,methods:{handlePortion:function(e){var n=Vow.delay(null,r);return t.invoke(e,"item"),n}}}),ns.Model.get("queueRateLimiter").setDataDefault()},{"models/model-queue":74,underscore:2}],120:[function(e,t){var n=e("underscore"),r=e("models/model-queue");r.define("queueRequest",t.exports={limit:10,methods:{handlePortion:function(e){var t,r=this,s=[],a=[];return n.each(e,function(e){var t={id:e.item.id,params:e.item.params};s.push(t),a.push(e.promise||null)}),t=ns.forcedRequest(s),t.then(function(e){n.each(e,function(e,t){var n=a[t];if(n){var s=e.getError();s?"WRONG_SK"===s.id?r.push(e).then(function(){n.fulfill()},function(){n.reject()}):n.reject(e):n.fulfill(e)}})}),t}}}),ns.Model.get("queueRequest").setDataDefault()},{"models/model-queue":74,underscore:2}],121:[function(e,t){var n=e("underscore"),r=e("models/model-queue");r.define("queueSync",t.exports={limit:3,methods:{handlePortion:function(e){var t=n.reduce(e,function(e,t){var n=ns.Model.key(t.item.id,t.item.params);return e[n]?e[n].promise&&e[n].promise.then(function(){t.promise.fulfill()},function(){t.promise.reject()}):e[n]=t,e},{}),r=n.pluck(t,"item"),s=ns.forcedRequest(r);return s.then(function(e){n.each(e,function(e){var n=ns.Model.key(e.id,e.params);t[n].promise&&t[n].promise.fulfill(e)})}),s}}}),ns.Model.get("queueSync").setDataDefault()},{"models/model-queue":74,underscore:2}],122:[function(e,t){var n=e("underscore"),r=e("models/model-queue");r.define("queueUpload",t.exports={limit:2,methods:{handlePortion:function(e){return Vow.all(n.map(e,function(e){var t=e.promise,n=this.upload(e.item.url,e.item.data,t);return n.done(function(){t.fulfill()}),n.fail(function(){t.reject(n)}),t.fail(n.abort,n),t},this))},upload:function(e,t,n){return $.ajax({url:e,data:t,type:"POST",cache:!1,contentType:!1,processData:!1,xhr:function(){var e=$.ajaxSettings.xhr();if(e.upload){var t=function(e){e&&e.lengthComputable&&n&&n.notify({event:"progress",loaded:e.loaded,total:Math.max(e.total,e.loaded)})},r=function(){e.upload.removeEventListener("loadend",r,!1),e.upload.removeEventListener("progress",t,!1)};e.upload.addEventListener("progress",t,!1),e.upload.addEventListener("loadend",r,!1)}return e}})}}}),ns.Model.get("queueUpload").setDataDefault()},{"models/model-queue":74,underscore:2}],123:[function(e){var t=e("underscore");e("models/model-local").define("resourceUploaded",{params:{id:null},methods:{isFinalized:t.constant(!0),cancel:no.nop,extractDataUpload:function(e){this.setData({idDst:e.get(".idDst"),total:e.get(".total"),status:"done",progress:100})}}})},{"models/model-local":72,underscore:2}],124:[function(){ns.Model.get("resource",{id:"/attach"}).setData({id:"/attach",type:"dir",isSlice:!0,name:"Отправленные как ссылки на Диск",parents:[{id:"/disk",name:"disk"},{id:"/mail",name:"Почтовые вложения"}]})},{}],125:[function(){ns.Model.get("resource",{id:"/disk"}).setData({id:"/disk",type:"dir",name:"Яндекс.Диск",parents:[]})},{}],126:[function(){ns.Model.get("resource",{id:"/mail"}).setData({id:"/mail",type:"dir",isSlice:!0,name:"Почтовые вложения",parents:[{id:"/disk",name:"disk"}]})},{}],127:[function(){ns.Model.get("resource",{id:"/narod"}).setData({id:"/narod",type:"dir",isSlice:!0,name:"Народ",parents:[{id:"/disk",name:"disk"}]})},{}],128:[function(){ns.Model.get("resource",{id:"/published"}).setData({id:"/published",type:"dir",isSlice:!0,name:"Публичные ссылки",parents:[{id:"/disk",name:"disk"}]})},{}],129:[function(){ns.Model.get("resource",{id:"/shared"}).setData({id:"/shared",type:"dir",isSlice:!0,name:"Общие папки",parents:[{id:"/disk",name:"disk"}]})},{}],130:[function(e){e("models/space/space");var t=ns.Model.get("space"),n=ns.Model.get("resource",{id:"/trash"}).setData({id:"/trash",type:"dir",isSlice:!0,name:"Корзина",meta:{size:t.get(".trash")},parents:[{id:"/disk",name:"disk"}]});t.on("ns-model-changed",function(){n.set(".meta.size",t.get(".trash"))})},{"models/space/space":163}],131:[function(){ns.Model.get("resource",{id:"/attach/yaruarchive"}).setData({id:"/attach/yaruarchive",type:"dir",isSlice:!0,name:"Архив Я.Ру",parents:[{id:"/disk",name:"disk"}]})},{}],132:[function(){ns.Model.get("resource",{id:"/yavideo"}).setData({id:"/yavideo",type:"dir",isSlice:!0,name:"Яндекс.Видео",parents:[{id:"/disk",name:"disk"}]})},{}],133:[function(e,t){e("models/queues/queue-request"),e("models/queues/queue-sync"),e("models/resources/do-get-resource-url");var n=e("underscore"),r=e("helpers/resource"),s=e("helpers/path");ns.Model.define("resource",t.exports={params:{id:null},methods:{show:function(){this.set(".state.hidden",!1)},hide:function(){this.set(".state.hidden",!0)},rename:function(){return this.promiseRename=new Vow.Promise,this.set(".state.renaming",!0),this.promiseRename},setName:function(e){""===e&&(e=this.get(".name")),this.set(".state.renaming",!1),this.promiseRename.fulfill(e)},resetName:function(){this.set(".state.renaming",!1),this.promiseRename.reject()},startPublish:function(){this.set(".state.publishing",!0)},stopPublish:function(){this.set(".state.publishing",!1)},setPublish:function(e){this.set(".meta.public",1),this.set(".meta.short_url",e.short_url),this.notifyUpdated()},unsetPublish:function(){this.set(".meta.public",0),this.set(".meta.short_url",""),this.notifyUpdated()},startImport:function(){this.set(".state.importing",!0)},stopImport:function(){this.set(".state.importing",!1)},fetch:function(){var e=ns.Model.get("queueSync").push(this);return e.then(this.notifyUpdated.bind(this)),e},getURL:function(e){return ns.Model.get("queueRequest").push({id:"do-get-resource-url",params:{id:this.params.id,inline:e&&e.inline}})},preprocessData:function(e){e=r.preprocess(e);var t=[".state.hidden",".state.blocked",".state.portional",".state.publishing"];return n.each(t,function(t){var r=this.get(t),s=no.jpath(t,e);!n.isUndefined(r)&&n.isUndefined(s)&&no.jpath.set(t,e,r)},this),e},notifyCreated:function(e){ns.events.trigger("ufo-resource-created",{resource:this,options:e}),this.trigger("created",this)},notifyUpdated:function(){ns.events.trigger("ufo-resource-updated",{resource:this})},notifyChangedAccess:function(){this.trigger("ufo-changed-access")},notifyReplaced:function(e){this.trigger("ufo-replaced",e)},remove:function(){ns.events.trigger("ufo-resource-removed",{resource:this}),ns.Model.destroy(this)},replace:function(e){this.notifyReplaced(e)},replaceData:function(e){if(s.normalize(e.id)===this.get(".id"))no.jpath.set(".state.blocked",e,!1),no.jpath.set(".state.part",e,!1),this.updateData(r.preprocess(e)),this.notifyUpdated();else{var t=r.create(e,{silent:!0});this.notifyReplaced(t)}},allowsUpload:function(){return!this.get(".isSlice")&&!this.get(".meta.group.readonly")&&!s.isParent("/yavideo",this.get(".id"))},hideChildren:function(){this.trigger("ufo-resources-hidden")},showChildren:function(){this.trigger("ufo-resources-shown")},destroyChildren:function(){this.trigger("ufo-resources-destroyed")}}}),e("models/resource/local/disk"),e("models/resource/local/published"),e("models/resource/local/shared"),e("models/resource/local/trash"),e("models/resource/local/mail"),e("models/resource/local/attach"),e("models/resource/local/narod"),e("models/resource/local/yavideo"),e("models/resource/local/yaru")},{"helpers/path":20,"helpers/resource":22,"models/queues/queue-request":120,"models/queues/queue-sync":121,"models/resource/local/attach":124,"models/resource/local/disk":125,"models/resource/local/mail":126,"models/resource/local/narod":127,"models/resource/local/published":128,"models/resource/local/shared":129,"models/resource/local/trash":130,"models/resource/local/yaru":131,"models/resource/local/yavideo":132,"models/resources/do-get-resource-url":134,underscore:2}],134:[function(e){var t=e("helpers/uri"),n=e("helpers/path");ns.Model.define("do-get-resource-url",{params:{id:null,inline:null},methods:{preprocessData:function(e){var r=e.file||e.folder;return n.isParent("/yavideo",this.params.id)||(r=t.replaceTld(r,t.getTldRootCurrent())),r=t.cutProto(r),e.file?e.file=r:e.folder&&(e.folder=r),e}}})},{"helpers/path":20,"helpers/uri":29}],135:[function(){ns.Model.define("do-resource-copy",{params:{src:null,dst:null,force:0}})},{}],136:[function(){ns.Model.define("do-resource-create-folder",{params:{id:null,force:0}})},{}],137:[function(){ns.Model.define("do-resource-delete",{params:{id:null}})},{}],138:[function(){ns.Model.define("do-resource-invite-accept",{params:{hash:null}})},{}],139:[function(){ns.Model.define("do-resource-invite-reject",{params:{hash:null}})},{}],140:[function(){ns.Model.define("do-resource-leave",{params:{gid:null}})},{}],141:[function(){ns.Model.define("do-resource-move",{params:{src:null,dst:null,force:0}})},{}],142:[function(){ns.Model.define("do-resource-publish",{params:{id:null,reverse:null,type:null}})},{}],143:[function(){ns.Model.define("do-resource-restore",{params:{id:null,nameNew:null,forced:null}})},{}],144:[function(){ns.Model.define("do-resource-share-access",{params:{gid:null,userid:null,uid:null,service:null,status:null,rights:null}})},{}],145:[function(){ns.Model.define("do-resource-unshare",{params:{gid:null}})},{}],146:[function(){ns.Model.define("do-resource-upload-url",{params:{dst:null,force:0}})},{}],147:[function(e,t){e("models/resource/resource");var n=e("underscore"),r=e("helpers/path"),s=e("helpers/array"),a=e("models/model-collection-lazy"),i=e("models/user-current/user-current");a.define("resources",t.exports={split:{items:".resources",model_id:"resource",params:{id:".id"}},params:{idContext:null,order:null,sort:null,querySearch:null,scopeSearch:null,typeSearch:null},events:{"ns-model-insert":"onInserted","ns-model-remove":"onRemoved","ns-model-loading-complete":"insertTrash"},methods:{onInserted:function(e,t){var r=this;n.each(t,function(e){r.bindModel(e,"ufo-replaced",function(t,n){r.onReplaced(e,n)})})},onRemoved:function(e,t){var r=this;n.each(t,function(e){r.unbindModel(e,"ufo-replaced")})},preprocessData:function(e){if(e.error)return{resources:[],error:e.error};if("/yavideo"===this.params.idContext){var t=no.jpath('.[.id == "/yavideo/0/"]',e.resources);t&&(t[0].name="Все ролики");var s=no.jpath('.[.id == "/yavideo/100000001/"]',e.resources);s&&(s[0].name="Любимые ролики")}return n.each(e.resources,function(e){no.jpath.set(".state.portional",e,!0),e.id=r.normalize(e.id)}),e},_init:function(){this.super_._init.apply(this,arguments),"/shared"===this.params.idContext&&this.complete(),n.bindAll(this,"onResourceCreated","onResourceUpdated","onRemovedFromYavideo","onRootDestroyed","onRootChangedAccess","hideChildren","showChildren","destroyChildren","getParamSort","getPosition","sort"),this.bindResourceEvents(),this.root=ns.Model.get("resource",{id:this.params.idContext}),this.root.on("ufo-resources-hidden",this.hideChildren),this.root.on("ufo-resources-shown",this.showChildren),this.root.on("ufo-resources-destroyed",this.destroyChildren),this.root.on("ns-model-destroyed",this.onRootDestroyed),this.root.on("ufo-changed-access",this.onRootChangedAccess)},bindResourceEvents:function(){ns.events.on("ufo-resource-created",this.onResourceCreated),ns.events.on("ufo-resource-updated",this.onResourceUpdated),r.isParent("/yavideo",this.params.idContext)&&ns.events.on("ufo-resource-removed",this.onRemovedFromYavideo)},hideChildren:function(){this.set(".state.hiddenChildren",!0)},showChildren:function(){this.set(".state.hiddenChildren",!1)},onRootDestroyed:function(){this.destroyAll()},onRootChangedAccess:function(){this.destroyAll()},offsetFilter:function(e){return!!e.get(".state.portional")},onResourceCreated:function(e,t){var n=t.resource,r=no.jpath(".options.position.after",t),s=this.isSearchResult()&&this.contains(r);(this.isParentFor(n)||s)&&this.insert(n,this.getPosition(n))},insert:function(e,t){n.isUndefined(t)&&this.models.length?n.each(e,function(e){this.super_.insert.call(this,e,this.getPosition(e))},this):this.super_.insert.call(this,e,t)},getPosition:function(e){var t=0,r=e.get(".type"),a=n.reduce(this.models,function(e,t){return"file"===t.get(".type")?e.files.push(t):"/trash"!=t.get(".id")&&e.dirs.push(t),e},{dirs:[],files:[]}),i=this.getParamSort();return n.isUndefined(e.get(i))||(t=s.sortedIndex("file"===r?a.files:a.dirs,e,this.sort)),"file"===r&&(t+=a.dirs.length),t},getParamSort:function(){var e=this.params.sort;return"type"==e?".name":"size"==e||"append_time"==e?".meta."+e:"."+e},sort:function(e,t){var n,r=this.getParamSort();return n="type"==this.params.sort?this.sortByType(e.get(r),t.get(r)):"name"==this.params.sort?this.sortByName(e.get(r),t.get(r)):this.sortDefault(e.get(r),t.get(r)),"0"==this.params.order?-1*n:n},sortDefault:function(e,t){return e?e-t:-1},sortByName:function(e,t){if(!e)return-1;e=this.formatString(e),t=this.formatString(t);for(var n=0;n!=e.length||n!=t.length;){if(typeof e[n]!=typeof t[n])return"number"==typeof e[n]?-1:1;if(e[n]>t[n])return 1;if(e[n]<t[n])return-1;n++}return e.length>t.length?1:-1},formatString:function(e){return e=e.match(/(\d+|\D+)/g),n.map(e,function(e){return isNaN(+e)?e.toLowerCase():+e})},sortByType:function(e,t){if(!e)return-1;var r=n.map([e,t],function(e){return e=e.split("."),1==e.length?e.unshift("0"):e.unshift(n.last(e)),e.join(".")});return r[0]>r[1]?1:-1},onResourceUpdated:function(e,t){var n=t.resource;if(!this.isSearchResult())if(this.isParentFor(n))this.insert(n,this.getPosition(n));else{this.remove(n);var r=ns.Model.getValid("stateResource",{id:n.params.id,idContext:this.params.idContext});r&&r.deselect()}},onReplaced:function(e,t){var n=this.models.indexOf(e);this.remove(e),this.insert(t,n)},onRemovedFromYavideo:function(e,t){var s=t.resource,a=s.get(".id");if(r.isParent("/yavideo",a)&&r.dirname(a)!=this.params.idContext){var i=this.params.idContext+"/"+r.basename(a),s=n.find(this.models,function(e){return e.get(".id")==i?e:void 0});s&&this.remove(s)}},isParentFor:function(e){var t=r.dirname(e.get(".id")),n=t===this.params.idContext,s="/published"===this.params.idContext&&e.get(".meta.public"),a="/shared"===this.params.idContext&&e.get(".meta.group.is_root"),i=s||a,o="/narod"===this.params.idContext&&r.isParent("/narod",e.get(".id"));return n||i||o},isEmpty:function(){return n.isEmpty(this.models)},isSearchResult:function(){return!(!this.params.querySearch||!this.params.scopeSearch)},isSocial:function(){return this.params.idContext===i.get(".foldersDefault.social")},destroyAll:function(){this.destroyChildren(),ns.Model.destroy(this)},destroyChildren:function(){n.invoke(this.models.slice(),"remove")},contains:function(e){return n.contains(this.models,e)},insertTrash:function(){"/disk"===this.params.idContext&&this.insert(ns.Model.get("resource",{id:"/trash"}),this.models.length)},getSiblingsOf:function(e,t){var r=n.extend({loop:!1,take:1},t);r.negative=r.take<0,r.take=Math.abs(r.take);var s=r.negative?"reduceRight":"reduce",a=n[s](this.models,function(t,s){return s.get(".id")===e?[]:(n.isArray(t)&&t.length<r.take&&(!n.isFunction(r.filter)||r.filter(s))&&t.push(s),t)},!e&&[]);return a&&a.length<r.take&&r.loop&&(a=a.concat(this.getSiblingsOf(null,n.extend(t,{take:(r.take-a.length)*(r.negative?-1:1)})))),a||[]},isQueryCorrected:function(){return this.get(".query")!==this.get(".queryOriginal")}}})},{"helpers/array":9,"helpers/path":20,"models/model-collection-lazy":71,"models/resource/resource":133,"models/user-current/user-current":177,underscore:2}],148:[function(e){e("models/queues/queue-request"),ns.Model.define("rightsSocial",{params:{scenario:null},methods:{fetch:function(){return ns.Model.get("queueRequest").push(this)},isAuthorized:function(e){return!!this.get("."+e+".auth")},setAuthorized:function(e){return this.set("."+e+".auth",!0)}}})},{"models/queues/queue-request":120}],149:[function(){ns.Model.define("do-save-editor-photo",{params:{id:null,actionList:null,suffixTime:null,overrideUrl:null}})},{}],150:[function(e){var t=e("environment");e("models/services/services-outer"),ns.Model.define("servicesHeader"),function(){var e=t.session.tld,n=ns.Model.get("servicesOuter").getData().services,r=[];"ru"==e||"ua"==e?r=[{content:n.search.name,href:n.search.url},{content:n.mail.name,href:n.mail.url},{content:n.disk.name,href:n.disk.url,isActive:!0},{content:n.money.name,href:n.money.url},{content:n.music.name,href:n.music.url},{content:n.moikrug.name,href:n.moikrug.url},{content:n.fotki.name,href:n.fotki.url},{content:n.auto.name,href:n.auto.url,hide:!0},{content:n.afisha.name,href:n.afisha.url,hide:!0},{content:n.blogs.name,href:n.blogs.url,hide:!0},{content:n.video.name,href:n.video.url,hide:!0},{content:n.images.name,href:n.images.url,hide:!0},{content:n.maps.name,href:n.maps.url,hide:!0},{content:n.catalog.name,href:n.catalog.url,hide:!0},{content:n.market.name,href:n.market.url,hide:!0},{content:n.news.name,href:n.news.url,hide:!0},{content:n.pogoda.name,href:n.pogoda.url,hide:!0},{content:n.rabota.name,href:n.rabota.url,hide:!0},{content:n.rasp.name,href:n.rasp.url,hide:!0},{content:n.slovari.name,href:n.slovari.url,hide:!0},{content:n.tv.name,href:n.tv.url,hide:!0},{content:n.uslugi.name,href:n.uslugi.url,hide:!0},{separator:!0,hide:!0},{content:n.mobile.name,href:n.mobile.url,hide:!0},{content:n.soft.name,href:n.soft.url,hide:!0},{content:n.all.name,href:n.all.url,hide:!0}]:"com"==e?r=[{content:n.search.name,href:n.search.url},{content:n.images.name,href:n.images.url},{content:n.video.name,href:n.video.url},{content:n.mail.name,href:n.mail.url},{content:n.disk.name,href:n.disk.url,isActive:!0},{content:n.translate.name,href:n.translate.url}]:"com.tr"==e&&(r=[{content:n.search.name,href:n.search.url},{content:n.maps.name,href:n.maps.url},{content:n.news.name,href:n.news.url},{content:n.mail.name,href:n.mail.url},{content:n.disk.name,href:n.disk.url,isActive:!0},{content:n.images.name,href:n.images.url},{content:n.video.name,href:n.video.url},{content:n.translate.name,href:n.translate.url},{content:n.pogoda.name,href:n.pogoda.url,hide:!0},{content:n.probki.name,href:n.probki.url,hide:!0},{content:n.mobile.name,href:n.mobile.url,hide:!0},{separator:!0,hide:!0},{content:n.soft.name,href:n.soft.url,hide:!0},{content:n.all.name,href:n.all.url,hide:!0}]),ns.Model.get("servicesHeader").setData(r)}()},{environment:8,"models/services/services-outer":151}],151:[function(e){var t=e("environment");ns.Model.define("servicesOuter"),function(){var e=t.session.tld,n={};n.services={search:{name:"Поиск",url:"http://www.yandex."+e},mail:{name:"Почта",url:"https://mail.yandex."+e+"/neo2#inbox"},disk:{name:"Диск",url:"https://disk.yandex."+e},money:{name:"Деньги",url:"https://money.yandex.ru"},music:{name:"Музыка",url:"ua"===e?"http://music.yandex.ua":"http://music.yandex.ru"},moikrug:{name:"Мой Круг",url:"http://moikrug.ru"},fotki:{name:"Фотки",url:"http://fotki.yandex.ru"},auto:{name:"Авто",url:"http://auto.yandex.ru"},afisha:{name:"Афиша",url:"http://afisha.yandex."+("ua"===e?"ua":"ru")},blogs:{name:"Блоги",url:"http://blogs.yandex."+("ua"===e?"ua":"ru")},video:{name:"Видео",url:"com"===e?"http://www.yandex.com/video":"http://video.yandex."+e},images:{name:"Картинки",url:"com.tr"===e?"http://gorsel.yandex.com.tr/":"com"===e?"http://yandex.com/images":"http://images.yandex."+e},maps:{name:"Карты",url:"com.tr"===e?"http://harita.yandex.com.tr/":"http://maps.yandex."+e},catalog:{name:"Каталог",url:"http://yaca.yandex."+("ua"===e?"ua":"ru")},market:{name:"Маркет",url:"http://market.yandex."+("ua"===e?"ua":"ru")},news:{name:"Новости",url:"com.tr"===e?"http://haber.yandex.com.tr/":"http://news.yandex."+("ua"===e?"ua":"ru")},pogoda:{name:"Погода",url:"com.tr"===e?"http://hava.yandex.com.tr/":"http://pogoda.yandex."+("ua"===e?"ua":"ru")},rabota:{name:"Работа",url:"http://rabota.yandex."+("ua"===e?"ua":"ru")},rasp:{name:"Расписания",url:"http://rasp.yandex."+("ua"===e?"ua":"ru")},slovari:{name:"Словари",url:"http://slovari.yandex.ru"},tv:{name:"Телепрограмма",url:"http://tv.yandex."+("ua"===e?"ua":"ru")},uslugi:{name:"Услуги",url:"http://uslugi.yandex.ru"},mobile:{name:"Мобильный",url:"com.tr"===e?"http://mobil.yandex.com.tr/":"http://mobile.yandex.ru"},soft:{name:"Программы",url:"com.tr"===e?"http://soft.yandex.com.tr/":"http://soft.yandex.ru"},translate:{name:"Перевод",url:"com.tr"===e?"http://ceviri.yandex.com.tr/":"http://translate.yandex."+e},probki:{name:"Пробки",url:"http://trafik.yandex.com.tr/"},all:{name:"Все сервисы",url:"http://www.yandex."+e+"/all"}},ns.Model.get("servicesOuter").setData(n)}()},{environment:8}],152:[function(){ns.Model.define("do-settings-set",{params:{key:null,value:null}})},{}],153:[function(e,t){e("models/settings/do-settings-set");var n=e("consts").VIEWS,r={view:n[1],viewPhotostream:n[0],viewSocial:n[0],wasDialogClosed:!1,countDisplaysDialogWelcome:0,timestampLastDisplayedDialogWelcome:0,timestampLastDisplayedDialogIntro:0,timestampDisplayedDialogYavideo:0};ns.Model.define("settings",{methods:{onChangeView:function(e,t){t&&this.save({key:t.replace(/^\./,""),value:this.get(t)})},save:function(e){e.key&&e.value&&(this.set("."+e.key,e.value),ns.Model.get("queueRequest").push({id:"do-settings-set",params:e}))},preprocessData:function(t){return e("environment").agent.isMobile&&(t.view="icons"),t=no.extend(r,t)}}}),t.exports=e("models-preloaded")("settings")},{consts:7,environment:8,"models-preloaded":42,"models/settings/do-settings-set":152}],154:[function(e,t){var n=e("models/user-current/user-current");e("environment"),e("helpers/uri");var r=[{id:"linkMail",name:"Почта",href:e("config").links.mail},{id:"disk",idContext:"/disk",name:"Файлы"},{id:"camera",idContext:n.get(".foldersDefault.photostream"),name:"Фотокамера"},{id:"social import",idContext:n.get(".foldersDefault.social"),name:"Фото из соцсетей"},{id:"shared",idContext:"/shared",name:"Общие папки"},{id:"published",idContext:"/published",name:"Ссылки"},{id:"trash",idContext:"/trash",name:"Корзина",droppable:!0},{id:"downloads",idContext:n.get(".foldersDefault.downloads"),hidden:!0,name:"Загрузки",inMenu:!0},{id:"yavideo",name:"Яндекс.Видео",hidden:!0,idContext:"/yavideo",inMenu:!0},{id:"yaru",name:"Архив Я.Ру",hidden:!0,idContext:"/attach/yaruarchive",inMenu:!0},{id:"narod",name:"Народ",hidden:!0,idContext:"/narod",inMenu:!0},{id:"mail",name:"Почтовые вложения",idContext:"/mail",inMenu:!0}];ns.Model.define("getSlices"),ns.Model.define("slices",t.exports={defaults:{slice:r},methods:{fetch:function(){return this.get(".loading")||this.get(".loaded")?this._promiseSyncLast:(this.set(".loading",!0),this._promiseSyncLast=ns.Model.get("queueSync").push(ns.Model.get("getSlices")),this._promiseSyncLast.then(this._onSlicesFetched,this),this._promiseSyncLast)},getIdSliceByContext:function(e){var t;return this.get(".slice").forEach(function(n){0===e.indexOf(n.idContext)&&(!t||t.idContext.length<n.idContext.length)&&(t=n)}),t&&t.id},_onSlicesFetched:function(e){if(e.get(".downloads")){var t=this.get('.slice[.id == "downloads"]')[0];t.hidden=!1}if(e.get(".yavideo")){var n=this.get('.slice[.id == "yavideo"]')[0];n.hidden=!1}if(e.get(".yaru")){var r=this.get('.slice[.id == "yaru"]')[0];r.hidden=!1}if(e.get(".narod")){var s=this.get('.slice[.id == "narod"]')[0];s.hidden=!1}this.set(".loading",!1),this.set(".loaded",!0)}}}),ns.Model.get("slices").setDataDefault()},{config:6,environment:8,"helpers/uri":29,"models/user-current/user-current":177}],155:[function(){ns.Model.define("do-export-social",{params:{service:null,aid:null,photos:null}})},{}],156:[function(){ns.Model.define("do-import-social",{params:{service:null,type:null}})},{}],157:[function(e,t){ns.Model.define("offerSpace",t.exports={params:{id:null}})},{}],158:[function(e,t){var n=e("environment");ns.Model.define("offersSpaceFree",t.exports={split:{items:".items",model_id:"offerSpace",params:{id:".id"}},methods:{preprocessData:function(e){var t=[],r=e.service_list,s=e.user_invite_info,a=1024,i=Math.pow(a,2),o=Math.pow(a,3);s&&s.referral&&"suspicious"!==s.state&&!no.jpath('.[.name=="invited"]',r)&&t.push({id:"invited",name:"invited",size:1*o});var c=(no.jpath('.[.name=="referral"]',r)||[]).length;return 20>c&&t.push({id:"referral",name:"referral",size:512*(20-c)*i,count:c}),("ru"===n.session.tld||"ua"===n.session.tld)&&t.push({id:"partners",name:"partners",size:50*o}),{items:t}}}})},{environment:8}],159:[function(e,t){e("models/space/offer-space"),ns.Model.define("offersSpacePaid",t.exports={split:{items:".items",model_id:"offerSpace",params:{id:".id"}},methods:{preprocessData:function(e){if(!e||e.error)return{items:[],error:e.error};var t=[];return e.forEach(function(e){var n=e.id.split("_")[0];-1!=n.indexOf("gb")?e.size={GB:n.replace("gb","")}:-1!=n.indexOf("tb")&&(e.size={TB:n.replace("tb","")}),t.push(e)}),{items:e}}}})},{"models/space/offer-space":157}],160:[function(e,t){ns.Model.define("packageSpace",t.exports={params:{id:null}})},{}],161:[function(e){e("models/space/packages-space"),e("models/space/package-space");var t=e("underscore");ns.Model.define("packagesSpacePaid",{split:{items:".items",model_id:"packageSpace",params:{id:".id"}},methods:{isValid:function(){return!0},_init:function(){this.super_._init.apply(this,arguments),t.bindAll(this,"updateData"),this.modelRelated=ns.Model.get("packagesSpace");var e=this.modelRelated.getData();e?this.insert(this.filterModels()):this.modelRelated.fetch(),this.modelRelated.on("ns-model-changed",this.updateData),this.modelRelated.on("ns-model-insert",this.updateData),this.modelRelated.on("ns-model-remove",this.updateData)},updateData:function(){this.remove(this.models),this.insert(this.filterModels()),this.trigger("ufo-model-updated")},filterModels:function(){var e=[];return this.modelRelated&&this.modelRelated.models&&this.modelRelated.models.forEach(function(t){t.get(".free")||e.push(t)}),e},preprocessData:function(e){return e&&e.items?e:{items:[]}}}})},{"models/space/package-space":160,"models/space/packages-space":162,underscore:2}],162:[function(e,t){e("models/queues/queue-request"),e("models/space/package-space");var n=e("underscore");ns.Model.define("packagesSpace",t.exports={split:{items:".items",model_id:"packageSpace",params:{id:".id"}},methods:{preprocessData:function(e){var t=[],r=0;t.push({size:10737418240,free:!0,name:"disk_start",id:r++,ctime:0});var s;e.forEach(function(e){"referral"===e.name?s?s.size+=e.size:s=e:(0===e.name.indexOf("blat")||-1!==["invited","yandex_staff","music_dec_2012","yandex_shad","yandex_browser","photostream_used","yandex_ege","samsung_ultrabook","samsung_notebook","sony_notebook","sony_tablet","samsung_201309","intel_device","yandex_mobile_services","yandex_mail_birthday","ny_2014","20131201_install_fail","yandex_video","kingston_flash","media_markt_tablets","10gb_1m","10gb_1y","100gb_1m","100gb_1y","1tb_1m","1tb_1y"].indexOf(e.name))&&(e.id=r++,t.push(e))}),s&&(s.id=r++,t.push(s));var a=n.partition(t,function(e){return!e.free}),i=a.map(function(e){return e.sort(function(e,t){return t.ctime-e.ctime})});return t=n.union(i[0],i[1]),{items:t}},fetch:function(){return ns.Model.get("queueRequest").push(this)}}})},{"models/queues/queue-request":120,"models/space/package-space":160,underscore:2}],163:[function(e,t){e("models/queues/queue-sync"),ns.Model.define("space",t.exports={methods:{fetch:function(){return ns.Model.get("queueSync").push(this)}}}),e("models-preloaded")("space")},{"models-preloaded":42,"models/queues/queue-sync":121}],164:[function(e,t){ns.Model.define("statePackageSpace",t.exports={defaults:{},params:{id:null}})},{}],165:[function(e){function t(e){var t=ns.Model.getValid("resource",{id:e});return t&&t.get(".hasPreview")&&"video"!==t.get(".meta.mediatype")}var n=e("underscore"),r=$(window);ns.Model.define("stateCached",{params:{id:null},defaults:function(){return{cached:!t(this.params.id),error:!1,loading:!1}},methods:{invalidate:function(){this.set(".loading",!1),this.set(".cached",!1),this.set(".error",!1)}}});var s=0;r.on("resize",n.debounce(function(){var e=r.width()*r.height();s>e||(s=e,ns.Model.invalidate("stateCached",function(e){return t(e.params.id)}))},200))},{underscore:2}],166:[function(e){function t(e,t,n){return t.checked&&(t.checkedAlbumNew?e.push({service:n,titleAlbum:t.titleAlbumNew,privacyAlbum:t.privacyAlbumNew}):e.push({service:n,titleAlbum:t.titleAlbum,privacyAlbum:t.privacyAlbum})),e}var n=e("underscore"),r=e("consts");ns.Model.define("stateExportSocial",{defaults:function(){var e={};return n.each(r.TYPE_FOLDER_SOCIAL,function(t){e[t]={checked:!1,checkedAlbumNew:!1}}),e.titleNewAlbumDefault="",e.idsResources=[],e},methods:{check:function(e){this.set("."+e+".checked",!0)},uncheck:function(e){if(this.set("."+e+".checked",!1),this.get(".serviceSelected")===e){var t=this.getAlbumsChecked()[0];t?this.set(".serviceSelected",t.service):this.set(".serviceSelected",null)}},isChecked:function(e){return!!this.get("."+e+".checked")},hasChecked:function(){return!!this.get(".*[ .checked ]")},getTitleAlbum:function(e){return this.get("."+e+".titleAlbum")},setTitleAlbum:function(e,t){this.getTitleAlbum(e)!==t&&this.set("."+e+".titleAlbum",t)},getPrivacyAlbum:function(e){return this.get("."+e+".privacyAlbum")},setPrivacyAlbum:function(e,t){this.getPrivacyAlbum(e)!==t&&this.set("."+e+".privacyAlbum",t)},getTitleAlbumNew:function(e){return this.get("."+e+".titleAlbumNew")},setTitleAlbumNew:function(e,t){this.getTitleAlbumNew(e)!==t&&this.set("."+e+".titleAlbumNew",t)},getPrivacyAlbumNew:function(e){return this.get("."+e+".privacyAlbumNew")},setPrivacyAlbumNew:function(e,t){this.getPrivacyAlbumNew(e)!==t&&this.set("."+e+".privacyAlbumNew",t)},isCheckedAlbumNew:function(e){return this.get("."+e+".checkedAlbumNew")},checkAlbumNew:function(e){this.isCheckedAlbumNew(e)||this.set("."+e+".checkedAlbumNew",!0)},uncheckAlbumNew:function(e){this.isCheckedAlbumNew(e)&&this.set("."+e+".checkedAlbumNew",!1)
},getAlbumsChecked:function(){return n.reduce(this.getData(),t,[])},getServiceChecked:function(){return n.reduce(this.getData(),function(e,t,n){return t.checked&&(e+=n),e},"")}}}),ns.Model.get("stateExportSocial").setDataDefault()},{consts:7,underscore:2}],167:[function(e,t){ns.Model.define("do-fetch-videostream-url",t.exports={params:{start:0,kbps:320,target:null,stid:null,host:null}})},{}],168:[function(e){e("models/state-player-video/do-fetch-videostream-url");var t=e("underscore");ns.Model.define("statePlayerVideo",{params:{stid:null,host:null},defaults:{start:0,rotate:0,stopped:!1,url:null},methods:{fetchUrl:function(e,n){var r=this;return t.isNumber(e)&&r.set(".start",e),ns.Model.get("queueRequest").push({id:"do-fetch-videostream-url",params:{start:e,kbps:n,target:Modernizr.videostream,stid:r.params.stid,host:r.params.host}}).then(function(e){r.set(".url",e.get(".url"))})}}})},{"models/state-player-video/do-fetch-videostream-url":167,underscore:2}],169:[function(e){var t=e("underscore");ns.Model.define("stateResource",{params:{idContext:null,id:null},defaults:{selected:!1,transfered:!1,dragging:!1},methods:{_init:function(){ns.Model.prototype._init.apply(this,arguments),t.bindAll(this,"onChange"),this.statesContext=ns.Model.get("statesContext",{idContext:this.params.idContext}),this.statesContext.on("ns-model-changed",this.onChange),this.resource=ns.Model.get("resource",{id:this.params.id}),this.resource.on("ns-model-changed.state.hidden",function(){this.resource.get(".state.hidden")&&this.reset()}.bind(this)),this.resource.on("ns-model-destroyed",function(){this.reset()}.bind(this)),this.syncSelected()},onChange:function(e,t){".selected"===t&&this.syncSelected(),".dragging"===t&&this.onChangeDragging()},syncSelected:function(){var e=this.statesContext.get(".selected")||[],t=-1!==e.indexOf(this.params.id);this.get(".selected")!==t&&(this.set(".selected",t),t||this.resetTransfered())},onChangeDragging:function(){var e=this.statesContext.get(".dragging")||[],t=-1!==e.indexOf(this.params.id);this.get(".dragging")!=t&&this.set(".dragging",t)},selectSingle:function(){this.statesContext.selectSingle(this.params.id)},selectRange:function(){this.statesContext.selectRange(this.params.id)},toggleSelected:function(){this.statesContext.toggleSelected(this.params.id)},reset:function(){this.deselect(),this.resetDragging()},deselect:function(){this.statesContext.deselect(this.params.id),this.resetTransfered()},dragging:function(){this.statesContext.dragging(this.params.id)},resetDragging:function(){this.statesContext.resetDragging(this.params.id)},setTransfered:function(){this.set(".transfered",!0)},resetTransfered:function(){this.get(".transfered")&&this.set(".transfered",!1)}}})},{underscore:2}],170:[function(){ns.Model.define("stateSlider",{defaults:{viewport:{width:0,height:0}}}),ns.Model.get("stateSlider").setDataDefault()},{}],171:[function(e){function t(e){return n.isArray(e)||(e=[e]),e}e("models/invites/invites-folder"),e("models/resources/resources"),e("models/settings/settings"),e("models/resource/resource");var n=e("underscore"),r=e("helpers/array"),s=e("helpers/path"),a=e("helpers/resource"),i=e("models/user-current/user-current").get(".foldersDefault"),o=ns.Model.get("settings");ns.Model.define("statesContext",{params:{idContext:null},defaults:function(){var e={sort:"name",order:"1",groupBy:"none",display:"normal",view:this.getView(),selected:[],dragging:[],wasAsideAnimated:!1};return(a.isCamera(this.params.idContext)||a.isInsideFolderCamera(this.params.idContext))&&(e.sort="etime",e.order="0",e.display="photostream",e.groupBy="month"),(a.isInsideFolderSocial(this.params.idContext)||this.isInstagram)&&(e.sort="etime",e.order="0",e.display="photostream"),"/trash"==this.params.idContext&&(e.sort="append_time",e.order="0"),(n.contains(["/mail","/attach","/yavideo",i.downloads,i.screenshots,"/attach/yaruarchive"],this.params.idContext)||s.isParent("/yavideo",this.params.idContext))&&(e.sort="mtime",e.order="0"),e},methods:{_init:function(){var e=this;e.super_._init.apply(e,arguments);var t=ns.Model.get("resource",{id:e.params.idContext});t.on("ns-model-destroyed",function(){e.reset()}),o.on("ns-model-changed",function(){e.set(".view",e.getView())}),this.isInstagram=this.params.idContext===i.social+"/Instagram"},deselectAll:function(){this.set(".selected",[])},setAnchor:function(e){this.lastAnchor=this.anchor,this.anchor=e},select:function(e){e=t(e),this.set(".selected",n.uniq(e))},addToSelection:function(e){e=t(e);var n=this.get(".selected")||[];e=n.concat(e),this.select(e)},deselect:function(e){e=t(e),this.select(n.difference(this.get(".selected"),e))},dragging:function(e){e=t(e),this.set(".dragging",n.uniq(e))},resetDragging:function(e){e=t(e),this.dragging(n.difference(this.get(".dragging"),e))},resetDraggingAll:function(){this.dragging([])},reset:function(){this.setDataDefault()},selectSingle:function(e){var t=this.get(".selected")||[];(1!=t.length||-1===t.indexOf(e))&&(this.setAnchor(e),this.select(e))},selectRange:function(e){"single"===this.getModeSelection()&&this.deselectAll();var t=this.get(".selected")||[],s=this.getSelectable();this.anchor||this.setAnchor(s[0]);var a=r.getRange(s,this.anchor,e);a&&(a=n.difference(a,this.getSelectableSingle()),r.hasGap(s,t)?this.addToSelection(a):this.select(a))},toggleSelected:function(e){var t=this.get(".selected")||[];-1!==t.indexOf(e)?(this.anchor===e&&this.setAnchor(this.lastAnchor),this.deselect(e)):(t.length&&("single"===this.getModeSelection()&&this.deselectAll(),-1!==this.getSelectableSingle().indexOf(e)&&this.deselect(t)),this.setAnchor(e),this.addToSelection(e))},getSelectable:function(){var e=[];if("/disk"===this.params.idContext||"/shared"===this.params.idContext){var t=ns.Model.getValid("invitesFolder").getData();e=e.concat(no.jpath(".invites.id",t)||[])}var r=ns.Model.getValid("resources",n.extend({},this.params,this.getData())).getData();return e=e.concat(no.jpath(".resources[ !.state.hidden && !.state.part && !.state.blocked ].id",r)||[])},getSelectableSingle:function(){var e=[];if("/disk"===this.params.idContext||"/shared"===this.params.idContext){var t=ns.Model.getValid("invitesFolder").getData();e=e.concat(no.jpath(".invites.id",t)||[])}var r=ns.Model.getValid("resources",n.extend({},this.params,this.getData()));return r=r?r.getData():[],e=e.concat(no.jpath(".resources[ .isSlice || .state.part || .state.blocked ].id",r)||[])},getModeSelection:function(){var e=this.get(".selected"),t=this.getSelectableSingle();if(e&&1===e.length){if(-1!==t.indexOf(e[0]))return"single"}else if(e&&e.length>1)return"multi";return"default"},setView:function(e){a.isCamera(this.params.idContext)||a.isInsideFolderCamera(this.params.idContext)?o.save({key:"viewPhotostream",value:e}):a.isInsideFolderSocial(this.params.idContext)||this.isInstagram?o.save({key:"viewSocial",value:e}):o.save({key:"view",value:e})},getView:function(){return s.isParent("/search",this.params.idContext)?"list":a.isCamera(this.params.idContext)||a.isInsideFolderCamera(this.params.idContext)?o.get(".viewPhotostream"):a.isInsideFolderSocial(this.params.idContext)||this.isInstagram?o.get(".viewSocial"):o.get(".view")}}})},{"helpers/array":9,"helpers/path":20,"helpers/resource":22,"models/invites/invites-folder":68,"models/resource/resource":133,"models/resources/resources":147,"models/settings/settings":153,"models/user-current/user-current":177,underscore:2}],172:[function(){ns.Model.define("do-sign-xiva",{params:{req:null}})},{}],173:[function(e,t){var n=e("config"),r=e("libs/transport"),s=e("helpers/xiva");e("models/subscription-xiva/do-sign-xiva"),e("models/operation/operation-remote-resource"),e("models/operation/operation-remote-share");var a=2,i=60,o=10;ns.Model.define("subscriptionXiva",t.exports={methods:{_init:function(){this.super_._init.apply(this,arguments),this.attemptsSubscribe=0,this.timeoutResignShort=a,this.timeoutResignLong=i,this.countAttemptsShort=o},preprocessData:function(e){return"object"!=typeof e?{}:e.uid&&e.sign&&e.expires&&e.created?e:{}},setData:function(){if(this.super_.setData.apply(this,arguments),!this.get(".sign"))return this.invalidate(),void 0;this.attemptsSubscribe=0;var e=Math.floor(this.get(".expires")-this.get(".created"));this.transport&&this.transport.destroy(),this.transport=new r(this._createUrl()),this.transport.on("message",this.onMessage.bind(this)),this._sheduleResign(.9*e)},onMessage:function(e,t){if(t.connection_id!==n.idClient){try{t=JSON.parse(t.data)}catch(e){return}s.handleMessage(t)}},_reset:function(){this.super_._reset.apply(this,arguments),window.clearTimeout(this.timeoutResign),delete this.timeoutResign,this._promiseSign&&(this._promiseSign.reject(),delete this._promiseSign)},_sheduleResign:function(e){var e=e||this._getTimeoutResign();this.attemptsSubscribe+=1,window.clearTimeout(this.timeoutResign),this.timeoutResign=window.setTimeout(function(){this.sign()}.bind(this),1e3*e)},_getTimeoutResign:function(){return this.attemptsSubscribe>=this.countAttemptsShort?this.timeoutResignLong:this.timeoutResignShort},sign:function(){var e=this;return this._reset(),this._promiseSign=ns.Model.get("queueRequest").pushPriority({id:"do-sign-xiva",params:{req:$.cookie("yandexuid")}}),this._promiseSign.then(function(t){e.setData(t.getData()),e.isValid()||e._sheduleResign()},function(t,n,r){r&&e._sheduleResign()}),this._promiseSign},reset:function(){this._reset(),this.transport.destroy(),this.attemptsSubscribe=0},_createUrl:function(){var e=$.url("");return e.host(n.xiva.host).path("/").addParam("uid",this.get(".uid")).addParam("sign",this.get(".sign")).addParam("ts",this.get(".expires")).addParam("timestamp",this.get(".created")).addParam("service","disk-json").addParam("client_id","ufo"),e}}})},{config:6,"helpers/xiva":30,"libs/transport":40,"models/operation/operation-remote-resource":96,"models/operation/operation-remote-share":97,"models/subscription-xiva/do-sign-xiva":172}],174:[function(){ns.Model.define("do-clean-trash")},{}],175:[function(){ns.Model.define("stateTree",{methods:{select:function(e){this.set(".selected",e)},deselect:function(){this.select(null)}}}),ns.Model.get("stateTree").setDataDefault()},{}],176:[function(e){function t(e){var t=ns.Model.get("tree",e.params);return t.setData($.extend(!0,{resource:[]},e.getData())),t.bindResource(),t}function n(e,n){var r=ns.Model.getValid("tree",{id:i.dirname(n.resource.get(".id"))});r&&r.isLoaded()&&(r.insert(t(n.resource),0),r.set(".hasfolders",!0))}function r(e,t,n){return"dir"===n.resource.get(".type")?e(t,n):void 0}e("models/resource/resource");var s=e("underscore"),a=e("helpers/resource"),i=e("helpers/path");ns.events.on("ufo-resource-created",s.wrap(n,r)),ns.Model.define("tree",{params:{id:null},split:{model_id:"tree",items:".resource",params:{id:".id"}},methods:{_init:function(){this.super_._init.apply(this,arguments),s.bindAll(this,"chainDestroy","onResourceChanged"),this.resource=ns.Model.get("resource",this.params),this.bindResource(),this.destroyWith(this.resource),this.off("ns-model-destroyed"),this.on("ns-model-destroyed",function(e,t){!t||!t.model||t.data&&t.data.model||this.remove(t.model)})},bindResource:function(){this.resource.on("ns-model-destroyed",this.chainDestroy),this.resource.on("ns-model-changed",this.onResourceChanged)},unbindResource:function(){this.resource.off("ns-model-destroyed",this.chainDestroy),this.resource.off("ns-model-changed",this.onResourceChanged)},preprocessData:function(e){if(!e||e.error||e.code)return e=this.getData()||{resource:[]},e.state={loaded:!0},e;e.resource||(e.resource=[]),s.each(e.resource.concat([e]),a.preprocess);var t=this.resource&&this.resource.get(".state")||{};return e.state=s.extend({loading:!1,loaded:!(e.hasfolders&&s.isEmpty(e.resource)),expanded:!!this.get(".state.expanded")},t),e},expand:function(){this.get(".hasfolders")&&!this.get(".state.loading")&&(this.isLoaded()?this.set(".state.expanded",!0):(this.fetch().then(this.expand.bind(this)),this.set(".state.loading",!0)))},collapse:function(){this.get(".state.expanded")&&this.set(".state.expanded",!1),s.defer(s.invoke.bind(s),this.models,"collapse")},toggle:function(){this.get(".state.expanded")?this.collapse():this.expand()},chainDestroy:function(){s.invoke(this.models.slice(),"chainDestroy"),ns.Model.destroy(this);var e=ns.Model.getValid("tree",{id:i.dirname(this.params.id)});e&&e.isLoaded()&&e.set(".hasfolders",!s.isEmpty(e.models)),this.unbindResource()},onResourceChanged:function(){var e=this.getData(),t=this.resource.getData(),n=e.hasfolders,r=s.pick(e.state,"loading","loaded","expanded");s.extend(e,t),s.extend(r,t.state),e.hasfolders=n,e.state=r,this.setData(e)},fetch:function(){return ns.Model.get("queueRequest").push(this).then(function(){this.set(".state.loaded",!0)}.bind(this))},isLoaded:function(){return!!this.get(".state.loaded")}}})},{"helpers/path":20,"helpers/resource":22,"models/resource/resource":133,underscore:2}],177:[function(e,t){function n(e){return r.last(e.split("@"))}var r=e("underscore"),s=e("helpers/path"),a=e("helpers/email");ns.Model.define("userCurrent",{methods:{preprocessData:function(e){e.foldersDefault&&!e.foldersDefault.error&&r.map(e.foldersDefault,function(e,t,n){n[t]=s.normalize(e)});var t=r.filter(["ru","en","uk","tr"],function(t){return t===e.locale}).length;return t||(e.locale="ru"),e},getDomainsYandex:function(){return this.domainsYandex?this.domainsYandex:(this.domainsYandex=r.map(this.get(".emails"),n),this.domainsYandex)},isEmailAlias:function(e){var t=this.emailNormalize||this.getEmailNormalized();return a.normalize(e)===t},getEmailNormalized:function(){return this.emailNormalize||(this.emailNormalize=this.get(".login")+"@"+"yandex.ru"),this.emailNormalize}}});var i=e("models-preloaded")("userCurrent")||ns.Model.get("userCurrent");t.exports=i},{"helpers/email":13,"helpers/path":20,"models-preloaded":42,underscore:2}],178:[function(e,t){e("helpers/email"),ns.Model.define("userFolder",t.exports={params:{userid:null,idFolder:null},methods:{isApproved:function(){return"approved"===this.get(".status")},isProposed:function(){return"proposed"===this.get(".status")},toContact:function(){var e=ns.Model.get("contact",{userid:this.get(".id")}),t=this.getData();return delete t.rights,delete t.idFolder,e.setData(t),e}}})},{"helpers/email":13}],179:[function(e,t){e("models/resource/resource"),e("models/users/user-folder");var n=e("underscore"),r=e("helpers/email");ns.Model.define("usersFolder",t.exports={split:{items:".users",model_id:"userFolder",params:{userid:".id",idFolder:".idFolder"}},params:{gidFolder:null,idFolder:null},defaults:function(){return this.params.gidFolder?void 0:{users:[],index:[]}},methods:{_init:function(){ns.ModelCollection.prototype._init.apply(this,arguments),n.bindAll(this,"destroyAll");var e=ns.Model.get("resource",{id:this.params.idFolder}),t=this;e.on("ns-model-destroyed",this.destroyAll),e.get(".meta.group.gid")&&e.on("ns-model-changed",function(){e.get(".meta.group.gid")||t.destroyAll()})},fetch:function(){return ns.Model.get("queueRequest").push(this)},destroyAll:function(){n.each(this.models.slice(),ns.Model.destroy),ns.Model.destroy(this)},preprocessData:function(e){var t=[],s=[],a=[],i=[];n.each(e.users,function(e){e.idFolder=this.params.idFolder,e.service||(e.service="email"),e.id=r.normalize(e.userid),"proposed"===e.status?(t.push(e),a.push(e.id)):"approved"===e.status&&(s.push(e),i.push(e.id))},this);var e={users:[].concat(t,s),index:[].concat(a,i)};return e},getByEmail:function(e){var t=r.normalize(e);return n.find(this.models,function(e){return e.get(".id")===t})},removeItem:function(e){this.remove(ns.Model.get("userFolder",{idFolder:this.params.idFolder,userid:e})),this.set(".index",n.without(this.get(".index"),e),{silent:!0})},insertItem:function(e){var t=0;this.insert(e,t);var n=this.get(".index");n.splice(t,0,e.get(".id")),this.set(".index",n,{silent:!0}),this.trigger("ufo-model-insert",e)}}})},{"helpers/email":13,"models/resource/resource":133,"models/users/user-folder":178,underscore:2}],180:[function(e,t){function n(e){if(e){if(e.noFallback)return!0;var t=r(e.formats),n=(t.flv||t.mp4)&&o.hasFlashPlayerVersion("10.2.0"),s=i.some(t,a);return n||s}return!1}function r(e){for(var t={},n=0;n<e.length;n++){var r=e[n].match(/\w+/)[0];t[r]="mpeg4"==r?"video/mp4":"video/"+r}return t}function s(e){return i.reduce(e,function(e,t){return t.width>e.width||t.height>e.height?t:e},{width:0,height:0})}function a(e){try{var t=document.createElement("video");return!!t.canPlayType(e)}catch(n){return!1}}var i=e("underscore"),o=e("swfobject");ns.Model.define("videoInfo",t.exports={params:{id:null},methods:{preprocessData:function(e){return e.dimension=s(e.dimensions),e.duration=Math.floor(e.duration/1e3),e.canUseYandexVideo=n(e.yandexVideo),e}}})},{swfobject:190,underscore:2}],181:[function(e){var t=e("zeroclipboard"),n=e("swfobject"),r=e("config").links.static.host,s=e("underscore"),a={moviePath:r+"/disk/www/_/CeTtulIj3g0peuK81ZoRUtT0Iqk.swf",trustedOrigins:location.protocol+"//"+location.host,allowScriptAccess:"always",debug:!1},i="Копировать ссылку",o="Ссылка скопирована",c="Не удалось скопировать",l=2e3;nb.define("button-copy",{events:{init:"_oninit"},_oninit:function(){this.$node=$(this.node),this.$text=this.$node.find(".js-button-copy-text"),this.$title=this.$node.find(".js-button-copy-title"),s.bindAll(this,"_onCopySuccess","_onCopyFailed"),n.hasFlashPlayerVersion("10.0.0")?(this._zc=new t(this.$node,a),this.trigger("nb-inited")):(this.$node.addClass("nb-is-hidden"),this.isInitFailed=!0),this._readyToChange=!0},_onCopySuccess:function(){this._changeTextTemporally(o),this.trigger("nb-copied")},_onCopyFailed:function(){this._changeTextTemporally(c),this.trigger("nb-error")},_changeTextTemporally:function(e){this._readyToChange&&(this._readyToChange=!1,this.$title.text(e),setTimeout(function(){this._readyToChange=!0,this.$title.text(i)}.bind(this),l))},destroy:function(){this.nbdestroy(),this.trigger("nb-destroyed")},setText:function(e){return this.$text.val(e),this.trigger("nb-changed"),this},enable:function(){this._zc.on("complete",this._onCopySuccess),this._zc.on("error",this._onCopyFailed)},disable:function(){this._zc.off("complete",this._onCopySuccess),this._zc.off("error",this._onCopyFailed)}})},{config:6,swfobject:190,underscore:2,zeroclipboard:3}],182:[function(e){var t=e("underscore"),n=$(window),r=125,s={},a=function(e){return e&&e.parentNode?e.contains?!document.body.contains(e):null==document.getElementById(e.id):!0},i=t.throttle(function(){var e=n.height();t.each(s,function(t,n){var i;a(t.node)||t.loaded?delete s[n]:(i=t.node.getBoundingClientRect(),i.bottom>=r&&i.top<e&&t.load())})},100);n.on("scroll resize",i),nb.define("icon-resource",{events:{init:"onInit"},onInit:function(){this.$node=$(this.node),this.$preview=this.$node.find(".js-icon-preview"),this.load=t.once(this.load),0!==this.$preview.length&&(s[this.id]=this,i())},load:function(){var e=this.$preview[0];this.$preview.attr("src",this.$preview.data("src")),e.complete&&0!==e.naturalWidth?this.onPreviewLoaded():this.$preview.one("load",this.onPreviewLoaded.bind(this))},onPreviewLoaded:function(){this.loaded=!0,this.$node.addClass("nb-icon-resource_loaded-preview")}})},{underscore:2}],183:[function(e){var t=e("underscore"),n=$(document);e("nanoblocks/button-copy/button-copy"),nb.define("popup-share",{events:{init:"_oninit"},_oninit:function(){t.bindAll(this,"_autoclosePopupCopy","_onCopied","_onOpened","_onClosed","_close"),this.$node=$(this.node),this.toggler=nb.block(this.node.querySelector(".js-toggler")),this.popup=this.toggler.getPopup(),this.toggler.on("nb-opened",this._onOpened),this.toggler.on("nb-closed",this._onClosed);var e=this.node.querySelector('[data-nb="button-copy"]');e&&(this.buttonCopy=nb.block(e),this.buttonCopy.on("nb-copied",this._onCopied),this._configureButtonCopy());var r=this.node.querySelector(".js-button-qr");r&&(this.togglerQr=nb.block(r),this._configurePopupQr()),n.on("click",this._autoclosePopupCopy),nb.on("popup-close",this._close)},_autoclosePopupCopy:function(e){var t=e.target.tagName.toLowerCase();2!==e.which&&3!==e.which&&($.contains(this.popup.node,e.target)||this.toggler.node!==e.target&&"embed"!==t&&"object"!==t&&this._close())},_configurePopupQr:function(){var e=this;this.togglerQr.setOptions(t.extend({},this.togglerQr.options,{where:this.toggler.node,withoutTail:!0}));var n=function(){e.toggler.off("nb-opened",n),e.toggler.close()};this.togglerQr.on("nb-opened",n)},_configureButtonCopy:function(){this.buttonCopy.isInitFailed&&(this.$node.hasClass("popup-share_no-items")&&this.toggler.$node.addClass("_nb-is-hidden"),this.buttonCopy.destroy(),delete this.buttonCopy)},_onOpened:function(){this.buttonCopy&&this.buttonCopy.enable(),this.trigger("nb-opened",this)},_onClosed:function(){this.buttonCopy&&this.buttonCopy.disable(),this.trigger("nb-closed",this)},_onCopied:function(){this.trigger("nb-copied",this)},_close:function(){this.toggler.close()},destroy:function(){this.nbdestroy(),this.popup.off("nb-opened",this._onOpened),this.popup.off("nb-closed",this._onClosed),this.buttonCopy&&this.buttonCopy.off("nb-copied",this._onCopied),nb.off("popup-close",this._close),this.toggler.destroy(),delete this.toggler,delete this.popup,delete this.buttonCopy,n.off("click",this._autoclosePopupCopy)}})},{"nanoblocks/button-copy/button-copy":181,underscore:2}],184:[function(){nb.define("preview-expirable",{events:{init:"init"},init:function(){this.$node=$(this.node),this.$node.one("error",this.fail.bind(this))},fail:function(e){var t=e.currentTarget;nb.trigger("preview-expired",{id:decodeURIComponent(this.$node.data("nb-id")),src:t&&t.src,block:this,event:e})},setSource:function(e){this.node.src=e}})},{}],185:[function(){nb.define("resource",{events:{init:"onInit"},onInit:function(){this.$node=$(this.node);var e=this.node.querySelectorAll(".nb-checkbox");e.length&&(this.nbCheckboxes=[].slice.call(e).map(function(e){return nb.block(e)}))},select:function(){return this.$node.addClass("nb-resource_selected"),this.nbCheckboxes&&this.nbCheckboxes.length&&this.nbCheckboxes.forEach(function(e){e.check()}),this.trigger("nb-resource_selected"),this.trigger("nb-resource_changed"),this},deselect:function(){return this.$node.removeClass("nb-resource_selected"),this.nbCheckboxes&&this.nbCheckboxes.length&&this.nbCheckboxes.forEach(function(e){e.uncheck()}),this.trigger("nb-resource_deselected"),this.trigger("nb-resource_changed"),this},isSelected:function(){return this.$node.hasClass("nb-resource_selected")},toggleSelected:function(){return this.isSelected()?this.deselect():this.select()}})},{}],186:[function(e){var t=e("underscore");nb.define("select-radio",{events:{init:"init",click:"open"},init:function(){this.$node=$(this.node),this.params=this.$node.data("nb-select-radio"),this.popup=nb.find(this.params.id),this.$title=$(this.node).find(".nb-button__text"),t.bindAll(this,"onchange","bindPopupEvents","unbindPopupEvents"),this.popup.on("nb-opened",this.bindPopupEvents),this.popup.on("nb-closed",this.unbindPopupEvents),this.radios=[]},open:function(){return this.popup?(this.popup.open({where:this.params.where||this.node,how:this.params.how}),void 0):this},close:function(){return this.popup?(this.popup.close(),void 0):this},bindPopupEvents:function(){var e=this.popup.$node.find('[data-nb="checkbox"]');e.each(function(e,t){var n=nb.block(t);n.on("nb-checked",this.onchange),this.radios.push(n)}.bind(this))},unbindPopupEvents:function(){this.radios.forEach(function(e){e.off("nb-checked",this.onchange)}),this.radios=[]},onchange:function(e,t){var n={label:t.getLabel(),name:t.getName(),value:t.getValue()};this.$title.text(n.label),this.trigger("nb-changed",n)}})},{underscore:2}],187:[function(e){var t=e("underscore");nb.define("share",{events:{init:"onInit"},onInit:function(){t.bindAll(this,"disable","enable"),this.$node=$(this.node)},disable:function(){return this.$node.addClass("b-share_disabled"),this},enable:function(){return this.$node.removeClass("b-share_disabled"),this}})},{underscore:2}],188:[function(e){!function(){var t="callback_disk_uploader_flash",n="10.0.0",r=e("underscore"),s=e("swfobject"),a=e("config");e("models/operation/operation-upload-flash");var i=e("helpers/operation"),o=e("helpers/page"),c={jsCallback:t},l={allowscriptaccess:"always",allowfullscreen:"true",wmode:"transparent"};nb.define("uploader-flash",{events:{init:"init",destroy:"destroy"},init:function(){this.nodeFlash=this.node.querySelector(".nb-uploader-flash__object"),this.initUploader().then(function(){this.nodeFlash=document.getElementById(this.nodeFlash.id)}.bind(this),function(){this.destroy()}.bind(this)),this.initGlobalFlashEvents()},destroy:function(){s.removeSWF(this.flashId),window[t]=no.nop},initUploader:function(){var e=new Vow.Promise;return s.embedSWF(a.links.static.host+"/disk/www/_/Nvkvup7pqxBLuGC1HIHT0ALLkDc.swf"+"?"+(new Date).getTime(),this.nodeFlash.id,"100%","100%",n,null,c,l,{},function(t){return t.success?e.fulfill():e.reject()}),e},initGlobalFlashEvents:function(){var e=this;this.promise=new Vow.Promise,window[t]=function(t,n){if("onFilesSelected"===t){var s=r.map(n,function(t){return i.create("uploadFlash",{file:t,idFolderDst:ns.page.current.params.idContext,uploader:e})});ns.Model.get("operationsUpload").insert(s),o.go(o.getUrlBase()+"|upload")}"onUploadComplete"===t&&e.promise.fulfill(),"onUploadError"===t&&e.promise.reject()}},notify:function(){this.nodeFlash.notify.apply(this.nodeFlash,[].slice.call(arguments))}})}()},{config:6,"helpers/operation":18,"helpers/page":19,"models/operation/operation-upload-flash":102,swfobject:190,underscore:2}],189:[function(e){var t=e("underscore");nb.define("video",{events:{init:"init"},init:function(){this.$node=$(this.node),this.video=this.node.querySelector(".js-video"),this.$video=$(this.video),this.moments=this.$node.data("nb-moments"),this.currentMomentValue=0,this.currentMomentNum=0,t.bindAll(this,"finish","_onTimeUpdate","setReady"),this.$video.on("ended",this.finish),this.$video.on("loadeddata",this.setReady),this.moments&&this.$video.on("timeupdate",this._onTimeUpdate),this.trigger("nb-inited",this)},destroy:function(){this.$video.off("ended",this.finish),this.$video.off("loadeddata",this.setReady),this.$video.off("timeupdate",this._onTimeUpdate),this.trigger("nb-destroyed",this),this.nbdestroy()},start:function(){return this.video.paused&&this._isReady?(this.video.play(),this.trigger("nb-video:start",this),this):this},finish:function(){return this.video.pause(),this.video.currentTime=0,this.currentMomentNum=0,this.currentMomentValue=0,this.trigger("nb-video:finish",this),this},isReady:function(){return this._isReady},setReady:function(){this._isReady=!0,this.trigger("nb-video:ready",this)},_onTimeUpdate:function(){this.currentMomentNum===this.moments.length||this.video.paused||(this.currentMomentValue=this.moments[this.currentMomentNum],Math.abs(this.video.currentTime-this.currentMomentValue)<=1&&(this.currentMomentNum++,this.trigger("nb-video:passed",{n:this.currentMomentNum,second:this.currentMomentValue})))}})},{underscore:2}],190:[function(e,t){var n=function(){function e(){if(!B){try{var e=E.getElementsByTagName("body")[0].appendChild(g("span"));e.parentNode.removeChild(e)}catch(t){return}B=!0;for(var n=V.length,r=0;n>r;r++)V[r]()}}function t(e){B?e():V[V.length]=e}function r(e){if(typeof q.addEventListener!=M)q.addEventListener("load",e,!1);else if(typeof E.addEventListener!=M)E.addEventListener("load",e,!1);else if(typeof q.attachEvent!=M)y(q,"onload",e);else if("function"==typeof q.onload){var t=q.onload;q.onload=function(){t(),e()}}else q.onload=e}function s(){$?a():i()}function a(){var e=E.getElementsByTagName("body")[0],t=g(F);t.setAttribute("type",R);var n=e.appendChild(t);if(n){var r=0;!function(){if(typeof n.GetVariable!=M){var s=n.GetVariable("$version");s&&(s=s.split(" ")[1].split(","),H.pv=[parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)])}else if(10>r)return r++,setTimeout(arguments.callee,10),void 0;e.removeChild(t),n=null,i()}()}else i()}function i(){var e=N.length;if(e>0)for(var t=0;e>t;t++){var n=N[t].id,r=N[t].callbackFn,s={success:!1,id:n};if(H.pv[0]>0){var a=v(n);if(a)if(!b(N[t].swfVersion)||H.wk&&H.wk<312)if(N[t].expressInstall&&c()){var i={};i.data=N[t].expressInstall,i.width=a.getAttribute("width")||"0",i.height=a.getAttribute("height")||"0",a.getAttribute("class")&&(i.styleclass=a.getAttribute("class")),a.getAttribute("align")&&(i.align=a.getAttribute("align"));for(var u={},p=a.getElementsByTagName("param"),f=p.length,h=0;f>h;h++)"movie"!=p[h].getAttribute("name").toLowerCase()&&(u[p[h].getAttribute("name")]=p[h].getAttribute("value"));l(i,u,n,r)}else d(a),r&&r(s);else k(n,!0),r&&(s.success=!0,s.ref=o(n),r(s))}else if(k(n,!0),r){var m=o(n);m&&typeof m.SetVariable!=M&&(s.success=!0,s.ref=m),r(s)}}}function o(e){var t=null,n=v(e);if(n&&"OBJECT"==n.nodeName)if(typeof n.SetVariable!=M)t=n;else{var r=n.getElementsByTagName(F)[0];r&&(t=r)}return t}function c(){return!W&&b("6.0.65")&&(H.win||H.mac)&&!(H.wk&&H.wk<312)}function l(e,t,n,r){W=!0,S=r||null,A={success:!1,id:n};var s=v(n);if(s){"OBJECT"==s.nodeName?(x=u(s),j=null):(x=s,j=n),e.id=z,(typeof e.width==M||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==M||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),E.title=E.title.slice(0,47)+" - Flash Player Installation";var a=H.ie&&H.win?"ActiveX":"PlugIn",i="MMredirectURL="+q.location.toString().replace(/&/g,"%26")+"&MMplayerType="+a+"&MMdoctitle="+E.title;if(typeof t.flashvars!=M?t.flashvars+="&"+i:t.flashvars=i,H.ie&&H.win&&4!=s.readyState){var o=g("div");n+="SWFObjectNew",o.setAttribute("id",n),s.parentNode.insertBefore(o,s),s.style.display="none",function(){4==s.readyState?s.parentNode.removeChild(s):setTimeout(arguments.callee,10)}()}p(e,t,n)}}function d(e){if(H.ie&&H.win&&4!=e.readyState){var t=g("div");e.parentNode.insertBefore(t,e),t.parentNode.replaceChild(u(e),t),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(u(e),e)}function u(e){var t=g("div");if(H.win&&H.ie)t.innerHTML=e.innerHTML;else{var n=e.getElementsByTagName(F)[0];if(n){var r=n.childNodes;if(r)for(var s=r.length,a=0;s>a;a++)1==r[a].nodeType&&"PARAM"==r[a].nodeName||8==r[a].nodeType||t.appendChild(r[a].cloneNode(!0))}}return t}function p(e,t,n){var r,s=v(n);if(H.wk&&H.wk<312)return r;if(s)if(typeof e.id==M&&(e.id=n),H.ie&&H.win){var a="";for(var i in e)e[i]!=Object.prototype[i]&&("data"==i.toLowerCase()?t.movie=e[i]:"styleclass"==i.toLowerCase()?a+=' class="'+e[i]+'"':"classid"!=i.toLowerCase()&&(a+=" "+i+'="'+e[i]+'"'));var o="";for(var c in t)t[c]!=Object.prototype[c]&&(o+='<param name="'+c+'" value="'+t[c]+'" />');s.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+o+"</object>",U[U.length]=e.id,r=v(e.id)}else{var l=g(F);l.setAttribute("type",R);for(var d in e)e[d]!=Object.prototype[d]&&("styleclass"==d.toLowerCase()?l.setAttribute("class",e[d]):"classid"!=d.toLowerCase()&&l.setAttribute(d,e[d]));for(var u in t)t[u]!=Object.prototype[u]&&"movie"!=u.toLowerCase()&&f(l,u,t[u]);s.parentNode.replaceChild(l,s),r=l}return r}function f(e,t,n){var r=g("param");r.setAttribute("name",t),r.setAttribute("value",n),e.appendChild(r)}function h(e){var t=v(e);t&&"OBJECT"==t.nodeName&&(H.ie&&H.win?(t.style.display="none",function(){4==t.readyState?m(e):setTimeout(arguments.callee,10)}()):t.parentNode.removeChild(t))}function m(e){var t=v(e);if(t){for(var n in t)"function"==typeof t[n]&&(t[n]=null);t.parentNode.removeChild(t)}}function v(e){var t=null;try{t=E.getElementById(e)}catch(n){}return t}function g(e){return E.createElement(e)}function y(e,t,n){e.attachEvent(t,n),L[L.length]=[e,t,n]}function b(e){var t=H.pv,n=e.split(".");return n[0]=parseInt(n[0],10),n[1]=parseInt(n[1],10)||0,n[2]=parseInt(n[2],10)||0,t[0]>n[0]||t[0]==n[0]&&t[1]>n[1]||t[0]==n[0]&&t[1]==n[1]&&t[2]>=n[2]?!0:!1}function _(e,t,n,r){if(!H.ie||!H.mac){var s=E.getElementsByTagName("head")[0];
if(s){var a=n&&"string"==typeof n?n:"screen";if(r&&(C=null,D=null),!C||D!=a){var i=g("style");i.setAttribute("type","text/css"),i.setAttribute("media",a),C=s.appendChild(i),H.ie&&H.win&&typeof E.styleSheets!=M&&E.styleSheets.length>0&&(C=E.styleSheets[E.styleSheets.length-1]),D=a}H.ie&&H.win?C&&typeof C.addRule==F&&C.addRule(e,t):C&&typeof E.createTextNode!=M&&C.appendChild(E.createTextNode(e+" {"+t+"}"))}}}function k(e,t){if(Y){var n=t?"visible":"hidden";B&&v(e)?v(e).style.visibility=n:_("#"+e,"visibility:"+n)}}function w(e){var t=/[\\\"<>\.;]/,n=null!=t.exec(e);return n&&typeof encodeURIComponent!=M?encodeURIComponent(e):e}var x,j,S,A,C,D,M="undefined",F="object",I="Shockwave Flash",P="ShockwaveFlash.ShockwaveFlash",R="application/x-shockwave-flash",z="SWFObjectExprInst",T="onreadystatechange",q=window,E=document,O=navigator,$=!1,V=[s],N=[],U=[],L=[],B=!1,W=!1,Y=!0,H=function(){var e=typeof E.getElementById!=M&&typeof E.getElementsByTagName!=M&&typeof E.createElement!=M,t=O.userAgent.toLowerCase(),n=O.platform.toLowerCase(),r=n?/win/.test(n):/win/.test(t),s=n?/mac/.test(n):/mac/.test(t),a=/webkit/.test(t)?parseFloat(t.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,i=!1,o=[0,0,0],c=null;if(typeof O.plugins!=M&&typeof O.plugins[I]==F)c=O.plugins[I].description,!c||typeof O.mimeTypes!=M&&O.mimeTypes[R]&&!O.mimeTypes[R].enabledPlugin||($=!0,i=!1,c=c.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),o[0]=parseInt(c.replace(/^(.*)\..*$/,"$1"),10),o[1]=parseInt(c.replace(/^.*\.(.*)\s.*$/,"$1"),10),o[2]=/[a-zA-Z]/.test(c)?parseInt(c.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof q.ActiveXObject!=M)try{var l=new ActiveXObject(P);l&&(c=l.GetVariable("$version"),c&&(i=!0,c=c.split(" ")[1].split(","),o=[parseInt(c[0],10),parseInt(c[1],10),parseInt(c[2],10)]))}catch(d){}return{w3:e,pv:o,wk:a,ie:i,win:r,mac:s}}();return function(){H.w3&&((typeof E.readyState!=M&&"complete"==E.readyState||typeof E.readyState==M&&(E.getElementsByTagName("body")[0]||E.body))&&e(),B||(typeof E.addEventListener!=M&&E.addEventListener("DOMContentLoaded",e,!1),H.ie&&H.win&&(E.attachEvent(T,function(){"complete"==E.readyState&&(E.detachEvent(T,arguments.callee),e())}),q==top&&function(){if(!B){try{E.documentElement.doScroll("left")}catch(t){return setTimeout(arguments.callee,0),void 0}e()}}()),H.wk&&function(){return B?void 0:/loaded|complete/.test(E.readyState)?(e(),void 0):(setTimeout(arguments.callee,0),void 0)}(),r(e)))}(),function(){H.ie&&H.win&&window.attachEvent("onunload",function(){for(var e=L.length,t=0;e>t;t++)L[t][0].detachEvent(L[t][1],L[t][2]);for(var r=U.length,s=0;r>s;s++)h(U[s]);for(var a in H)H[a]=null;H=null;for(var i in n)n[i]=null;n=null})}(),{registerObject:function(e,t,n,r){if(H.w3&&e&&t){var s={};s.id=e,s.swfVersion=t,s.expressInstall=n,s.callbackFn=r,N[N.length]=s,k(e,!1)}else r&&r({success:!1,id:e})},getObjectById:function(e){return H.w3?o(e):void 0},embedSWF:function(e,n,r,s,a,i,o,d,u,f){var h={success:!1,id:n};H.w3&&!(H.wk&&H.wk<312)&&e&&n&&r&&s&&a?(k(n,!1),t(function(){r+="",s+="";var t={};if(u&&typeof u===F)for(var m in u)t[m]=u[m];t.data=e,t.width=r,t.height=s;var v={};if(d&&typeof d===F)for(var g in d)v[g]=d[g];if(o&&typeof o===F)for(var y in o)typeof v.flashvars!=M?v.flashvars+="&"+y+"="+o[y]:v.flashvars=y+"="+o[y];if(b(a)){var _=p(t,v,n);t.id==n&&k(n,!0),h.success=!0,h.ref=_}else{if(i&&c())return t.data=i,l(t,v,n,f),void 0;k(n,!0)}f&&f(h)})):f&&f(h)},switchOffAutoHideShow:function(){Y=!1},ua:H,getFlashPlayerVersion:function(){return{major:H.pv[0],minor:H.pv[1],release:H.pv[2]}},hasFlashPlayerVersion:b,createSWF:function(e,t,n){return H.w3?p(e,t,n):void 0},showExpressInstall:function(e,t,n,r){H.w3&&c()&&l(e,t,n,r)},removeSWF:function(e){H.w3&&h(e)},createCSS:function(e,t,n,r){H.w3&&_(e,t,n,r)},addDomLoadEvent:t,addLoadEvent:r,getQueryParamValue:function(e){var t=E.location.search||E.location.hash;if(t){if(/\?/.test(t)&&(t=t.split("?")[1]),null==e)return w(t);for(var n=t.split("&"),r=0;r<n.length;r++)if(n[r].substring(0,n[r].indexOf("="))==e)return w(n[r].substring(n[r].indexOf("=")+1))}return""},expressInstallCallback:function(){if(W){var e=v(z);e&&x&&(e.parentNode.replaceChild(x,e),j&&(k(j,!0),H.ie&&H.win&&(x.style.display="block")),S&&S(A)),W=!1}}}}();t.exports=n},{}],191:[function(e){var t=e("environment"),n=e("helpers/metrika"),r=e("helpers/page");ns.View.define("ads",{models:["userCurrent"],events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","click .js-link-store-mobile":"onClickStoreMobile"},methods:{onhtmlinit:function(){this.$banner=this.$node.find(".js-ads-banner")},onhtmldestroy:function(){n.hooks.drop(this)},onshow:function(){n.hooks.execute(this,"show"),this.$banner.attr("src",this.$banner.data("src")||"")},onClickStoreMobile:function(e){r.deferFollowLink(e,function(){n.count("interface elements","store links","click",t.agent.OSFamily)})}}})},{environment:8,"helpers/metrika":17,"helpers/page":19}],192:[function(e){e("models/albums-social/album-social"),e("models/state-export-social/state-export-social");var t=e("helpers/page"),n=e("helpers/metrika");ns.View.define("albumSocial",{models:["albumSocial","stateExportSocial"],events:{"ns-view-show":"onshow","ns-view-hide":"onhide",click:"select"},methods:{onshow:function(){this.models.stateExportSocial.on("ns-model-changed",t.update)},onhide:function(){this.models.stateExportSocial.off("ns-model-changed",t.update)},select:function(){var e=this.models.stateExportSocial,t=e.get(".serviceSelected");n.count("interface elements","dialog social export","choose album"),e.setTitleAlbum(t,this.models.albumSocial.get(".title")),e.setPrivacyAlbum(t,this.models.albumSocial.get(".visibility")),e.uncheckAlbumNew(t)}}})},{"helpers/metrika":17,"helpers/page":19,"models/albums-social/album-social":43,"models/state-export-social/state-export-social":166}],193:[function(e){e("views/albums-social/album-social"),e("models/albums-social/albums-social"),e("models/state-export-social/state-export-social");var t=e("underscore"),n=ns.Model.get("stateExportSocial"),r=e("consts"),s=e("helpers/metrika"),a=e("helpers/page");ns.View.define("albumsSocial",{models:["albumsSocial"],events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide","keyup .js-input":"onTypeInInput","change .js-input":"updateTitle","change .js-privacy":"updatePrivacy","focusin .js-new":"checkNewAlbum","click .js-new":"updateTitle"},rewriteParamsOnInit:function(){return{service:n.get(".serviceSelected")}},methods:{oninit:function(){this.models.albumsSocial.isValid()||this.models.albumsSocial.setDataDefault()},onhtmlinit:function(){t.bindAll(this,"renderSelected"),this.models.albumsSocial.isLoaded()||this.models.albumsSocial.load().fail(function(){this._visible&&ns.action.run("dialog.close")}.bind(this)),this.$itemCreateNew=this.$node.find(".js-new"),this.$input=this.$node.find(".js-input");var e=this.node.querySelector(".js-checkbox-new-album");e&&(this.nbCheckboxNewAlbum=nb.block(e)),this.models.albumsSocial.on("ns-model-changed",a.update),this._autocompleteOnce=t.once(this._autocompleteTitleNewAlbum)},onhtmldestroy:function(){this.models.albumsSocial.off("ns-model-changed",a.update),this.nbCheckboxNewAlbum&&this.nbCheckboxNewAlbum.destroy()},onshow:function(){this.models.albumsSocial.isLoaded()&&this.setAlbumDefault(),n.on("ns-model-changed",this.renderSelected),this.renderSelected(),this._autocompleteOnce()},onhide:function(){n.off("ns-model-changed",this.renderSelected)},onTypeInInput:function(){this.updateTitle(),this.setTitleNewAlbumDefault()},checkNewAlbum:function(){var e=this.params.service;n.checkAlbumNew(e),n.getPrivacyAlbumNew(e)||n.setPrivacyAlbumNew(e,"public"),this.updateTitle()},updateTitle:function(){n.setTitleAlbumNew(this.params.service,this._getTitle())},setTitleNewAlbumDefault:function(){var e=this.$input.val();e&&n.set(".titleNewAlbumDefault",e)},renderSelected:function(){this.nbCheckboxNewAlbum&&this.nbCheckboxNewAlbum.isChecked()!=n.isCheckedAlbumNew(this.params.service)&&this.nbCheckboxNewAlbum.toggle()},updatePrivacy:function(e){var t=e.target.value;s.count("interface elements","dialog export social","change privacy",t),n.setPrivacyAlbumNew(this.params.service,t)},_getTitle:function(){return this.$input.val()||"Новый альбом"},_autocompleteTitleNewAlbum:function(){var e=n.get(".titleNewAlbumDefault");e&&this.$input.val(e).change()},setAlbumDefault:function(){var e=this.params.service,t=n.get(".titleNewAlbumDefault");if(t)n.checkAlbumNew(e),n.setTitleAlbumNew(e,t),n.setPrivacyAlbumNew(e,"public");else{var s=this.models.albumsSocial.findAlbumByTitle(r.TITLE_ALBUM_DEFAULT);n.setTitleAlbum(e,s.get(".title")),n.setPrivacyAlbum(e,s.get(".visibility"))}}}})},{consts:7,"helpers/metrika":17,"helpers/page":19,"models/albums-social/albums-social":44,"models/state-export-social/state-export-social":166,underscore:2,"views/albums-social/album-social":192}],194:[function(e){e("views/albums-social/album-social"),e("models/albums-social/group-albums-social"),e("models/state-export-social/state-export-social");var t=ns.Model.get("stateExportSocial");ns.ViewCollection.define("albumsSocialPublic",{models:["groupAlbumsSocial"],split:{intoViews:"albumSocial",byModel:"groupAlbumsSocial"},events:{"ns-view-init":"oninit"},rewriteParamsOnInit:function(){return{service:t.get(".serviceSelected"),privacy:"public"}},methods:{oninit:function(){this.models.groupAlbumsSocial.isValid()||this.models.groupAlbumsSocial.setDataDefault()}}}),ns.ViewCollection.define("albumsSocialFriends",{models:["groupAlbumsSocial"],split:{intoViews:"albumSocial",byModel:"groupAlbumsSocial"},events:{"ns-view-init":"oninit"},rewriteParamsOnInit:function(){return{service:t.get(".serviceSelected"),privacy:"friends"}},methods:{oninit:function(){this.models.groupAlbumsSocial.isValid()||this.models.groupAlbumsSocial.setDataDefault()}}}),ns.ViewCollection.define("albumsSocialPrivate",{models:["groupAlbumsSocial"],split:{intoViews:"albumSocial",byModel:"groupAlbumsSocial"},events:{"ns-view-init":"oninit"},rewriteParamsOnInit:function(){return{service:t.get(".serviceSelected"),privacy:"private"}},methods:{oninit:function(){this.models.groupAlbumsSocial.isValid()||this.models.groupAlbumsSocial.setDataDefault()}}})},{"models/albums-social/group-albums-social":47,"models/state-export-social/state-export-social":166,"views/albums-social/album-social":192}],195:[function(){ns.View.define("app")},{}],196:[function(e,t){function n(){$('<div class="nb-player-audio__flash"><div id="'+l+'"></div></div>').appendTo("body");var e={jsCallback:d},t={allowscriptaccess:"always",allowfullscreen:"true"};this.player.set(".isFlashPlayerInited",o.hasFlashPlayerVersion("10.0.0")),o.embedSWF(c+"/disk/www/_/8tP0Zl4l676Tf14kHZHuSmqTOmE.swf",l,"1","1","10.0.0",null,e,t,{})}function r(e){if(i.isString(e)){var t=i.extend({id:$.now().toString(),src:e,load:new Vow.Promise},ns.Events);return p[t.id]=t,u.then(function(){s.loadSound(t.id,e)}),t}}var s,a,i=e("underscore"),o=e("swfobject"),c=e("config").links.static.host,l="player-audio-"+$.now(),d="callback_disk_flash_player",u=new Vow.Promise,p={};window[d]=function(e,t){"init"===e&&(s=document.getElementById(l),u.fulfill()),"error"===e&&p[t.trackId]&&p[t.trackId].trigger("error",t),"loadingStart"===e&&p[t.trackId]&&p[t.trackId].load&&p[t.trackId].load.fulfill(),"playingProgress"===e&&p[t.trackId]&&p[t.trackId].trigger("timeupdate",t),"playingComplete"===e&&p[t.trackId]&&p[t.trackId].trigger("ended",t)},t.exports={playbackInit:function(){return s||n.call(this),i.bindAll(this,"onPlaybackTimeupdate","onPlaybackPause","onPlaybackError","onPlaybackEnded"),this},playbackDestroy:no.nop,playbackSetSource:function(e){var t=r(e);return a&&p[a]&&p[a].trigger("pause"),t.on("error",this.onPlaybackError),t.on("ended",this.onPlaybackEnded),t.on("pause",this.onPlaybackPause),this._id=t.id,this},playbackStart:function(){return this._id?(a!==this._id&&p[a]&&p[a].trigger("pause"),this.wait(function(){var e=p[this._id];s.playSound(this._id),i.isUndefined(e.position)||i.isNaN(e.position)||(s.seek(e.position),delete e.position),e.on("timeupdate",this.onPlaybackTimeupdate),a=this._id}),this.player.setPlaying(),this.render(),this):void 0},playbackPause:function(){return this.wait(function(){if(a===this._id){var e=p[this._id];e.off("timeupdate"),e.position=100*(this.stateResource.get(".audio.time")/this.stateResource.get(".audio.total")),s.pauseSound(),a=null}}),this.player.resetPlaying(),this.render(),this},playbackSeek:function(e){return this._id?(this.wait(function(){if(i.isNumber(e)&&!this.player.get(".error")){var t=100*(1>e?e:e/this.stateResource.get(".total"));a!==this._id?(p[this._id].position=t,this.stateResource.set(".audio.time",Math.ceil(t/100*this.stateResource.get(".audio.total"))),this.render()):s.seek(t)}}),this):void 0},playbackSetVolume:function(e){return this._id?(this.wait(function(){i.isNumber(e)&&s.setVolume(100*e)}),this):void 0},wait:function(e){Vow.Promise.wait([u,p[this._id].load]).then(i.bind(e,this))},onPlaybackTimeupdate:function(e,t){t.trackId===this._id&&(this.stateResource.set(".audio.time",Math.ceil(t.time)),this.stateResource.set(".audio.total",Math.ceil(t.duration)),this._seeking||this.render())},onPlaybackError:function(e,t){t.trackId===this._id&&(a=null,this.stop(),this.player.setError(),this.render())},onPlaybackEnded:function(e,t){t.trackId===this._id&&(this.stop(),this.playNextAuto())},onPlaybackPause:function(){this.pause()}}},{config:6,swfobject:190,underscore:2}],197:[function(e,t){var n,r=e("underscore");t.exports={playbackInit:function(e){return this._$audio=$("<audio />",{preload:"none"}),this._$audio.appendTo("body"),this._audio=this._$audio[0],this.playbackSetSource(e),r.bindAll(this,"onPlaybackTimeupdate","onPlaybackDurationChange","onPlaybackError","onPlaybackEnded"),this._$audio.on("timeupdate",this.onPlaybackTimeupdate),this._$audio.on("durationchange",this.onPlaybackDurationChange),this._$audio.on("error",this.onPlaybackError),this._$audio.on("ended",this.onPlaybackEnded),this},playbackDestroy:function(){this._$audio.remove()},playbackStart:function(){return this._audio.src&&(n&&n.pause(),n=this,r.isUndefined(this.position)||(this.playbackSeek(this.position),delete this.position),this._audio.play(),this.player.setPlaying(),this.render()),this},playbackPause:function(){return n===this&&(n=null),this._audio.paused||(this._audio.pause(),this.player.resetPlaying(),this.render()),this},playbackSeek:function(e){if(r.isNumber(e)&&r.isFinite(this._audio.duration)&&!r.isNaN(this._audio.duration)&&!this.player.get(".error")&&this._audio&&this._audio.src){var t=1>e?e*this._audio.duration:e;n===this?this._audio.currentTime=t:(this.position=t,this.stateResource.set(".audio.time",Math.ceil(t)),this.render())}return this},playbackSetSource:function(e){return r.isString(e)&&(this.player.resetError(),this.render(),this._audio.src=e,this._audio.load()),this},playbackSetVolume:function(e){return r.isNumber(e)&&(this._audio.volume=e),this},onPlaybackTimeupdate:function(){this.stateResource.set(".audio.time",Math.ceil(this._audio.currentTime)),this._seeking||this.render()},onPlaybackDurationChange:function(){var e=r.isFinite(this._audio.duration)?Math.ceil(this._audio.duration):!1;e&&this.stateResource.set(".audio.total",e),this.render()},onPlaybackEnded:function(){this.stop(),this.playNextAuto()},onPlaybackError:function(){this.pause(),this.player.setError(),this.render()}}},{underscore:2}],198:[function(e){e("models/resource/resource"),e("models/state-resource/state-resource"),e("models/player/player");var t=e("underscore"),n=e("helpers/format").secondsToTime,r=e("helpers/metrika"),s="b-player-audio_playing",a="b-player-audio_error",i="b-player-audio_slide-handle-visible",o=e("./_html5.js"),c=e("./_flash.js");ns.View.define("asideAudio",{models:{resource:{"ns-model-changed":function(e,t){".state.publishing"!==t&&this.invalidate()}}},rewriteParamsOnInit:function(e){return{id:e.selected[0]}},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide","click .js-audio-pause":"pause"},methods:t.extend(Modernizr.audiomp3?o:c,{onhtmlinit:function(){if(nb.init(this.node),this.stateResource=ns.Model.get("stateResource",{idContext:ns.page.current.params.idContext,id:this.params.id}),this.player=ns.Model.get("player"),this.player.get(".isFlashPlayerInited")===!1)return this.$node.addClass("b-player-audio_install-plugin"),void 0;this.nodeAudio=this.$node.find(".js-aside-player");var e=this.node.querySelector(".js-audio-track-slider"),n=this.node.querySelector(".js-audio-volume-slider");e&&(this.sliderPlayer=nb.block(e)),n&&(this.sliderVolume=nb.block(n)),this.$time=this.nodeAudio.find(".js-audio-time"),this.$total=this.nodeAudio.find(".js-audio-total"),this.setSrc(),this.render=t.debounce(this.render,5),this.setVolume=t.debounce(this.setVolume,5),t.bindAll(this,"seek","play","pause","jump","setVolume"),this.sliderPlayer&&(this.sliderPlayer.on("nb-slider_slidestart",function(){this._seeking=!0}.bind(this)),this.sliderPlayer.on("nb-slider_slide",this.seek),this.sliderPlayer.on("nb-slider_slidestop",function(){this._seeking=!1,this.jump()}.bind(this))),this.sliderVolume&&(this.sliderVolume.on("nb-slider_slide",this.setVolume),this.sliderVolume.on("nb-slider_slidestop",function(){this.player.setVolume(this.sliderVolume.getValue()/100)}.bind(this))),this.playbackInit()},onhtmldestroy:function(){this.playbackDestroy()},onshow:function(){return this.player.get(".isFlashPlayerInited")===!1?(r.count("interface elements","audio","show","disabled (no tech)"),void 0):(this.syncVolume(),this.player.on("play",this.play),this.player.on("pause",this.pause),this.player.get(".resourcePlaying")===this.models.resource.get(".id")&&this.player.play(),r.count("interface elements","audio","show",Modernizr.audiomp3?"html5":"flash"),void 0)},onhide:function(){this.player.off("play",this.play),this.player.off("pause",this.pause),this.nodeAudio.removeClass(i),this.stop(),this.player.get(".autoplay")||this.player.setDataDefault()},setSrc:function(){this.setSrcResult=new Vow.Promise,this.models.resource.getURL({inline:!0}).then(function(e){this.setSource(e.get(".file")),this.setSrcResult.fulfill()}.bind(this))},play:function(){return this.player.set(".autoplay",!1),this.setSrcResult.then(function(){this.nodeAudio.addClass(s),this.nodeAudio.addClass(i),this.playbackStart()}.bind(this)),this},pause:function(){return this.setSrcResult.then(function(){this.nodeAudio.removeClass(s),this.playbackPause()}.bind(this)),this},stop:function(){return this.setSrcResult.then(function(){this.stateResource.get(".audio.time")&&this.playbackSeek(0),this.pause()}.bind(this)),this},playNextAuto:function(){ns.action.run("resource.play-next"),r.count("interface elements","audio","play","autoplay next")},jump:function(){return this.playbackSeek(this.sliderPlayer.getValue()/100)},seek:function(){return this.stateResource.set(".audio.time",Math.ceil(this.sliderPlayer.getValue()/100*this.stateResource.get(".audio.total"))),this.render(),this},setSource:function(e){return this.playbackSetSource(e)},render:function(){return this.nodeAudio.toggleClass(a,!!this.player.get(".error")),this.$time.text(n(this.stateResource.get(".audio.time")||0)),this.$total.text(this.stateResource.get(".audio.total")?n(this.stateResource.get(".audio.total")):"--:--"),this._seeking||this.sliderPlayer.setValue(100*(this.stateResource.get(".audio.time")/this.stateResource.get(".audio.total"))||0),this},setVolume:function(){this.playbackSetVolume(this.sliderVolume.getValue()/100)},syncVolume:function(){this.sliderVolume&&this.sliderVolume.getValue()!==100*this.player.get(".volume")&&(this.sliderVolume.setValue(100*this.player.get(".volume")),this.setVolume())}})})},{"./_flash.js":196,"./_html5.js":197,"helpers/format":14,"helpers/metrika":17,"models/player/player":115,"models/resource/resource":133,"models/state-resource/state-resource":169,underscore:2}],199:[function(e){e("models/resources/resources"),e("models/states-context/states-context"),e("models/operation/operation-delete"),e("models/operation/operation-move"),e("models/operation/operation-copy"),e("models/operation/operation-restore"),e("models/operation/operation-bundle"),e("models/user-current/user-current");var t=e("underscore"),n=e("helpers/operation"),r=e("helpers/metrika");ns.View.define("asideMultiple",{models:["resources","statesContext","userCurrent"],events:{"click .js-multiple-op":"createOperation","click .js-bundle":"createOperationBundle","click .js-deselect":"deselectAll","click .js-export":"openDialogExport"},methods:{createOperation:function(e){return e&&e.currentTarget?n.create(e.currentTarget.getAttribute("data-operation"),t.map(this.models.statesContext.get(".selected"),function(e){return{idSrc:e}})):void 0},createOperationBundle:function(){return r.count("actions","with resources","move","to new folder"),n.create("bundle",{ids:this.models.statesContext.get(".selected")})},deselectAll:function(){this.models.statesContext.deselectAll(),r.count("interface elements","listing","deselect all","link in sidebar")},openDialogExport:function(){ns.action.run("export-social.dialog-open",{idsResources:this.models.statesContext.get(".selected")})}}})},{"helpers/metrika":17,"helpers/operation":18,"models/operation/operation-bundle":79,"models/operation/operation-copy":82,"models/operation/operation-delete":84,"models/operation/operation-move":92,"models/operation/operation-restore":99,"models/resources/resources":147,"models/states-context/states-context":171,"models/user-current/user-current":177,underscore:2}],200:[function(e,t){e("models/tree/tree"),e("models/states-context/states-context");var n,r,s,a,i,o,c=e("underscore"),l=e("helpers/page"),d=e("helpers/path"),u=e("helpers/operation"),p=e("helpers/metrika"),f=1e3;ns.ViewCollection.define("asideTree",t.exports={models:["tree","statesContext"],rewriteParamsOnInit:function(e){return e.id=e.id||"/disk",e},split:{intoViews:"asideTree",byModel:"tree"},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy"},methods:{onhtmlinit:function(){this.$itemTree=this.$node.children(".js-aside-tree-item"),this.models.tree.on("ns-model-changed.state",l.update),this.initDropping(),this.$node.hasClass("js-aside-scrollable")&&(c.bindAll(this,"initScrollable","destroyScrollable","scrollContainer"),n=$(".nb-bar_top").height(),r=$(".nb-bar_bottom").height(),s=$.ui.ddmanager.current.helperProportions.height,a=this._$window.height(),i=n+$.ui.ddmanager.current.options.scrollSensitivity,o=a-r-s-$.ui.ddmanager.current.options.scrollSensitivity,this.$node.droppable({tolerance:"pointer",over:this.initScrollable,out:this.destroyScrollable}))},onhtmldestroy:function(){this.models.tree.off("ns-model-changed.state",l.update),this.$itemTree&&this.$itemTree.droppable("destroy")},tryExpand:function(e){return e.stopPropagation(),this.models.tree.get(".hasfolders")?this.models.tree.get(".state.loaded")?!1:(this.timeoutExpand=setTimeout(function(){this.models.tree.expand()}.bind(this),f),void 0):!1},clearTimeoutExpand:function(){clearTimeout(this.timeoutExpand)},initDropping:function(){this.$itemTree.droppable({hoverClass:"_droppable",tolerance:"pointer",drop:this.onDrop.bind(this),over:c.throttle(this.tryExpand.bind(this),100),out:this.clearTimeoutExpand.bind(this)})},onDrop:function(e,t){var n=this.params.id,r=t.helper.data("params").resources,s=c.map(r,function(e){return{idSrc:d.unescape(e.id),idFolderDst:n}}),a="group";return 1===r.length&&(a=r[0].type),p.count("actions","with resources","move",n.split("/").length<4?"d&d to side pane folder":"d&d to side pane subfolder",a),u.create("move",s)},initScrollable:function(){$.ui.ddmanager.current.element.draggable("option","scroll",!1),ns.events.on("ufo-dragging",this.scrollContainer)},destroyScrollable:function(){$.ui.ddmanager.current.element.draggable("option","scroll","document"),ns.events.off("ufo-dragging",this.scrollContainer)},scrollContainer:function(e,t){var n=this.$node.scrollTop(),r=this._$window.scrollTop();t.offset.top-r<=i&&this.$node.scrollTop(n-$.ui.ddmanager.current.options.scrollSpeed),t.offset.top-r>=o&&this.$node.scrollTop(n+$.ui.ddmanager.current.options.scrollSpeed)}}})},{"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"helpers/path":20,"models/states-context/states-context":171,"models/tree/tree":176,underscore:2}],201:[function(e){e("models/resource/resource"),e("models/states-context/states-context"),e("models/state-resource/state-resource"),e("models/user-current/user-current"),e("models/rights-social/rights-social"),e("nanoblocks/popup-share/popup-share");var t=e("environment"),n=e("underscore"),r=e("consts"),s=e("config"),a=e("helpers/metrika"),i=e("helpers/page"),o=e("helpers/editor-photo"),c=200;$(document),ns.View.define("aside",{models:{resource:{"ns-model-changed":function(e,t){return".meta.public"===t&&(this._needToOpenPopupShare=this.models.resource.get(".meta.public")&&!ns.page.current.params.dialog),".state.publishing"===t&&this.togglerPublish?(this.updateToggler(),void 0):(this.invalidate(),this.disableSlide(),this.isContextAside&&i.update(),void 0)}},userCurrent:!0},"params+":{idContext:null},rewriteParamsOnInit:function(e){return{idContext:ns.page.current.params.idContext,id:e.selected.length?e.selected[0]:ns.page.current.params.idContext}},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide","keyup .js-aside-input-name":"onKeyup","blur .js-aside-input-name":"setName","click .js-button-qr":function(){this.runOperationPublish(),this._needToOpenPopupQr=!0},"click .js-export":"countMetrikaExport","submit .js-aside-form-name":no["false"],"click .js-resource-public-link":"selectPublicLink","click .js-open-dialog-export":function(){a.count("actions","social export","single export","show dialog","from sidebar"),ns.action.run("export-social.dialog-open",{idsResources:[this.models.resource.get(".id")]})}},methods:{onhtmlinit:function(){n.bindAll(this,"closePopup","setKeeping","slideIn","moveOut","moveIn","disableSlide","updateToggler","runOperationPublish","onCopyToClipboard","selectPublicLink"),nb.init(this.node),this.requestRightsSocial(),this.initPopupActions();var e=this.$node.find(".js-container-preview");if(e.length){var r=this.$node.find(".nb-panel__title").outerHeight(!0)+this.$node.find(".nb-details").outerHeight(!0);e.css("top",r+"px")}this.statesContext=ns.Model.get("statesContext",this.params),this.stateResource=ns.Model.get("stateResource",this.params),this.inputName=this.node.querySelector(".js-aside-input-name"),this.isContextAside=this.params.id===this.params.idContext,this.isContextAside&&this.models.resource.on("ns-model-changed",i.update),o.init({urlFeather:s.links.static.path+"/static/_feather.js",language:"uk"===t.session.locale?"ua":t.session.locale});var a=this.node.querySelector(".js-toggler-publish");a&&(this.togglerPublish=nb.block(a),this.togglerPublish.on("nb-changed",this.runOperationPublish));var c=this.node.querySelector(".js-popup-share");c&&(this.popupShare=nb.block(c),this.popupShare.on("nb-opened",this.selectPublicLink),this.popupShare.on("nb-copied",this.onCopyToClipboard));var l=this.node.querySelector(".js-toggler-qr");l&&(this.togglerQr=nb.block(l));var d=this.node.querySelector(".js-resource-public-link");d&&(this.inputPublic=nb.block(d))},onhtmldestroy:function(){this.popupActions&&$(this.popupActions.node).off("click",".js-item-menu",this.closePopup),this.togglerPublish&&this.togglerPublish.off("nb-changed",this.runOperationPublish),this.popupShare&&(this.popupShare.destroy(),delete this.popupShare)},onshow:function(){if(this.slideDisabled=this.isContextAside||this.statesContext.get(".wasAsideAnimated")||this.stateResource.get(".transfered")||!1,clearTimeout(this.timeoutMoveOut),this.isContextAside&&this.unsetKeeping(),this.slideDisabled?this.moveIn():(this.timeoutSlideIn=n.defer(this.slideIn),this.statesContext.set(".wasAsideAnimated",!0)),this._needToOpenPopupShare&&!this._needToOpenPopupQr&&(this.popupShare.toggler.open(),this._needToOpenPopupShare=!1,this._needToOpenPopupQr=!1),this._needToOpenPopupQr&&(this.togglerQr&&this.togglerQr.open(),this._needToOpenPopupQr=!1),this.models.resource.get(".state.renaming")){var e=this.$node.find(".js-aside-input-name");e.removeAttr("disabled"),e.focus();var t=e.val().lastIndexOf(".");"dir"!=this.models.resource.get(".type")&&-1!=t?e.selectRange(0,t):e.select()}},onhide:function(){this.isContextAside||this.stateResource.get(".selected")||!this.models.resource.get(".state.renaming")||this.models.resource.resetName(),clearTimeout(this.timeoutSlideIn),this.isContextAside&&this.setKeeping(),this.popupShare&&this.popupShare.popup.close();var e=ns.page.current.params.idContext!==this.params.idContext;!this.statesContext.get(".selected").length&&!this.isContextAside||e?(this.moveOut(),this.statesContext.set(".wasAsideAnimated",!1)):this.timeoutMoveOut=setTimeout(this.moveOut,2*c),this.$node.find(".js-aside-input-name").attr("disabled","disabled")},requestRightsSocial:function(){var e=ns.Model.get("rightsSocial",{scenario:"photos_export"});this.models.resource.get(".isExportable")&&!e.isValid()&&e.fetch()},slideIn:function(){this.$node.addClass("nb-panel_curtain_animated").removeClass("nb-panel_curtain_moved")},moveIn:function(){this.$node.removeClass("nb-panel_curtain_animated nb-panel_curtain_moved")},moveOut:function(){this.$node.removeClass("nb-panel_curtain_animated nb-panel_curtain_keeping").addClass("nb-panel_curtain_moved"),this.timeoutMoveOut=null},disableSlide:function(){this.slideDisabled=!0},selectPublicLink:function(){return t.agent.isMobile||(a.count("actions","with resources","public links","link sharing attempt","click on link",this.models.resource.get(".type")),this.inputPublic.focus(),this.inputPublic.node.select()),this},initPopupActions:function(){var e=$(this.node).find(".js-popup-toggler")[0];if(e){var t=nb.block(e),n=$(t.node).data("nb-popup-toggler")||{};this.popupActions=nb.find(n.id),this.popupActions&&$(this.popupActions.node).on("click",".js-item-menu",this.closePopup)}},closePopup:function(){this.popupActions&&this.popupActions.close()},updateToggler:function(){!this.models.resource.get(".state.publishing")&&this.togglerPublish.isChecked()&&this.togglerPublish.uncheck()},onKeyup:function(e){if(this.models.resource.get(".state.renaming"))switch(e.keyCode){case r.KEYS.ENTER:this.models.resource.setName(this.inputName.value),e.stopPropagation();break;case r.KEYS.ESC:this.models.resource.resetName(),e.stopPropagation()}},setName:function(){this.models.resource.get(".state.renaming")&&(this.inputName.value!==this.models.resource.get(".name")||this.models.resource.get(".state.part")?this.models.resource.setName(this.inputName.value):this.models.resource.resetName())},runOperationPublish:function(){ns.action.run("resource.publish",{id:this.models.resource.get(".idEncoded"),reverse:this.models.resource.get(".meta.public")})},setKeeping:function(){this.$node.addClass("nb-panel_curtain_keeping")},unsetKeeping:function(){this.$node.removeClass("nb-panel_curtain_keeping")},countMetrikaExport:function(e){var t=$(e.currentTarget).data("params")||{};t.service&&a.count("actions","social export","single export from sidebar",t.service)},onCopyToClipboard:function(){a.count("actions","with resources","public links","copy link","sidebar",this.models.resource.get(".type")),i.update()}}})},{config:6,consts:7,environment:8,"helpers/editor-photo":12,"helpers/metrika":17,"helpers/page":19,"models/resource/resource":133,"models/rights-social/rights-social":148,"models/state-resource/state-resource":169,"models/states-context/states-context":171,"models/user-current/user-current":177,"nanoblocks/popup-share/popup-share":183,underscore:2}],202:[function(e){e("models/resources/resources"),ns.View.define("attach-link",{models:["resources"],rewriteParamsOnInit:function(e){return e.idContext="/attach",e
}})},{"models/resources/resources":147}],203:[function(e){e("models/awaps/awaps");var t=e("environment"),n=e("models/user-current/user-current");ns.View.define("awaps",{rewriteParamsOnInit:function(e){return e["disk-has-desktop"]=n.get(".devices.desktop")?"yes":"no",e["disk-has-mobile"]=n.get(".devices.mobile")?"yes":"no",e["disk-lang"]=t.session.locale,e["disk-domain"]=t.session.tld,e},models:["awaps"],events:{"click .js-link-web-client":"registerHitAwaps"},methods:{registerHitAwaps:function(e){var t=$(e.currentTarget),n=t.data("url-awaps");n&&$("<img />",{src:n}).hide().appendTo("body")}}})},{environment:8,"models/awaps/awaps":48,"models/user-current/user-current":177}],204:[function(e){e("models/settings/settings");var t=e("helpers/page"),n=e("helpers/metrika");ns.View.define("banner",{models:["settings","userCurrent"],events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","click .js-close-android":"closeBannerAndroid","click .js-install-android":"registerInstallAndroid"},methods:{onhtmlinit:function(){this.models.settings.on("ns-model-changed",t.update)},onhtmldestroy:function(){this.models.settings.off("ns-model-changed",t.update)},onshow:function(){n.hooks.execute(this,"show")},closeBannerAndroid:function(){this.models.settings.save({key:"timestampClosedBannerAndroid",value:Date.now()}),n.count("interface elements","android banner","x-closed")},registerInstallAndroid:function(e){t.deferFollowLink(e,function(){n.count("interface elements","android banner","install")})}}})},{"helpers/metrika":17,"helpers/page":19,"models/settings/settings":153}],205:[function(e){e("models/resource/resource"),e("models/operations/operations");var t=e("underscore"),n=e("helpers/page");ns.View.define("cleanTrash",{models:["resource","resources"],rewriteParamsOnInit:function(e){return{context:e.idContext,idContext:"/trash",id:"/trash",order:e.order,sort:e.sort}},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy"},methods:{onhtmlinit:function(){t.bindAll(this,"disableButton"),this.button=nb.block(this.node.querySelector(".js-clean-trash"));var e=ns.Model.get("operations").getByType("cleanTrash");t.isEmpty(e)||this.disableButton(),this.models.resource.on("ufo-resources-hidden",this.disableButton),this.models.resources.on("ns-model-changed",n.update)},onhtmldestroy:function(){this.models.resource.off("ufo-resources-hidden",this.disableButton),this.models.resources.off("ns-model-changed",n.update)},disableButton:function(){this.button.disable()}}})},{"helpers/page":19,"models/operations/operations":107,"models/resource/resource":133,underscore:2}],206:[function(e){function t(e){return e&&n.reduce(e.serializeArray(),function(e,t){return t.value&&(e[t.name]=t.value),e},{})}e("models/confirmation/confirmation"),e("views/confirmations/confirmation");var n=e("underscore"),r=e("helpers/metrika");ns.View.define("confirmationPrompt",{models:["confirmation"],events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","keydown@show window":"onkeydown","click .js-confirmation-cancel":"cancel","click .js-confirmation-accept":"accept"},methods:{onhtmlinit:function(){this.$form=this.$node.find(".js-form-prompt"),this.$checkboxes=this.$node.find(".js-import-social-content"),this.buttonAccept=nb.block(this.node.querySelector(".js-confirmation-accept")),this.serialize=n.bind(t,null,this.$form),this.checkAcceptabilityThrottled=n.throttle(this.checkAcceptability.bind(this),200),this.$form.on("input keyup change",this.checkAcceptabilityThrottled)},onhtmldestroy:function(){this.$form.off("input keyup change",this.checkAcceptabilityThrottled),r.hooks.drop(this)},onshow:function(){r.hooks.execute(this,"show"),this.checkAcceptability()},cancel:function(){this.models.confirmation.reject(this.serialize())},checkAcceptability:function(){n.isEmpty(this.serialize())?this.buttonAccept.disable():this.buttonAccept.enable()},accept:function(e){var t=$(e.target);t.hasClass("js-import-social-accept")&&this.$checkboxes.each(function(){var e=$(this).find("input"),t=e.attr("name"),n=e.is(":checked")?"on":"off",s=["interface elements","import initialize dialog"].concat([t,n]);r.count.apply(r,s)}),this.models.confirmation.confirm(this.serialize())}}},"confirmation")},{"helpers/metrika":17,"models/confirmation/confirmation":50,underscore:2,"views/confirmations/confirmation":207}],207:[function(e){e("models/confirmation/confirmation"),e("underscore");var t=e("consts"),n=e("helpers/metrika");ns.View.define("confirmation",{models:["confirmation"],events:{"ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","keydown@show window":"onkeydown","click .js-confirmation-cancel":"cancel","click .js-confirmation-accept":"accept","click .js-confirmation-accept-all":"acceptAll"},methods:{onhtmldestroy:function(){n.hooks.drop(this)},onshow:function(){n.hooks.execute(this,"show")},onkeydown:function(e){return e&&e.keyCode==t.KEYS.ESC?(this.cancel(),!1):void 0},cancel:function(){this.models.confirmation.reject()},accept:function(){this.models.confirmation.confirm()},acceptAll:function(){this.models.confirmation.confirmAll()}}})},{consts:7,"helpers/metrika":17,"models/confirmation/confirmation":50,underscore:2}],208:[function(e){e("models/contacts/contact"),e("models/invitees/invitee"),e("models/contacts/state-contact-invite-disk");var t=e("helpers/page"),n=e("helpers/operation"),r=e("underscore");ns.View.define("contactInviteDisk",{models:{contact:!0,invitee:!1,stateContactInviteDisk:{"ns-model-changed":function(e,n){return".hidden"===n?(this.$node.toggleClass("_hidden",this.models.stateContactInviteDisk.get(".hidden")),void 0):(this.invalidate(),t.update(),void 0)}}},events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy",click:"setChecked",tap:"setChecked","click .js-refresh-token":"refreshToken"},methods:{oninit:function(){ns.Model.getValid("stateContactInviteDisk",this.params)||ns.Model.get("stateContactInviteDisk",this.params).setDataDefault(),ns.Model.getValid("invitee",this.params)||ns.Model.get("invitee",this.params).setDataDefault()},onhtmlinit:function(){var e=this.node.querySelector(".js-flag-invite");r.bindAll(this,"onCheckboxCheck","onCheckboxUncheck"),e&&(this.nbCheckbox=nb.block(e),this.nbCheckbox.on("nb-checked",this.onCheckboxCheck),this.nbCheckbox.on("nb-unchecked",this.onCheckboxUncheck))},onhtmldestroy:function(){this.nbCheckbox&&(this.nbCheckbox.off("nb-checked",this.onCheckboxCheck),this.nbCheckbox.off("nb-unchecked",this.onCheckboxUncheck))},onCheckboxCheck:function(){this.models.stateContactInviteDisk.set(".checked",!0)},onCheckboxUncheck:function(){this.models.stateContactInviteDisk.set(".checked",!1)},setChecked:function(){this.nbCheckbox&&(this.models.stateContactInviteDisk.get(".checked")?this.nbCheckbox.uncheck():this.nbCheckbox.check())},refreshToken:function(){var e=this.models.contact.get(".service"),t={service:e,scenario:"invite"};ns.action.run("ufo-broker.bind-social",t).then(function(){n.create("inviteDisk",{userid:this.models.contact.get(".userid"),service:e,notify:!1})}.bind(this))}}})},{"helpers/operation":18,"helpers/page":19,"models/contacts/contact":51,"models/contacts/state-contact-invite-disk":54,"models/invitees/invitee":58,underscore:2}],209:[function(e){e("models/contacts/contacts"),e("models/rights-social/rights-social"),e("views/contacts/contacts-invite-disk/contact-invite-disk");var t=e("underscore"),n=e("helpers/page"),r=e("helpers/format"),s=e("helpers/metrika"),a=e("helpers/email"),i=e("consts");ns.ViewCollection.define("contactsInviteDisk",{models:["contacts","rightsSocial"],events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","keyup .js-filter-contacts":"onKeyUp"},split:{intoViews:"contactInviteDisk",byModel:"contacts"},rewriteParamsOnInit:function(){return{scenario:"invite"}},methods:{onhtmlinit:function(){t.bindAll(this,"onContactInsert","onInputChange","onInputChange","clearInput"),this.$input=this.$node.find(".js-filter-contacts"),this.$input.on("propertychange input",this.onInputChange),this.models.contacts.on("ns-model-changed",n.update),this.models.contacts.on("ns-model-insert",this.onContactInsert),this.models.contacts.load(),this.state=ns.Model.get("stateDialogInviteDisk").setDataDefault(),this.statesContact=ns.Model.get("statesContactInviteDisk"),this.toggleNotFound(),this.statesContact.on("reset",this.clearInput)},onhtmldestroy:function(){this.$input.off("propertychange input",this.onInputChange),this.models.contacts.off("ns-model-changed",n.update),this.models.contacts.off("ns-model-insert",this.onContactInsert),this.statesContact.off("reset",this.clearInput)},onshow:function(){var e,t,n=this.models.contacts.get(".status");"loading"===n?this._timeLoadingStart=Date.now():"loaded"===n&&(s.count("interface elements","invites to disk contacts dialog","show",this.models.contacts.isEmpty()?"empty":"filled"),this._timeLoadingStart&&(e=this.models.contacts.models.length,t=r.numberToInterval(e,i.INTERVALS_COUNT_CONTACTS),s.count("tech","count contacts",t),s.count("tech","invite disk dialog","contacts list load time",Date.now()-this._timeLoadingStart),delete this._timeLoadingStart))},onContactInsert:function(){n.go(n.getUrlBase()).always(function(){this.clearInput()}.bind(this))},onKeyUp:function(e){switch(e.keyCode){case i.KEYS.ENTER:ns.action.run("dialog-invite-disk.invite")}},onInputChange:function(e){var t=e&&e.target&&e.target.value||"";this.statesContact.hideFiltered(t),this.toggleNotFound(),this.checkEmail(t)},checkEmail:function(e){this.state.get(".emailValid")&&this.state.resetEmail(),a.isEmail(e)&&this.state.set(".emailValid",e)},toggleNotFound:function(){this.$node.find(".js-filter-not-found").toggleClass("_hidden",!t.all(this.statesContact.models,function(e){return e.get(".hidden")},this))},clearInput:function(){this.$input.val(""),this.onInputChange()}}})},{consts:7,"helpers/email":13,"helpers/format":14,"helpers/metrika":17,"helpers/page":19,"models/contacts/contacts":52,"models/rights-social/rights-social":148,underscore:2,"views/contacts/contacts-invite-disk/contact-invite-disk":208}],210:[function(){ns.View.define("crumbsPage",{"params+":{page:null}})},{}],211:[function(e){e("models/resource/resource"),ns.View.define("crumbs",{models:["resource"],rewriteParamsOnInit:function(e){return{id:e.idContext}}})},{"models/resource/resource":133}],212:[function(e){e("models/resource/resource"),e("models/invitees/invitees-folder/invitees-folder"),e("models/invitees/invitees-folder/state-access-folder"),e("models/invites/state-form-invite-folder"),e("underscore");var t=e("helpers/metrika");ns.View.define("dialogAccessFolder",{"params+":{id:null},rewriteParamsOnInit:function(e){return{id:e.idDialog}},events:{"ufo-dialog-close@show":"onClose"},methods:{onClose:function(){this.clear(),t.release("interface elements","folder access dialog","invite")},clear:function(){var e=ns.Model.get("inviteesFolder",{idFolder:this.params.id});e.resetState();var t=ns.Model.get("stateAccessFolder",{idFolder:this.params.id});t.reset();var n=ns.Model.get("stateFormInviteFolder",{id:this.params.id});n.reset()}}})},{"helpers/metrika":17,"models/invitees/invitees-folder/invitees-folder":60,"models/invitees/invitees-folder/state-access-folder":61,"models/invites/state-form-invite-folder":70,"models/resource/resource":133,underscore:2}],213:[function(e){e("models/resource/resource"),ns.View.define("titleAccessFolder",{models:["resource"],rewriteParamsOnInit:function(e){return{id:e.idDialog}}})},{"models/resource/resource":133}],214:[function(e){e("models/resource/resource"),e("models/contacts/contacts"),e("models/rights-social/rights-social"),ns.View.define("toolsetAccessFolder",{models:["resource","contacts","rightsSocial"],"params+":{id:null},rewriteParamsOnInit:function(e){return{id:e.idDialog,scenario:"invite"}}})},{"models/contacts/contacts":52,"models/resource/resource":133,"models/rights-social/rights-social":148}],215:[function(e){e("models/invitees/invitees-folder/invitees-folder"),e("models/invitees/invitees-folder/state-access-folder"),e("models/user-current/user-current"),e("underscore");var t=e("helpers/page");ns.View.define("warningAccessFolder",{models:["resource","stateAccessFolder","userCurrent"],"params+":{id:null,idFolder:null},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","click ._link":"onClickLink"},rewriteParamsOnInit:function(e){return{id:e.idDialog,idFolder:e.idDialog}},methods:{onhtmlinit:function(){this.models.stateAccessFolder.on("ns-model-changed",t.update)},onhtmldestroy:function(){this.models.stateAccessFolder.on("ns-model-changed",t.update)},onClickLink:function(){this.models.stateAccessFolder.reset()}}})},{"helpers/page":19,"models/invitees/invitees-folder/invitees-folder":60,"models/invitees/invitees-folder/state-access-folder":61,"models/user-current/user-current":177,underscore:2}],216:[function(e){e("models/resource/resource"),e("models/states-context/states-context"),e("models/albums-social/albums-social"),e("consts");var t=e("helpers/page"),n=e("helpers/metrika");e("helpers/operation"),ns.View.define("dialogConfirmExportSocial",{models:["resource","albumsSocial"],rewriteParamsOnInit:function(e){return e.id=ns.Model.get("statesContext",e).get(".selected")[0],e},events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","click .js-cancel":"cancel"},methods:{oninit:function(){this.models.albumsSocial.isValid()||this.models.albumsSocial.setDataDefault()},onhtmlinit:function(){this.models.albumsSocial.isLoaded()||this.models.albumsSocial.load().fail(function(){this._visible&&ns.action.run("dialog.close")}.bind(this)),nb.init(this.node),this.models.albumsSocial.on("ns-model-changed",t.update)},onhtmldestroy:function(){this.models.albumsSocial.off("ns-model-changed",t.update)},cancel:function(){n.count("interface elements","dialog for single photo export","cancel"),ns.action.run("dialog.close")}}})},{consts:7,"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"models/albums-social/albums-social":44,"models/resource/resource":133,"models/states-context/states-context":171}],217:[function(e){e("models/tree/tree"),e("models/tree/state-tree"),e("models/operation/operation-create-folder");var t=e("underscore"),n=e("helpers/page"),r=e("helpers/path"),s=e("helpers/metrika"),a=e("helpers/operation"),i=e("helpers/format"),o=ns.Model.get("stateTree"),c="b-dialog-create-shared__dropdown_placeholder";ns.View.define("dialogCreateFolderShared",{models:{tree:"keepValid"},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide","click .js-button-action":"selectFolder"},rewriteParamsOnInit:function(){return{id:"/disk"}},methods:{onhtmlinit:function(){t.bindAll(this,"onFolderExists","onFolderCreated","onIntentCreateFolder","onMenuChosen","onInputCreateFolderChange"),this.buttonCreateFolder=nb.block(this.node.querySelector(".js-button-create-folder")),this.models.tree.get(".hasfolders")?(this.popup=nb.block(this.node.querySelector(".js-popup-tree")),this.dropdown=nb.block(this.node.querySelector(".js-dropdown")),this.buttonAction=nb.block(this.node.querySelector(".js-button-action")),this.togglerPopup=this.node.querySelector(".js-popup-toggler"),this.popup.$node.on("input.shareFolder propertychange.shareFolder",".js-input-create-folder",this.onInputCreateFolderChange),this.popup.$node.on("submit.shareFolder",".js-form-create-folder",this.onIntentCreateFolder)):(this.$node.on("input.shareFolder propertychange.shareFolder",".js-input-create-folder",this.onInputCreateFolderChange),this.$node.on("submit.shareFolder",".js-form-create-folder",this.onIntentCreateFolder))},onhtmldestroy:function(){this.popup?this.popup.$node.off(".shareFolder"):this.$node.off(".shareFolder")},onshow:function(){this.popup&&this.popup.open({where:this.togglerPopup}),o.on("ns-model-changed.menuChosen",this.onMenuChosen)},onhide:function(){this.popup?(this.popup.$node.find(".js-input-create-folder").val(""),this.popup.close()):this.$node.find(".js-input-create-folder").val(""),o.set(".menuChosen",null),o.off("ns-model-changed.menuChosen",this.onMenuChosen)},onMenuChosen:function(){var e=o.get(".menuChosen");if(e){this._idChosen=e,this.dropdown.setContent(r.basename(this._idChosen)),this.dropdown.$node.removeClass(c);var t=ns.Model.getValid("tree",{id:this._idChosen});t&&t.get(".meta.group.is_root")?this.buttonAction.setContent("Настроить доступ"):this.buttonAction.setContent("Сделать папку общей"),this.buttonAction.enable(),this.popup.close()}else this.dropdown.setContent("Выберите папку…"),this.dropdown.$node.addClass(c),this.buttonAction.setContent("Сделать папку общей"),this.buttonAction.disable()},onInputCreateFolderChange:function(e){var t=e.currentTarget.value;t?(this._nameFolderNew=t,this.buttonCreateFolder.enable()):(delete this._nameFolderNew,this.buttonCreateFolder.disable())},selectFolder:function(e){this._idChosen&&(this.openDialogAccessFolder(this._idChosen),s.count("actions","shared folders","add shared folder","existing folder")),e.preventDefault()},onIntentCreateFolder:function(e){this._nameFolderNew&&(this.buttonCreateFolder.disable(),this.createFolder(),s.count("actions","shared folders","add shared folder","new folder")),e.preventDefault()},openDialogAccessFolder:function(e){n.go(n.getUrlBase()+"|access-folder"+r.escape(e))},createFolder:function(){this.operation=a.initialize("createFolder",{nameFolderDst:this._nameFolderNew,idFolderDst:"disk/"}),this.operation.notify=no.nop,this.operation.on("status.done",this.onFolderCreated),this.operation.on("status.exists",this.onFolderExists),this.operation.run()},onFolderCreated:function(){this.openDialogAccessFolder(this.operation.get(".dst").get(".id")),this.unbindFromOperation()},onFolderExists:function(){this.unbindFromOperation();var e=Math.floor(Date.now()/1e3);this._nameFolderNew+="_"+i.timestampToDate(e,"DD.MM.YYYY"),this.createFolder()},unbindFromOperation:function(){this.operation.off("status.completed",this.onFolderCreated),this.operation.off("status.exists",this.onFolderExists),delete this.operation}}})},{"helpers/format":14,"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"helpers/path":20,"models/operation/operation-create-folder":83,"models/tree/state-tree":175,"models/tree/tree":176,underscore:2}],218:[function(e){e("models/resource/resource"),e("models/operation/operation-save-editor-photo");var t=e("underscore"),n=e("helpers/editor-photo");e("helpers/page");var r=e("helpers/operation"),s=e("helpers/metrika");ns.View.define("dialogEditPhoto",{models:{resource:{"ns-model-changed":"keepValid"}},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-show":"onshow","ns-view-hide":"onhide"},rewriteParamsOnInit:function(e){return e.id=e.idDialog,e},methods:{onhtmlinit:function(){t.bindAll(this,"openEditor","onInit","onStartSave","onClose","onDoneSave","onError","onFailSave")},onshow:function(){n.isReady?this.openEditor():n.on("editor-photo.inited",this.onInit),n.on("editor-photo.save",this.onStartSave),n.on("editor-photo.error",this.onError),n.on("editor-photo.closed",this.onClose)},onhide:function(){n.close(),n.off("editor-photo.save",this.onStartSave),n.off("editor-photo.error",this.onError),n.off("editor-photo.closed",this.onClose)},onInit:function(){this.openEditor(),n.off("editor-photo.inited",this.onInit)},onStartSave:function(){var e=n.getActionsJson(),t=JSON.parse(e);return s.count("interface elements","image editor","close","save"),s.reach("finish_edit_photo"),n.isUnsaved=!1,t.actionlist.length<=1?(this.closeDialog(),void 0):(this.operation=r.create("saveEditorPhoto",{id:this.models.resource.get(".id"),actions:e}),this.operation.on("status.done",this.onDoneSave),this.operation.on("status.failed",this.onFailSave),this.closeDialog(),void 0)},onClose:function(){this.closeDialog(),s.count("interface elements","image editor","close","x-closed")},onDoneSave:function(){s.count("interface elements","image editor","complete","show"),this.operation.off("status.done",this.onDoneSave),this.transferSelection()},onFailSave:function(){s.count("interface elements","image editor","edit error"),this.operation.off("status.failed",this.onFailSave)},onError:function(){s.count("interface elements","image editor","edit error"),this.closeDialog()},openEditor:function(){n.open({image:"editor-photo-"+this.models.resource.get(".idEncoded")})},closeDialog:function(){ns.action.run("dialog.close")},transferSelection:function(){var e=ns.page.current.params.idContext,t=ns.Model.getValid("stateResource",{idContext:e,id:this.operation.get(".resource").get(".id")}),n=ns.Model.getValid("stateResource",{idContext:e,id:this.models.resource.get(".id")});t&&n&&(t.toggleSelected(),t.setTransfered(),n.deselect())}}})},{"helpers/editor-photo":12,"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"models/operation/operation-save-editor-photo":100,"models/resource/resource":133,underscore:2}],219:[function(e){e("models/state-export-social/state-export-social"),e("models/confirmation/confirmation"),e("models/rights-social/rights-social");var t=e("underscore"),n=e("consts"),r=e("helpers/page"),s=e("helpers/metrika"),a=e("helpers/operation"),i=ns.Model.get("stateExportSocial"),o="b-dialog-export-social_expanded",c="b-dialog-export-social__service_selected",l="b-dialog-export-social__album_visible";ns.View.define("dialogExportSocial",{models:{stateExportSocial:{"ns-model-changed":function(e,t){".idsResources"===t&&(this.invalidate(),r.update())}}},events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide","keydown@show window":"onkeydown","click .js-service":"onClickService","click .js-cancel":"cancel","click .js-accept":"accept","ufo-dialog-close@show":"resetState"},methods:{oninit:function(){this.rightsSocial=ns.Model.get("rightsSocial",{scenario:"photos_export"}),this.rightsSocial.fetch()},onhtmlinit:function(){t.bindAll(this,"onCheckboxChanged","onStateChanged"),this.$dialog=this.$node.find(".js-dialog"),this.$services=this.$node.find(".js-service"),this.nodesCheckbox=this.node.querySelectorAll(".js-checkbox"),this.nbButtonAccept=nb.block(this.node.querySelector(".js-accept")),nb.bindTo(this.nodesCheckbox,"nb-changed",this.onCheckboxChanged),s.count("interface elements","dialog social export","show")},onhtmldestroy:function(){nb.destroy(this.node)},onshow:function(){i.on("ns-model-changed",this.onStateChanged),this.onStateChanged()},onhide:function(){i.off("ns-model-changed",this.onStateChanged)},onkeydown:function(e){return e&&e.keyCode==n.KEYS.ESC?(this.cancel(),!1):void 0},onCheckboxChanged:function(e,t){function n(){i.uncheck(o)}function r(){i.check(o),i.set(".serviceSelected",o)}var a=t.$node.data("params"),o=a.service,c=t.isChecked();s.count("interface elements","dialog social export","togglers for albums",o,"turn "+(c?"on":"off")),c?this.rightsSocial.isAuthorized(o)?r():this._requestAuthForExport(o).then(r,n):n()},onStateChanged:function(){var e=i.get(".serviceSelected");this.$dialog.toggleClass(o,!!e),this.$services.each(function(){var t=$(this),r=t.find(".js-title-album"),s=t.data("service"),a=nb.block(this.querySelector(".js-checkbox")),o=i.isChecked(s),d="";d=i.isCheckedAlbumNew(s)?i.getTitleAlbumNew(s):i.getTitleAlbum(s),d||(d=n.TITLE_ALBUM_DEFAULT),t.toggleClass(c,s===e),r.toggleClass(l,o),r.text(d),a.isChecked()!==o&&a.toggle()}),i.hasChecked()?this.nbButtonAccept.enable():this.nbButtonAccept.disable(),r.update()},onClickService:function(e){function t(){i.set(".serviceSelected",r)}var n=$(e.currentTarget),r=n.data("service");i.isChecked(r)&&(this.rightsSocial.isAuthorized(r)?t():this._requestAuthForExport(r).then(t))},resetState:function(){i.setDataDefault()},cancel:function(){s.count("interface elements","dialog social export","button for cancel export","click"),ns.action.run("dialog.close")},accept:function(){s.count("interface elements","dialog social export","button for start export","click"),s.reach("start_export");var e=i.get(".idsResources"),n=i.getAlbumsChecked(),r=i.getServiceChecked(),o=(e.length>1?"multi":"single")+" export";s.count("actions","social export","chosen at the same time",n.length),s.count("actions","social export",o,"export",r);var c=t.map(n,function(t){return t.titleAlbum===i.get(".titleDefault")&&s.count("actions","social export","export into default album"),{service:t.service,titleAlbum:t.titleAlbum,privacyAlbum:t.privacyAlbum,idsResources:e}});a.create("exportSocial",c),ns.action.run("dialog.close")},_requestAuthForExport:function(e){return ns.action.run("ufo-broker.bind-social",{scenario:"photos_export",service:e})}}})},{consts:7,"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"models/confirmation/confirmation":50,"models/rights-social/rights-social":148,"models/state-export-social/state-export-social":166,underscore:2}],220:[function(){ns.View.define("dialogInviteDisk",{events:{"ns-view-init":"oninit","ns-view-show":"onshow","ns-view-hide":"onhide"},methods:{oninit:function(){ns.Model.get("statesContactInviteDisk",this.params).setDataDefault()},onshow:function(){nb.trigger("popup-close")},onhide:function(){ns.Model.get("statesContactInviteDisk").reset()}}})},{}],221:[function(e){e("models/contacts/states-contact-invite-disk"),e("models/invites/state-dialog-invite-disk");var t=e("underscore"),n=e("helpers/page");e("helpers/email"),e("helpers/operation"),e("consts"),ns.View.define("toolsetInviteDisk",{models:["statesContactInviteDisk"],events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","click .js-send":"send"},methods:{onhtmlinit:function(){t.bindAll(this,"send","updateButton"),this.buttonSend=nb.block(this.node.querySelector(".js-send"));var e=this.models.statesContactInviteDisk;e.on("ns-model-insert",n.update),e.on("ns-model-remove",n.update),e.on("ns-model-changed",n.update),ns.Model.get("stateDialogInviteDisk").on("ns-model-changed.emailValid",this.updateButton)},onhtmldestroy:function(){var e=this.models.statesContactInviteDisk;e.off("ns-model-insert",n.update),e.off("ns-model-remove",n.update),e.off("ns-model-changed",n.update),ns.Model.get("stateDialogInviteDisk").off("ns-model-changed.emailValid",this.updateButton)},updateButton:function(){ns.Model.get("stateDialogInviteDisk").get(".emailValid")?this.buttonSend.enable():this.buttonSend.disable()},send:function(){ns.action.run("dialog-invite-disk.invite")}}})},{consts:7,"helpers/email":13,"helpers/operation":18,"helpers/page":19,"models/contacts/states-contact-invite-disk":55,"models/invites/state-dialog-invite-disk":69,underscore:2}],222:[function(e){var t=e("helpers/page");ns.View.define("dialogInvitees",{models:["invitees"],events:{"ns-view-show":"onshow"},methods:{onshow:function(){0===this.models.invitees.models.length&&t.go("/invites")}}})},{"helpers/page":19}],223:[function(e){var t=e("helpers/page");e("models/user-current/user-current"),ns.View.define("dialogMessage",{models:["userCurrent"],events:{"click .js-close-dialog-message":"close"},methods:{close:function(){this.models.userCurrent.set(".attemptAcceptInvite",!1),t.update()}}})},{"helpers/page":19,"models/user-current/user-current":177}],224:[function(e){e("nanoblocks/video/video");var t=e("underscore"),n=e("environment"),r=e("helpers/metrika"),s=e("helpers/page"),a=7,i="iOS"===n.agent.OSFamily;ns.View.define("dialogPromoEditor",{events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide","dialog-promo-editor-finish-screen-show@show":"onFinishScreenShow","click .js-poster":"onPlayClick","click .js-replay":"onReplayClick","click .js-x-close":"onXCloseClick","click .js-button-close":"onButtonCloseClick","click .js-android-link":"onAndroidLinkClick"},methods:{onhtmlinit:function(){this.$dialog=this.$node.find(".b-dialog-promo-editor"),this.video=nb.block(this.node.querySelector(".js-video")),t.bindAll(this,"onMomentPassed","onPlayStart","onPlayingFinish","onVideoReady"),this.video.on("nb-video:passed",this.onMomentPassed),this.video.on("nb-video:start",this.onPlayStart),this.video.on("nb-video:finish",this.onPlayingFinish),this.video.on("nb-video:ready",this.onVideoReady),i&&this.video.setReady()},onhtmldestroy:function(){this.video.off("nb-video:passed",this.onMomentPassed),this.video.off("nb-video:start",this.onPlayStart),this.video.off("nb-video:finish",this.onPlayingFinish),this.video.off("nb-video:ready",this.onVideoReady),this.video.destroy()},onshow:function(){r.count("interface elements","Aviary promo popup","show")},onhide:function(){this.video.finish()},onPlayClick:function(){r.count("interface elements","Aviary promo popup","play","click"),this.play()},onReplayClick:function(){r.count("interface elements","Aviary promo popup","play again","click"),this.play()},onXCloseClick:function(){r.count("interface elements","Aviary promo popup","x-close","click")},onButtonCloseClick:function(){r.count("interface elements","Aviary promo popup","button close","click")},onAndroidLinkClick:function(e){s.deferFollowLink(e,function(){r.count("interface elements","Aviary promo popup","android link","click")})},play:function(){this.video.isReady()&&this.video.start()},onMomentPassed:function(e,t){this.$dialog.attr("data-moment-current",t.n),a===t.n&&r.count("interface elements","Aviary promo popup","video subtitles","filters")},onPlayStart:function(){this.$dialog.attr("data-moment-current",0),this.$dialog.removeClass("b-dialog-promo-editor_finished"),this.$dialog.addClass("b-dialog-promo-editor_playing")},onPlayingFinish:function(){this.$dialog.removeClass("b-dialog-promo-editor_playing"),this.$dialog.addClass("b-dialog-promo-editor_finished"),ns.events.trigger("dialog-promo-editor-finish-screen-show")},onFinishScreenShow:function(){r.count("interface elements","Aviary promo popup","play again","show")},onVideoReady:function(){this.$dialog.addClass("b-dialog-promo-editor_ready")}}})},{environment:8,"helpers/metrika":17,"helpers/page":19,"nanoblocks/video/video":189,underscore:2}],225:[function(e){e("nanoblocks/video/video");var t=e("underscore"),n=e("environment"),r=e("helpers/metrika");e("helpers/page");var s="iOS"===n.agent.OSFamily;ns.View.define("dialogPromoExport",{events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide","dialog-promo-export-finish-screen-show@show":"onFinishScreenShow","click .js-replay":"onReplayClick","click .js-x-close":"onXCloseClick"},methods:{onhtmlinit:function(){this.$dialog=this.$node.find(".dialog-promo-export"),this.video=nb.block(this.node.querySelector(".js-video")),t.bindAll(this,"onMomentPassed","onPlayStart","onPlayingFinish","onVideoReady"),this.video.on("nb-video:passed",this.onMomentPassed),this.video.on("nb-video:start",this.onPlayStart),this.video.on("nb-video:finish",this.onPlayingFinish),this.video.on("nb-video:ready",this.onVideoReady),s&&this.video.setReady()},onhtmldestroy:function(){this.video.off("nb-video:passed",this.onMomentPassed),this.video.off("nb-video:start",this.onPlayStart),this.video.off("nb-video:finish",this.onPlayingFinish),this.video.off("nb-video:ready",this.onVideoReady),this.video.destroy()},onshow:function(){r.count("interface elements","Export promo popup","show")},onhide:function(){this.video.finish()},onReplayClick:function(){r.count("interface elements","Export promo popup","play again","click"),this.play()},onXCloseClick:function(){r.count("interface elements","Export promo popup","x-close","click")},play:function(){this.video.isReady()&&this.video.start()},onMomentPassed:function(e,t){this.$dialog.data("moment-current",t.n),1===t.n?r.count("interface elements","Export promo popup","show half video"):2===t.n?this.$dialog.addClass("dialog-promo-export_gray"):3==t.n&&this.$dialog.addClass("dialog-promo-export_finished")},onPlayStart:function(){this.$dialog.data("moment-current",0),this.$dialog.removeClass("dialog-promo-export_finished")
},onPlayingFinish:function(){this.$dialog.addClass("dialog-promo-export_finished"),this.$dialog.removeClass("dialog-promo-export_gray"),ns.events.trigger("dialog-promo-export-finish-screen-show")},onFinishScreenShow:function(){r.count("interface elements","Export promo popup","play again","show")},onVideoReady:function(){this.$dialog.removeClass("dialog-promo-export_unready"),this.play()}}})},{environment:8,"helpers/metrika":17,"helpers/page":19,"nanoblocks/video/video":189,underscore:2}],226:[function(e){e("models/confirmation/confirmation");var t=e("helpers/metrika");ns.View.define("dialogRefreshTokenSocial",{models:["confirmation"],events:{"ns-view-htmlinit":"oninit","click .js-cancel":"cancel","click .js-request":"requestRights"},methods:{oninit:function(){t.count("interface elements","dialog social token expired","show")},cancel:function(){this.models.confirmation.reject(),t.count("interface elements","dialog social token expired","cancel")},requestRights:function(){var e=this.models.confirmation,n=ns.action.run("ufo-broker.bind-social",{scenario:e.get(".scenario"),service:e.get(".service")});t.count("interface elements","dialog social token expired","ok"),n.then(e.confirm.bind(e))}}})},{"helpers/metrika":17,"models/confirmation/confirmation":50}],227:[function(e){e("models/settings/settings");var t=e("helpers/path"),n=e("helpers/page");e("helpers/metrika"),ns.View.define("dialogSlice",{models:["settings"],events:{"ns-view-show":"onshow","click .js-dialog-close":"close"},methods:{onshow:function(){var e=this.params.idContext;this.nameSlice="/yavideo"===e||t.isParent("/yavideo",e)?"yavideo":"",this.timeDisplayed=Date.now()},close:function(){"yavideo"===this.nameSlice&&this.models.settings.save({key:"timestampDisplayedDialogYavideo",value:this.timeDisplayed}),n.update()}}})},{"helpers/metrika":17,"helpers/page":19,"helpers/path":20,"models/settings/settings":153}],228:[function(e){function t(e){var t=$(e);t.wrap("<form />").parent().get(0).reset(),t.unwrap()}e("models/operations/operations-upload"),e("views/item-upload/item-upload-file"),e("views/item-upload/item-upload-folder"),e("views/item-upload/item-upload-done");var n=e("underscore"),r=e("helpers/page"),s=e("helpers/metrika"),a="b-dialog-upload_complete";ns.ViewCollection.define("dialogUpload",{models:{operationsUpload:{"ns-model-insert":r.update,"ns-model-remove":"onUploadRemoved"}},split:{intoViews:function(e){return"operationUploadFolder"===e.id?"itemUploadFolder":"resourceUploaded"===e.id?"itemUploadDone":"itemUploadFile"},byModel:"operationsUpload"},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-show":"onshow","ns-view-hide":"onhide","ufo-dialog-close@show":"onclose","change .js-choose-file":"onFileChosen","click .js-cross":"onCrossClicked","click .js-hide":"onHideClicked","click .js-cancel-all":"cancelAll","scroll .js-content":"hidePopupShare"},methods:{onhtmlinit:function(){n.bindAll(this,"onUploadChanged"),this.title=this.$node.find(".js-title")},onshow:function(){this.models.operationsUpload.on("ns-model-changed",this.onUploadChanged),this.hideIfEmpty(),this.toggleClassComplete(),ns.action.run("popup.close")},onhide:function(){this.models.operationsUpload.off("ns-model-changed",this.onUploadChanged),this.hidePopupShare()},onclose:function(){this.models.operationsUpload.isComplete()&&this.models.operationsUpload.destroyAll()},onUploadRemoved:function(){this.hideIfEmpty(),r.update()},onUploadChanged:function(e,t){t&&t.model&&this.toggleClassComplete(),this.keepValid()},hidePopupShare:function(){ns.action.run("popup.close")},onFileChosen:function(e){ns.action.run("resource.upload",{files:e.target.files}),s.count("actions","uploading","start upload","via add files button"),t(e.target)},onCrossClicked:function(){this.models.operationsUpload.isComplete()||s.count("actions","uploading","hide upload dialog","hide upload dialog")},onHideClicked:function(){this.models.operationsUpload.isComplete()||s.count("actions","uploading","hide upload dialog","close button")},hideIfEmpty:function(){this.models.operationsUpload.isEmpty()&&ns.action.run("dialog.close")},toggleClassComplete:function(){var e=this.models.operationsUpload.isComplete();if(e!==this.isUploadComplete){this.isUploadComplete=e;var t="Загрузка";this.isUploadComplete&&!this.models.operationsUpload.isAllFailed()&&(t="Загрузка завершена"),this.title.text(t),this.$node.toggleClass(a,this.isUploadComplete)}},cancelAll:function(){s.count("actions","uploading","cancel all uploads"),this.models.operationsUpload.cancelAll()}}})},{"helpers/metrika":17,"helpers/page":19,"models/operations/operations-upload":106,underscore:2,"views/item-upload/item-upload-done":252,"views/item-upload/item-upload-file":253,"views/item-upload/item-upload-folder":254}],229:[function(e){e("models/settings/settings"),e("models/user-current/user-current");var t=e("helpers/page"),n=e("helpers/metrika");ns.View.define("dialogWelcome",{models:["settings","userCurrent"],events:{"ns-view-show":"onshow","ns-view-hide":"onhide","ns-view-htmldestroy":"onhtmldestroy","click .js-dialog-close":"close"},methods:{onshow:function(){this.timeDisplayed=Date.now(),n.hooks.execute(this,"show")},onhide:function(){this.models.settings.save({key:"timestampLastDisplayedDialogWelcome",value:this.timeDisplayed}),this.models.settings.save({key:"countDisplaysDialogWelcome",value:parseInt(this.models.settings.get(".countDisplaysDialogWelcome"),10)+1})},onhtmldestroy:function(){n.hooks.drop(this)},close:function(){this.models.settings.set(".wasDialogClosed",!0),t.update()}}})},{"helpers/metrika":17,"helpers/page":19,"models/settings/settings":153,"models/user-current/user-current":177}],230:[function(e){var t=e("helpers/metrika"),n=e("helpers/page");ns.View.define("dropzoneSmall",{events:{"click .js-dropzone":"onDropzoneClick","change .js-button-upload":"selectFile"},methods:{onDropzoneClick:function(){$(this.node).find(".js-button-upload").click()},selectFile:function(e){var r={files:e.target.files};ns.action.run("resource.upload",r,this.node,e),$(e.target).val(null),t.count("actions","uploading","start upload","via click to dropzone"),n.go(n.getUrlBase()+"|upload")}}})},{"helpers/metrika":17,"helpers/page":19}],231:[function(e){function t(e){return r.isFunction(e.getAsEntry)?e.getAsEntry():r.isFunction(e.webkitGetAsEntry)?e.webkitGetAsEntry():void 0}function n(e){return e&&e.isDirectory}var r=e("underscore"),s=e("helpers/page"),a=e("helpers/metrika");ns.View.define("dropzone",{events:{"dragleave .nb-dropzone":"close","drop .nb-dropzone":"dropFile","click .nb-dropzone":"close"},methods:{close:function(e){e.stopPropagation(),s.go(s.getUrlBase())},dropFile:function(e){e.preventDefault(),e.stopPropagation();var i=e.originalEvent.dataTransfer;if(Modernizr.folderupload&&i.items){var o=r.partition(r.map(i.items,t),n);ns.action.run("resource.upload",{folders:o[0],files:o[1]}),a.count("tech","dropzone data transfer key","items")}else i.files?(ns.action.run("resource.upload",{files:i.files}),a.count("tech","dropzone data transfer key","files")):(ns.action.run("resource.upload",{files:[{error:"unsupported"}]}),a.count("tech","dropzone data transfer key","unsupported"));var c="/disk"===ns.page.current.params.idContext?"via drop to root":"via drop to folder";a.count("actions","uploading","start upload",c),s.go(s.getUrlBase()+"|upload")}}})},{"helpers/metrika":17,"helpers/page":19,underscore:2}],232:[function(e){e("models/resource/resource");var t=e("views/view-fetch");t.define("fetchResourceContext",{models:["resource"],rewriteParamsOnInit:function(e){return{id:e.idContext}}})},{"models/resource/resource":133,"views/view-fetch":305}],233:[function(e){e("models/resource/resource");var t=e("views/view-fetch");t.define("fetchResource",{models:["resource"],rewriteParamsOnInit:function(e){return{id:e.idDialog}}})},{"models/resource/resource":133,"views/view-fetch":305}],234:[function(e){e("models/resources/resources");var t=e("views/view-fetch");t.define("fetchResources",{models:["resources"]})},{"models/resources/resources":147,"views/view-fetch":305}],235:[function(e){e("models/video-info/video-info");var t=e("views/view-fetch");t.define("fetchVideoInfo",{models:["videoInfo"],rewriteParamsOnInit:function(e){return{id:e.idDialog}}})},{"models/video-info/video-info":180,"views/view-fetch":305}],236:[function(){ns.View.define("footer",{})},{}],237:[function(e){e("models/user-current/user-current"),e("models/resource/resource"),e("models/invites/state-form-invite-folder"),e("models/contacts/contacts"),e("models/users/users-folder");var t=e("underscore"),n=e("helpers/email"),r=e("helpers/metrika");ns.View.define("formInviteFolder",{models:{resource:{"ns-model-changed":"keepValid"},stateFormInviteFolder:{"ns-model-changed":function(e,t){t||this.invalidate()}},contacts:"updateSuggest"},"params+":{id:null},rewriteParamsOnInit:function(e){return{id:e.idDialog}},events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","submit .js-form":"submit"},methods:{oninit:function(){this.models.stateFormInviteFolder.setDataDefault()},onhtmlinit:function(){t.bindAll(this,"handleChangeRights","onTypeSuggest","onSelectSuggest","submit");var e=$(this.node).find(".js-form-invite-folder-rights")[0];e&&(this.nbRights=nb.block(e),this.nbRights.on("nb-changed",this.handleChangeRights)),this.nbSuggest=nb.block($(this.node).find(".js-form-input")[0]),this.nbSuggest.on("nb-type",this.onTypeSuggest),this.nbSuggest.on("nb-select",this.onSelectSuggest),this.$input=$(this.node).find(".js-form-input"),this.$text=$(this.node).find(".js-form-text"),this.updateSuggest();var n=$(this.node).find(".js-form-button")[0];n&&(this.nbButton=nb.block(n)),nb.init(this.node),this.models.contacts.load(),this.$node.on(ns.V.EVENTS.click,".js-form-button",this.submit)},onhtmldestroy:function(){this.nodeRights&&this.nbRights.off("nb-changed",this.handleChangeRights)},handleChangeRights:function(){var e=this.nbRights.getState(),t=parseInt(e.value,10);this.models.stateFormInviteFolder.set(".rights",t)},onTypeSuggest:function(){this.resetError(),this.resetState(),this.selectFromSuggest=!1;var e=this.nbSuggest.getValue();if(e){var t=this.models.contacts.get('.contacts[.nameEncoded == "'+encodeURIComponent(e)+'"]');t?this.trySetState(t[0].userid,t[0].service||"email"):n.isEmail(e)&&this.trySetState(e,"email")}},trySetState:function(e,t){if("email"===t)if(ns.Model.get("userCurrent").isEmailAlias(e))this.setError("Невозможно пригласить себя"),this.nbButton.disable();else{var n=ns.Model.get("usersFolder",{idFolder:this.params.id,gidFolder:this.models.resource.get(".meta.group.gid")}).getByEmail(e);n&&n.isApproved()?(this.setError("Уже является участником папки"),this.nbButton.disable()):this.setState(e,t)}else this.setState(e,t)},setState:function(e,t){this.models.stateFormInviteFolder.set(".userid",e),this.models.stateFormInviteFolder.set(".service",t),this.nbButton.enable()},resetState:function(){this.models.stateFormInviteFolder.set(".userid",null),this.models.stateFormInviteFolder.set(".service",null),this.nbButton.disable()},onSelectSuggest:function(){var e=this.nbSuggest.getSelected();this.selectFromSuggest=!0,this.trySetState(e.userid,e.service)},submit:function(e){e.preventDefault(),this.nbButton.isEnabled()&&(this.nbSuggest.close(),this.models.resource.get(".meta.group")||r.count("actions","shared folders","share folder (first invite)",640==this.models.stateFormInviteFolder.get(".rights")?"ro":"rw"),this.selectFromSuggest?r.count("actions","shared folders","invite user","contact from suggest",this.models.stateFormInviteFolder.get(".service")):r.count("actions","shared folders","invite user","direct email"),ns.action.run("form-invite-folder.invite",{id:this.params.id}))},updateSuggest:function(){this.nbSuggest.setOption({source:this.models.contacts.formatSuggest()})},setError:function(e){this.$input.addClass("b-input_invite-error"),this.$text.text(e),this.$text.addClass("b-form-text_error"),this.models.stateFormInviteFolder.set(".error",{massage:e})},resetError:function(){this.$input.hasClass("b-input_invite-error")&&(this.$input.removeClass("b-input_invite-error"),this.$text.removeClass("b-form-text_error"),this.models.stateFormInviteFolder.set(".error",null))}}})},{"helpers/email":13,"helpers/metrika":17,"models/contacts/contacts":52,"models/invites/state-form-invite-folder":70,"models/resource/resource":133,"models/user-current/user-current":177,"models/users/users-folder":179,underscore:2}],238:[function(e){e("models/space/offers-space-paid"),e("models/payment/state-form-payment"),e("models/payment/methods-payment");var t=e("underscore"),n=e("helpers/page"),r=e("helpers/metrika");ns.View.define("formPayment",{models:["offersSpacePaid","stateFormPayment","methodsPayment"],events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","change .js-method":"onChangeMethod","click .js-offer-space":"onChangeOfferSpace","click .js-form-button":"submit"},methods:{oninit:function(){this.models.stateFormPayment.isValid()||this.models.stateFormPayment.setDataDefault()},onhtmlinit:function(){t.bindAll(this,"onChangeRepeat"),nb.init(this.node);var e=this.node.querySelector(".js-form-button");e&&(this.nbButton=nb.block(e));var r=this.node.querySelector(".js-popup-error");r&&(this.nbPopup=nb.block(r),this.nbPopup.open({where:e}));var s=this.node.querySelector(".js-repeat");s&&(this.nbCheckbox=nb.block(s),this.nbCheckbox.on("nb-changed",this.onChangeRepeat)),this.models.stateFormPayment.on("ns-model-changed",n.update)},onhtmldestroy:function(){this.models.stateFormPayment.off("ns-model-changed",n.update),"error"===this.models.stateFormPayment.get(".status")&&this.models.stateFormPayment.set(".status",""),this.nbCheckbox&&this.nbCheckbox.off("nb-changed",this.onChangeRepeat)},onChangeMethod:function(e){this.models.stateFormPayment.setMethod(e.target.value)},onChangeRepeat:function(){this.models.stateFormPayment.setRepeat(this.nbCheckbox.isChecked())},onChangeOfferSpace:function(e){var t=$(e.currentTarget).data("offer-space")||e.currentTarget.getAttribute("value");this.models.stateFormPayment.get(".idOfferSpace")!=t&&(this.models.stateFormPayment.set(".idOfferSpace",t),n.go("/payment/"+t))},submit:function(){this.nbButton.isEnabled()&&(this.models.stateFormPayment.set(".status","progressing"),this.nbButton.disable(),r.reach("PAY-CLICK"),r.count("interface elements","payment page","pay"),ns.action.run("payment.pay"))}}})},{"helpers/metrika":17,"helpers/page":19,"models/payment/methods-payment":111,"models/payment/state-form-payment":112,"models/space/offers-space-paid":159,underscore:2}],239:[function(e){var t=e("helpers/page"),n=e("environment"),r="form-search-ufo-query-search.changed";ns.View.define("formSearch",{rewriteParamsOnInit:function(e){return e.scopeSearch?{scopeSearch:e.scopeSearch}:"/trash"===e.idContext||"/mail"===e.idContext?{scopeSearch:e.idContext}:{scopeSearch:"/disk"}},"params+":{scopeSearch:null},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-touch":"ontouch","submit .js-search":"search","mousedown .js-button-submit":"search","mousedown .js-clear":"clearInput"},methods:{onhtmlinit:function(){var e=this.node.querySelector(".js-query"),t=this.node.querySelector(".js-button-submit");this.input=$(e),this.nbInput=nb.block(e),this.nbButtonSubmit=nb.block(t),this.buttonClear=$(this.node.querySelector(".js-clear")),this.buttonClear.hide(),this.nbButtonSubmit.disable(),this.input.on("propertychange input",this.updateStateButtons.bind(this)),n.agent.isMobile&&this.input.on("focus",function(){setTimeout(function(){window.scrollTo(0,0),$(".nb-layer_type_fixed").css("position","absolute")},0)}),this.on(r,this.onQuerySearchChanged)},onhtmldestroy:function(){this.input.off(),this.off(r,this.onQuerySearchChanged)},ontouch:function(){var e=ns.page.current.params.querySearch;(e!==this._querySearch||this._querySearch!==encodeURIComponent(this.nbInput.getValue()))&&(this._querySearch=e,this.trigger(r))},search:function(e){var n=this.input.val();n?ns.action.run("app.search",{querySearch:n,scopeSearch:this.params.scopeSearch,from:"formSearch"}):t.go("/client"+this.params.scopeSearch),e.preventDefault()},updateStateButtons:function(){this.nbInput.getValue().length>0?(this.buttonClear.show(),this.nbButtonSubmit.enable()):(this.buttonClear.hide(),this.nbButtonSubmit.disable())},onQuerySearchChanged:function(){if(this.nbInput){var e=this._querySearch?decodeURIComponent(this._querySearch):"";this.nbInput.setValue(e)}this.updateStateButtons()},clearInput:function(){this.nbInput.setValue(""),this.updateStateButtons()}}})},{environment:8,"helpers/page":19}],240:[function(e){e("models/user-current/user-current"),e("models/services/services-header"),ns.View.define("header",{models:["userCurrent","servicesHeader"]})},{"models/services/services-header":150,"models/user-current/user-current":177}],241:[function(e){var t=e("helpers/metrika");ns.View.define("hintSearchAction",{models:["resources"],events:{"ns-view-show":"onshow"},methods:{onshow:function(){t.count("about search","search","hint links","show")}}})},{"helpers/metrika":17}],242:[function(e){e("models/resources/resources"),ns.View.define("hintSearchQuery",{models:["resources"]})},{"models/resources/resources":147}],243:[function(e){e("models/resources/resources"),ns.View.define("hintSearchScopeDisk",{models:["resources"],rewriteParamsOnInit:function(e){return e.scopeSearch="/disk",e}})},{"models/resources/resources":147}],244:[function(e){e("models/resources/resources"),ns.View.define("hintSearchScopeMail",{models:["resources"],rewriteParamsOnInit:function(e){return e.scopeSearch="/mail",e}})},{"models/resources/resources":147}],245:[function(e){e("models/resources/resources"),ns.View.define("hintSearchScopeTrash",{models:["resources"],rewriteParamsOnInit:function(e){return e.scopeSearch="/trash",e}})},{"models/resources/resources":147}],246:[function(e){e("models/space/space");var t=e("helpers/page");ns.View.define("infoSpace",{models:["space"],events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy"},methods:{onhtmlinit:function(){this.models.space.on("ns-model-changed",t.update)},onhtmldestroy:function(){this.models.space.off("ns-model-changed",t.update)}}})},{"helpers/page":19,"models/space/space":163}],247:[function(e){e("models/invitees/invitee"),e("views/page-invites/page-invites"),ns.View.define("invitee",{models:["invitee"],events:{"mouseenter .js-head":"showInvitePopup","mousedown .js-head":no["false"],"mouseleave .js-head":"hideInvitePopup"}},"pageInvites")},{"models/invitees/invitee":58,"views/page-invites/page-invites":265}],248:[function(e){e("models/invitees/invitees-folder/invitee-folder"),e("models/invitees/invitees-folder/state-invitee-folder"),e("models/operation/operation-access-folder"),e("underscore");var t=e("helpers/page");e("helpers/operation"),e("helpers/metrika"),ns.View.define("inviteeFolder",{models:["inviteeFolder","stateInviteeFolder"],events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy"},rewriteParamsOnInit:function(e){return e.idFolder=e.idDialog,e},methods:{oninit:function(){ns.Model.get("stateInviteeFolder",this.params).setDataDefault()},onhtmlinit:function(){this.models.stateInviteeFolder.on("ns-model-changed",t.update)},onhtmldestroy:function(){this.models.stateInviteeFolder.off("ns-model-changed",t.update);var e=this.node.querySelector(".js-user-folder-rights");if(e){var n=nb.find(e);n&&n.destroy()}}}})},{"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"models/invitees/invitees-folder/invitee-folder":59,"models/invitees/invitees-folder/state-invitee-folder":62,"models/operation/operation-access-folder":78,underscore:2}],249:[function(e){e("models/invitees/invitees-folder/invitees-folder"),e("views/invitees/invitees-folder/invitee-folder");var t=e("underscore"),n=e("helpers/page"),r=e("helpers/metrika"),s=e("helpers/format"),a=e("consts");ns.ViewCollection.define("inviteesFolder",{models:["inviteesFolder"],rewriteParamsOnInit:function(e){return e.idFolder=e.idDialog,e},split:{intoViews:"inviteeFolder",byModel:"inviteesFolder"},events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow"},methods:{oninit:function(){this.models.inviteesFolder.isValid()||this.models.inviteesFolder.setDataDefault(),this.countShowOnce=t.once(this.countShow)},onhtmlinit:function(){t.bindAll(this,"toggleAbookEmpty"),this.models.inviteesFolder.on("ns-model-insert",this.toggleAbookEmpty),this.models.inviteesFolder.on("ns-model-insert",n.update),this.models.inviteesFolder.on("ns-model-changed",n.update),this.$node.find(".ns-view-container-desc").scrollTop(0)},onhtmldestroy:function(){this.models.inviteesFolder.off("ns-model-insert",this.toggleAbookEmpty),this.models.inviteesFolder.off("ns-model-insert",n.update),this.models.inviteesFolder.off("ns-model-changed",n.update)},onshow:function(){var e=this.models.inviteesFolder.get(".status");"loadingContacts"===e?this._timeLoadingStart=Date.now():"loaded"===e&&this.countShowOnce(),this.toggleAbookEmpty()},countShow:function(){var e,t;r.count("interface elements","folder access dialog","show",this.models.inviteesFolder.isEmpty()?"empty":"filled"),this._timeLoadingStart&&(e=this.models.inviteesFolder.models.length,t=s.numberToInterval(e,a.INTERVALS_COUNT_CONTACTS),r.count("tech","count contacts",t),r.count("tech","invite folder dialog","contacts list load time",Date.now()-this._timeLoadingStart),delete this._timeLoadingStart)},toggleAbookEmpty:function(){var e=this.models.inviteesFolder;"loaded"==e.get(".status")&&this.$node.find(".js-abook-empty").toggleClass("_hidden",!e.isEmpty())}}})},{consts:7,"helpers/format":14,"helpers/metrika":17,"helpers/page":19,"models/invitees/invitees-folder/invitees-folder":60,underscore:2,"views/invitees/invitees-folder/invitee-folder":248}],250:[function(e){e("models/invitees/invitees"),e("views/invitees/invitee"),ns.ViewCollection.define("invitees",{models:["invitees"],split:{intoViews:"invitee",byModel:"invitees"}})},{"models/invitees/invitees":63,"views/invitees/invitee":247}],251:[function(e){e("models/invites/invites-folder"),e("views/resource/resource"),ns.ViewCollection.define("invites",{models:["invitesFolder"],split:{intoViews:"resource",byModel:"invitesFolder"}})},{"models/invites/invites-folder":68,"views/resource/resource":280}],252:[function(e){e("models/resource/resource"),e("models/resource-uploaded/resource-uploaded"),e("models/rights-social/rights-social"),e("models/operation/operation-publish"),e("nanoblocks/share/share");var t=e("environment"),n=e("underscore"),r=e("helpers/page"),s=e("helpers/metrika"),a=e("helpers/operation");e("nanoblocks/popup-share/popup-share"),ns.View.define("itemUploadDone",{models:{resourceUploaded:!0,resource:{"ns-model-changed":function(e,t){".state.publishing"!==t&&(this.invalidate(),r.update())}}},events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","click .js-resource-public-link":"selectPublicLink","click .js-open-dialog-export":function(){s.count("actions","social export","single export","show dialog","from upload"),ns.action.run("export-social.dialog-open",{idsResources:[this.models.resource.get(".id")]})}},methods:{oninit:function(){n.bindAll(this,"onCopyToClipboard","selectPublicLink"),this.requestRightsSocial=n.once(this.requestRightsSocial)},onhtmlinit:function(){nb.init(this.node),this.nbTogglerPublish=nb.block(this.node.querySelector(".js-toggler-publish")),this.nbTogglerPublish.on("nb-changed",this.publishResource.bind(this)),this.requestRightsSocial();var e=this.node.querySelector(".js-popup-share");e&&(this.popupShare=nb.block(e),this.popupShare.on("nb-copied",this.onCopyToClipboard),this.popupShare.on("nb-opened",this.selectPublicLink));var t=this.node.querySelector(".js-resource-public-link");t&&(this.inputPublic=nb.block(t))},onhtmldestroy:function(){this.nbTogglerPublish.destroy(),this.popuShare&&this.popupShare.destroy(),this.inputPublic&&this.inputPublic.destroy(),delete this.inputPublic,delete this.popupShare,delete this.nbTogglerPublish},publishResource:function(){a.create("publish",{idSrc:this.params.id,reverse:this.models.resource.get(".meta.public")})},requestRightsSocial:function(){var e=ns.Model.get("rightsSocial",{scenario:"photos_export"});this.models.resource.get(".isExportable")&&!e.isValid()&&e.fetch()},onCopyToClipboard:function(){s.count("actions","with resources","public links","copy link","upload",this.models.resource.get(".type")),r.update()},selectPublicLink:function(){t.agent.isMobile||(s.count("actions","with resources","public links","link sharing attempt","click on link",this.models.resource.get(".type")),this.inputPublic.focus(),this.inputPublic.node.select())}}})},{environment:8,"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"models/operation/operation-publish":94,"models/resource-uploaded/resource-uploaded":123,"models/resource/resource":133,"models/rights-social/rights-social":148,"nanoblocks/popup-share/popup-share":183,"nanoblocks/share/share":187,underscore:2}],253:[function(e){e("models/operation/operation-upload"),e("models/operation/operation-upload-flash"),e("nanoblocks/share/share"),e("environment");var t=e("underscore"),n=e("helpers/page"),r=e("helpers/metrika"),s="flash"===Modernizr.uploader?"operationUploadFlash":"operationUpload",a=500;ns.View.define("itemUploadFile",{models:t.object([[s,"onOperationChange"]]),events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-destroy":"onhtmldestroy","mousedown .js-cancel":"cancel","click .js-replace":"replace","click .js-retry":"retry"},methods:{oninit:function(){this.updateProgressbar=t.throttle(this.updateProgressbar,a,{leading:!1})},onhtmlinit:function(){this.progressbar=this.node.querySelector(".js-progressbar"),this._prevProgress=0},onhtmldestroy:function(){delete this._prevProgress},onOperationChange:function(e,t){".total"===t||".progress"===t?this.updateProgressbar():(this.invalidate(),n.update())},getModelOperation:function(){return this.models[s]},getTypeResource:t.constant("file"),cancel:function(){var e=this.getModelOperation();r.count("actions","uploading","cancel upload",this.getTypeResource()),this._prevProgress=0,e.cancel()},replace:function(){r.count("actions","uploading","change file"),this.getModelOperation().force()},retry:function(){this._prevProgress=0,this.getModelOperation().restart()},updateProgressbar:function(){var e=+this.getModelOperation().get(".progress");e<this._prevProgress||(this.progressbar.style.width=(e||this._prevProgress)+"%",this._prevProgress=e)}}})},{environment:8,"helpers/metrika":17,"helpers/page":19,"models/operation/operation-upload":104,"models/operation/operation-upload-flash":102,"nanoblocks/share/share":187,underscore:2}],254:[function(e){e("models/operation/operation-upload-folder"),e("views/item-upload/item-upload-file");var t=e("underscore"),n=e("helpers/metrika"),r="b-item-upload_renaming";ns.View.define("itemUploadFolder",{models:{operationUploadFolder:"onOperationChange"},events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","mousedown .js-cancel":"cancel","click .js-retry":"retry","click .js-merge":"merge","click .js-show-form-rename":"showFormRename","input .js-input":"onNameInput","submit .js-form-rename":"rename"},methods:{getModelOperation:function(){return this.models.operationUploadFolder},getTypeResource:t.constant("folder"),merge:function(){n.count("actions","uploading","merge with existing directory"),this.getModelOperation().merge()},showFormRename:function(){this.$node.addClass(r)},rename:function(e){var t=this.node.querySelector(".js-input").value;""!==t&&(this.getModelOperation().renameDst(t),this.$node.removeClass(r),n.count("actions","uploading","rename directory to avoid conflict")),e.preventDefault()},onNameInput:function(e){var t=nb.block(this.node.querySelector(".js-save"));""!==e.target.value?t.enable():t.disable()}}},"itemUploadFile")},{"helpers/metrika":17,"models/operation/operation-upload-folder":103,underscore:2,"views/item-upload/item-upload-file":253}],255:[function(){ns.View.define("layoutErrors")},{}],256:[function(e){function t(e){return function(t){if(t.type.match(/^drag|drop/)){var s=no.jpath(".originalEvent.dataTransfer.types",t),a="Firefox"===n.agent.BrowserName?"application/x-moz-file":"Files";if(!s||s.indexOf&&-1===s.indexOf("Files")||s.contains&&!s.contains(a))return!1}var i=ns.page.current.params;if(r.isSearch(i))return!1;var o=ns.Model.getValid("resource",{id:i.idContext});return e(!!o&&o.allowsUpload())}}e("models/resource/resource"),e("models/states-context/states-context");var n=e("environment"),r=e("helpers/page"),s=e("underscore");ns.View.define("layoutPanels",{events:{"ns-view-htmlinit":"onhtmlinit","dragenter@show window":"dragEnter","dragover@show window":"dragOver","drop@show window":"onUpload","ns-view-touch":"ontouch"},methods:{onhtmlinit:function(){nb.init(this.node),ns.events.on("ufo-layers-update",this.updateLayout.bind(this))},ontouch:function(){if(ns.page.current.params.idContext){var e=ns.Model.get("statesContext",ns.page.current.params),t=!e.get(".selected").length;t!==this._state&&(this.$node.toggleClass("b-layout-panels_contracted",!t),this._state=t)}},dragEnter:t(function(e){return e?(r.go(r.getUrlBase()+"|dropzone"),!1):void 0}),onUpload:t(function(e){return e?void 0:(ns.action.run("resource.upload-denied"),!1)}),dragOver:function(e){e.preventDefault(),e.stopPropagation()},updateLayout:function(e,t,n){if(n=n||{},"stickies"===t){var r=this.$node.attr("class"),a=r.split(" "),i=s.filter(a,function(e){return/^b-layout-panels_contains_invites/.test(e)}).join(" ");this.$node.removeClass(i),this.$node.addClass("b-layout-panels_contains_invites-"+n.count)}else"linkImportSocial"===t&&("show"===n.event&&this.$node.addClass("b-layout-panels_contains_link-import-social"),"hide"===n.event&&this.$node.removeClass("b-layout-panels_contains_link-import-social"))}}})},{environment:8,"helpers/page":19,"models/resource/resource":133,"models/states-context/states-context":171,underscore:2}],257:[function(e){e("models/resources/resources");var t=e("models/user-current/user-current");ns.View.define("linkImportSocial",{models:["userCurrent","resources"],rewriteParamsOnInit:function(){return{sort:"name",order:"1",idContext:t.get(".foldersDefault.social")}},events:{"ns-view-show":"onshow","ns-view-async":"onshow","ns-view-hide":"onhide","click .b-link-import-social__link":"onClick"},methods:{onshow:function(){ns.events.trigger("ufo-layers-update",this.id,{event:"show"})},onhide:function(){ns.events.trigger("ufo-layers-update",this.id,{event:"hide"})},onClick:function(){this.node.querySelector(".js-button").blur()}}})},{"models/resources/resources":147,"models/user-current/user-current":177}],258:[function(e){e("models/resource/resource"),e("models/states-context/states-context"),e("models/operation/operation-rename");var t=e("underscore"),n=e("helpers/page");e("helpers/operation");var r=e("consts"),s=e("helpers/metrika");ns.View.define("listing",{"params+":{idContext:null,sort:null,order:null,view:null,querySearch:null,scopeSearch:null,typeSearch:null},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide"},methods:{onhtmlinit:function(){t.bindAll(this,"onKeyup","syncWithStates"),this.statesContext=ns.Model.get("statesContext",this.params),this.syncWithStates(),this.statesContext.on("ns-model-changed.view",n.update),this.statesContext.on("ns-model-changed.selected",this.syncWithStates),this.statesContext.on("ns-model-changed.dragging",this.syncWithStates)},onhtmldestroy:function(){this.statesContext.off("ns-model-changed.view",n.update),this.statesContext.off("ns-model-changed.selected",this.syncWithStates),this.statesContext.off("ns-model-changed.dragging",this.syncWithStates),s.hooks.drop(this),delete this.statesContext
},syncWithStates:function(){this.updateModeSelect(),this.updateModeDragging()},onshow:function(){this._$window.on("keyup",this.onKeyup),s.hooks.execute(this,"show")},onhide:function(){this._$window.off("keyup",this.onKeyup)},updateModeSelect:function(){this.$node.removeClass("b-listing_multiselect"),this.$node.removeClass("b-listing_singleselect");var e=this.statesContext.getModeSelection();"single"===e?this.$node.addClass("b-listing_singleselect"):"multi"===e&&this.$node.addClass("b-listing_multiselect")},updateModeDragging:function(){var e=this.statesContext.get(".dragging");this.$node.toggleClass("b-listing_dragging",e&&e.length>1)},onKeyup:function(e){if(!ns.page.current.params.dialog)switch(e.keyCode){case r.KEYS.ESC:s.count("interface elements","listing","deselect all","escape hotkey"),this.statesContext.deselectAll()}}}})},{consts:7,"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"models/operation/operation-rename":98,"models/resource/resource":133,"models/states-context/states-context":171,underscore:2}],259:[function(e){e("models/resources/resources");var t=e("underscore");ns.View.define("loaderPortion",{models:["resources"],events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","scroll@show window":"tryFetchNext"},methods:{onhtmlinit:function(){t.bindAll(this,"loadingStart","loadingFinish"),this.models.resources.on("ns-model-loading-start",this.loadingStart),this.models.resources.on("ns-model-loading-finish",this.loadingFinish),this.tryFetchNext()},onhtmldestroy:function(){this.models.resources.off("ns-model-loading-start",this.loadingStart),this.models.resources.off("ns-model-loading-finish",this.loadingFinish)},loadingStart:function(){this.$node.addClass("b-loader-portion_loading")},loadingFinish:function(){this.$node.removeClass("b-loader-portion_loading")},tryFetchNext:t.throttle(function(){this._$window.scrollTop()+this._$window.height()>this._$document.height()-350&&this.models.resources.fetchNext()},300)}})},{"models/resources/resources":147,underscore:2}],260:[function(e){e("models/resource/resource"),ns.View.define("locationResource",{models:["resource"],rewriteParamsOnInit:function(e){return{id:e.selected[0]}}})},{"models/resource/resource":133}],261:[function(){ns.View.define("notFound")},{}],262:[function(e){function t(e){return $(ns.renderNode({notification:e.getData()},"notification"))}e("models/queues/queue-notifications");var n=e("helpers/metrika");ns.View.define("notifications",{models:{queueNotifications:{"ns-model-changed":"keepValid"}},events:{"ns-view-init":function(){this.models.queueNotifications.on("processing",this.add.bind(this))},"ns-view-show":"updateWidth",click:"closeNext",mouseover:"stopTimer",mouseout:"startTimer"},methods:{timeClose:5e3,timeMove:400,add:function(e,r){var s=r.item,a=r.promise,i=t(s);if(!i.text())return a.fulfill(),void 0;n.count("notifications","operation "+s.get(".operation"),s.get(".status"));var o=function(){i.html(t(s).html()).find(".js-message").css("width",""),this.updateWidth()}.bind(this);s.on("ns-model-changed",o),a.always(s.off.bind(s,"ns-model-changed",o)),this.$node.append(i),setTimeout(function(){i.addClass("b-notification_moved"),this.updateWidth()}.bind(this),100),this.promises=this.promises||[],this.promises.unshift(a),this.timer||this.startTimer()},updateWidth:function(){var e=this.getChildren(),t=this.getChildNext(),n=t.children(".b-notification__text").width();e.width(n)},closeNext:function(){var e=this.getChildNext();e.removeClass("b-notification_moved"),this.updateWidth(),e.length?setTimeout(function(){e.remove(),this.startTimer(),this.promises.pop().fulfill()}.bind(this),this.timeMove):this.stopTimer()},getChildren:function(){var e=$(this.node),t=e.children(".b-notification_moved");return t},getChildNext:function(){var e=this.getChildren();return e.eq(0)},startTimer:function(){this.timer&&this.stopTimer(),this.timer=setTimeout(function(){this.closeNext()}.bind(this),this.timeClose)},stopTimer:function(){clearTimeout(this.timer),this.timer=null}}})},{"helpers/metrika":17,"models/queues/queue-notifications":118}],263:[function(){ns.View.define("pageError",{events:{"click .js-page-reload":"reload"},methods:{reload:function(){window.location.reload()}}})},{}],264:[function(e){function t(e){return s.create("importSocial",{service:e})}e("models/resources/resources"),e("models/rights-social/rights-social"),e("models/operation/operation-import-social");var n=e("underscore"),r=e("helpers/page"),s=e("helpers/operation"),a=e("helpers/metrika"),i=e("models/user-current/user-current").get(".foldersDefault.social"),o="b-import-social_hidden",c="b-import-social_slide-out";ns.View.define("pageImportSocial",{models:["userCurrent","resources"],events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-show":"onshow","ns-view-htmldestroy":"onhtmldestroy","click .js-import-social-button":"startImport"},rewriteParamsOnInit:function(e){return e.idContext=i,e},methods:{oninit:function(){this.rightsSocial=ns.Model.get("rightsSocial",{scenario:"photos_import"}),this.rightsSocial.fetch()},_hideNode:function(){if(ns.page.current.params.idContext===i){var e=this.$node.find(".js-slide"),t=this.$node.find(".js-footer");this.$node.addClass(c),e.css({transform:"translateY(-"+(e.height()-t.height())+"px)"})}else this.$node.addClass(o)},_showNode:function(){this.$node.removeClass(o).removeClass(c).find(".js-slide").css({transform:""})},onhtmlinit:function(){this.models.resources.on("ns-model-changed",r.update)},onhtmldestroy:function(){this.models.resources.off("ns-model-changed",r.update)},onshow:function(){a.count("interface elements","import page","show")},startImport:function(e){var r=$(e.currentTarget).data("service"),s=n.partial(t,r);a.reach("start_import"),this.rightsSocial.isAuthorized(r)?s():ns.action.run("ufo-broker.bind-social",{scenario:"photos_import",service:r}).then(s)}}})},{"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"models/operation/operation-import-social":88,"models/resources/resources":147,"models/rights-social/rights-social":148,"models/user-current/user-current":177,underscore:2}],265:[function(e){!function(t){function n(e){return"email"===e.service}e("models/operation/operation-invite-disk"),e("models/queues/queue-notifications"),e("models/contacts/contacts"),e("models/invitees/link-invite"),e("models/rights-social/rights-social");var r,s,a=e("underscore"),i=e("zeroclipboard"),o=e("swfobject"),c=e("environment"),l=e("config").links.static.host,d=e("helpers/page"),u=e("helpers/email"),p=e("helpers/operation"),f=e("helpers/metrika"),h=500,m={moviePath:l+"/disk/www/_/CeTtulIj3g0peuK81ZoRUtT0Iqk.swf",trustedOrigins:location.protocol+"//"+location.host,allowScriptAccess:"always",hoverClass:"b-sharing-invites__button-copy-link_hover",activeClass:"b-sharing-invites__button-copy-link_active",debug:!1};t.ZeroClipboard=i,ns.View.define("pageInvites",{models:{contacts:{"ns-model-changed":"keepValid"},invitees:{},linkInvite:{}},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","mouseenter .js-head-empty":"showInvitePopup","mousedown .js-head-empty":no["false"],"mouseleave .js-head-empty":"hideInvitePopup","click .js-link-copy":"linkSelect","click .js-send-invite":"send"},methods:{onhtmlinit:function(){a.bindAll(this,"updateSuggestSource","onSuggestType","onSuggestSelect","onSendingFinish","send"),this.buttonSend=nb.block(this.node.querySelector(".js-send-invite")),this.suggest=nb.block(this.node.querySelector(".js-suggest")),this.suggest.on("nb-type",this.onSuggestType),this.suggest.on("nb-select",this.onSuggestSelect),this.suggest.on("nb-keypress-enter",this.send);var e=this.$node.find(".js-button-copy");o.hasFlashPlayerVersion("10.0.0")?(this._zc=new i(e,m),this._zc.on("complete",this.onClipboardCopy)):e.addClass("_hidden"),this.models.invitees.on("ns-model-changed",d.update),this.models.contacts.on("ns-model-changed",this.updateSuggestSource),this.updateSuggestSource(),this.models.contacts.load(),this.checkErrors();var t=ns.Model.get("rightsSocial",{scenario:"invite"});t.isValid()||t.fetch()},onhtmldestroy:function(){this.suggest.off("nb-type",this.onSuggestType),this.suggest.off("nb-select",this.onSuggestSelect),this.suggest.off("nb-keypress-enter",this.send),this._zc&&(this._zc.off("complete",this.onClipboardCopy),delete this._zc),this.models.invitees.off("ns-model-changed",d.update),this.models.contacts.off("ns-model-changed",this.updateSuggestSource)},checkErrors:function(){this.hasErrorFatalModels(this.models.invitees)&&(d.go("/client/error","preserve"),this.models.invitees.invalidate())},onshow:function(){d.scrollToTop(),f.count("interface elements","invites","show")},linkSelect:function(e){c.agent.isMobile&&e.currentTarget&&e.currentTarget.select(),f.count("interface elements","invites","link sharing attempt","click on link")},updateSuggestSource:function(){this.suggest.setSource(a.filter(this.models.contacts.formatSuggest(),n))},onSuggestType:function(){this.selectFromSuggest=!1,this.validateEmail(this.suggest.getValue())},onSuggestSelect:function(){var e=this.suggest.getSelected();this.selectFromSuggest=!0,this.validateEmail(e&&e.value)},validateEmail:function(e){var t=u.isEmail(e);this._userid=t?e:null,t?this.buttonSend.enable():this.buttonSend.disable()},send:function(){this._userid&&(this.onSendingStart(),this.operation=p.create("inviteDisk",{service:"email",userid:this._userid}),this.operation.on("status.done",this.onSendingFinish),this.operation.on("status.failed",this.onSendingFinish))},onSendingStart:function(){f.count("interface elements","invites","invite via email"),f.count("actions","invite user to Disk",this.selectFromSuggest?"email from suggest":"direct email"),this.buttonSend.disable(),this.suggest.disable()},onSendingFinish:function(){this.operation.off("status.done",this.onSendingFinish),this.operation.off("status.failed",this.onSendingFinish),delete this.operation,this.suggest.enable(),this.suggest.setValue("")},showInvitePopup:function(e){var t=Date.now();clearTimeout(r),r=setTimeout(function(){var t=$(e.currentTarget),n=nb.find(t.data("popup"));n&&n.open({where:e.currentTarget})},Math.max(0,h-(t-s))),s=t},hideInvitePopup:function(){clearTimeout(r),nb.trigger("popup-close")},onClipboardCopy:function(){f.count("interface elements","invites","link sharing attempt","copy link"),ns.Model.get("queueNotifications").add({action:"copyLinkInviteDisk"}),d.update()}}})}.call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{config:6,environment:8,"helpers/email":13,"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"models/contacts/contacts":52,"models/invitees/link-invite":64,"models/operation/operation-invite-disk":89,"models/queues/queue-notifications":118,"models/rights-social/rights-social":148,swfobject:190,underscore:2,zeroclipboard:3}],266:[function(e){e("models/payment/state-form-payment");var t=e("helpers/page"),n=e("helpers/metrika");ns.View.define("pagePayment",{events:{"ns-view-hide":"onhide","ns-view-show":"onshow"},methods:{onhide:function(){var e=ns.Model.get("stateFormPayment");e.reset()},onshow:function(){t.scrollToTop(),n.count("interface elements","payment page","show")}}})},{"helpers/metrika":17,"helpers/page":19,"models/payment/state-form-payment":112}],267:[function(e){e("models/space/offers-space-paid"),e("models/payment/state-form-payment");var t=e("helpers/page"),n=e("helpers/metrika");ns.View.define("pageTuning",{models:["offersSpacePaid"],events:{"ns-view-init":"oninit","ns-view-show":"onshow","ns-view-htmlinit":"onhtmlinit"},methods:{oninit:function(){ns.Model.get("stateFormPayment").setDataDefault()},onshow:function(){n.reach("SHOW-TUNING"),n.count("interface elements","tuning page","show"),n.count("interface elements","tuning page","chargeable space (payable)","show"),t.scrollToTop()},onhtmlinit:function(){this.checkErrors()},checkErrors:function(){this.hasErrorFatalModels(this.models.offersSpacePaid)&&(t.go("/client/error","preserve"),this.models.offersSpacePaid.invalidate())}}})},{"helpers/metrika":17,"helpers/page":19,"models/payment/state-form-payment":112,"models/space/offers-space-paid":159}],268:[function(e){e("models/space/space"),e("underscore");var t=e("helpers/page"),t=e("helpers/page");ns.View.define("tuningSpace",{models:["space"],events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy"},methods:{onhtmlinit:function(){this.models.space.on("ns-model-changed",t.update),this.checkErrors()},onhtmldestroy:function(){this.models.space.off("ns-model-changed",t.update)},checkErrors:function(){this.hasErrorFatalModels(this.models.space)&&(t.go("/client/error","preserve"),this.models.space.invalidate())}}})},{"helpers/page":19,"models/space/space":163,underscore:2}],269:[function(){ns.View.define("contentDualPane")},{}],270:[function(){ns.View.define("contentSearch")},{}],271:[function(){ns.View.define("contentSinglePane")},{}],272:[function(e){e("models/photostream/photostream-group"),e("views/resource/resource");var t=e("helpers/page");ns.ViewCollection.define("photostreamGroup",{models:["photostreamGroup"],split:{intoViews:"resource",byModel:"photostreamGroup"},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy"},methods:{onhtmlinit:function(){this.models.photostreamGroup.on("ns-model-insert",t.update),this.models.photostreamGroup.on("ns-model-remove",t.update)},onhtmldestroy:function(){this.models.photostreamGroup.off("ns-model-insert",t.update),this.models.photostreamGroup.off("ns-model-remove",t.update)}}})},{"helpers/page":19,"models/photostream/photostream-group":113,"views/resource/resource":280}],273:[function(e){e("models/photostream/photostream"),e("views/photostream/photostream-group");var t=e("helpers/page");ns.ViewCollection.define("photostream",{models:["photostream"],split:{intoViews:"photostreamGroup",byModel:"photostream"},events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy"},methods:{oninit:function(){ns.Model.get("photostream",{idContext:this.params.idContext}).setDataDefault()},onhtmlinit:function(){this.models.photostream.on("ns-model-insert",t.update),this.models.photostream.on("ns-model-remove",t.update)},onhtmldestroy:function(){this.models.photostream.off("ns-model-insert",t.update),this.models.photostream.off("ns-model-remove",t.update)}}})},{"helpers/page":19,"models/photostream/photostream":114,"views/photostream/photostream-group":272}],274:[function(e){function t(){var e=s.links.pathVideoPlayerFlash;if(l)return Vow.fulfill(l);var t=new Vow.Promise;return $.ajax({type:"GET",url:e+"/info",data:{ns:Math.random()},dataType:"jsonp",jsonpCallback:"getInfo"}).then(function(n){l=[e,"/v-",n.version,"/disk-videoplayer.swf"].join(""),t.fulfill(l)},t.reject),t}e("models/resource/resource"),e("models/video-info/video-info"),e("models/state-resource/state-resource");var n=e("underscore"),r=e("swfobject"),s=e("config"),a=e("environment"),i=e("helpers/transform"),o=e("helpers/metrika"),c="9.0.0";ns.View.define("playerVideoFlv",{models:{resource:"keepValid",videoInfo:"keepValid",stateResource:"keepValid"},rewriteParamsOnInit:function(e){return{idContext:e.idContext,id:e.idDialog}},events:{"ns-view-init":"oninit","ns-view-show":"onshow","ns-view-hide":"onhide","resize@show window":"onresize"},methods:{oninit:function(){ns.Model.getValid("stateResource",this.params)||ns.Model.get("stateResource",this.params).setDataDefault()},onshow:function(){this.idNode=this.$node.find(".js-container-player").attr("id"),this.insertPlayer(),this.countShow()},countShow:function(){o.count("interface elements","video","show","streaming")},onhide:function(){this.destroyPlayer()},onresize:n.debounce(function(){this.resizePlayer.apply(this,this.getDimensionsScaled())},200),insertPlayer:function(){var e=this.models.videoInfo,n={"stream-slb-url-prefix":e.get(".host"),"stream-id":e.get(".stid"),lang:a.session.locale};this.models.stateResource.get(".autoplay")&&(n.autoplay="true",this.models.stateResource.set(".autoplay",!1));var s=this.models.resource.get('.meta.sizes[.name == "L"].url');s&&(n["preview-url"]=encodeURIComponent(s[0])),t().then(function(e){var t=this.getDimensionsScaled();r.embedSWF(e,this.idNode,t[0],t[1],c,null,n,{allowScriptAccess:"always",allowfullscreen:"true",hasPriority:"true",wmode:"opaque"},{"class":"b-player-container__object"})}.bind(this))},destroyPlayer:function(){var e=$("#"+this.idNode),t=$("<div />",{"class":"js-container-player"}).insertAfter(e);e.remove(),t.attr("id",this.idNode)},resizePlayer:function(e,t){$("#"+this.idNode).attr({width:e,height:t})},getDimensionsScaled:function(){var e=this.models.videoInfo;return i.scaleDimensionsToArea([e.get(".dimension.width"),e.get(".dimension.height")],[this.$node.width(),this.$node.height()])}}});var l},{config:6,environment:8,"helpers/metrika":17,"helpers/transform":28,"models/resource/resource":133,"models/state-resource/state-resource":169,"models/video-info/video-info":180,swfobject:190,underscore:2}],275:[function(e){e("models/video-info/video-info"),e("models/state-resource/state-resource"),e("views/player-video-container/player-video-flv");var t=e("underscore"),n=e("config"),r=e("environment"),s=e("helpers/path"),a=e("helpers/metrika");ns.View.define("playerVideoYandex",{models:{videoInfo:"keepValid",stateResource:"keepValid"},rewriteParamsOnInit:function(e){return{idContext:e.idContext,id:e.idDialog}},events:{"ns-view-init":"oninit","ns-view-show":"onshow","ns-view-hide":"onhide","resize@show window":"onresize"},methods:{countShow:function(){a.count("interface elements","video","show","yandex-video")},insertPlayer:function(){var e=this.models.videoInfo,t=this.getDimensionsScaled(),a=[n.domains.video,"/iframe/",e.get(".yandexVideo.login"),"/",e.get(".yandexVideo.storageDir"),"/","?hidden=about,share&lang=",r.session.locale],i=e.get(".stid");i&&a.push("&stream-id=",encodeURIComponent(i));var o=e.get(".yandexVideo.videodiskToken");o&&a.push(encodeURIComponent(";"+o)),this.models.stateResource.get(".autoplay")&&(a.push("&autoplay=true"),this.models.stateResource.set(".autoplay",!1)),s.isParent("/yavideo",this.params.id)&&a.push("&player-type=full"),$("#"+this.idNode).replaceWith($("<iframe />",{id:this.idNode,"class":"b-player-container__object",src:a.join(""),width:t[0],height:t[1],frameborder:0}))},resizePlayer:function(e,n){var r=$("#"+this.idNode),s={width:e,height:n};r.attr(t.extend({style:""},s)),r[0].contentWindow&&r[0].contentWindow.postMessage?r[0].contentWindow.postMessage({size:s},"*"):this.insertPlayer()}}},"playerVideoFlv")},{config:6,environment:8,"helpers/metrika":17,"helpers/path":20,"models/state-resource/state-resource":169,"models/video-info/video-info":180,underscore:2,"views/player-video-container/player-video-flv":274}],276:[function(e){e("models/resource/resource"),e("models/video-info/video-info"),e("models/state-player-video/state-player-video"),e("models/state-resource/state-resource");var t=e("underscore"),n=e("screenfull"),r=e("environment"),s=e("helpers/transform"),a=e("helpers/metrika");n.onchange=ns.events.trigger.bind(ns.events,"fullscreen-changed");var i=t.compose(e("helpers/format").secondsToTime,Math.floor.bind(Math)),o=$(window),c=[0,90,180,270],l="b-player-video__controls_show",d=2e3,u="iOS"===r.agent.OSFamily;ns.View.define("playerVideoHtml",{models:{resource:"onChangedResource",videoInfo:"invalidate",stateResource:"keepValid"},rewriteParamsOnInit:function(e){return{idContext:e.idContext,id:e.idDialog}},events:{"ns-view-init":"oninit","ns-view-show":"onshow","ns-view-hide":"onhide","fullscreen-changed@show":"renderFullscreen","click .js-video-area":"start","click .js-toggle":"toggle","click .js-fullscreen":"toggleFullscreen","click .js-rotate":"rotate","resize@show window":"fit"},methods:{onChangedResource:function(e,t){".state.publishing"!==t&&this.invalidate()},oninit:function(){ns.Model.getValid("stateResource",this.params)||ns.Model.get("stateResource",this.params).setDataDefault()},onshow:function(){t.bindAll(this,"renderTime","renderBuffered","renderFullscreen","renderRotation","renderStopped","updateQuality","updateSource"),this.state=ns.Model.get("statePlayerVideo",{host:this.models.videoInfo.get(".host"),stid:this.models.videoInfo.get(".stid")}).setDataDefault();var e=this.$node;this.$el=e.find(".js-video-el"),this.$time=e.find(".js-video-time"),this.$buffered=e.find(".js-video-buffered"),this.$controls=e.find(".js-video-controls"),this.$area=e.find(".js-video-area"),this.el=this.$el.get(0),this._ready=$.Deferred(),this.onReady=t.once(function(){this.renderReady(),this.play()}),this.$track=e.find(".js-seek").slider({range:"min",step:.03,start:this.onSeekStart.bind(this),stop:this.onSeekStop.bind(this),max:this.models.videoInfo.get(".duration")}),this.$volume=e.find(".js-volume").slider({range:"min",stop:this.onVolumeChange.bind(this)});var n=e.find(".js-video-quality");n.length&&(this.quality=nb.block(n.get(0)),this.quality.on("nb-changed",this.updateQuality)),this.$el.on("play pause",this.renderStatus.bind(this)).on("ended",this.stop.bind(this)).on("volumechange",this.renderVolume.bind(this)),this.fit(),this.renderVolume(),this.$area.on("mousemove",this.showControls.bind(this)),this.state.on("ns-model-changed.url",this.updateSource),this.state.on("ns-model-changed.rotate",this.renderRotation),this.state.on("ns-model-changed.start",this.renderTime),this.state.on("ns-model-changed.stopped",this.renderStopped),this._checkAutoplay(),u&&this.state.fetchUrl(),this.countShow()},countShow:function(){a.count("interface elements","video","show","streaming")},onhide:function(){this.pause(),this.el.removeAttribute("src"),this.$track.slider("destroy"),this.$volume.slider("destroy"),this.quality&&this.quality.off("nb-changed",this.updateQuality),this.$el.off(),this.$area.off(),this.state.off("ns-model-changed.url",this.updateSource),this.state.off("ns-model-changed.rotate",this.renderRotation),this.state.off("ns-model-changed.start",this.renderTime),this.state.off("ns-model-changed.stopped",this.renderStopped),this.invalidate()},start:function(){"resolved"===this._ready.state()?this.onReady():this.state.fetchUrl().then(this.onReady.bind(this))},updateSource:function(){this.el.setAttribute("src",this.state.get(".url")),this.el.load(),this._ready.fulfill()},updateQuality:function(){var e=this.quality.getState(),t=this,n=!this.el.paused;return this.state.fetchUrl(Math.floor(this.state.get(".start")+this.el.currentTime),parseInt(e.value,10)).then(function(){n&&t.play()}),this.pause()},showControls:t.debounce(function(){var e=this.$controls;e.addClass(l),clearTimeout(this._inactive),this._inactive=setTimeout(function(){e.removeClass(l)},d)},30),renderStatus:function(){this.$node.toggleClass("b-player-video_paused",this.el.paused)},renderTime:function(e){var n=this.models.videoInfo.get(".duration"),r=this.el.paused;n>0&&(t.isNumber(e)||(e=this.state.get(".start")+(this.el.currentTime||0)),this._seeking||r||this.$track.slider("option","value",e),this.$time.text(i(e)+"/"+i(n)))},renderBuffered:function(){if(1===this.el.buffered.length){var e=this.models.videoInfo,t=100*((this.el.buffered.end(0)+this.state.get(".start"))/e.get(".duration"));this.$buffered.css("right",100-t+"%")}},renderVolume:function(){this.$volume.slider("option","value",100*this.el.volume)},renderFullscreen:function(){this.$node.toggleClass("b-player-video_fullscreen",n.isFullscreen),n.isFullscreen||o.trigger("resize")},renderRotation:function(){var e=this.state.get(".rotate");this.$el.attr("data-rotate",c[e%c.length])},renderStopped:function(){this.state.get(".stopped")?(this.$track.slider("option","value",0),this.$buffered.css("right","100%"),this.renderTime(0),this.showControls()):this.seek(0)},renderReady:function(){this.$node.addClass("b-player-video_ready")},toggle:function(){return this.el.paused?this.play():this.pause()},toggleFullscreen:function(){n.enabled&&n.toggle(this.node)},play:function(){return this.$el.on("timeupdate",this.renderTime).on("progress",this.renderBuffered),this.el.play(),this._renderTimeInterval=setInterval(this.renderTime,500),this.state.get(".stopped")&&this.state.set(".stopped",!1),this},pause:function(){return this.$el.off("timeupdate",this.renderTime),this.el.pause(),clearInterval(this._renderTimeInterval),this},stop:function(){return this.pause(),this.state.set(".stopped",!0),this.el.removeAttribute("src"),this},seek:function(e){var t=this,n=!this.el.paused;return this.pause(),this.$el.off("progress",this.renderBuffered),this.state.fetchUrl(Math.floor(e)).then(function(){n&&!u&&t.play()}),this},rotate:function(){this.state.set(".rotate",this.state.get(".rotate")+1)},onSeekStart:function(){this._seeking=!0},onSeekStop:function(e,t){this._seeking=!1,this.seek(t.value)},onVolumeChange:function(e,t){this.el.volume=t.value/100},fit:function(){var e=this.models.videoInfo,t=this.$node.parent(),n=s.scaleDimensionsToArea([e.get(".dimension.width"),e.get(".dimension.height")],[t.width(),t.height()]);this.$area.css({width:n[0]+"px",height:n[1]+"px"})},_checkAutoplay:t.debounce(function(){this.models.stateResource.get(".autoplay")&&(u||this.start(),this.models.stateResource.set(".autoplay",!1))},50)}})},{environment:8,"helpers/format":14,"helpers/metrika":17,"helpers/transform":28,"models/resource/resource":133,"models/state-player-video/state-player-video":168,"models/state-resource/state-resource":169,"models/video-info/video-info":180,screenfull:1,underscore:2}],277:[function(e){e("models/progress-group/progress-group");var t=e("helpers/page");ns.View.define("progressbarCommon",{models:{progressGroup:{"ns-model-changed":"onUpdateModels"}},methods:{onUpdateModels:function(){this.invalidate(),t.update()}}})},{"helpers/page":19,"models/progress-group/progress-group":116}],278:[function(e){e("models/operations/operations-upload");var t=e("underscore"),n=e("helpers/page"),r=e("helpers/metrika");ns.View.define("progressbarUpload",{models:{operationsUpload:!1},events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-show":"onshow","ns-view-hide":"onhide",mousedown:"showUpload",tap:"showUpload"},methods:{oninit:function(){t.bindAll(this,"onUpdateModels")},onhtmlinit:function(){this.$bar=this.$node.find(".js-progress")},onshow:function(){this.models.operationsUpload.on("ns-model-changed",this.onUpdateModels)},onhide:function(){this.models.operationsUpload.off("ns-model-changed",this.onUpdateModels),clearTimeout(this.timeoutComplete)},onUpdateModels:function(){var e=this.models.operationsUpload.getProgressOverall(),t=this.models.operationsUpload.isComplete();(this._progress!==e||t)&&(this.$bar.toggleClass("b-progressbar__fill_complete",t).toggleClass("b-progressbar__fill_animating",e>=this._progress).css("clip","rect(0 "+e/100*this.$node.width()+"px auto 0)"),this._progress=e,n.update()),t&&(this.timeoutComplete=setTimeout(function(){this.models.operationsUpload.isComplete()&&this.models.operationsUpload.destroyAll()}.bind(this),1e4))},showUpload:function(){r.count("actions","uploading","reopen upload dialog"),n.go([n.getUrlBase(),"|upload"].join(""))}}}),ns.View.define("progressbarUploadBack",{models:["operationsUpload"]}),ns.View.define("progressbarUploadFront",{models:["operationsUpload"]})},{"helpers/metrika":17,"helpers/page":19,"models/operations/operations-upload":106,underscore:2}],279:[function(){ns.View.define("progressbars")},{}],280:[function(e){var t=e("underscore"),n=e("environment"),r=e("helpers/page"),s=e("helpers/path"),a=e("helpers/operation"),i=e("helpers/metrika");e("models/user-current/user-current"),e("nanoblocks/resource/resource"),e("nanoblocks/icon-resource/icon-resource");var o={"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy",mousedown:"registerRightClick","dblclick .js-resource-checkbox":"stopPropagation"};o[ns.V.EVENTS.click]="select",ns.View.define("resource",{models:{resource:{"ns-model-changed":function(){this.invalidate(),r.update()}},stateResource:{"ns-model-changed.selected":function(){this.onSelected()},"ns-model-changed":function(){r.update()}},userCurrent:!0},events:o,methods:{oninit:function(){this.models.stateResource.isValid()||(ns.Model.get("stateResource",this.params).setDataDefault(),this.models.stateResource.syncSelected())},onhtmlinit:function(){this.isDraggable()&&this.initDragging(),this.isDroppable()&&this.initDropping(),nb.init(this.node),this.nbResource=nb.block(this.node.querySelector(".nb-resource")),(n.agent.isMobile||Modernizr.touch)&&this.nbResource.isSelected()&&this.replaceAttrsDblclick()},onhtmldestroy:function(){this.models.stateResource.get(".dragging")&&this.models.stateResource.resetDragging(),this.nodeDrag&&(this.nodeDrag.draggable("destroy"),this.nodeDrag=null),this.nodeDrop&&(this.nodeDrop.droppable("destroy"),this.nodeDrop=null)},registerRightClick:function(e){3===e.which&&i.count("interface elements","listing","right click on resource")},select:function(e){var t="_blank"===$(e.target).attr("target");if(t||e.preventDefault(),!this.models.stateResource.get(".dragging")&&!this.models.resource.get(".state.blocked")&&!this.models.resource.get(".state.part")){var n=$(e.target).is(".js-resource-checkbox"),r=-1!==navigator.platform.toLowerCase().indexOf("mac")?e.metaKey:e.ctrlKey;e.shiftKey?(i.count("interface elements","listing","select resources` group","with shift"),this.models.stateResource.selectRange()):r||n?(r&&i.count("interface elements","listing","select resources` group","with ctrl"),n&&i.count("interface elements","listing","select resources` group","via checkbox"),this.models.stateResource.toggleSelected()):this.models.stateResource.selectSingle()}},onSelected:function(){(n.agent.isMobile||Modernizr.touch)&&(this.nbResource.isSelected()?this.restoreAttrsDblclick():setTimeout(this.replaceAttrsDblclick.bind(this),0)),this.nbResource.toggleSelected()},replaceAttrsDblclick:function(){this.$node.attr("data-dblclick-action")&&(this.$node.attr("data-click-action",this.$node.attr("data-dblclick-action")),this.$node.attr("data-dblclick-action","stub")),this.$node.attr("data-metrika-dblclick")&&(this.$node.attr("data-metrika-click-replaced",this.$node.attr("data-metrika-click")),this.$node.attr("data-metrika-click",this.$node.attr("data-metrika-dblclick")),this.$node.removeAttr("data-metrika-dblclick"))},restoreAttrsDblclick:function(){this.$node.attr("data-dblclick-action")&&(this.$node.attr("data-dblclick-action",this.$node.attr("data-click-action")),this.$node.removeAttr("data-click-action")),this.$node.attr("data-metrika-click-replaced")&&(this.$node.attr("data-metrika-dblclick",this.$node.attr("data-metrika-click")),this.$node.attr("data-metrika-click",this.$node.attr("data-metrika-click-replaced")),this.$node.removeAttr("data-metrika-click-replaced"))},initDragging:function(){this.nodeDrag=this.$node.find(".b-resource"),this.nodeDrag.draggable({helper:this.createHelperDrag.bind(this),cursorAt:{left:20,top:60},zIndex:100,distance:5,scrollSensitivity:40,start:this.onDragStart.bind(this),stop:this.onDragStop.bind(this),refreshPositions:!0,containment:"document",drag:t.throttle(this.onDrag.bind(this),80)})},initDropping:function(){this.nodeDrop=this.$node.find(".b-resource"),this.nodeDrop.droppable({hoverClass:"_droppable",tolerance:"pointer",accept:this.dropAccepted.bind(this),drop:this.onDrop.bind(this)})},isDraggable:function(){var e=this.models.resource;if(!n.agent.isMobile){if(0!==this.params.idContext.indexOf("/disk"))return!1;var t=ns.Model.getValid("resource",{id:this.params.idContext});return!t||t.get(".meta.group.readonly")||t.get(".meta.group.in_readonly")?!1:e.get(".invite")||e.get(".state.blocked")||e.get(".state.part")?!1:"/trash"===e.get(".id")?!1:!0}},isDroppable:function(){return n.agent.isMobile?void 0:"dir"!==this.models.resource.get(".type")?!1:this.models.resource.get(".invite")||this.models.resource.get(".state.blocked")||this.models.resource.get(".state.part")?!1:this.models.resource.get(".meta.group.readonly")?!1:!0
},onDragStart:function(e,n){var r=ns.Model.getValid("statesContext",{idContext:this.params.idContext});r.dragging(t.map(n.helper.data("params").resources,function(e){return s.unescape(e.id)})),nb.init(n.helper),this.models.stateResource.get(".selected")||this.models.stateResource.selectSingle()},onDragStop:function(){ns.Model.getValid("statesContext",{idContext:this.params.idContext}).resetDraggingAll()},createHelperDrag:function(){var e,t=this.params.idContext,n=ns.Model.get("statesContext",{idContext:t});return e=this.models.stateResource.get(".selected")?n.get(".selected").map(function(e){var t=ns.Model.getValid("resource",{id:e});return t&&t.getData()}):[this.models.resource.getData()],ns.renderNode({"drag-params":{resources:e,idContext:t}},"resource-draggable")},dropAccepted:function(){return this.models.stateResource.get(".dragging")?!1:!0},onDrop:function(e,n){var r="move",o=this.models.resource.get(".id"),c=n.helper.data("params");"/trash"===o&&(r="delete");var l=t.map(c.resources,function(e){return{idSrc:s.unescape(e.id),idFolderDst:o}});if(c.resources.length>1)"delete"===r?i.count("actions","with resources","delete","d&d on Trash","group"):i.count("actions","with resources","move","d&d on subfolder","group");else{var d=ns.Model.getValid("resource",{id:s.unescape(c.resources[0].id)});"delete"===r?i.count("actions","with resources","delete","d&d on Trash",d.get(".type")):i.count("actions","with resources","move","d&d on subfolder",d.get(".type"))}return a.create(r,l)},onDrag:function(e,t){ns.events.trigger("ufo-dragging",t)},stopPropagation:function(e){e.stopPropagation()}}})},{environment:8,"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"helpers/path":20,"models/user-current/user-current":177,"nanoblocks/icon-resource/icon-resource":182,"nanoblocks/resource/resource":185,underscore:2}],281:[function(e){e("models/resources/resources"),e("models/resource/resource"),e("models/state-resource/state-resource"),e("views/resource/resource");var t=e("underscore"),n=e("helpers/path"),r=e("helpers/page");e("helpers/resource");var s=e("helpers/metrika"),a=e("helpers/statbox"),i=e("models/user-current/user-current");ns.ViewCollection.define("resources",{models:["resources"],split:{intoViews:"resource",byModel:"resources"},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide","ufo-context-changed":"scrollToTop","ns-view-touch":"updateDraggable","click .js-results-search":"countClicksSearch"},methods:{onhtmlinit:function(){t.bindAll(this,"onRename"),this.models.resources.on("created",r.update),this.models.resources.on("ns-model-insert",r.update),this.models.resources.on("ns-model-remove",r.update),this.models.resources.on("ns-model-changed.state.renaming",this.onRename),this.models.resources.on("ns-model-changed.state.hiddenChildren",r.update),this.handleIdDialog(),this.idRequest=i.get(".uid")+Date.now()},onhtmldestroy:function(){this.models.resources.off("created",r.update),this.models.resources.off("ns-model-insert",r.update),this.models.resources.off("ns-model-remove",r.update),this.models.resources.off("ns-model-changed.state.renaming",this.onRename),this.models.resources.off("ns-model-changed.state.hiddenChildren",r.update)},onshow:function(){this.models.resources.isSearchResult()&&(this._countClicksSearch=0)},onhide:function(){var e=this.models.resources;e.isSearchResult()&&(s.count("about search","search with "+this._countClicksSearch+" click(s)",e.isQueryCorrected()?"with typo":"without typo",e.params.scopeSearch,e.isEmpty()?"empty result":"not empty result"),delete this._countClicksSearch)},onRename:function(e,t){var n=function(){this.off("ns-view-touch",n),t.model&&t.model.get(t.data)&&this.scrollToItem(t.model.get(".id"))}.bind(this);this.on("ns-view-touch",n)},scrollTo:function(e){$("html, body").animate({scrollTop:e})},scrollToTop:function(){$("html, body").scrollTop()&&this.scrollTo(0)},scrollToItem:function(e){var t=this.getItem(e);if(t){var n=parseInt($(".nb-layer_type_fixed").css("padding-bottom"),10),r=parseInt($(".nb-layer_type_listing").css("padding-top"),10),s=t.$node.offset().top,a=t.$node.outerHeight(),i=this._$window.outerHeight(),o=this._$window.scrollTop(),c=s>o+r,l=i+o-n>s+a;if(c&&l)return;var d=s-r;this.scrollTo(d)}},handleIdDialog:function(){var e=ns.page.current.params.idDialog;e&&n.isParent(this.params.idContext,e)&&(this.selectItem(e),this.loadTillItem(e).then(function(){var t=function(){this.off("ns-view-touch",t),this.scrollToItem(e)};this.on("ns-view-touch",t)}.bind(this)))},loadTillItem:function(e){var t=new Vow.Promise,n=this,r=function(){var s=ns.Model.getValid("resource",{id:e});s&&n.models.resources.contains(s)?t.fulfill():n.models.resources.isComplete()?t.reject():n.models.resources.fetchNext().then(r,function(){t.reject()})};return r(),t},selectItem:function(e){var t=ns.Model.get("stateResource",{idContext:this.params.idContext,id:e});t.selectSingle()},getItem:function(e){var t={id:e,idContext:this.params.idContext};return this._getView("resource",t)},updateDraggable:function(){$.ui.ddmanager.current&&($.ui.ddmanager.current.document=$(document),$.ui.ddmanager.current._setContainment())},countClicksSearch:function(e){var n,r=this.models.resources,o=$(e.target).closest(".ns-view-resource"),c=decodeURIComponent(o.data("id")),l=t.find(r.models,function(e,t){return e.get(".id")===c?(n=t+1,!0):void 0});s.count("about search","click on result",r.isQueryCorrected()?"with typo":"without typo","click on #"+n,r.params.scopeSearch),a.count({dtype:"PS",project:"search_disk",r:encodeURIComponent(r.params.querySearch),pos:n,group:l.get(".meta.search_scope"),reqid:this.idRequest,user:i.get(".uid")}),this._countClicksSearch+=1}}})},{"helpers/metrika":17,"helpers/page":19,"helpers/path":20,"helpers/resource":22,"helpers/statbox":24,"models/resource/resource":133,"models/resources/resources":147,"models/state-resource/state-resource":169,"models/user-current/user-current":177,underscore:2,"views/resource/resource":280}],282:[function(e){e("models/confirmation/confirmation"),e("models/tree/tree"),e("models/tree/state-tree");var t=e("underscore"),n=e("consts");ns.View.define("select-folder",{models:["confirmation"],events:{"keyup@show window":"onkeyup","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","click .js-folders-cancel":"cancel","click .js-folders-accept":"accept"},methods:{onhtmlinit:function(){t.bindAll(this,"toggleAccept"),nb.trigger("popup-close"),this.buttonAccept=nb.block(this.node.querySelector(".js-folders-accept")),ns.Model.get("stateTree").on("ns-model-changed.selected",this.toggleAccept)},onhtmldestroy:function(){ns.Model.get("stateTree").off("ns-model-changed.selected",this.toggleAccept)},toggleAccept:function(){var e=ns.Model.get("stateTree").get(".selected");e?this.buttonAccept.enable():this.buttonAccept.disable()},accept:function(){var e=ns.Model.get("stateTree").get(".selected");e&&(this.models.confirmation.confirmAll(e),this.cleanup())},cancel:function(){this.models.confirmation.rejectAll(),this.cleanup()},onkeyup:function(e){e.keyCode===n.KEYS.ESC&&this.cancel()},cleanup:function(){ns.Model.get("stateTree").deselect(),ns.Model.get("tree",{id:"/disk"}).collapse()}}})},{consts:7,"models/confirmation/confirmation":50,"models/tree/state-tree":175,"models/tree/tree":176,underscore:2}],283:[function(e){e("models/slices/slices"),e("models/counter-mail/counter-mail");var t=e("helpers/page"),n=e("helpers/metrika");ns.View.define("sliceLinkMail",{models:["slices","counterMail"],events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","click .js-link-mail":"countClickLinkMail"},methods:{onhtmlinit:function(){this.models.counterMail.on("ns-model-changed",t.update)},onhtmldestroy:function(){this.models.counterMail.off("ns-model-changed",t.update)},countClickLinkMail:function(e){t.deferFollowLink(e,function(){n.count("go to mail")})}}})},{"helpers/metrika":17,"helpers/page":19,"models/counter-mail/counter-mail":56,"models/slices/slices":154}],284:[function(e){e("models/slices/slices"),e("models/invites/invites-folder"),e("underscore");var t=e("helpers/page");ns.View.define("sliceShared",{models:{slices:"invalidate",invitesFolder:{"ns-model-changed":"onUpdateModels","ns-model-remove":"onUpdateModels"}},"params+":{idContext:null},methods:{onUpdateModels:function(){this.invalidate(),t.update()}}})},{"helpers/page":19,"models/invites/invites-folder":68,"models/slices/slices":154,underscore:2}],285:[function(e){function t(e){e.hasClass("js-link-trash")&&e.toggleClass(i)}e("models/slices/slices");var n=e("underscore"),r=e("environment"),s=e("helpers/path"),a=e("helpers/operation"),i="b-slices-menu__item_hovered";ns.View.define("slices",{models:["slices"],"params+":{sliceActive:null},rewriteParamsOnInit:function(e){return e.idContext&&(e.sliceActive=ns.Model.getValid("slices").getIdSliceByContext(e.idContext)),e},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","click .js-slice":"onSliceClick"},methods:{onhtmlinit:function(){n.bindAll(this,"onSliceClick","onDrop","onPopupOpen","onPopupClose","onSlicesLoaded");var e=this.node.querySelector(".js-popup-toggler");e&&(this.toggler=nb.block(e)),this.toggler&&(this.popup=this.toggler.getPopup(),this.popup.$node.on("click",".js-slice",this.onSliceClick),this.popup.on("nb-opened",this.onPopupOpen),this.popup.on("nb-closed",this.onPopupClose),this.$toggler=$(e)),this.isDroppable()&&(this.$droppable=this.$node.find(".js-droppable"),this.$droppable.droppable({hoverClass:"b-slices-menu__item_droppable",tolerance:"pointer",over:this.onOver,out:this.onOut,drop:this.onDrop})),this.models.slices.on("ns-model-changed.loaded",this.onSlicesLoaded)},onhtmldestroy:function(){this.popup&&(this.popup.$node.off("click",".js-slice",this.onSliceClick),this.popup.off("nb-opened",this.onPopupOpen),this.popup.off("nb-closed",this.onPopupClose)),this.$droppable&&this.$droppable.droppable("destroy"),this.models.slices.off("ns-model-changed.loaded",this.onSlicesLoaded)},onSliceClick:function(e){this.popup&&this.popup.close();var t=$(e.currentTarget);if(!/^https?:/.test(t.attr("href"))){var n=t.data("params");return ns.action.run("listing.openFolder",n),!1}},onDrop:function(e,r){var i=$(e.target),o=r.helper.data("params"),c=i.data("params"),l=n.map(o.resources,function(e){return{idSrc:s.unescape(e.id)}});"/trash"===c.idContext&&(a.create("delete",l),t(i))},onOver:function(e){$.ui.ddmanager.current.element.draggable("option","scroll",!1),t($(e.target))},onOut:function(e){$.ui.ddmanager.current.element.draggable("option","scroll","document"),t($(e.target))},onPopupClose:function(){this.$toggler.removeClass(i)},onPopupOpen:function(){this.models.slices.fetch(),this.$toggler.addClass(i)},onSlicesLoaded:function(){var e=this.models.slices;this.popup&&this.popup.$node.find(".js-hidden").each(function(t,n){var r=$(n),s=r.data("id"),a=e.get('.slice[.id == "'+s+'"].hidden')[0];a||r.removeClass("js-hidden b-slices-menu__popup-item_hidden")})},isDroppable:function(){return!r.agent.isMobile}}})},{environment:8,"helpers/operation":18,"helpers/path":20,"models/slices/slices":154,underscore:2}],286:[function(e){e("models/resource/resource"),e("models/operation/operation-publish"),e("models/user-current/user-current"),e("models/rights-social/rights-social"),e("nanoblocks/share/share");var t=e("underscore");e("environment"),e("helpers/operation");var n=e("helpers/metrika"),r=e("helpers/page");ns.View.define("slider-bar",{models:{resource:{"ns-model-changed":function(e,t){".meta.public"===t&&(this._needToOpenPopupShare=this.models.resource.get(".meta.public")&&ns.page.current.params.dialog),this.invalidate()}},userCurrent:!0},rewriteParamsOnInit:function(e){return{id:e.idDialog}},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide","click .js-toggler-share":function(){var e=this.models.resource;n.count("interface elements","slider","publish",e.get(".meta.mediatype"),e.get(".icon")),n.count("actions","with resources","public links","publish","photoviewer",e.get(".type")),ns.action.run("resource.publish",{id:e.get(".idEncoded"),reverse:e.get(".meta.public")})},"click .js-delete":function(){var e=this.models.resource;n.count("interface elements","slider","delete",e.get(".meta.mediatype"),e.get(".icon")),n.count("actions","with resources","delete","photoviewer",e.get(".type")),ns.action.run("resource.delete",{id:e.get(".idEncoded")})},"click .js-open-dialog-export":function(){n.count("actions","social export","single export","show dialog","from slider"),ns.action.run("export-social.dialog-open",{idsResources:[this.models.resource.get(".id")]})}},methods:{onhtmlinit:function(){t.bindAll(this,"onCopyToClipboard"),this.requestRightsSocial(),nb.init(this.node);var e=this.node.querySelector(".js-popup-share");e&&(this.popupShare=nb.block(e),this.popupShare.on("nb-opened",this.onCopyToClipboard))},onhtmldestroy:function(){this.popupShare&&this.popupShare.destroy()},requestRightsSocial:function(){var e=ns.Model.get("rightsSocial",{scenario:"photos_export"});this.models.resource.get(".isExportable")&&!e.isValid()&&e.fetch()},onshow:function(){this._needToOpenPopupShare&&(this.popupShare&&this.popupShare.toggler.open(),this._needToOpenPopupShare=!1)},onhide:function(){this.popupShare&&this.popupShare.toggler.close()},onCopyToClipboard:function(){n.count("actions","with resources","public links","copy link","slider",this.models.resource.get(".type")),r.update()}}})},{environment:8,"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"models/operation/operation-publish":94,"models/resource/resource":133,"models/rights-social/rights-social":148,"models/user-current/user-current":177,"nanoblocks/share/share":187,underscore:2}],287:[function(e){e("models/resources/resources"),e("models/resource/resource"),e("models/state-cached/state-cached"),e("models/operation/operation-preload"),e("models/state-slider/state-slider"),e("nanoblocks/icon-resource/icon-resource");var t=e("underscore"),n=e("helpers/page"),r=e("helpers/operation"),s=e("helpers/metrika");e("helpers/resource"),ns.View.define("slider-item",{models:{resource:{"ns-model-changed":"keepValid"},stateCached:"invalidate"},rewriteParamsOnInit:function(e){return{id:e.idDialog}},events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide","click .js-docviewer":"onClickDocviewer"},methods:{oninit:function(){ns.Model.get("stateCached",this.params).setDataDefault(),this.stateSlider=ns.Model.get("stateSlider")},onhtmlinit:function(){t.bindAll(this,"preloadImage","updateImage"),this.models.stateCached.on("ns-model-changed",n.update),this.stateSlider.on("ns-model-changed",this.updateImage)},onshow:function(){this.preloadImage(),this.models.stateCached.on("ns-model-changed.cached",this.preloadImage)},onhide:function(){this.models.stateCached.off("ns-model-changed.cached",this.preloadImage)},onhtmldestroy:function(){this.models.stateCached.off("ns-model-changed",n.update),this.stateSlider.off("ns-model-changed",this.updateImage)},preloadImage:function(){this.models.stateCached.get(".cached")||r.create("preload",{resource:this.models.resource,fit:this.stateSlider.get(".viewport")})},onClickDocviewer:function(){var e=this.models.resource;ns.action.run("resource.view-docviewer",{name:e.get(".name"),id:e.get(".idEncoded")}),s.count("interface elements","slider","view in DV",e.get(".meta.mediatype"),e.get(".icon"))},updateImage:function(){this.models.resource.get(".hasPreview")&&"video"!==this.models.resource.get(".meta.mediatype")&&(this.invalidate(),n.update())}}})},{"helpers/metrika":17,"helpers/operation":18,"helpers/page":19,"helpers/resource":22,"models/operation/operation-preload":93,"models/resource/resource":133,"models/resources/resources":147,"models/state-cached/state-cached":165,"models/state-slider/state-slider":170,"nanoblocks/icon-resource/icon-resource":182,underscore:2}],288:[function(e){e("models/resource/resource"),e("models/state-resource/state-resource"),e("nanoblocks/resource/resource"),e("nanoblocks/icon-resource/icon-resource");var t=e("helpers/path"),n=e("helpers/page"),r=e("helpers/metrika");ns.View.define("slider-stream-item",{models:["resource","stateResource"],events:{"ns-view-htmlinit":"onhtmlinit",mousedown:"select",tap:"select"},methods:{onhtmlinit:function(){nb.init(this.node)},select:function(){return this.$node.hasClass("js-disabled")?void 0:(r.count("interface elements","slider","thumbnails","click to thumb"),n.go([n.getUrlBase(),"|slider",t.escape(this.params.id)].join("")))}}})},{"helpers/metrika":17,"helpers/page":19,"helpers/path":20,"models/resource/resource":133,"models/state-resource/state-resource":169,"nanoblocks/icon-resource/icon-resource":182,"nanoblocks/resource/resource":185}],289:[function(e){function t(e){return"file"===e.get(".type")}e("models/resources/resources"),e("models/state-resource/state-resource"),e("models/operation/operation-preload"),e("models/state-cached/state-cached"),e("views/slider/slider-stream-item");var n,r=e("underscore"),s=e("helpers/metrika"),a=e("helpers/operation"),i="slider-ufo-dialog-current.changed",o=200,c=300,l=5,d="b-slider__stream-arrow_disabled";ns.ViewCollection.define("slider-stream",{models:["resources"],events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow","ns-view-hide":"onhide","ns-view-touch":"ontouch","click .js-stream-prev":"prev","click .js-stream-next":"next"},split:{intoViews:"slider-stream-item",byModel:"resources"},methods:{onhtmlinit:function(){r.bindAll(this,"updateStreamArrows","tryFetchNext","onmousewheel","hideLoader","showLoader","removeLoader"),n||(n=this.$node.find(".js-slider-stream-item").outerWidth(!0)),this.$stream=this.$node.find(".js-stream"),this.$prev=this.$node.find(".js-stream-prev"),this.$next=this.$node.find(".js-stream-next"),this.models.resources.on("ns-model-loading-start",this.showLoader),this.models.resources.on("ns-model-loading-finish",this.hideLoader),this.models.resources.on("ns-model-loading-complete",this.removeLoader),this.on(i,this.updateSelectionItem),this.on(i,this.updateStream),this.on(i,this.updateStreamArrows),this.on(i,this.preloadImages)},onhtmldestroy:function(){this.models.resources.off("ns-model-loading-start",this.showLoader),this.models.resources.off("ns-model-loading-finish",this.hideLoader),this.models.resources.off("ns-model-loading-complete",this.removeLoader),this.off(i,this.updateSelectionItem),this.off(i,this.updateStream),this.off(i,this.updateStreamArrows),this.off(i,this.preloadImages)},onshow:function(){this.$stream.on("scroll",this.tryFetchNext),this.$stream.on("mousewheel",this.onmousewheel),this.updateStream(),this.updateStreamArrows()},onhide:function(){this.$stream.off("scroll",this.tryFetchNext),this.$stream.off("mousewheel",this.onmousewheel)},ontouch:function(){var e=ns.page.current.params.idDialog;e!==this._idDialogCurrent&&(this._idDialogCurrent=e,this.trigger(i))},onmousewheel:function(e){if(this.countScrollstart(),Math.abs(e.deltaX)>Math.abs(e.deltaY))var t=e.deltaX*e.deltaFactor;else var t=e.deltaY*e.deltaFactor;return e.currentTarget.scrollLeft-=t,e.preventDefault(),e.stopPropagation(),this.updateStreamArrows(),!1},tryFetchNext:r.debounce(function(){var e=this.$stream.find(".b-slider__stream-loader").position();e&&this.$stream.scrollLeft()+this.$stream.width()>e.left-100&&this.models.resources.fetchNext()},50),prev:function(){this.moveStream(-o)},next:function(){this.moveStream(o)},getItemOffset:function(e){var t=e.position().left,n=this.$stream.outerWidth(!0)+this.$node.find(".b-slider__overlay").width()-e.outerWidth(!0)-t;return{left:t,right:n,width:e.outerWidth(!0)}},isItemVisible:function(e){var t=this.getItemOffset(e);return t.left>=0&&t.right>=0},isFirstItemVisible:function(){var e=this.$stream.children(".js-slider-stream-item:visible").first();return e.length&&this.isItemVisible(e)},isLastItemVisible:function(){var e=this.$stream.children(".js-slider-stream-item:visible").last();return e.length&&this.isItemVisible(e)},updateStreamArrows:function(){this.$prev.toggleClass(d,this.isFirstItemVisible()),this.$next.toggleClass(d,this.isLastItemVisible())},updateStream:function(){var e=ns.page.current.params,t=this._getView("slider-stream-item",{id:e.idDialog,idContext:e.idContext});t&&t.$node&&this.fitStream(this.getItemOffset(t.$node))},fitStream:function(e){var t=e.width/1.2;return e.left-=t,e.right-=t,e.left<0?this.moveStream({right:Math.abs(e.left)}):e.right<0?this.moveStream({left:Math.abs(e.right)}):void 0},moveStream:function(e){r.isObject(e)&&(e.left&&(e=e.left),e.right&&(e=-e.right));var t=this.$stream.scrollLeft(),n=t+e;this.$stream.stop(!0,!0).animate({scrollLeft:n},c,this.updateStreamArrows)},hideLoader:function(){this.$stream.removeClass("b-slider__stream_loading")},showLoader:function(){this.$stream.addClass("b-slider__stream_loading")},removeLoader:function(){this.$stream.addClass("b-slider__stream_complete")},updateSelectionItem:function(){var e=ns.Model.get("stateResource",{id:this._idDialogCurrent,idContext:this.params.idContext});e.get(".selected")||e.selectSingle()},preloadImages:function(){var e=r.find(this.models.resources.models,function(e){return e.get(".id")===this._idDialogCurrent},this);if(e){var n=e.get(".id"),s=ns.Model.get("stateSlider"),i=a.initialize("preload",{resource:e,fit:s.get(".viewport")}),o=function(){i.off("status.done",o);var e=this.models.resources.getSiblingsOf(n,{take:l,filter:t});a.create("preload",r.map(e,function(e){return{resource:e}}))}.bind(this);i.on("status.done",o),i.run()}},countScrollstart:r.throttle(function(){s.count("interface elements","slider","thumbnails","scrollstart")},1e4)}})},{"helpers/metrika":17,"helpers/operation":18,"models/operation/operation-preload":93,"models/resources/resources":147,"models/state-cached/state-cached":165,"models/state-resource/state-resource":169,underscore:2,"views/slider/slider-stream-item":288}],290:[function(e){function t(e){return"file"===e.get(".type")&&!e.get(".state.hidden")&&!e.get(".state.part")&&!e.get(".state.blocked")}e("models/resources/resources"),e("models/state-slider/state-slider");var n=e("underscore"),r=e("helpers/page"),s=e("helpers/path"),a=e("helpers/metrika"),i=e("consts");ns.View.define("slider",{"params+":{idContext:null},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-show":"onshow","ns-view-hide":"onhide","keyup window":"onkeyup","click .js-slider-next":"next","click .js-slider-prev":"prev","click .js-close":"close","mouseenter .js-slider-bottom":"onThumbnailsMouseenter","mouseleave .js-slider-bottom":"onThumbnailsMouseleave","resize@show window":"changeStateSlider"},methods:{onhtmlinit:function(){n.bindAll(this,"toggleModeSingle","onSwipeLeft","onSwipeRight","onChangedResource"),this.resources=ns.Model.get("resources",ns.page.current.params),this.$arrows=this.$node.find(".js-slider-next, .js-slider-prev"),this.$viewport=this.$node.find(".js-slider-viewport"),this.stateSlider=ns.Model.get("stateSlider"),this.stateSlider.set(".viewport",this.calculateViewport())},onshow:function(){this.toggleModeSingle(),Modernizr.webkit&&this.$node.on("mousewheel",this.handleMouseWheel=this.getHandleMouseWheel().bind(this)),this.$arrows.on("swipeleft",this.onSwipeLeft),this.$arrows.on("swiperight",this.onSwipeRight),this.resources.on("ns-model-changed",this.onChangedResource),this.resources.on("ns-model-insert",this.toggleModeSingle),this.resources.on("ns-model-remove",this.toggleModeSingle);var e=ns.Model.getValid("resource",{id:ns.page.current.params.idDialog});if(e){var t=e.get(".meta.mediatype")||"unknown",n=e.get(".icon");a.count("interface elements","slider","open",t,n)}ns.action.run("popup.close")},onhide:function(){this.handleMouseWheel&&this.$node.off("mousewheel",this.handleMouseWheel),this.$arrows.off("swipeleft",this.onSwipeLeft),this.$arrows.off("swiperight",this.onSwipeRight),this.resources.off("ns-model-changed",this.onChangedResource),this.resources.off("ns-model-insert",this.toggleModeSingle),this.resources.off("ns-model-remove",this.toggleModeSingle)},close:function(){ns.action.run("dialog.close")},move:function(e){var a=ns.page.current.params,i=n.last(this.resources.getSiblingsOf(a.idDialog,{take:e,loop:!0,filter:t}));r.go([r.getUrlBase(),"|slider",s.escape(i.get(".id"))].join(""))},next:function(){this.move(1)},prev:function(){this.move(-1)},onkeyup:function(e){e.keyCode&&e.keyCode in o&&n.isFunction(this[o[e.keyCode]])&&(e.preventDefault(),this[o[e.keyCode]](e),e.keyCode===i.KEYS.ESC?a.count("interface elements","slider","close","esc hotkey"):e.keyCode===i.KEYS.RIGHT?a.count("interface elements","slider","next image","arrow button hotkey"):e.keyCode===i.KEYS.LEFT&&a.count("interface elements","slider","previous image","arrow button hotkey"))},getHandleMouseWheel:function(){var e,t=!0,n=45,r=800;return function(s){var a=s.wheelDeltaX||s.originalEvent.wheelDeltaX,i=a/n;t&&(i>1||-1>i)&&(-1>i?this.next():this.prev(),t=!1,e&&clearTimeout(e),e=setTimeout(function(){t=!0},r)),s.preventDefault(),s.stopPropagation()}},onThumbnailsMouseenter:function(){this._thumbsShown||this.isModeSingle()||(this._thumbsShown=!0,a.count("interface elements","slider","thumbnails","show"))},onThumbnailsMouseleave:function(){delete this._thumbsShown},onSwipeLeft:function(e){e.stopImmediatePropagation(),this.next()},onSwipeRight:function(e){e.stopImmediatePropagation(),this.prev()},isModeSingle:function(){return this._countResourcesVisible()<=1},onChangedResource:function(e,t){t&&t.model&&".state.hidden"==t.jpath&&t.model.get(".id")===ns.page.current.params.idDialog&&(0==this._countResourcesVisible()?this.close():this.next()),this.toggleModeSingle()},toggleModeSingle:function(){this.$node.toggleClass("b-slider_single",this.isModeSingle())},_countResourcesVisible:function(){return n.filter(this.resources.models,t).length},calculateViewport:function(){return{width:this.$viewport.width(),height:this.$viewport.height()}},changeStateSlider:function(){this.stateSlider.set(".viewport",this.calculateViewport())}}});var o={27:"close",39:"next",37:"prev",32:"next"}},{consts:7,"helpers/metrika":17,"helpers/page":19,"helpers/path":20,"models/resources/resources":147,"models/state-slider/state-slider":170,underscore:2}],291:[function(e){e("models/space/offer-space");var t=e("helpers/metrika");ns.View.define("offerSpace",{models:["offerSpace"],events:{"ns-view-show":"onshow","ns-view-htmldestroy":"onhtmldestroy"},methods:{onshow:function(){t.hooks.execute(this,"show")},onhtmldestroy:function(){t.hooks.drop(this)}}})},{"helpers/metrika":17,"models/space/offer-space":157}],292:[function(e){e("models/space/offers-space-free"),e("views/space/offer-space"),ns.ViewCollection.define("offersSpaceFree",{models:["offersSpaceFree"],split:{intoViews:"offerSpace",byModel:"offersSpaceFree"}})},{"models/space/offers-space-free":158,"views/space/offer-space":291}],293:[function(e){e("models/space/package-space"),e("models/space/state-package-space"),e("models/space/offers-space-paid"),e("models/space/offer-space");var t=e("helpers/page"),n=e("helpers/metrika"),r=e("underscore");ns.View.define("packageSpace",{models:["statePackageSpace","packageSpace","offersSpacePaid","space"],events:{"ns-view-init":"oninit","ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"onshow"},methods:{oninit:function(){ns.Model.get("statePackageSpace",this.params).setDataDefault()},onhtmlinit:function(){r.bindAll(this,"prolong","cancel","changeMethod","changeSpace","togglePopupState","updateLoading","removeError");var e=this.node.querySelector(".js-popup-prolong-toggler");if(e){this.popupProlong=nb.find($(e).data("nb-popup-toggler").id);var n=this.popupProlong.node.querySelector(".js-payment-prolong");this.nbButtonProlong=nb.block(n),$(n).on("click",this.prolong),$(n).on("tap",this.prolong),this.popupProlong.on("close",this.removeError)}var s=this.node.querySelector(".js-popup-repeat-toggler");s&&(this.popupRepeat=nb.find($(s).data("nb-popup-toggler").id),this.popupRepeat&&(this.$popupRepeat=$(this.popupRepeat.node),this.$popupRepeat.on("click",".js-payment-cancel",this.cancel),this.$popupRepeat.on("tap",".js-payment-cancel",this.cancel),this.popupRepeat.on("close",this.removeError)));var a=this.node.querySelector(".js-popup-rejected-toggler");a&&(this.popupRejected=nb.find($(a).data("nb-popup-toggler").id),this.popupRejected&&$(this.popupRejected.node).on("click",".js-payment-change-method",this.changeMethod)),this.models.packageSpace.on("ns-model-changed",t.update),this.models.space.on("ns-model-changed",this.changeSpace),this.models.statePackageSpace.on("ns-model-changed.error",this.togglePopupState),this.models.statePackageSpace.on("ns-model-changed.loading",this.updateLoading)},onshow:function(){n.hooks.execute(this,"show")},onhtmldestroy:function(){this.models.packageSpace.off("ns-model-changed",t.update),this.models.space.on("ns-model-changed",this.changeSpace),n.hooks.drop(this)},prolong:function(){ns.action.run("payment.prolong",{method:this.popupProlong.node.querySelector(".js-method-prolong input:checked").value,sid:this.models.packageSpace.get(".sid"),id:this.models.packageSpace.get(".id")})},cancel:function(){ns.action.run("payment.cancel",{sid:this.models.packageSpace.get(".sid"),id:this.models.packageSpace.get(".id")})},changeMethod:function(){t.go("/payment/100gb_1y"),nb.trigger("popup-close")},changeSpace:function(){!this.models.packageSpace.get(".free")&&this.models.packageSpace.get(".subscription")&&t.update()},updateLoading:function(){var e=this.models.statePackageSpace.get(".loading"),t=this.models.statePackageSpace.get(".action");"prolong"===t?e?this.nbButtonProlong.disable():this.nbButtonProlong.enable():"cancel"===t&&this.$popupRepeat&&this.$popupRepeat.toggleClass("b-pakages-received__popup_loading",e)},togglePopupState:function(){var e,t="b-pakages-received__popup_error",n=this.models.statePackageSpace.get(".error"),r=this.models.statePackageSpace.get(".action");"prolong"===r&&this.popupProlong?($(this.popupProlong.node).toggleClass(t,n),e=this.popupProlong):"cancel"===r&&this.popupRepeat&&(this.$popupRepeat.toggleClass(t,n),e=this.popupRepeat),n&&!e.where&&e.open({})},removeError:function(){this.models.statePackageSpace.set(".error",!1)}}})},{"helpers/metrika":17,"helpers/page":19,"models/space/offer-space":157,"models/space/offers-space-paid":159,"models/space/package-space":160,"models/space/state-package-space":164,underscore:2}],294:[function(e){e("models/space/packages-space-paid"),e("views/space/package-space");var t=e("underscore"),n=e("helpers/page");ns.ViewCollection.define("packagesSpacePaid",{models:["packagesSpacePaid","space"],split:{intoViews:"packageSpace",byModel:"packagesSpacePaid"},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy"},methods:{onhtmlinit:function(){t.bindAll(this,"onUpdatedPackagesSpace"),this.models.packagesSpacePaid.on("ufo-model-updated",this.onUpdatedPackagesSpace.bind(this))},onhtmldestroy:function(){this.models.packagesSpacePaid.off("ufo-model-updated",this.onUpdatedPackagesSpace.bind(this))},onUpdatedPackagesSpace:function(){this.invalidate(),n.update()}}})},{"helpers/page":19,"models/space/packages-space-paid":161,underscore:2,"views/space/package-space":293}],295:[function(e){e("models/space/packages-space"),e("views/space/package-space"),ns.ViewCollection.define("packagesSpace",{models:["packagesSpace"],split:{intoViews:"packageSpace",byModel:"packagesSpace"}})},{"models/space/packages-space":162,"views/space/package-space":293}],296:[function(e){function t(e){return r.reduce(e,n,0)}function n(e,t){return e+t}e("models/invites/invites-folder");var r=e("underscore"),s=3;ns.View.define("stickies",{events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"update","ns-view-hide":"onhide"},methods:{onhtmlinit:function(){r.bindAll(this,"onUpdateModels"),ns.Model.get("invitesFolder").on("ns-model-remove",this.onUpdateModels),ns.Model.get("invitesFolder").on("ns-model-changed",this.onUpdateModels)
},onhtmldestroy:function(){ns.Model.get("invitesFolder").off("ns-model-remove",this.onUpdateModels),ns.Model.get("invitesFolder").off("ns-model-changed",this.onUpdateModels)},onUpdateModels:function(){var e=ns.Model.get("invitesFolder").countOpen();this.count=Math.min(s,e),ns.events.trigger("ufo-layers-update",this.id,{count:this.count})},onhide:function(){ns.events.trigger("ufo-layers-update",this.id,{count:0})},countOpen:function(){var e=["invitesFolder"];return t(r.invoke(r.each(e,ns.Model.get),"countOpen"))}}})},{"models/invites/invites-folder":68,underscore:2}],297:[function(e){e("models/resource/resource"),ns.View.define("sticky-invite",{models:["resource"],events:{"click .js-sticky-close":"close"},methods:{close:function(){this.models.resource.set(".state.closed",!0)}}})},{"models/resource/resource":133}],298:[function(e){e("models/invites/invites-folder"),e("views/stickies/sticky-invite"),ns.ViewCollection.define("sticky-invites",{models:["invitesFolder"],split:{intoViews:"sticky-invite",byModel:"invitesFolder"}})},{"models/invites/invites-folder":68,"views/stickies/sticky-invite":297}],299:[function(e){e("models/settings/settings");var t=e("helpers/metrika");ns.View.define("stub",{"params+":{idContext:null},models:["settings","userCurrent"],events:{"ns-view-show":"onshow","ns-view-htmldestroy":"onhtmldestroy"},methods:{onshow:function(){t.hooks.execute(this,"show")},onhtmldestroy:function(){t.hooks.drop(this)}}})},{"helpers/metrika":17,"models/settings/settings":153}],300:[function(e){e("models/resource/resource"),e("models/states-context/states-context"),e("nanoblocks/select-radio/select-radio");var t=e("underscore"),n=e("helpers/page"),r=e("helpers/metrika");e("nanoblocks/uploader-flash/uploader-flash"),ns.View.define("toolset",{models:["statesContext","resource"],rewriteParamsOnInit:function(e){return{id:e.idContext,idContext:e.idContext,display:e.display}},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","change .js-select-view":"setView","change .js-button-upload":"selectFile"},methods:{onhtmlinit:function(){t.bindAll(this,"onUpdateModels","handleChangeSort");var e=this.node.querySelector(".js-radio-sorting");e&&(this.sorting=nb.block(e)),this.sorting&&this.sorting.on("nb-changed",this.handleChangeSort),this.models.statesContext.on("ns-model-changed.sort",this.onUpdateModels),this.models.statesContext.on("ns-model-changed.order",this.onUpdateModels),this.models.statesContext.on("ns-model-changed.view",n.update),nb.init(this.node)},onhtmldestroy:function(){this.sorting&&this.sorting.off("nb-changed",this.handleChangeSort),this.models.statesContext.off("ns-model-changed.sort",this.onUpdateModels),this.models.statesContext.off("ns-model-changed.order",this.onUpdateModels),this.models.statesContext.off("ns-model-changed.view",n.update)},handleChangeSort:function(e,t){"sort"===t.name&&(this.models.statesContext.set(".sort",t.value),r.count("interface elements","listing","set sorting",t.value,"1"===this.models.statesContext.get(".order")?"ascending":"descending")),"order"===t.name&&(this.models.statesContext.set(".order",t.value),r.count("interface elements","listing","set sorting",this.models.statesContext.get(".sort"),"1"===t.value?"ascending":"descending"))},setView:function(e){r.count("interface elements","listing","set view",e.target.value),this.models.statesContext.setView(e.target.value)},onUpdateModels:function(){this.sorting&&this.sorting.close(),n.update()},selectFile:function(e){var t={files:e.target.files};ns.action.run("resource.upload",t,this.node,e),$(e.target).val(null),r.count("actions","uploading","start upload","via button in toolbar"),n.go(n.getUrlBase()+"|upload")}}})},{"helpers/metrika":17,"helpers/page":19,"models/resource/resource":133,"models/states-context/states-context":171,"nanoblocks/select-radio/select-radio":186,"nanoblocks/uploader-flash/uploader-flash":188,underscore:2}],301:[function(e){e("models/tree/tree"),e("models/tree/state-tree"),e("nanoblocks/icon-resource/icon-resource");var t=e("helpers/page");ns.ViewCollection.define("treeMenu",{models:{tree:{"ns-model-changed":function(){this.invalidate(),t.update()}}},rewriteParamsOnInit:function(e){return e.id=e.id||"/disk",e},split:{intoViews:"treeMenu",byModel:"tree"},events:{click:"select",dblclick:"toggleSubfolders","click .js-folders-toggle":"toggleSubfolders"},methods:{toggleSubfolders:function(e){this.models.tree.toggle(),e.stopPropagation()},select:function(e){var t=this.models.tree.get(".id");"/disk"===t||this.$node.hasClass("js-disabled")||ns.Model.get("stateTree").set(".menuChosen",t),e.stopPropagation()}}})},{"helpers/page":19,"models/tree/state-tree":175,"models/tree/tree":176,"nanoblocks/icon-resource/icon-resource":182}],302:[function(e){e("models/tree/tree"),e("models/tree/state-tree"),e("models/confirmation/confirmation"),e("models/states-context/states-context"),e("nanoblocks/icon-resource/icon-resource");var t=e("underscore"),n=e("helpers/page");ns.ViewCollection.define("tree",{models:["tree","statesContext","confirmation"],rewriteParamsOnInit:function(e){return e.id=e.id||"/disk",e},split:{intoViews:"tree",byModel:"tree"},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","click .js-folders-toggle":"toggleSubfolders",dblclick:"toggleSubfolders",click:"select",tap:"select"},methods:{onhtmlinit:function(){t.bindAll(this,"updateSelected"),this.updateSelected(),this.models.tree.on("ns-model-changed",n.update),ns.Model.get("stateTree").on("ns-model-changed.selected",this.updateSelected)},onhtmldestroy:function(){this.models.tree.off("ns-model-changed",n.update),ns.Model.get("stateTree").off("ns-model-changed.selected",this.updateSelected)},updateSelected:function(){this.$node.toggleClass("b-tree__item_selected",ns.Model.get("stateTree").get(".selected")===this.params.id)},select:function(e){this.$node.hasClass("js-disabled")||ns.Model.get("stateTree").select(this.params.id),e.stopPropagation()},toggleSubfolders:function(e){this.$node.hasClass("js-disabled-subtree")||this.models.tree.toggle(),e.stopPropagation()}}})},{"helpers/page":19,"models/confirmation/confirmation":50,"models/states-context/states-context":171,"models/tree/state-tree":175,"models/tree/tree":176,"nanoblocks/icon-resource/icon-resource":182,underscore:2}],303:[function(e){e("models/users/user-folder");var t=e("helpers/page");ns.View.define("userFolder",{models:["userFolder"],events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy"},methods:{onhtmlinit:function(){this.models.userFolder.on("ns-model-changed",t.update)},onhtmldestroy:function(){this.models.userFolder.off("ns-model-changed",t.update)}}})},{"helpers/page":19,"models/users/user-folder":178}],304:[function(e){e("models/resource/resource"),e("models/users/users-folder"),e("views/users/users-folder/user-folder");var t=e("helpers/page");ns.ViewCollection.define("usersFolder",{models:["usersFolder"],rewriteParamsOnInit:function(e){var t=ns.Model.get("resource",{id:e.selected.length?e.selected[0]:ns.page.current.params.idContext});return{gidFolder:t.get(".meta.group.gid"),idFolder:t.get(".id")}},split:{intoViews:"userFolder",byModel:"usersFolder"},events:{"ns-view-htmlinit":"onhtmlinit","ns-view-htmldestroy":"onhtmldestroy","ns-view-show":"collapse","click .js-list-users-expand":"expand","click .js-list-users-collapse":"collapse"},methods:{onhtmlinit:function(){this.bindEvents()},onhtmldestroy:function(){this.unbindEvents()},bindEvents:function(){this.models.usersFolder.on("ns-model-insert",t.update),this.models.usersFolder.on("ns-model-remove",t.update),this.models.usersFolder.on("ns-model-destroyed",t.update),this.models.usersFolder.on("ns-model-changed",t.update)},unbindEvents:function(){this.models.usersFolder.off("ns-model-insert",t.update),this.models.usersFolder.off("ns-model-remove",t.update),this.models.usersFolder.off("ns-model-destroyed",t.update),this.models.usersFolder.off("ns-model-changed",t.update)},expand:function(){$(this.node).removeClass("list-users_collapsed");var e=$(this.node).height();this._$window.scrollTop(e)},collapse:function(){$(this.node).addClass("list-users_collapsed")}}})},{"helpers/page":19,"models/resource/resource":133,"models/users/users-folder":179,"views/users/users-folder/user-folder":303}],305:[function(e,t){e("underscore");var n=e("helpers/page"),r=t.exports=function(){};no.inherit(r,ns.View,{_htmlinit:function(){ns.View.prototype._htmlinit.apply(this,arguments),n.update()}}),r.define=function(e,t){return ns.View.define(e,t,r)}},{"helpers/page":19,underscore:2}]},{},[4]),__i18n__={},__i18n__.i18n=__i18n__.i18n||{},__i18n__.i18n.convert=function(e,t){var n=e.length;if(4==n&&1==t)return e[0];var r=t%100,s=t%10,a=2;return r>10&&20>=r?a=2:1==s?a=0:s>1&&5>s&&(a=1),4==n&&a++,e[a]},__i18n__.i18n["if"]=function(e,t,n){return e?t:n},__i18n__.i18n.index=function(e,t){return e[+t]},__i18n__.i18n.plural=function(e,t,n){return e>1?t:n};